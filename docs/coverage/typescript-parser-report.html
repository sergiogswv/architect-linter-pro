<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>:root {
  --color: black;
  --bg: white;
  --head-bg: white;
  --link: #338;

  --blue: #ccf;
  --red: #fcc;
  --yellow: #ffc;
  --green: #cfc;
}

[data-theme='dark'] {
  --color: white;
  --bg: black;
  --head-bg: #333;
  --link: #aaf;

  --blue: #225;
  --red: #522;
  --yellow: #552;
  --green: #252;
}

html,
body {
  margin: 0;
  padding: 0;
  color: var(--color);
  background: var(--bg);
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: var(--head-bg);
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: var(--blue);
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: var(--red);
}
.files-list__file_medium {
  background: var(--yellow);
}
.files-list__file_high {
  background: var(--green);
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: var(--bg);
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: var(--link);
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
  content: counter(line);
  margin-right: 72px;
}
.code-line {
  margin: 0;
  height: 1em;
  counter-increment: line;

  position: absolute;
  padding: 0 0.3em 0.3em 0.3em;
  display: inherit;
  width: 100%;
}
.code-line_covered {
  background: var(--green);
}
.code-line_uncovered {
  background: var(--red);
}

.code-text-container {
  position: relative;
  height: 1em;
  padding: 0.3em 0;
}

.cover-indicator {
  display: flex;
  width: 100%;
  position: absolute;
  justify-content: end;
  height: 1em;
  align-items: center;
  padding: 0 0.3em 0.3em 0.3em;
}

.cover-indicator.check-cover::after {
  content: "\2713";
  font-weight: bold;
  background-color: var(--green);
  height: 1em;
}

.cover-indicator.no-cover::after {
  content: "\2716";
  font-weight: bold;
  background-color: var(--red);
  height: 1em;
}

.stat-line-hit {
  max-width: 48px;
  overflow: hidden;
  font-weight: bold;
  margin-right: 4px;
  background-color: var(--green);
  position: relative;
  top: 0.1em;
}

#theme-toggle-label {
  margin-left: 1ch;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","protec","Documentos","dev","architect-linter-pro","benches","parsing_bench.rs"],"content":"//! Parsing performance benchmarks for Architect Linter Pro\n//!\n//! This module benchmarks the parsing performance for different file counts.\n//! It establishes performance baselines for detecting regressions.\n//!\n//! Run with: cargo bench --bench parsing_bench\n\nuse architect_linter_pro::analyzer::swc_parser;\nuse architect_linter_pro::config::{ArchPattern, Framework, LinterContext};\nuse criterion::{black_box, criterion_group, criterion_main, BenchmarkId, Criterion};\nuse std::path::{Path, PathBuf};\nuse swc_common::sync::Lrc;\nuse swc_common::SourceMap;\nuse tempfile::TempDir;\n\n/// Sample TypeScript code for benchmarking\nconst TS_CODE: \u0026str = r#\"\nexport class Service {\n    constructor(private id: number) {}\n\n    getData(): Data {\n        return new Data();\n    }\n\n    processData(input: string): number {\n        let result = 0;\n        for (let i = 0; i \u003c input.length; i++) {\n            result += input.charCodeAt(i);\n        }\n        return result;\n    }\n}\n\nexport class Data {\n    constructor() {}\n\n    validate(): boolean {\n        return true;\n    }\n\n    transform(value: string): string {\n        return value.trim().toLowerCase();\n    }\n}\n\nexport class Controller {\n    constructor(private service: Service) {}\n\n    handleRequest(input: string): number {\n        const data = this.service.getData();\n        return this.service.processData(input);\n    }\n}\n\"#;\n\n/// Create TypeScript files for benchmarking\nfn create_ts_files(n: usize, temp_dir: \u0026Path) {\n    for i in 0..n {\n        let file_path = temp_dir.join(format!(\"test{}.ts\", i));\n        std::fs::write(\u0026file_path, TS_CODE).unwrap();\n    }\n}\n\n/// Create a test LinterContext for benchmarking\nfn create_test_context() -\u003e LinterContext {\n    LinterContext {\n        max_lines: 50,\n        framework: Framework::Unknown,\n        pattern: ArchPattern::MVC,\n        forbidden_imports: vec![],\n        ignored_paths: vec![],\n        ai_configs: vec![],\n    }\n}\n\n/// Benchmark parsing 10 files\nfn bench_parse_10_files(c: \u0026mut Criterion) {\n    let temp_dir = TempDir::new().unwrap();\n    create_ts_files(10, temp_dir.path());\n    let parser_context = create_test_context();\n    let cm = Lrc::new(SourceMap::default());\n    let files: Vec\u003cPathBuf\u003e = (0..10)\n        .map(|i| temp_dir.path().join(format!(\"test{}.ts\", i)))\n        .collect();\n\n    c.bench_function(\"parse_10_files\", |b| {\n        b.iter(|| {\n            for file in \u0026files {\n                black_box(\n                    swc_parser::analyze_file(\u0026cm, file, \u0026parser_context)\n                        .unwrap_or_else(|e| panic!(\"Parse failed: {}\", e)),\n                );\n            }\n        });\n    });\n}\n\n/// Benchmark parsing 100 files\nfn bench_parse_100_files(c: \u0026mut Criterion) {\n    let temp_dir = TempDir::new().unwrap();\n    create_ts_files(100, temp_dir.path());\n    let parser_context = create_test_context();\n    let cm = Lrc::new(SourceMap::default());\n    let files: Vec\u003cPathBuf\u003e = (0..100)\n        .map(|i| temp_dir.path().join(format!(\"test{}.ts\", i)))\n        .collect();\n\n    c.bench_function(\"parse_100_files\", |b| {\n        b.iter(|| {\n            for file in \u0026files {\n                black_box(\n                    swc_parser::analyze_file(\u0026cm, file, \u0026parser_context)\n                        .unwrap_or_else(|e| panic!(\"Parse failed: {}\", e)),\n                );\n            }\n        });\n    });\n}\n\n/// Benchmark parsing with different file counts\nfn bench_parse_scaling(c: \u0026mut Criterion) {\n    let mut group = c.benchmark_group(\"parse_scaling\");\n    let file_counts = vec![10, 50, 100];\n\n    for file_count in file_counts {\n        let temp_dir = TempDir::new().unwrap();\n        create_ts_files(file_count, temp_dir.path());\n        let parser_context = create_test_context();\n        let cm = Lrc::new(SourceMap::default());\n        let files: Vec\u003cPathBuf\u003e = (0..file_count)\n            .map(|i| temp_dir.path().join(format!(\"test{}.ts\", i)))\n            .collect();\n\n        group.bench_with_input(\n            BenchmarkId::from_parameter(file_count),\n            \u0026file_count,\n            |b, \u0026_file_count| {\n                b.iter(|| {\n                    for file in \u0026files {\n                        black_box(\n                            swc_parser::analyze_file(\u0026cm, file, \u0026parser_context)\n                                .unwrap_or_else(|e| panic!(\"Parse failed: {}\", e)),\n                        );\n                    }\n                });\n            },\n        );\n\n        drop(temp_dir);\n    }\n\n    group.finish();\n}\n\ncriterion_group!(\n    benches,\n    bench_parse_10_files,\n    bench_parse_100_files,\n    bench_parse_scaling\n);\ncriterion_main!(benches);\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","benches","performance_bench.rs"],"content":"//! Performance benchmarks for Architect Linter Pro\n//!\n//! This module benchmarks key performance characteristics:\n//! - Parallel vs sequential file analysis\n//! - Cache hit/miss performance\n//!\n//! Run with: cargo bench\n\nuse criterion::{black_box, criterion_group, criterion_main, BenchmarkId, Criterion};\nuse std::fs;\nuse std::path::{Path, PathBuf};\nuse std::sync::Arc;\nuse std::time::Instant;\nuse tempfile::TempDir;\n\n// Import our modules for benchmarking\nuse architect_linter_pro::analyzer::collector::analyze_all_files;\nuse architect_linter_pro::cache::{AnalysisCache, FileCacheEntry};\nuse architect_linter_pro::config::{\n    AIConfig, ArchPattern, ForbiddenRule, Framework, LinterContext,\n};\nuse architect_linter_pro::discovery;\nuse architect_linter_pro::memory_cache::MemoryCache;\nuse swc_common::sync::Lrc;\nuse swc_common::SourceMap;\n\n/// Create a temporary directory with test TypeScript/JavaScript files\nfn create_test_files(count: usize, avg_lines: usize) -\u003e TempDir {\n    let temp_dir = TempDir::new().unwrap();\n    let _files = (0..count)\n        .map(|i| {\n            let file_path = temp_dir.path().join(format!(\"file_{}.ts\", i));\n            let content = generate_ts_file(avg_lines, i);\n            fs::write(\u0026file_path, content).unwrap();\n            file_path\n        })\n        .collect::\u003cVec\u003cPathBuf\u003e\u003e();\n\n    temp_dir\n}\n\n/// Generate a TypeScript file with specified number of lines\nfn generate_ts_file(lines: usize, file_index: usize) -\u003e String {\n    let mut content = String::new();\n    content.push_str(\u0026format!(\"// File {} with {} lines\\n\", file_index, lines));\n\n    if lines \u003e 10 {\n        content.push_str(\"import { Component, Injectable } from '@angular/core';\\n\");\n        content.push_str(\"import { UserService } from './user.service';\\n\\n\");\n    }\n\n    for i in 0..(lines / 5) {\n        content.push_str(\u0026format!(\"export class Component{} {{\\n\", i));\n        content.push_str(\"  constructor(private service: UserService) {}\\n\");\n        content.push_str(\"\\n  public method1() {\\n\");\n        content.push_str(\"    return this.service.getData();\\n\");\n        content.push_str(\"  }\\n\\n\");\n        content.push_str(\"  public method2() {\\n\");\n        content.push_str(\"    const data = [];\\n\");\n        for j in 0..10 {\n            content.push_str(\u0026format!(\"    data.push('item{}');\\n\", j));\n        }\n        content.push_str(\"    return data;\\n\");\n        content.push_str(\"  }\\n\");\n        content.push_str(\"}\\n\\n\");\n    }\n\n    content\n}\n\n/// Setup function for benchmarks\nfn setup_linter_context() -\u003e LinterContext {\n    LinterContext {\n        max_lines: 50,\n        framework: Framework::Unknown,\n        pattern: ArchPattern::Clean,\n        forbidden_imports: vec![ForbiddenRule {\n            from: \"*\".to_string(),\n            to: \"app/components\".to_string(),\n        }],\n        ignored_paths: vec![],\n        ai_configs: vec![],\n    }\n}\n\n/// Benchmark parallel vs sequential file analysis\nfn bench_sequential_vs_parallel(c: \u0026mut Criterion) {\n    let file_counts = vec![10, 50, 100];\n    let ctx = setup_linter_context();\n\n    for file_count in file_counts {\n        let temp_dir = create_test_files(file_count, 20);\n        let files: Vec\u003cPathBuf\u003e = (0..file_count)\n            .map(|i| temp_dir.path().join(format!(\"file_{}.ts\", i)))\n            .collect();\n\n        // Parallel analysis (current implementation)\n        let mut par_group = c.benchmark_group(\"parallel_analysis\");\n\n        par_group.bench_with_input(\n            BenchmarkId::new(\"parallel\", file_count),\n            \u0026(\u0026files, \u0026temp_dir.path(), \u0026ctx),\n            |b, \u0026(ref files, ref project_root, ref ctx)| {\n                let cm = Lrc::new(SourceMap::default());\n                b.iter(|| {\n                    black_box(analyze_all_files(\n                        files,\n                        project_root,\n                        ctx.pattern.clone(),\n                        ctx,\n                        \u0026cm,\n                        Some(\u0026mut AnalysisCache::new(\"test_config_hash\".to_string())),\n                    ))\n                    .unwrap();\n                });\n            },\n        );\n        par_group.finish();\n\n        // Drop temp directory after benchmark\n        drop(temp_dir);\n    }\n}\n\n/// Benchmark cache performance - hit vs miss\nfn bench_cache_performance(c: \u0026mut Criterion) {\n    let temp_dir = create_test_files(50, 20);\n    let files: Vec\u003cPathBuf\u003e = (0..50)\n        .map(|i| temp_dir.path().join(format!(\"file_{}.ts\", i)))\n        .collect();\n\n    let ctx = setup_linter_context();\n    let project_root = temp_dir.path();\n\n    // Create and populate cache\n    let cache_key = \"test\".to_string();\n    let mut cache = AnalysisCache::new(\"test_config_hash\".to_string());\n\n    // Pre-populate cache with some entries\n    for i in 0..25 {\n        let file_path = project_root.join(format!(\"file_{}.ts\", i));\n        let content = fs::read(\u0026file_path).unwrap();\n        let content_hash = architect_linter_pro::cache::hash_content(\u0026content);\n\n        cache.insert(\n            architect_linter_pro::cache::AnalysisCache::normalize_path(\u0026file_path, project_root),\n            FileCacheEntry {\n                content_hash,\n                violations: vec![],\n                long_functions: vec![],\n                import_count: 5,\n                function_count: 10,\n            },\n        );\n    }\n\n    // Benchmark cache hits\n    let mut cache_hit_group = c.benchmark_group(\"cache_hits\");\n\n    cache_hit_group.bench_function(\"cache_hit\", |b| {\n        b.iter(|| {\n            // Hit the cache for existing files\n            for i in 0..25 {\n                let file_path = project_root.join(format!(\"file_{}.ts\", i));\n                let normalized_key = architect_linter_pro::cache::AnalysisCache::normalize_path(\n                    \u0026file_path,\n                    project_root,\n                );\n                let content_hash = format!(\"{:016x}\", i as u64); // Simulated content hash\n\n                black_box(cache.get(\u0026normalized_key, \u0026content_hash));\n            }\n        });\n    });\n    cache_hit_group.finish();\n\n    // Benchmark cache misses\n    let mut cache_miss_group = c.benchmark_group(\"cache_misses\");\n\n    cache_miss_group.bench_function(\"cache_miss\", |b| {\n        b.iter(|| {\n            // Try to get non-existent files\n            for i in 25..50 {\n                let file_path = project_root.join(format!(\"file_{}.ts\", i));\n                let normalized_key = architect_linter_pro::cache::AnalysisCache::normalize_path(\n                    \u0026file_path,\n                    project_root,\n                );\n                let content_hash = format!(\"{:016x}\", i as u64);\n\n                black_box(cache.get(\u0026normalized_key, \u0026content_hash));\n            }\n        });\n    });\n    cache_miss_group.finish();\n\n    // Benchmark memory cache performance\n    let mut mem_cache_group = c.benchmark_group(\"memory_cache\");\n\n    let memory_cache = Arc::new(MemoryCache::new(100));\n\n    // Populate memory cache\n    for i in 0..50 {\n        let file_path = project_root.join(format!(\"file_{}.ts\", i));\n        memory_cache.put(file_path, format!(\"hash_{}\", i));\n    }\n\n    mem_cache_group.bench_function(\"memory_cache_get\", |b| {\n        b.iter(|| {\n            for i in 0..50 {\n                let file_path = project_root.join(format!(\"file_{}.ts\", i));\n                black_box(memory_cache.get(\u0026file_path));\n            }\n        });\n    });\n    mem_cache_group.finish();\n\n    // Drop temp directory\n    drop(temp_dir);\n}\n\n/// Benchmark memory usage with different file counts\nfn bench_memory_usage(c: \u0026mut Criterion) {\n    let mut memory_group = c.benchmark_group(\"memory_usage\");\n\n    let file_counts = vec![10, 25, 50];\n\n    for file_count in file_counts {\n        memory_group.bench_with_input(\n            BenchmarkId::new(\"analyze_files\", file_count),\n            \u0026file_count,\n            |b, \u0026file_count| {\n                let temp_dir = create_test_files(file_count, 20);\n                let files: Vec\u003cPathBuf\u003e = (0..file_count)\n                    .map(|i| temp_dir.path().join(format!(\"file_{}.ts\", i)))\n                    .collect();\n\n                let ctx = setup_linter_context();\n                let project_root = temp_dir.path();\n\n                b.iter(|| {\n                    let start = Instant::now();\n                    let result = analyze_all_files(\n                        \u0026files,\n                        project_root,\n                        ctx.pattern.clone(),\n                        \u0026ctx,\n                        \u0026Lrc::new(SourceMap::default()),\n                        Some(\u0026mut AnalysisCache::new(\"test_config_hash\".to_string())),\n                    )\n                    .unwrap();\n                    let duration = start.elapsed();\n\n                    // Include result size in benchmark to prevent optimization\n                    black_box(result);\n                    black_box(duration);\n                });\n\n                drop(temp_dir);\n            },\n        );\n    }\n\n    memory_group.finish();\n}\n\ncriterion_group!(\n    benches,\n    bench_sequential_vs_parallel,\n    bench_cache_performance,\n    bench_memory_usage\n);\ncriterion_main!(benches);\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","ai.rs"],"content":"use crate::config::{AIConfig, AIProvider};\nuse serde::{Deserialize, Serialize};\n\n// Estructuras para el mapeo de la respuesta de la IA\n#[derive(Deserialize, Serialize, Debug)]\npub struct AISuggestionResponse {\n    pub pattern: String,\n    pub suggested_max_lines: usize,\n    pub rules: Vec\u003cSuggestedRule\u003e,\n}\n\n#[derive(Deserialize, Serialize, Debug, Clone)]\npub struct SuggestedRule {\n    pub from: String,\n    pub to: String,\n    pub reason: String,\n}\n\n/// Obtiene la lista de modelos disponibles para el proveedor configurado\npub fn obtener_modelos_disponibles(\n    provider: \u0026AIProvider,\n    api_url: \u0026str,\n    api_key: \u0026str,\n) -\u003e anyhow::Result\u003cVec\u003cString\u003e\u003e {\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let url = api_url.trim_end_matches('/');\n\n        match provider {\n            AIProvider::Claude =\u003e {\n                let response = client\n                    .get(format!(\"{}/v1/models\", url))\n                    .header(\"x-api-key\", api_key)\n                    .header(\"anthropic-version\", \"2023-06-01\")\n                    .send()\n                    .await?;\n\n                let json: serde_json::Value = response.json().await?;\n                let models = json[\"data\"]\n                    .as_array()\n                    .ok_or_else(|| anyhow::anyhow!(\"Respuesta de Claude inválida\"))?\n                    .iter()\n                    .filter_map(|m| m[\"id\"].as_str().map(|s| s.to_string()))\n                    .collect();\n                Ok(models)\n            }\n            AIProvider::Gemini =\u003e {\n                let response = client\n                    .get(format!(\"{}/v1beta/models?key={}\", url, api_key))\n                    .send()\n                    .await?;\n\n                let json: serde_json::Value = response.json().await?;\n                let models = json[\"models\"]\n                    .as_array()\n                    .ok_or_else(|| anyhow::anyhow!(\"Respuesta de Gemini inválida\"))?\n                    .iter()\n                    .filter_map(|m| {\n                        m[\"name\"]\n                            .as_str()\n                            .map(|s| s.trim_start_matches(\"models/\").to_string())\n                    })\n                    .collect();\n                Ok(models)\n            }\n            AIProvider::OpenAI\n            | AIProvider::Groq\n            | AIProvider::Ollama\n            | AIProvider::Kimi\n            | AIProvider::DeepSeek =\u003e {\n                let mut request = client.get(format!(\"{}/models\", url));\n                if !api_key.is_empty() {\n                    request = request.header(\"authorization\", format!(\"Bearer {}\", api_key));\n                }\n\n                let response = request.send().await?;\n                let json: serde_json::Value = response.json().await?;\n                let models = json[\"data\"]\n                    .as_array()\n                    .ok_or_else(|| anyhow::anyhow!(\"Respuesta de API compatible inválida\"))?\n                    .iter()\n                    .filter_map(|m| m[\"id\"].as_str().map(|s| s.to_string()))\n                    .collect();\n                Ok(models)\n            }\n        }\n    })\n}\n\n/// Función para consultar la IA seleccionada de forma genérica\npub fn consultar_ia(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    match ai_config.provider {\n        AIProvider::Claude =\u003e consultar_claude(prompt, ai_config),\n        AIProvider::Gemini =\u003e consultar_gemini(prompt, ai_config),\n        AIProvider::OpenAI | AIProvider::Groq | AIProvider::Ollama | AIProvider::Kimi =\u003e {\n            consultar_openai_compatible(prompt, ai_config)\n        }\n        AIProvider::DeepSeek =\u003e consultar_openai_compatible(prompt, ai_config),\n    }\n}\n\n/// Orquestador que intenta consultar varias IAs en orden hasta que una funcione\npub fn consultar_ia_con_fallback(prompt: String, configs: \u0026[AIConfig]) -\u003e anyhow::Result\u003cString\u003e {\n    if configs.is_empty() {\n        return Err(anyhow::anyhow!(\"No hay configuraciones de IA disponibles. Ejecuta el linter sin architect.json para configurar una.\"));\n    }\n\n    let mut last_error = anyhow::anyhow!(\"Error desconocido\");\n\n    for (i, config) in configs.iter().enumerate() {\n        if i \u003e 0 {\n            println!(\n                \"\\n⚠️  El modelo '{}' falló. Intentando con el siguiente configurado: '{}'...\",\n                configs[i - 1].name,\n                config.name\n            );\n        }\n\n        match consultar_ia(prompt.clone(), config.clone()) {\n            Ok(res) =\u003e {\n                if i \u003e 0 {\n                    println!(\"✅ El modelo '{}' respondió correctamente.\\n\", config.name);\n                }\n                return Ok(res);\n            }\n            Err(e) =\u003e {\n                println!(\"❌ Error en '{}': {}\", config.name, e);\n                last_error = e;\n            }\n        }\n    }\n\n    Err(anyhow::anyhow!(\n        \"❌ Todos los modelos configurados fallaron. Último error: {}\",\n        last_error\n    ))\n}\n\n/// Función exclusiva para el Linter: Sugiere la arquitectura inicial\npub fn sugerir_arquitectura_inicial(\n    context: crate::discovery::ProjectContext,\n    ai_configs: Vec\u003cAIConfig\u003e,\n) -\u003e anyhow::Result\u003cAISuggestionResponse\u003e {\n    let prompt = format!(\n        \"Eres un Arquitecto de Software Senior. Analiza este proyecto {framework} con las siguientes dependencias: {deps:?}\n        y esta estructura de carpetas: {files:?}.\n        Además, estos son los archivos arquitectónicos clave del proyecto: {key_files:?}.\n\n        TAREA:\n        Identifica el patrón (Hexagonal, Clean o MVC) y sugiere reglas de importaciones prohibidas basándote en las mejores prácticas.\n        Usa los archivos arquitectónicos clave para entender mejor la estructura del proyecto (ej: user.controller.ts, auth_service.py indican convenciones de nomenclatura).\n\n        RESPONDE EXCLUSIVAMENTE EN FORMATO JSON con esta estructura:\n        {{\n          \\\"pattern\\\": \\\"Nombre del patrón\\\",\n          \\\"suggested_max_lines\\\": 60,\n          \\\"rules\\\": [\n            {{ \\\"from\\\": \\\"patrón_origen\\\", \\\"to\\\": \\\"patrón_prohibido\\\", \\\"reason\\\": \\\"explicación corta\\\" }}\n          ]\n        }}\",\n        framework = context.framework,\n        deps = context.dependencies,\n        files = context.folder_structure,\n        key_files = context.key_files\n    );\n\n    // Obtener respuesta con fallback\n    let response_text = consultar_ia_con_fallback(prompt, \u0026ai_configs)?;\n\n    // Limpiar el JSON de posibles textos adicionales de la IA\n    let json_start = response_text\n        .find('{')\n        .ok_or_else(|| anyhow::anyhow!(\"No se encontró JSON en la respuesta\"))?;\n    let json_end = response_text\n        .rfind('}')\n        .ok_or_else(|| anyhow::anyhow!(\"No se encontró JSON en la respuesta\"))?;\n    let clean_json = \u0026response_text[json_start..=json_end];\n\n    let suggestion: AISuggestionResponse = serde_json::from_str(clean_json)?;\n    Ok(suggestion)\n}\n\n/// Consulta la API de Claude (Anthropic)\nfn consultar_claude(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    let url = format!(\"{}/v1/messages\", ai_config.api_url.trim_end_matches('/'));\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let body = serde_json::json!({\n            \"model\": ai_config.model,\n            \"max_tokens\": 1024,\n            \"messages\": [{\n                \"role\": \"user\",\n                \"content\": prompt\n            }]\n        });\n\n        let response = client\n            .post(\u0026url)\n            .header(\"x-api-key\", \u0026ai_config.api_key)\n            .header(\"anthropic-version\", \"2023-06-01\")\n            .header(\"content-type\", \"application/json\")\n            .json(\u0026body)\n            .send()\n            .await?;\n\n        procesar_respuesta(response).await\n    })\n}\n\n/// Consulta la API de Gemini (Google)\nfn consultar_gemini(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    let url = format!(\n        \"{}/v1beta/models/{}:generateContent?key={}\",\n        ai_config.api_url.trim_end_matches('/'),\n        ai_config.model,\n        ai_config.api_key\n    );\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let body = serde_json::json!({\n            \"contents\": [{\n                \"parts\": [{\n                    \"text\": prompt\n                }]\n            }]\n        });\n\n        let response = client\n            .post(\u0026url)\n            .header(\"content-type\", \"application/json\")\n            .json(\u0026body)\n            .send()\n            .await?;\n\n        let status = response.status();\n        let response_text = response.text().await?;\n\n        if !status.is_success() {\n            return Err(anyhow::anyhow!(\n                \"Error Gemini ({}): {}\",\n                status,\n                response_text\n            ));\n        }\n\n        let json: serde_json::Value = serde_json::from_str(\u0026response_text)?;\n        let content = json[\"candidates\"][0][\"content\"][\"parts\"][0][\"text\"]\n            .as_str()\n            .ok_or_else(|| anyhow::anyhow!(\"No se pudo extraer texto de Gemini\"))?;\n\n        Ok(content.to_string())\n    })\n}\n\n/// Consulta APIs compatibles con OpenAI (OpenAI, Groq, Ollama)\nfn consultar_openai_compatible(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    let url = format!(\n        \"{}/chat/completions\",\n        ai_config.api_url.trim_end_matches('/')\n    );\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let body = serde_json::json!({\n            \"model\": ai_config.model,\n            \"messages\": [\n                {\"role\": \"system\", \"content\": \"Eres un Arquitecto de Software Senior.\"},\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            \"temperature\": 0.1\n        });\n\n        let mut request = client.post(\u0026url).header(\"content-type\", \"application/json\");\n\n        if !ai_config.api_key.is_empty() {\n            request = request.header(\"authorization\", format!(\"Bearer {}\", ai_config.api_key));\n        }\n\n        let response = request.json(\u0026body).send().await?;\n\n        let status = response.status();\n        let response_text = response.text().await?;\n\n        if !status.is_success() {\n            return Err(anyhow::anyhow!(\"Error API ({}): {}\", status, response_text));\n        }\n\n        let json: serde_json::Value = serde_json::from_str(\u0026response_text)?;\n        let content = json[\"choices\"][0][\"message\"][\"content\"]\n            .as_str()\n            .ok_or_else(|| anyhow::anyhow!(\"No se pudo extraer texto de la respuesta\"))?;\n\n        Ok(content.to_string())\n    })\n}\n\nasync fn procesar_respuesta(response: reqwest::Response) -\u003e anyhow::Result\u003cString\u003e {\n    let status = response.status();\n    let response_text = response.text().await?;\n\n    if !status.is_success() {\n        return Err(anyhow::anyhow!(\"Error API ({}): {}\", status, response_text));\n    }\n\n    let json: serde_json::Value = serde_json::from_str(\u0026response_text)?;\n\n    // Claude format\n    if let Some(content) = json[\"content\"][0][\"text\"].as_str() {\n        return Ok(content.to_string());\n    }\n\n    Ok(response_text)\n}\n","traces":[{"line":20,"address":[24898304,24898771,24898777],"length":1,"stats":{"Line":0}},{"line":25,"address":[24898362],"length":1,"stats":{"Line":0}},{"line":27,"address":[24898628],"length":1,"stats":{"Line":0}},{"line":28,"address":[25054514,25054791],"length":1,"stats":{"Line":0}},{"line":29,"address":[25054906,25054794],"length":1,"stats":{"Line":0}},{"line":31,"address":[25054913],"length":1,"stats":{"Line":0}},{"line":33,"address":[25057488,25055497,25057003,25054964,25057064,25057137],"length":1,"stats":{"Line":0}},{"line":34,"address":[25054979,25055174],"length":1,"stats":{"Line":0}},{"line":35,"address":[25055333],"length":1,"stats":{"Line":0}},{"line":36,"address":[25055383],"length":1,"stats":{"Line":0}},{"line":37,"address":[25055435],"length":1,"stats":{"Line":0}},{"line":38,"address":[24174959],"length":1,"stats":{"Line":0}},{"line":40,"address":[25058477,25057400,25057306,25057515,25054623],"length":1,"stats":{"Line":0}},{"line":41,"address":[25057916,25058173,25058084],"length":1,"stats":{"Line":0}},{"line":42,"address":[25058014],"length":1,"stats":{"Line":0}},{"line":43,"address":[25058157,25058041,25061888,25061892],"length":1,"stats":{"Line":0}},{"line":44,"address":[25058261],"length":1,"stats":{"Line":0}},{"line":45,"address":[25062486,25062272,25062464,25062307,25058304],"length":1,"stats":{"Line":0}},{"line":46,"address":[25058347],"length":1,"stats":{"Line":0}},{"line":47,"address":[25058366],"length":1,"stats":{"Line":0}},{"line":50,"address":[25058718,25058779,25059203,25055848,25055017,25058852],"length":1,"stats":{"Line":0}},{"line":51,"address":[25055032,25055600],"length":1,"stats":{"Line":0}},{"line":52,"address":[25055786],"length":1,"stats":{"Line":0}},{"line":53,"address":[24175003],"length":1,"stats":{"Line":0}},{"line":55,"address":[24175025],"length":1,"stats":{"Line":0}},{"line":56,"address":[25059888,25059799,25059631],"length":1,"stats":{"Line":0}},{"line":57,"address":[25059729],"length":1,"stats":{"Line":0}},{"line":58,"address":[25059756,25062116,25062112,25059872],"length":1,"stats":{"Line":0}},{"line":59,"address":[25059976],"length":1,"stats":{"Line":0}},{"line":60,"address":[25062176,25060019],"length":1,"stats":{"Line":0}},{"line":61,"address":[25062211],"length":1,"stats":{"Line":0}},{"line":62,"address":[25062239],"length":1,"stats":{"Line":0}},{"line":63,"address":[25062368,25062253,25062416],"length":1,"stats":{"Line":0}},{"line":65,"address":[25060062],"length":1,"stats":{"Line":0}},{"line":66,"address":[25060081],"length":1,"stats":{"Line":0}},{"line":73,"address":[25055090,25055943],"length":1,"stats":{"Line":0}},{"line":74,"address":[25056183,25056616,25056106],"length":1,"stats":{"Line":0}},{"line":75,"address":[25056621,25056197,25056358],"length":1,"stats":{"Line":0}},{"line":78,"address":[24175047],"length":1,"stats":{"Line":0}},{"line":79,"address":[24175069],"length":1,"stats":{"Line":0}},{"line":80,"address":[25061506,25061285,25061429],"length":1,"stats":{"Line":0}},{"line":81,"address":[25061377],"length":1,"stats":{"Line":0}},{"line":82,"address":[25061956,25061490,25061952,25061398],"length":1,"stats":{"Line":0}},{"line":83,"address":[25061582],"length":1,"stats":{"Line":0}},{"line":84,"address":[25062534,25062051,25062016,25061613,25062512],"length":1,"stats":{"Line":0}},{"line":85,"address":[25061644],"length":1,"stats":{"Line":0}},{"line":86,"address":[25061663],"length":1,"stats":{"Line":0}},{"line":93,"address":[24892688],"length":1,"stats":{"Line":0}},{"line":94,"address":[24892714],"length":1,"stats":{"Line":0}},{"line":95,"address":[24892755],"length":1,"stats":{"Line":0}},{"line":96,"address":[24892830],"length":1,"stats":{"Line":0}},{"line":98,"address":[24892923],"length":1,"stats":{"Line":0}},{"line":100,"address":[24893013],"length":1,"stats":{"Line":0}},{"line":105,"address":[24895168,24896940,24897341],"length":1,"stats":{"Line":0}},{"line":106,"address":[24895338,24895253],"length":1,"stats":{"Line":0}},{"line":107,"address":[24895379,24897269],"length":1,"stats":{"Line":0}},{"line":110,"address":[24895344,24895433],"length":1,"stats":{"Line":0}},{"line":112,"address":[24895598,24897204,24895511],"length":1,"stats":{"Line":0}},{"line":113,"address":[24895832],"length":1,"stats":{"Line":0}},{"line":114,"address":[24896255,24896124],"length":1,"stats":{"Line":0}},{"line":121,"address":[24896396,24896097,24897231],"length":1,"stats":{"Line":0}},{"line":122,"address":[24896628],"length":1,"stats":{"Line":0}},{"line":123,"address":[24896676],"length":1,"stats":{"Line":0}},{"line":124,"address":[24896772,24896843],"length":1,"stats":{"Line":0}},{"line":126,"address":[24896690],"length":1,"stats":{"Line":0}},{"line":128,"address":[24896553],"length":1,"stats":{"Line":0}},{"line":129,"address":[24896577,24896987],"length":1,"stats":{"Line":0}},{"line":130,"address":[24897103],"length":1,"stats":{"Line":0}},{"line":135,"address":[24895855],"length":1,"stats":{"Line":0}},{"line":142,"address":[24898800,24900585,24900631],"length":1,"stats":{"Line":0}},{"line":146,"address":[24898842,24898974],"length":1,"stats":{"Line":0}},{"line":170,"address":[24899227,24900591,24900609],"length":1,"stats":{"Line":0}},{"line":173,"address":[24899575,24899822,24900564,24899737],"length":1,"stats":{"Line":0}},{"line":175,"address":[24899706,24899806],"length":1,"stats":{"Line":0}},{"line":176,"address":[24899966,24900051,24899872,24900562],"length":1,"stats":{"Line":0}},{"line":178,"address":[24899935,24900035],"length":1,"stats":{"Line":0}},{"line":179,"address":[24900093],"length":1,"stats":{"Line":0}},{"line":181,"address":[24900541,24900182],"length":1,"stats":{"Line":0}},{"line":182,"address":[24900382],"length":1,"stats":{"Line":0}},{"line":186,"address":[24893120,24893986,24894037],"length":1,"stats":{"Line":0}},{"line":187,"address":[24893227,24893155],"length":1,"stats":{"Line":0}},{"line":188,"address":[24893407,24893467],"length":1,"stats":{"Line":0}},{"line":190,"address":[25037109,25036962,25037129,25039372,25036912,25037072,25039491],"length":1,"stats":{"Line":0}},{"line":191,"address":[25037007,25037178],"length":1,"stats":{"Line":0}},{"line":192,"address":[25038341,25039350,25039378,25037641,25037347,25038409,25037828,25037189,25037893,25037276,25037238,25037575,25038041,25038110],"length":1,"stats":{"Line":0}},{"line":201,"address":[25039742,25039300,25038979,25039812,25039687],"length":1,"stats":{"Line":0}},{"line":202,"address":[25038986],"length":1,"stats":{"Line":0}},{"line":203,"address":[25039059],"length":1,"stats":{"Line":0}},{"line":204,"address":[25039101],"length":1,"stats":{"Line":0}},{"line":205,"address":[25039153],"length":1,"stats":{"Line":0}},{"line":206,"address":[25039210],"length":1,"stats":{"Line":0}},{"line":207,"address":[25039241],"length":1,"stats":{"Line":0}},{"line":208,"address":[25037099,25039327,25039796,25039268,25039694,25039522],"length":1,"stats":{"Line":0}},{"line":210,"address":[24195842],"length":1,"stats":{"Line":0}},{"line":215,"address":[24895077,24894064,24895026],"length":1,"stats":{"Line":0}},{"line":216,"address":[24894228],"length":1,"stats":{"Line":0}},{"line":218,"address":[24894099,24894171],"length":1,"stats":{"Line":0}},{"line":222,"address":[24894479,24894539],"length":1,"stats":{"Line":0}},{"line":224,"address":[25040560,25040807,25040622,25040735,25042867,25040778,25042927],"length":1,"stats":{"Line":0}},{"line":225,"address":[25040676,25040862],"length":1,"stats":{"Line":0}},{"line":226,"address":[25041475,25041031,25042873,25041401,25041250,25040963,25041182,25040925,25042845,25040873],"length":1,"stats":{"Line":0}},{"line":234,"address":[25043141,25043275,25042789,25043679,25043202,25042562],"length":1,"stats":{"Line":0}},{"line":235,"address":[25042569],"length":1,"stats":{"Line":0}},{"line":236,"address":[25042640],"length":1,"stats":{"Line":0}},{"line":237,"address":[25042700],"length":1,"stats":{"Line":0}},{"line":238,"address":[25042727],"length":1,"stats":{"Line":0}},{"line":239,"address":[24196207],"length":1,"stats":{"Line":0}},{"line":241,"address":[25043424,25043520],"length":1,"stats":{"Line":0}},{"line":242,"address":[24196226],"length":1,"stats":{"Line":0}},{"line":244,"address":[25044147,25044210],"length":1,"stats":{"Line":0}},{"line":245,"address":[25044224,25044299],"length":1,"stats":{"Line":0}},{"line":252,"address":[25044533,25045404,25044279],"length":1,"stats":{"Line":0}},{"line":253,"address":[25044715,25045115,25045041,25044807],"length":1,"stats":{"Line":0}},{"line":254,"address":[25044991],"length":1,"stats":{"Line":0}},{"line":255,"address":[25045099,25045472,25045022,25045476],"length":1,"stats":{"Line":0}},{"line":257,"address":[25045176],"length":1,"stats":{"Line":0}},{"line":262,"address":[24898226,24897360,24898277],"length":1,"stats":{"Line":0}},{"line":263,"address":[24897527],"length":1,"stats":{"Line":0}},{"line":265,"address":[24897395,24897467],"length":1,"stats":{"Line":0}},{"line":267,"address":[24897707,24897647],"length":1,"stats":{"Line":0}},{"line":269,"address":[24897979],"length":1,"stats":{"Line":0}},{"line":270,"address":[25047988,25048218],"length":1,"stats":{"Line":0}},{"line":271,"address":[25048393,25049892,25048281,25049203,25048229,25048621,25050471,25050540,25049137,25048686,25049821,25048837,25048906,25049521,25051612,25049590,25048319],"length":1,"stats":{"Line":0}},{"line":280,"address":[25050834,25050756],"length":1,"stats":{"Line":0}},{"line":282,"address":[25051412,25050898,25050968],"length":1,"stats":{"Line":0}},{"line":283,"address":[25051154,25051417,25050982],"length":1,"stats":{"Line":0}},{"line":286,"address":[24174671],"length":1,"stats":{"Line":0}},{"line":288,"address":[25052302,25052398],"length":1,"stats":{"Line":0}},{"line":289,"address":[25054217,25052591,25052401,25048142],"length":1,"stats":{"Line":0}},{"line":291,"address":[25053086,25053023],"length":1,"stats":{"Line":0}},{"line":292,"address":[25053175,25053100],"length":1,"stats":{"Line":0}},{"line":295,"address":[25053155,25053409,25054212],"length":1,"stats":{"Line":0}},{"line":296,"address":[25053919,25053591,25053845,25053683],"length":1,"stats":{"Line":0}},{"line":297,"address":[25053795],"length":1,"stats":{"Line":0}},{"line":298,"address":[25053826,25054308,25053903,25054304],"length":1,"stats":{"Line":0}},{"line":300,"address":[25053980],"length":1,"stats":{"Line":0}},{"line":304,"address":[24895121,24895104],"length":1,"stats":{"Line":0}},{"line":305,"address":[25045842,25045704],"length":1,"stats":{"Line":0}},{"line":306,"address":[24196865],"length":1,"stats":{"Line":0}},{"line":308,"address":[25046576,25046513],"length":1,"stats":{"Line":0}},{"line":309,"address":[25046668,25046590],"length":1,"stats":{"Line":0}},{"line":312,"address":[25047625,25046648,25046902],"length":1,"stats":{"Line":0}},{"line":315,"address":[25047084,25047176],"length":1,"stats":{"Line":0}},{"line":316,"address":[25047358,25047468],"length":1,"stats":{"Line":0}},{"line":319,"address":[25047377],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":145},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analysis_result.rs"],"content":"//! Aggregated analysis results for v4.0 scoring system\n//!\n//! This module provides the AnalysisResult struct that collects all analysis\n//! data needed for scoring and reporting.\n\nuse crate::autofix::Violation;\nuse crate::circular::CircularDependency;\nuse crate::config::ArchPattern;\nuse crate::metrics::{ComplexityStats, HealthScore, LayerStats};\nuse chrono::{DateTime, Utc};\nuse serde::{Deserialize, Serialize};\nuse std::path::PathBuf;\n\n/// Category of a violation for severity classification\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\npub enum ViolationCategory {\n    /// Critical violation that breaks architecture rules\n    Blocked,\n    /// Warning that should be reviewed\n    Warning,\n    /// Informational notice\n    Info,\n}\n\nimpl ViolationCategory {\n    pub fn as_str(\u0026self) -\u003e \u0026'static str {\n        match self {\n            ViolationCategory::Blocked =\u003e \"blocked\",\n            ViolationCategory::Warning =\u003e \"warning\",\n            ViolationCategory::Info =\u003e \"info\",\n        }\n    }\n}\n\n/// A categorized violation with additional metadata\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct CategorizedViolation {\n    /// The original violation\n    pub violation: Violation,\n    /// Category of this violation\n    pub category: ViolationCategory,\n    /// Optional suggestion for fixing\n    pub suggestion: Option\u003cString\u003e,\n}\n\nimpl CategorizedViolation {\n    pub fn new(violation: Violation, category: ViolationCategory) -\u003e Self {\n        Self {\n            violation,\n            category,\n            suggestion: None,\n        }\n    }\n}\n\n/// Long function detected during complexity analysis\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct LongFunction {\n    /// File containing the function\n    pub file_path: PathBuf,\n    /// Function/method name\n    pub name: String,\n    /// Line number where function starts\n    pub line_start: usize,\n    /// Number of lines\n    pub lines: usize,\n    /// Threshold that was exceeded\n    pub threshold: usize,\n}\n\n/// Complete analysis result with all metrics\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AnalysisResult {\n    /// Project name (derived from directory or package.json)\n    pub project_name: String,\n    /// Architecture pattern detected or configured\n    pub pattern: ArchPattern,\n    /// Total files analyzed\n    pub files_analyzed: usize,\n    /// Timestamp of analysis\n    pub timestamp: DateTime\u003cUtc\u003e,\n    /// All categorized violations found\n    pub violations: Vec\u003cCategorizedViolation\u003e,\n    /// All circular dependencies found\n    pub circular_dependencies: Vec\u003cCircularDependency\u003e,\n    /// All long functions found\n    pub long_functions: Vec\u003cLongFunction\u003e,\n    /// Layer statistics for scoring\n    pub layer_stats: LayerStats,\n    /// Complexity statistics for scoring\n    pub complexity_stats: ComplexityStats,\n    /// Computed health score (set after calculation)\n    pub health_score: Option\u003cHealthScore\u003e,\n}\n\nimpl AnalysisResult {\n    /// Create a new empty analysis result\n    pub fn new(project_name: String, pattern: ArchPattern) -\u003e Self {\n        Self {\n            project_name,\n            pattern,\n            files_analyzed: 0,\n            timestamp: Utc::now(),\n            violations: Vec::new(),\n            circular_dependencies: Vec::new(),\n            long_functions: Vec::new(),\n            layer_stats: LayerStats::default(),\n            complexity_stats: ComplexityStats::default(),\n            health_score: None,\n        }\n    }\n\n    /// Add a violation to the result\n    pub fn add_violation(\u0026mut self, violation: CategorizedViolation) {\n        match violation.category {\n            ViolationCategory::Blocked =\u003e self.layer_stats.blocked_violations += 1,\n            ViolationCategory::Warning | ViolationCategory::Info =\u003e {}\n        }\n        self.violations.push(violation);\n    }\n\n    /// Add a circular dependency to the result\n    pub fn add_circular_dependency(\u0026mut self, cycle: CircularDependency) {\n        self.circular_dependencies.push(cycle);\n    }\n\n    /// Add a long function to the result\n    pub fn add_long_function(\u0026mut self, func: LongFunction) {\n        self.long_functions.push(func);\n        self.complexity_stats.long_functions += 1;\n    }\n\n    /// Get blocked violations count\n    pub fn blocked_count(\u0026self) -\u003e usize {\n        self.violations\n            .iter()\n            .filter(|v| v.category == ViolationCategory::Blocked)\n            .count()\n    }\n\n    /// Get warning violations count\n    pub fn warning_count(\u0026self) -\u003e usize {\n        self.violations\n            .iter()\n            .filter(|v| v.category == ViolationCategory::Warning)\n            .count()\n    }\n\n    /// Check if there are any critical issues\n    pub fn has_critical_issues(\u0026self) -\u003e bool {\n        self.blocked_count() \u003e 0 || !self.circular_dependencies.is_empty()\n    }\n\n    /// Get pattern as display string\n    pub fn pattern_display(\u0026self) -\u003e \u0026str {\n        match self.pattern {\n            ArchPattern::Hexagonal =\u003e \"Hexagonal Architecture\",\n            ArchPattern::Clean =\u003e \"Clean Architecture\",\n            ArchPattern::MVC =\u003e \"MVC Pattern\",\n            ArchPattern::Ninguno =\u003e \"No Pattern\",\n        }\n    }\n}\n","traces":[{"line":26,"address":[24677312],"length":1,"stats":{"Line":0}},{"line":27,"address":[24677317],"length":1,"stats":{"Line":0}},{"line":28,"address":[24677349],"length":1,"stats":{"Line":0}},{"line":29,"address":[24677372],"length":1,"stats":{"Line":0}},{"line":30,"address":[24677395],"length":1,"stats":{"Line":0}},{"line":47,"address":[24677440],"length":1,"stats":{"Line":0}},{"line":98,"address":[24676672,24677285],"length":1,"stats":{"Line":0}},{"line":103,"address":[24676719],"length":1,"stats":{"Line":0}},{"line":104,"address":[24676776],"length":1,"stats":{"Line":0}},{"line":105,"address":[24676792],"length":1,"stats":{"Line":0}},{"line":106,"address":[24676849],"length":1,"stats":{"Line":0}},{"line":107,"address":[24676909],"length":1,"stats":{"Line":0}},{"line":108,"address":[24676995],"length":1,"stats":{"Line":0}},{"line":114,"address":[24676091,24675856,24676120],"length":1,"stats":{"Line":0}},{"line":115,"address":[24675881],"length":1,"stats":{"Line":0}},{"line":116,"address":[24675920,24676023],"length":1,"stats":{"Line":0}},{"line":119,"address":[24675953],"length":1,"stats":{"Line":0}},{"line":123,"address":[24676608],"length":1,"stats":{"Line":0}},{"line":124,"address":[24676617],"length":1,"stats":{"Line":0}},{"line":128,"address":[24676400],"length":1,"stats":{"Line":0}},{"line":129,"address":[24676414],"length":1,"stats":{"Line":0}},{"line":130,"address":[24676457,24676503],"length":1,"stats":{"Line":0}},{"line":134,"address":[24676128],"length":1,"stats":{"Line":0}},{"line":135,"address":[24676133],"length":1,"stats":{"Line":0}},{"line":137,"address":[24704608,24704622],"length":1,"stats":{"Line":0}},{"line":142,"address":[24676192],"length":1,"stats":{"Line":0}},{"line":143,"address":[24676197],"length":1,"stats":{"Line":0}},{"line":145,"address":[24676225],"length":1,"stats":{"Line":0}},{"line":150,"address":[24676528],"length":1,"stats":{"Line":0}},{"line":151,"address":[24676541],"length":1,"stats":{"Line":0}},{"line":155,"address":[24676256],"length":1,"stats":{"Line":0}},{"line":156,"address":[24676261],"length":1,"stats":{"Line":0}},{"line":157,"address":[24676296],"length":1,"stats":{"Line":0}},{"line":158,"address":[24676319],"length":1,"stats":{"Line":0}},{"line":159,"address":[24676342],"length":1,"stats":{"Line":0}},{"line":160,"address":[24676365],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":36},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","collector.rs"],"content":"//! File analysis collector with caching support\n\nuse crate::analysis_result::{AnalysisResult, CategorizedViolation, ViolationCategory};\nuse crate::cache::{self, AnalysisCache, FileCacheEntry};\nuse crate::config::{ArchPattern, LinterContext};\nuse crate::metrics::ComplexityStats;\nuse indicatif::{ProgressBar, ProgressStyle};\nuse miette::Result;\nuse rayon::prelude::*;\nuse std::fs;\nuse std::path::{Path, PathBuf};\nuse std::sync::Mutex;\nuse swc_common::sync::Lrc;\nuse swc_common::SourceMap;\n\nuse super::metrics::{count_functions, count_imports, find_long_functions};\nuse super::swc_parser::collect_violations_from_file;\n\n/// Result of analyzing a single file\nstruct FileAnalysis {\n    violations: Vec\u003cCategorizedViolation\u003e,\n    long_functions: Vec\u003ccrate::analysis_result::LongFunction\u003e,\n    import_count: usize,\n    function_count: usize,\n}\n\n/// Analyzes all files and returns a complete AnalysisResult for scoring.\n/// When a cache is provided, unchanged files are served from cache.\npub fn analyze_all_files(\n    files: \u0026[PathBuf],\n    project_root: \u0026Path,\n    pattern: ArchPattern,\n    ctx: \u0026LinterContext,\n    _cm: \u0026SourceMap,\n    mut analysis_cache: Option\u003c\u0026mut AnalysisCache\u003e,\n) -\u003e Result\u003cAnalysisResult\u003e {\n    // Get project name from directory\n    let project_name = project_root\n        .file_name()\n        .and_then(|n| n.to_str())\n        .unwrap_or(\"project\")\n        .to_string();\n\n    let mut result = AnalysisResult::new(project_name, pattern);\n    result.files_analyzed = files.len();\n\n    // Initialize complexity stats with threshold\n    result.complexity_stats = ComplexityStats {\n        total_functions: 0,\n        long_functions: 0,\n        max_lines_threshold: ctx.max_lines,\n    };\n\n    // Initialize progress bar\n    let pb = if files.len() \u003e 10 {\n        let pb = ProgressBar::new(files.len() as u64);\n        pb.set_style(\n            ProgressStyle::default_bar()\n                .template(\"{spinner:.green} [{elapsed_precise}] [{bar:40.cyan/blue}] {pos}/{len} files ({eta})\")\n                .unwrap()\n                .progress_chars(\"#\u003e-\"),\n        );\n        Some(pb)\n    } else {\n        None\n    };\n\n    // Prepare cache for thread-safe access\n    // We clone the cache if it exists to use in parallel, then update it back\n    let cache_mutex: Option\u003cMutex\u003cAnalysisCache\u003e\u003e = analysis_cache\n        .as_mut()\n        .map(|cache| Mutex::new((**cache).clone()));\n\n    // Process files in parallel\n    let file_results: Vec\u003c(PathBuf, Option\u003cString\u003e, FileAnalysis)\u003e = files\n        .par_iter()\n        .filter_map(|file_path| {\n            // Update progress bar\n            if let Some(ref p) = pb {\n                p.inc(1);\n            }\n\n            // Read file content for hashing\n            let file_bytes = match fs::read(file_path) {\n                Ok(b) =\u003e b,\n                Err(_) =\u003e return None,\n            };\n            let content_hash = cache::hash_content(\u0026file_bytes);\n            let cache_key = AnalysisCache::normalize_path(file_path, project_root);\n\n            // Try to get from cache (thread-safe)\n            if let Some(ref mutex) = cache_mutex {\n                if let Ok(guard) = mutex.lock() {\n                    if let Some(entry) = guard.get(\u0026cache_key, \u0026content_hash) {\n                        // Cache hit — use stored data\n                        return Some((\n                            file_path.clone(),\n                            Some(cache_key),\n                            FileAnalysis {\n                                violations: entry.violations.clone(),\n                                long_functions: entry.long_functions.clone(),\n                                import_count: entry.import_count,\n                                function_count: entry.function_count,\n                            },\n                        ));\n                    }\n                }\n            }\n\n            // Cache miss — run full analysis with thread-local SourceMap\n            let cm = Lrc::new(SourceMap::default());\n\n            let mut file_violations = Vec::new();\n            if let Ok(violations) = collect_violations_from_file(\u0026cm, file_path, ctx) {\n                for violation in violations {\n                    let categorized =\n                        CategorizedViolation::new(violation, ViolationCategory::Blocked);\n                    file_violations.push(categorized);\n                }\n            }\n\n            let mut file_long_functions = Vec::new();\n            if let Ok(long_funcs) = find_long_functions(\u0026cm, file_path, ctx.max_lines) {\n                file_long_functions = long_funcs;\n            }\n\n            let import_count = count_imports(file_path).unwrap_or(0);\n            let function_count = count_functions(\u0026cm, file_path).unwrap_or(0);\n\n            let analysis = FileAnalysis {\n                violations: file_violations.clone(),\n                long_functions: file_long_functions.clone(),\n                import_count,\n                function_count,\n            };\n\n            // Store in cache (thread-safe)\n            if let Some(ref mutex) = cache_mutex {\n                if let Ok(mut guard) = mutex.lock() {\n                    guard.insert(\n                        cache_key.clone(),\n                        FileCacheEntry {\n                            content_hash,\n                            violations: file_violations,\n                            long_functions: file_long_functions,\n                            import_count,\n                            function_count,\n                        },\n                    );\n                }\n            }\n\n            Some((file_path.clone(), None, analysis))\n        })\n        .collect();\n\n    // Finish progress bar\n    if let Some(ref p) = pb {\n        p.finish_with_message(\"Analysis complete\");\n    }\n\n    // Update the original cache from the mutex\n    if let Some(mutex) = cache_mutex {\n        if let Ok(guard) = mutex.lock() {\n            if let Some(ref mut analysis_cache) = analysis_cache {\n                **analysis_cache = (*guard).clone();\n            }\n        }\n    }\n\n    // Merge all file results into the main result\n    for (_file_path, _cache_key, file_analysis) in file_results {\n        for cv in file_analysis.violations {\n            result.add_violation(cv);\n        }\n        for func in file_analysis.long_functions {\n            result.add_long_function(func);\n        }\n        result.layer_stats.total_imports += file_analysis.import_count;\n        result.complexity_stats.total_functions += file_analysis.function_count;\n    }\n\n    // Update blocked_violations count\n    result.layer_stats.blocked_violations = result.blocked_count();\n\n    Ok(result)\n}\n","traces":[{"line":40,"address":[24628222,24628208],"length":1,"stats":{"Line":0}},{"line":72,"address":[24628259,24628240],"length":1,"stats":{"Line":0}},{"line":77,"address":[24628304,24633432,24630205],"length":1,"stats":{"Line":0}},{"line":79,"address":[24628359],"length":1,"stats":{"Line":0}},{"line":80,"address":[24628439],"length":1,"stats":{"Line":0}},{"line":84,"address":[24628458],"length":1,"stats":{"Line":0}},{"line":85,"address":[24628576],"length":1,"stats":{"Line":0}},{"line":86,"address":[24628517],"length":1,"stats":{"Line":0}},{"line":88,"address":[24628823,24628728],"length":1,"stats":{"Line":0}},{"line":89,"address":[24628946,24628858],"length":1,"stats":{"Line":0}},{"line":92,"address":[24628989],"length":1,"stats":{"Line":0}},{"line":93,"address":[24629108,24629142,24629026],"length":1,"stats":{"Line":0}},{"line":94,"address":[24629172,24629251],"length":1,"stats":{"Line":0}},{"line":96,"address":[24629835],"length":1,"stats":{"Line":0}},{"line":97,"address":[24629483],"length":1,"stats":{"Line":0}},{"line":98,"address":[24629520],"length":1,"stats":{"Line":0}},{"line":99,"address":[24629755],"length":1,"stats":{"Line":0}},{"line":100,"address":[24629592],"length":1,"stats":{"Line":0}},{"line":101,"address":[24629667],"length":1,"stats":{"Line":0}},{"line":102,"address":[24629747],"length":1,"stats":{"Line":0}},{"line":103,"address":[24629751],"length":1,"stats":{"Line":0}},{"line":111,"address":[24630277,24629045],"length":1,"stats":{"Line":0}},{"line":113,"address":[24630320],"length":1,"stats":{"Line":0}},{"line":114,"address":[24630480,24630586,24630383],"length":1,"stats":{"Line":0}},{"line":115,"address":[24630618,24630878,24630743],"length":1,"stats":{"Line":0}},{"line":117,"address":[24631047],"length":1,"stats":{"Line":0}},{"line":118,"address":[24631259],"length":1,"stats":{"Line":0}},{"line":122,"address":[24631331],"length":1,"stats":{"Line":0}},{"line":123,"address":[24631581,24631350,24631431,24631807],"length":1,"stats":{"Line":0}},{"line":124,"address":[24631613,24631632,24631751],"length":1,"stats":{"Line":0}},{"line":127,"address":[24631861],"length":1,"stats":{"Line":0}},{"line":128,"address":[24631952],"length":1,"stats":{"Line":0}},{"line":130,"address":[24632196],"length":1,"stats":{"Line":0}},{"line":131,"address":[24632080],"length":1,"stats":{"Line":0}},{"line":132,"address":[24632107],"length":1,"stats":{"Line":0}},{"line":138,"address":[24632308],"length":1,"stats":{"Line":0}},{"line":139,"address":[24632345,24632434,24632468],"length":1,"stats":{"Line":0}},{"line":140,"address":[24632498,24632838],"length":1,"stats":{"Line":0}},{"line":141,"address":[24632565],"length":1,"stats":{"Line":0}},{"line":142,"address":[24632726],"length":1,"stats":{"Line":0}},{"line":143,"address":[24632606],"length":1,"stats":{"Line":0}},{"line":144,"address":[24632646],"length":1,"stats":{"Line":0}},{"line":145,"address":[24632686],"length":1,"stats":{"Line":0}},{"line":153,"address":[24632380,24632970],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":44},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","metrics.rs"],"content":"//! Metrics utilities for counting imports and functions\n\nuse crate::analysis_result::LongFunction;\nuse miette::{IntoDiagnostic, Result};\nuse std::fs;\nuse std::path::Path;\nuse swc_common::SourceMap;\nuse swc_ecma_parser::{lexer::Lexer, EsConfig, Parser, StringInput, Syntax, TsConfig};\n\n/// Represents a function or method call extracted from the AST\n#[derive(Debug, Clone)]\npub struct FunctionCall {\n    pub name: String,\n    pub line: usize,\n}\n\n/// Extract function calls from a file\n/// This function parses the AST and extracts all function/method calls\npub fn extract_function_calls(cm: \u0026SourceMap, path: \u0026Path) -\u003e Result\u003cVec\u003cFunctionCall\u003e\u003e {\n    let mut calls = Vec::new();\n\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only analyze TypeScript/JavaScript for now\n    if !matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n        return Ok(calls);\n    }\n\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(calls),\n    };\n\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(calls),\n    };\n\n    // Recursively visit all nodes in the AST to extract function calls\n    for item in \u0026module.body {\n        extract_calls_from_module_item(item, \u0026mut calls, cm);\n    }\n\n    Ok(calls)\n}\n\n/// Recursively extract function calls from a module item\nfn extract_calls_from_module_item(\n    item: \u0026swc_ecma_ast::ModuleItem,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match item {\n        swc_ecma_ast::ModuleItem::Stmt(stmt) =\u003e extract_calls_from_stmt(stmt, calls, cm),\n        swc_ecma_ast::ModuleItem::ModuleDecl(_) =\u003e {}\n    }\n}\n\n/// Extract calls from a statement\nfn extract_calls_from_stmt(\n    stmt: \u0026swc_ecma_ast::Stmt,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match stmt {\n        swc_ecma_ast::Stmt::Decl(decl) =\u003e extract_calls_from_decl(decl, calls, cm),\n        swc_ecma_ast::Stmt::Expr(expr_stmt) =\u003e {\n            extract_calls_from_expr(\u0026expr_stmt.expr, calls, cm);\n        }\n        swc_ecma_ast::Stmt::Block(block) =\u003e {\n            for stmt in \u0026block.stmts {\n                extract_calls_from_stmt(stmt, calls, cm);\n            }\n        }\n        swc_ecma_ast::Stmt::If(if_stmt) =\u003e {\n            extract_calls_from_expr(\u0026if_stmt.test, calls, cm);\n            extract_calls_from_stmt(\u0026*if_stmt.cons, calls, cm);\n            if let Some(alt) = \u0026if_stmt.alt {\n                extract_calls_from_stmt(alt, calls, cm);\n            }\n        }\n        swc_ecma_ast::Stmt::While(while_stmt) =\u003e {\n            extract_calls_from_expr(\u0026while_stmt.test, calls, cm);\n            extract_calls_from_stmt(\u0026*while_stmt.body, calls, cm);\n        }\n        swc_ecma_ast::Stmt::For(for_stmt) =\u003e {\n            if let Some(init) = \u0026for_stmt.init {\n                extract_calls_from_for_init(init, calls, cm);\n            }\n            if let Some(test) = \u0026for_stmt.test {\n                extract_calls_from_expr(test, calls, cm);\n            }\n            if let Some(update) = \u0026for_stmt.update {\n                extract_calls_from_expr(update, calls, cm);\n            }\n            extract_calls_from_stmt(\u0026*for_stmt.body, calls, cm);\n        }\n        swc_ecma_ast::Stmt::Return(ret_stmt) =\u003e {\n            if let Some(arg) = \u0026ret_stmt.arg {\n                extract_calls_from_expr(arg, calls, cm);\n            }\n        }\n        _ =\u003e {}\n    }\n}\n\n/// Extract calls from a declaration\nfn extract_calls_from_decl(\n    decl: \u0026swc_ecma_ast::Decl,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match decl {\n        swc_ecma_ast::Decl::Class(class) =\u003e {\n            for member in \u0026class.class.body {\n                if let swc_ecma_ast::ClassMember::Method(method) = member {\n                    extract_calls_from_function_body(\u0026method.function, calls, cm);\n                }\n            }\n        }\n        swc_ecma_ast::Decl::Fn(fn_decl) =\u003e {\n            extract_calls_from_function_body(\u0026fn_decl.function, calls, cm);\n        }\n        swc_ecma_ast::Decl::Var(var_decl) =\u003e {\n            for decl in \u0026var_decl.decls {\n                if let Some(init) = \u0026decl.init {\n                    extract_calls_from_expr(init, calls, cm);\n                }\n            }\n        }\n        _ =\u003e {}\n    }\n}\n\n/// Extract calls from a function body\nfn extract_calls_from_function_body(\n    function: \u0026swc_ecma_ast::Function,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    if let Some(body) = \u0026function.body {\n        for stmt in \u0026body.stmts {\n            extract_calls_from_stmt(stmt, calls, cm);\n        }\n    }\n}\n\n/// Extract calls from a for loop init expression\nfn extract_calls_from_for_init(\n    init: \u0026swc_ecma_ast::VarDeclOrExpr,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match init {\n        swc_ecma_ast::VarDeclOrExpr::VarDecl(var_decl) =\u003e {\n            for decl in \u0026var_decl.decls {\n                if let Some(init) = \u0026decl.init {\n                    extract_calls_from_expr(init, calls, cm);\n                }\n            }\n        }\n        swc_ecma_ast::VarDeclOrExpr::Expr(expr) =\u003e {\n            extract_calls_from_expr(expr, calls, cm);\n        }\n    }\n}\n\n/// Extract calls from an expression\nfn extract_calls_from_expr(\n    expr: \u0026swc_ecma_ast::Expr,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match expr {\n        swc_ecma_ast::Expr::Call(call_expr) =\u003e {\n            let line = cm.lookup_char_pos(call_expr.span.lo).line;\n\n            // Extract the function name\n            let name = extract_call_name(\u0026call_expr.callee);\n\n            calls.push(FunctionCall { name, line });\n\n            // Also extract calls from arguments\n            for arg in \u0026call_expr.args {\n                extract_calls_from_expr_or_spread(arg, calls, cm);\n            }\n        }\n        swc_ecma_ast::Expr::Member(member_expr) =\u003e {\n            extract_calls_from_expr(\u0026*member_expr.obj, calls, cm);\n            if let swc_ecma_ast::MemberProp::Computed(prop) = \u0026member_expr.prop {\n                extract_calls_from_expr(\u0026*prop.expr, calls, cm);\n            }\n        }\n        swc_ecma_ast::Expr::Ident(_) =\u003e {}\n        swc_ecma_ast::Expr::Lit(_) =\u003e {}\n        swc_ecma_ast::Expr::This(_) =\u003e {}\n        swc_ecma_ast::Expr::Array(array_lit) =\u003e {\n            for elem in \u0026array_lit.elems {\n                if let Some(elem_expr) = elem {\n                    extract_calls_from_expr_or_spread(elem_expr, calls, cm);\n                }\n            }\n        }\n        swc_ecma_ast::Expr::Unary(unary_expr) =\u003e {\n            extract_calls_from_expr(\u0026*unary_expr.arg, calls, cm);\n        }\n        swc_ecma_ast::Expr::Bin(bin_expr) =\u003e {\n            extract_calls_from_expr(\u0026*bin_expr.left, calls, cm);\n            extract_calls_from_expr(\u0026*bin_expr.right, calls, cm);\n        }\n        swc_ecma_ast::Expr::Assign(assign_expr) =\u003e {\n            // Handle PatOrExpr\n            match \u0026assign_expr.left {\n                swc_ecma_ast::PatOrExpr::Pat(pat) =\u003e {\n                    // For patterns, we don't extract calls\n                    let _ = pat;\n                }\n                swc_ecma_ast::PatOrExpr::Expr(expr) =\u003e {\n                    extract_calls_from_expr(expr, calls, cm);\n                }\n            }\n            extract_calls_from_expr(\u0026*assign_expr.right, calls, cm);\n        }\n        swc_ecma_ast::Expr::Update(update_expr) =\u003e {\n            extract_calls_from_expr(\u0026*update_expr.arg, calls, cm);\n        }\n        swc_ecma_ast::Expr::Cond(cond_expr) =\u003e {\n            extract_calls_from_expr(\u0026*cond_expr.test, calls, cm);\n            extract_calls_from_expr(\u0026*cond_expr.cons, calls, cm);\n            extract_calls_from_expr(\u0026*cond_expr.alt, calls, cm);\n        }\n        swc_ecma_ast::Expr::New(new_expr) =\u003e {\n            extract_calls_from_expr(\u0026*new_expr.callee, calls, cm);\n        }\n        swc_ecma_ast::Expr::Seq(seq_expr) =\u003e {\n            for expr in \u0026seq_expr.exprs {\n                extract_calls_from_expr(expr, calls, cm);\n            }\n        }\n        _ =\u003e {}\n    }\n}\n\n/// Extract calls from ExprOrSpread (used in function arguments and array elements)\nfn extract_calls_from_expr_or_spread(\n    expr_or_spread: \u0026swc_ecma_ast::ExprOrSpread,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    extract_calls_from_expr(\u0026expr_or_spread.expr, calls, cm);\n}\n\n/// Extract the name from a call expression callee\nfn extract_call_name(callee: \u0026swc_ecma_ast::Callee) -\u003e String {\n    match callee {\n        swc_ecma_ast::Callee::Expr(callee_expr) =\u003e {\n            match \u0026**callee_expr {\n                swc_ecma_ast::Expr::Ident(ident) =\u003e ident.sym.to_string(),\n                swc_ecma_ast::Expr::Member(member_expr) =\u003e {\n                    // Handle methods like this.helper() or console.log()\n                    match \u0026*member_expr.obj {\n                        swc_ecma_ast::Expr::Ident(obj_ident) =\u003e match \u0026member_expr.prop {\n                            swc_ecma_ast::MemberProp::Ident(prop_ident) =\u003e {\n                                format!(\"{}.{}\", obj_ident.sym, prop_ident.sym)\n                            }\n                            _ =\u003e \"member_call\".to_string(),\n                        },\n                        swc_ecma_ast::Expr::This(_) =\u003e match \u0026member_expr.prop {\n                            swc_ecma_ast::MemberProp::Ident(prop_ident) =\u003e {\n                                format!(\"this.{}\", prop_ident.sym)\n                            }\n                            _ =\u003e \"this.method\".to_string(),\n                        },\n                        _ =\u003e \"unknown_call\".to_string(),\n                    }\n                }\n                _ =\u003e \"anonymous_call\".to_string(),\n            }\n        }\n        swc_ecma_ast::Callee::Super(_) =\u003e \"super_call\".to_string(),\n        swc_ecma_ast::Callee::Import(_) =\u003e \"import_call\".to_string(),\n    }\n}\n\n/// Count imports in a file\npub fn count_imports(path: \u0026Path) -\u003e Result\u003cusize\u003e {\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only count for supported file types\n    if !matches!(\n        extension,\n        \"ts\" | \"tsx\" | \"js\" | \"jsx\" | \"py\" | \"go\" | \"php\" | \"java\"\n    ) {\n        return Ok(0);\n    }\n\n    let content = fs::read_to_string(path).into_diagnostic()?;\n    let mut count = 0usize;\n\n    for line in content.lines() {\n        let trimmed = line.trim();\n        // TypeScript/JavaScript\n        if trimmed.starts_with(\"import \") || trimmed.starts_with(\"import{\") {\n            count += 1;\n        }\n        // Python\n        else if trimmed.starts_with(\"import \") || trimmed.starts_with(\"from \") {\n            count += 1;\n        }\n        // Go\n        else if trimmed.starts_with(\"import \") || trimmed == \"import (\" {\n            count += 1;\n        }\n        // PHP\n        else if trimmed.starts_with(\"use \")\n            || trimmed.starts_with(\"require \")\n            || trimmed.starts_with(\"include \")\n        {\n            count += 1;\n        }\n        // Java\n        else if trimmed.starts_with(\"import \") {\n            count += 1;\n        }\n    }\n\n    Ok(count)\n}\n\n/// Count functions in a file\npub fn count_functions(cm: \u0026SourceMap, path: \u0026Path) -\u003e Result\u003cusize\u003e {\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only analyze TypeScript/JavaScript for now\n    if !matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n        return Ok(0);\n    }\n\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(0),\n    };\n\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(0),\n    };\n\n    let mut count = 0usize;\n\n    for item in \u0026module.body {\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(_) = member {\n                    count += 1;\n                }\n            }\n        }\n        // Count standalone functions\n        else if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Fn(_),\n        )) = item\n        {\n            count += 1;\n        }\n    }\n\n    Ok(count)\n}\n\n/// Find functions that exceed the max lines threshold\npub fn find_long_functions(\n    cm: \u0026SourceMap,\n    path: \u0026Path,\n    max_lines: usize,\n) -\u003e Result\u003cVec\u003cLongFunction\u003e\u003e {\n    let mut long_functions = Vec::new();\n\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only analyze TypeScript/JavaScript for now\n    if !matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n        return Ok(long_functions);\n    }\n\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(long_functions),\n    };\n\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(long_functions),\n    };\n\n    for item in \u0026module.body {\n        // Check class methods\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(m) = member {\n                    let lo = cm.lookup_char_pos(m.span.lo).line;\n                    let hi = cm.lookup_char_pos(m.span.hi).line;\n                    let lines = hi - lo;\n\n                    if lines \u003e max_lines {\n                        // Get method name\n                        let name = match \u0026m.key {\n                            swc_ecma_ast::PropName::Ident(id) =\u003e id.sym.to_string(),\n                            swc_ecma_ast::PropName::Str(s) =\u003e s.value.to_string(),\n                            swc_ecma_ast::PropName::Num(n) =\u003e n.value.to_string(),\n                            swc_ecma_ast::PropName::BigInt(b) =\u003e b.value.to_string(),\n                            _ =\u003e \"anonymous\".to_string(),\n                        };\n\n                        long_functions.push(LongFunction {\n                            file_path: path.to_path_buf(),\n                            name,\n                            line_start: lo,\n                            lines,\n                            threshold: max_lines,\n                        });\n                    }\n                }\n            }\n        }\n        // Check standalone function declarations\n        else if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Fn(f),\n        )) = item\n        {\n            let lo = cm.lookup_char_pos(f.function.span.lo).line;\n            let hi = cm.lookup_char_pos(f.function.span.hi).line;\n            let lines = hi - lo;\n\n            if lines \u003e max_lines {\n                let name = f.ident.sym.to_string();\n\n                long_functions.push(LongFunction {\n                    file_path: path.to_path_buf(),\n                    name,\n                    line_start: lo,\n                    lines,\n                    threshold: max_lines,\n                });\n            }\n        }\n        // Check exported functions\n        else if let swc_ecma_ast::ModuleItem::ModuleDecl(swc_ecma_ast::ModuleDecl::ExportDecl(\n            e,\n        )) = item\n        {\n            if let swc_ecma_ast::Decl::Fn(f) = \u0026e.decl {\n                let lo = cm.lookup_char_pos(f.function.span.lo).line;\n                let hi = cm.lookup_char_pos(f.function.span.hi).line;\n                let lines = hi - lo;\n\n                if lines \u003e max_lines {\n                    let name = f.ident.sym.to_string();\n\n                    long_functions.push(LongFunction {\n                        file_path: path.to_path_buf(),\n                        name,\n                        line_start: lo,\n                        lines,\n                        threshold: max_lines,\n                    });\n                }\n            }\n            // Also check exported classes\n            else if let swc_ecma_ast::Decl::Class(c) = \u0026e.decl {\n                for member in \u0026c.class.body {\n                    if let swc_ecma_ast::ClassMember::Method(m) = member {\n                        let lo = cm.lookup_char_pos(m.span.lo).line;\n                        let hi = cm.lookup_char_pos(m.span.hi).line;\n                        let lines = hi - lo;\n\n                        if lines \u003e max_lines {\n                            let name = match \u0026m.key {\n                                swc_ecma_ast::PropName::Ident(id) =\u003e id.sym.to_string(),\n                                swc_ecma_ast::PropName::Str(s) =\u003e s.value.to_string(),\n                                swc_ecma_ast::PropName::Num(n) =\u003e n.value.to_string(),\n                                swc_ecma_ast::PropName::BigInt(b) =\u003e b.value.to_string(),\n                                _ =\u003e \"anonymous\".to_string(),\n                            };\n\n                            long_functions.push(LongFunction {\n                                file_path: path.to_path_buf(),\n                                name,\n                                line_start: lo,\n                                lines,\n                                threshold: max_lines,\n                            });\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    Ok(long_functions)\n}\n","traces":[{"line":19,"address":[24663283,24663361,24660688],"length":1,"stats":{"Line":0}},{"line":20,"address":[24660759],"length":1,"stats":{"Line":0}},{"line":22,"address":[24660808,24660892],"length":1,"stats":{"Line":0}},{"line":25,"address":[24660995],"length":1,"stats":{"Line":0}},{"line":26,"address":[24661222],"length":1,"stats":{"Line":0}},{"line":29,"address":[24661389,24663330,24661339],"length":1,"stats":{"Line":0}},{"line":32,"address":[24661550,24661637,24661719,24662292],"length":1,"stats":{"Line":0}},{"line":34,"address":[24661682],"length":1,"stats":{"Line":0}},{"line":35,"address":[24662223],"length":1,"stats":{"Line":0}},{"line":37,"address":[24661725,24661850,24661996],"length":1,"stats":{"Line":0}},{"line":39,"address":[24661813],"length":1,"stats":{"Line":0}},{"line":40,"address":[24661985],"length":1,"stats":{"Line":0}},{"line":42,"address":[24661864],"length":1,"stats":{"Line":0}},{"line":45,"address":[24662398,24662173],"length":1,"stats":{"Line":0}},{"line":46,"address":[24662526],"length":1,"stats":{"Line":0}},{"line":48,"address":[24662552,24662623],"length":1,"stats":{"Line":0}},{"line":49,"address":[24662809],"length":1,"stats":{"Line":0}},{"line":50,"address":[24662672],"length":1,"stats":{"Line":0}},{"line":54,"address":[24662917,24663000],"length":1,"stats":{"Line":0}},{"line":55,"address":[24663116,24663278],"length":1,"stats":{"Line":0}},{"line":58,"address":[24663134],"length":1,"stats":{"Line":0}},{"line":62,"address":[24669232],"length":1,"stats":{"Line":0}},{"line":67,"address":[24669265],"length":1,"stats":{"Line":0}},{"line":68,"address":[24669302],"length":1,"stats":{"Line":0}},{"line":74,"address":[24666864],"length":1,"stats":{"Line":0}},{"line":79,"address":[24666919],"length":1,"stats":{"Line":0}},{"line":80,"address":[24667280],"length":1,"stats":{"Line":0}},{"line":81,"address":[24667310],"length":1,"stats":{"Line":0}},{"line":82,"address":[24667325,24668621],"length":1,"stats":{"Line":0}},{"line":84,"address":[24666996],"length":1,"stats":{"Line":0}},{"line":85,"address":[24667008,24667353],"length":1,"stats":{"Line":0}},{"line":86,"address":[24667442],"length":1,"stats":{"Line":0}},{"line":89,"address":[24667104],"length":1,"stats":{"Line":0}},{"line":90,"address":[24667574,24667666,24667124],"length":1,"stats":{"Line":0}},{"line":91,"address":[24667645,24667799,24667684],"length":1,"stats":{"Line":0}},{"line":92,"address":[24667817,24667755],"length":1,"stats":{"Line":0}},{"line":93,"address":[24667825],"length":1,"stats":{"Line":0}},{"line":96,"address":[24667160],"length":1,"stats":{"Line":0}},{"line":97,"address":[24668029,24667180,24667937],"length":1,"stats":{"Line":0}},{"line":98,"address":[24668008,24668047],"length":1,"stats":{"Line":0}},{"line":100,"address":[24667216],"length":1,"stats":{"Line":0}},{"line":101,"address":[24667224,24668155],"length":1,"stats":{"Line":0}},{"line":102,"address":[24668163],"length":1,"stats":{"Line":0}},{"line":104,"address":[24668176],"length":1,"stats":{"Line":0}},{"line":105,"address":[24668228,24668302],"length":1,"stats":{"Line":0}},{"line":107,"address":[24668256,24668388],"length":1,"stats":{"Line":0}},{"line":108,"address":[24668396,24668449],"length":1,"stats":{"Line":0}},{"line":110,"address":[24668424,24668534],"length":1,"stats":{"Line":0}},{"line":112,"address":[24667043],"length":1,"stats":{"Line":0}},{"line":113,"address":[24667063,24667454],"length":1,"stats":{"Line":0}},{"line":114,"address":[24667462],"length":1,"stats":{"Line":0}},{"line":122,"address":[24663408],"length":1,"stats":{"Line":0}},{"line":127,"address":[24663454],"length":1,"stats":{"Line":0}},{"line":128,"address":[24663508],"length":1,"stats":{"Line":0}},{"line":129,"address":[24663523,24663645,24663725],"length":1,"stats":{"Line":0}},{"line":130,"address":[24663791],"length":1,"stats":{"Line":0}},{"line":131,"address":[24663841],"length":1,"stats":{"Line":0}},{"line":135,"address":[24663549],"length":1,"stats":{"Line":0}},{"line":136,"address":[24663948,24663564],"length":1,"stats":{"Line":0}},{"line":138,"address":[24663597],"length":1,"stats":{"Line":0}},{"line":139,"address":[24664107,24664031,24663612],"length":1,"stats":{"Line":0}},{"line":140,"address":[24664177],"length":1,"stats":{"Line":0}},{"line":141,"address":[24664229],"length":1,"stats":{"Line":0}},{"line":150,"address":[24669328],"length":1,"stats":{"Line":0}},{"line":155,"address":[24669356],"length":1,"stats":{"Line":0}},{"line":156,"address":[24669411,24669434],"length":1,"stats":{"Line":0}},{"line":157,"address":[24669497],"length":1,"stats":{"Line":0}},{"line":163,"address":[24668720],"length":1,"stats":{"Line":0}},{"line":168,"address":[24668757],"length":1,"stats":{"Line":0}},{"line":169,"address":[24668819],"length":1,"stats":{"Line":0}},{"line":170,"address":[24668931,24668831],"length":1,"stats":{"Line":0}},{"line":171,"address":[24668985,24669039],"length":1,"stats":{"Line":0}},{"line":172,"address":[24669044],"length":1,"stats":{"Line":0}},{"line":176,"address":[24668771],"length":1,"stats":{"Line":0}},{"line":177,"address":[24668786,24669146],"length":1,"stats":{"Line":0}},{"line":183,"address":[24664336],"length":1,"stats":{"Line":0}},{"line":188,"address":[24664391],"length":1,"stats":{"Line":0}},{"line":189,"address":[24664843],"length":1,"stats":{"Line":0}},{"line":190,"address":[24664863],"length":1,"stats":{"Line":0}},{"line":193,"address":[24664920],"length":1,"stats":{"Line":0}},{"line":195,"address":[24664950],"length":1,"stats":{"Line":0}},{"line":198,"address":[24665025,24666496],"length":1,"stats":{"Line":0}},{"line":199,"address":[24666585],"length":1,"stats":{"Line":0}},{"line":202,"address":[24664735],"length":1,"stats":{"Line":0}},{"line":203,"address":[24665958,24666043,24664743],"length":1,"stats":{"Line":0}},{"line":204,"address":[24666032,24666064],"length":1,"stats":{"Line":0}},{"line":205,"address":[24666079],"length":1,"stats":{"Line":0}},{"line":211,"address":[24664471],"length":1,"stats":{"Line":0}},{"line":212,"address":[24665150,24664483],"length":1,"stats":{"Line":0}},{"line":213,"address":[24665228],"length":1,"stats":{"Line":0}},{"line":214,"address":[24665279],"length":1,"stats":{"Line":0}},{"line":218,"address":[24664518],"length":1,"stats":{"Line":0}},{"line":219,"address":[24664533,24665297],"length":1,"stats":{"Line":0}},{"line":221,"address":[24664626],"length":1,"stats":{"Line":0}},{"line":222,"address":[24665594,24664649,24665493],"length":1,"stats":{"Line":0}},{"line":223,"address":[24665612,24665573],"length":1,"stats":{"Line":0}},{"line":225,"address":[24664688],"length":1,"stats":{"Line":0}},{"line":227,"address":[24664708],"length":1,"stats":{"Line":0}},{"line":228,"address":[24665701],"length":1,"stats":{"Line":0}},{"line":232,"address":[24665720],"length":1,"stats":{"Line":0}},{"line":233,"address":[24665735],"length":1,"stats":{"Line":0}},{"line":236,"address":[24665845],"length":1,"stats":{"Line":0}},{"line":238,"address":[24664572],"length":1,"stats":{"Line":0}},{"line":239,"address":[24664587,24665395],"length":1,"stats":{"Line":0}},{"line":241,"address":[24664779],"length":1,"stats":{"Line":0}},{"line":242,"address":[24666192,24664799,24666284],"length":1,"stats":{"Line":0}},{"line":243,"address":[24666394,24666302,24666263],"length":1,"stats":{"Line":0}},{"line":244,"address":[24666412,24666373],"length":1,"stats":{"Line":0}},{"line":246,"address":[24665060],"length":1,"stats":{"Line":0}},{"line":247,"address":[24665075,24666597],"length":1,"stats":{"Line":0}},{"line":249,"address":[24665111],"length":1,"stats":{"Line":0}},{"line":250,"address":[24666681,24665123],"length":1,"stats":{"Line":0}},{"line":251,"address":[24666754],"length":1,"stats":{"Line":0}},{"line":259,"address":[24669504],"length":1,"stats":{"Line":0}},{"line":264,"address":[24669533,24669622],"length":1,"stats":{"Line":0}},{"line":268,"address":[24652768],"length":1,"stats":{"Line":0}},{"line":269,"address":[24652798],"length":1,"stats":{"Line":0}},{"line":270,"address":[24652884],"length":1,"stats":{"Line":0}},{"line":271,"address":[24652899,24652938],"length":1,"stats":{"Line":0}},{"line":272,"address":[24653117],"length":1,"stats":{"Line":0}},{"line":273,"address":[24653078],"length":1,"stats":{"Line":0}},{"line":275,"address":[24653086,24653145],"length":1,"stats":{"Line":0}},{"line":276,"address":[24653305],"length":1,"stats":{"Line":0}},{"line":277,"address":[24653507],"length":1,"stats":{"Line":0}},{"line":278,"address":[24653524],"length":1,"stats":{"Line":0}},{"line":280,"address":[24653688],"length":1,"stats":{"Line":0}},{"line":282,"address":[24653284],"length":1,"stats":{"Line":0}},{"line":283,"address":[24653342],"length":1,"stats":{"Line":0}},{"line":284,"address":[24653354],"length":1,"stats":{"Line":0}},{"line":286,"address":[24653474],"length":1,"stats":{"Line":0}},{"line":288,"address":[24653256],"length":1,"stats":{"Line":0}},{"line":291,"address":[24653050],"length":1,"stats":{"Line":0}},{"line":294,"address":[24652834],"length":1,"stats":{"Line":0}},{"line":295,"address":[24652859],"length":1,"stats":{"Line":0}},{"line":300,"address":[24650103,24648160,24650109],"length":1,"stats":{"Line":0}},{"line":301,"address":[24648199],"length":1,"stats":{"Line":0}},{"line":304,"address":[24648336,24648584],"length":1,"stats":{"Line":0}},{"line":306,"address":[24648276,24648365],"length":1,"stats":{"Line":0}},{"line":308,"address":[24648594],"length":1,"stats":{"Line":0}},{"line":311,"address":[24648757,24648636],"length":1,"stats":{"Line":0}},{"line":312,"address":[24648868],"length":1,"stats":{"Line":0}},{"line":314,"address":[24648973,24648888],"length":1,"stats":{"Line":0}},{"line":315,"address":[24649221,24649147],"length":1,"stats":{"Line":0}},{"line":317,"address":[24649371,24649237,24650077],"length":1,"stats":{"Line":0}},{"line":318,"address":[24649333,24650069,24650082],"length":1,"stats":{"Line":0}},{"line":321,"address":[24649511,24650041,24649377],"length":1,"stats":{"Line":0}},{"line":322,"address":[24650033,24650046,24649473],"length":1,"stats":{"Line":0}},{"line":325,"address":[24649517,24649638,24650005],"length":1,"stats":{"Line":0}},{"line":326,"address":[24649600,24649997,24650010],"length":1,"stats":{"Line":0}},{"line":329,"address":[24649969,24649644],"length":1,"stats":{"Line":0}},{"line":330,"address":[24649778,24649697],"length":1,"stats":{"Line":0}},{"line":331,"address":[24649784],"length":1,"stats":{"Line":0}},{"line":333,"address":[24649740,24649974,24649961],"length":1,"stats":{"Line":0}},{"line":336,"address":[24649837,24649931],"length":1,"stats":{"Line":0}},{"line":337,"address":[24649936,24649893],"length":1,"stats":{"Line":0}},{"line":341,"address":[24649164],"length":1,"stats":{"Line":0}},{"line":345,"address":[24652750,24650128,24652703],"length":1,"stats":{"Line":0}},{"line":346,"address":[24650209],"length":1,"stats":{"Line":0}},{"line":349,"address":[24650264],"length":1,"stats":{"Line":0}},{"line":350,"address":[24650439],"length":1,"stats":{"Line":0}},{"line":353,"address":[24650489,24650575],"length":1,"stats":{"Line":0}},{"line":356,"address":[24650733,24650815,24650646,24651307],"length":1,"stats":{"Line":0}},{"line":358,"address":[24650778],"length":1,"stats":{"Line":0}},{"line":359,"address":[24651238],"length":1,"stats":{"Line":0}},{"line":361,"address":[24650821,24650943,24651011],"length":1,"stats":{"Line":0}},{"line":363,"address":[24650909],"length":1,"stats":{"Line":0}},{"line":364,"address":[24651000],"length":1,"stats":{"Line":0}},{"line":366,"address":[24650949],"length":1,"stats":{"Line":0}},{"line":369,"address":[24651188,24651413],"length":1,"stats":{"Line":0}},{"line":370,"address":[24651541],"length":1,"stats":{"Line":0}},{"line":372,"address":[24651638,24651567],"length":1,"stats":{"Line":0}},{"line":373,"address":[24651745],"length":1,"stats":{"Line":0}},{"line":374,"address":[24651675],"length":1,"stats":{"Line":0}},{"line":377,"address":[24651853],"length":1,"stats":{"Line":0}},{"line":379,"address":[24651865,24651948],"length":1,"stats":{"Line":0}},{"line":380,"address":[24652168,24652053],"length":1,"stats":{"Line":0}},{"line":381,"address":[24652252],"length":1,"stats":{"Line":0}},{"line":384,"address":[24652275],"length":1,"stats":{"Line":0}},{"line":385,"address":[24652564,24652496],"length":1,"stats":{"Line":0}},{"line":386,"address":[24652526,24652569],"length":1,"stats":{"Line":0}},{"line":391,"address":[24652618,24652218,24652680],"length":1,"stats":{"Line":0}},{"line":395,"address":[24652685,24652644],"length":1,"stats":{"Line":0}},{"line":399,"address":[24652078],"length":1,"stats":{"Line":0}},{"line":403,"address":[24660656,24657775,24653712],"length":1,"stats":{"Line":0}},{"line":408,"address":[24653799],"length":1,"stats":{"Line":0}},{"line":410,"address":[24653964,24653880],"length":1,"stats":{"Line":0}},{"line":413,"address":[24654073],"length":1,"stats":{"Line":0}},{"line":414,"address":[24654324],"length":1,"stats":{"Line":0}},{"line":417,"address":[24654441,24654503,24660622],"length":1,"stats":{"Line":0}},{"line":420,"address":[24655475,24654781,24654688,24654872],"length":1,"stats":{"Line":0}},{"line":422,"address":[24654829],"length":1,"stats":{"Line":0}},{"line":423,"address":[24655397],"length":1,"stats":{"Line":0}},{"line":425,"address":[24654878,24655167,24655018],"length":1,"stats":{"Line":0}},{"line":427,"address":[24654975],"length":1,"stats":{"Line":0}},{"line":428,"address":[24655153],"length":1,"stats":{"Line":0}},{"line":430,"address":[24655032],"length":1,"stats":{"Line":0}},{"line":433,"address":[24655581,24655344],"length":1,"stats":{"Line":0}},{"line":434,"address":[24655721],"length":1,"stats":{"Line":0}},{"line":436,"address":[24655821,24655750],"length":1,"stats":{"Line":0}},{"line":437,"address":[24656007],"length":1,"stats":{"Line":0}},{"line":438,"address":[24655870],"length":1,"stats":{"Line":0}},{"line":441,"address":[24656210,24656115],"length":1,"stats":{"Line":0}},{"line":443,"address":[24656516,24656324],"length":1,"stats":{"Line":0}},{"line":444,"address":[24656609],"length":1,"stats":{"Line":0}},{"line":447,"address":[24656632],"length":1,"stats":{"Line":0}},{"line":448,"address":[24656891],"length":1,"stats":{"Line":0}},{"line":449,"address":[24656964],"length":1,"stats":{"Line":0}},{"line":450,"address":[24657045],"length":1,"stats":{"Line":0}},{"line":451,"address":[24657179,24657126],"length":1,"stats":{"Line":0}},{"line":453,"address":[24657748,24657169],"length":1,"stats":{"Line":0}},{"line":455,"address":[24657207],"length":1,"stats":{"Line":0}},{"line":456,"address":[24657252,24657437],"length":1,"stats":{"Line":0}},{"line":457,"address":[24657480,24657294],"length":1,"stats":{"Line":0}},{"line":458,"address":[24657336,24657490],"length":1,"stats":{"Line":0}},{"line":459,"address":[24657375,24657500],"length":1,"stats":{"Line":0}},{"line":460,"address":[24657406,24657510],"length":1,"stats":{"Line":0}},{"line":463,"address":[24657625],"length":1,"stats":{"Line":0}},{"line":464,"address":[24657461],"length":1,"stats":{"Line":0}},{"line":465,"address":[24657585],"length":1,"stats":{"Line":0}},{"line":475,"address":[24657789,24656554],"length":1,"stats":{"Line":0}},{"line":476,"address":[24657882],"length":1,"stats":{"Line":0}},{"line":479,"address":[24657913],"length":1,"stats":{"Line":0}},{"line":480,"address":[24658088],"length":1,"stats":{"Line":0}},{"line":481,"address":[24658270,24658323],"length":1,"stats":{"Line":0}},{"line":483,"address":[24658646,24658313],"length":1,"stats":{"Line":0}},{"line":484,"address":[24658352],"length":1,"stats":{"Line":0}},{"line":486,"address":[24658523],"length":1,"stats":{"Line":0}},{"line":487,"address":[24658399],"length":1,"stats":{"Line":0}},{"line":488,"address":[24658483],"length":1,"stats":{"Line":0}},{"line":496,"address":[24657842,24658704],"length":1,"stats":{"Line":0}},{"line":497,"address":[24658722],"length":1,"stats":{"Line":0}},{"line":500,"address":[24658730],"length":1,"stats":{"Line":0}},{"line":501,"address":[24658819,24658764],"length":1,"stats":{"Line":0}},{"line":502,"address":[24658958],"length":1,"stats":{"Line":0}},{"line":503,"address":[24659119,24659166],"length":1,"stats":{"Line":0}},{"line":505,"address":[24659156,24659480],"length":1,"stats":{"Line":0}},{"line":506,"address":[24659192],"length":1,"stats":{"Line":0}},{"line":508,"address":[24659357],"length":1,"stats":{"Line":0}},{"line":509,"address":[24659239],"length":1,"stats":{"Line":0}},{"line":510,"address":[24659317],"length":1,"stats":{"Line":0}},{"line":518,"address":[24659515,24658796],"length":1,"stats":{"Line":0}},{"line":519,"address":[24659530],"length":1,"stats":{"Line":0}},{"line":520,"address":[24659756],"length":1,"stats":{"Line":0}},{"line":521,"address":[24659819],"length":1,"stats":{"Line":0}},{"line":522,"address":[24659894],"length":1,"stats":{"Line":0}},{"line":523,"address":[24660013,24659966],"length":1,"stats":{"Line":0}},{"line":525,"address":[24660554,24660003],"length":1,"stats":{"Line":0}},{"line":526,"address":[24660039],"length":1,"stats":{"Line":0}},{"line":527,"address":[24660249,24660073],"length":1,"stats":{"Line":0}},{"line":528,"address":[24660292,24660112],"length":1,"stats":{"Line":0}},{"line":529,"address":[24660151,24660302],"length":1,"stats":{"Line":0}},{"line":530,"address":[24660312,24660187],"length":1,"stats":{"Line":0}},{"line":531,"address":[24660218,24660322],"length":1,"stats":{"Line":0}},{"line":534,"address":[24660431],"length":1,"stats":{"Line":0}},{"line":535,"address":[24660273],"length":1,"stats":{"Line":0}},{"line":536,"address":[24660391],"length":1,"stats":{"Line":0}},{"line":548,"address":[24656364],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":257},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","mod.rs"],"content":"//! Analyzer module for Architect Linter Pro\n//!\n//! This module contains all file analysis logic:\n//! - SWC-based parser for TypeScript/JavaScript\n//! - Pattern matching utilities\n//! - Metrics collection (imports, functions)\n//! - File collection with caching\n\npub mod collector;\npub mod metrics;\nmod pattern_matcher;\npub mod swc_parser;\n\n// Re-export public functions\npub use collector::analyze_all_files;\npub use metrics::{count_functions, count_imports, extract_function_calls, find_long_functions};\npub use swc_parser::{analyze_file, collect_violations_from_file};\n\n// Note: analyze_changed_files is defined in main.rs to avoid circular imports\n// For tests, import directly from main\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","pattern_matcher.rs"],"content":"//! Pattern matching utilities for import validation\n\n/// Normaliza un patrón glob para hacer matching simple\n/// Ejemplos:\n/// - \"src/components/**\" → \"src/components/\"\n/// - \"**/*.tsx\" → \".tsx\"\n/// - \"src/services/**\" → \"src/services/\"\npub fn normalize_pattern(pattern: \u0026str) -\u003e String {\n    let normalized = pattern\n        .to_lowercase()\n        .replace(\"\\\\\", \"/\")  // Normalizar separadores de Windows\n        .replace(\"**\", \"\")   // Quitar comodines globales\n        .replace(\"*\", \"\"); // Quitar comodines simples\n\n    // Si el patrón termina en /, dejarlo; si no, mantenerlo como está\n    normalized\n}\n\n/// Verifica si un path coincide con un patrón normalizado\n/// Usa matching flexible para soportar diferentes formatos de import\npub fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n    let normalized_path = path.to_lowercase().replace(\"\\\\\", \"/\");\n    let normalized_pattern = pattern.to_lowercase();\n\n    // Si el patrón está vacío después de normalización, no matchear nada\n    if normalized_pattern.is_empty() {\n        return false;\n    }\n\n    // Matching flexible para rutas absolutas y relativas\n    // Ejemplos:\n    // - Path: \"c:/proyecto/src/components/button.jsx\" con Pattern: \"src/components/\"\n    // - Import: \"../services/userservice\" con Pattern: \"src/services/\"\n    //   → Extraer \"services/\" del pattern y buscar \"/services/\" o \"../services/\" en el import\n    // - Import: \"@/api/posts\" con Pattern: \"src/api/\"\n    //   → Buscar \"/api/\" en el import\n\n    if normalized_path.contains(\u0026normalized_pattern) {\n        return true;\n    }\n\n    // Para imports: si el patrón contiene \"src/\", extraer solo la carpeta después de src/\n    // Ejemplo: \"src/services/\" → buscar también \"/services/\" o \"services/\"\n    if normalized_pattern.contains(\"src/\") {\n        // Extraer la parte después de \"src/\"\n        if let Some(folder_part) = normalized_pattern.strip_prefix(\"src/\") {\n            // Buscar \"/folder/\" o \"../folder/\" en el path (para imports relativos)\n            let with_slash = format!(\"/{}\", folder_part);\n            let with_relative = format!(\"../{}\", folder_part);\n            let with_at = format!(\"@/{}\", folder_part); // Para alias como @/services\n\n            if normalized_path.contains(\u0026with_slash)\n                || normalized_path.contains(\u0026with_relative)\n                || normalized_path.contains(\u0026with_at)\n                || normalized_path.contains(folder_part)\n            {\n                return true;\n            }\n        }\n    }\n\n    false\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_normalize_pattern() {\n        assert_eq!(normalize_pattern(\"src/components/**\"), \"src/components/\");\n        assert_eq!(normalize_pattern(\"**/*.tsx\"), \"/.tsx\"); // Note: keeps leading /\n        assert_eq!(normalize_pattern(\"src/services/**\"), \"src/services/\");\n    }\n\n    #[test]\n    fn test_matches_pattern_basic() {\n        assert!(matches_pattern(\n            \"src/components/button.tsx\",\n            \"src/components/\"\n        ));\n        assert!(!matches_pattern(\"src/services/api.ts\", \"src/components/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_with_relative_imports() {\n        assert!(matches_pattern(\"../services/userservice\", \"src/services/\"));\n        assert!(matches_pattern(\"@/services/api\", \"src/services/\"));\n    }\n}\n","traces":[{"line":8,"address":[25252061,25252067,25251424],"length":1,"stats":{"Line":0}},{"line":9,"address":[25251484,25251612,25251733],"length":1,"stats":{"Line":0}},{"line":16,"address":[25252027],"length":1,"stats":{"Line":0}},{"line":21,"address":[25249520,25251348,25251401],"length":1,"stats":{"Line":0}},{"line":22,"address":[25249584],"length":1,"stats":{"Line":0}},{"line":23,"address":[25249828],"length":1,"stats":{"Line":0}},{"line":26,"address":[25249855,25249917],"length":1,"stats":{"Line":0}},{"line":27,"address":[25249954],"length":1,"stats":{"Line":0}},{"line":38,"address":[25249983,25249931],"length":1,"stats":{"Line":0}},{"line":39,"address":[25250053],"length":1,"stats":{"Line":0}},{"line":44,"address":[25250030,25250082],"length":1,"stats":{"Line":0}},{"line":46,"address":[25250163],"length":1,"stats":{"Line":0}},{"line":48,"address":[25250348],"length":1,"stats":{"Line":0}},{"line":49,"address":[25250499,25250570],"length":1,"stats":{"Line":0}},{"line":50,"address":[25250765,25250694],"length":1,"stats":{"Line":0}},{"line":52,"address":[25250877,25250948],"length":1,"stats":{"Line":0}},{"line":53,"address":[25250989,25251046],"length":1,"stats":{"Line":0}},{"line":54,"address":[25251087],"length":1,"stats":{"Line":0}},{"line":55,"address":[25251159],"length":1,"stats":{"Line":0}},{"line":57,"address":[25251006],"length":1,"stats":{"Line":0}},{"line":62,"address":[25250125],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":21},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","swc_parser.rs"],"content":"//! SWC-based parser for TypeScript/JavaScript files\n\nuse crate::autofix::Violation;\nuse crate::config::{ArchError, LinterContext};\nuse crate::parsers;\nuse miette::{IntoDiagnostic, Result, SourceSpan};\nuse std::fs;\nuse std::path::PathBuf;\nuse swc_common::SourceMap;\nuse swc_ecma_parser::{lexer::Lexer, EsConfig, Parser, StringInput, Syntax, TsConfig};\n\nuse super::pattern_matcher::{matches_pattern, normalize_pattern};\n\n/// Analyze a single file for architecture violations\npub fn analyze_file(cm: \u0026SourceMap, path: \u0026PathBuf, ctx: \u0026LinterContext) -\u003e Result\u003c()\u003e {\n    // Try to use multi-language parser first\n    if let Some(parser) = parsers::get_parser_for_file(path) {\n        let source_code = fs::read_to_string(path).into_diagnostic()?;\n        let violations = parser.find_violations(\u0026source_code, path, ctx)?;\n\n        if let Some(first_violation) = violations.first() {\n            // Return error for the first violation\n            let fm = cm.load_file(path).into_diagnostic()?;\n            return Err(create_error_from_violation(\u0026fm, first_violation));\n        }\n\n        // Validate method length for TypeScript/JavaScript files\n        let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n        if matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n            validate_method_length(cm, path, ctx)?;\n        }\n\n        return Ok(());\n    }\n\n    // Fallback to old swc parser for unsupported files\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    // Detectar si es TypeScript o JavaScript según la extensión\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e Syntax::Typescript(TsConfig::default()),\n    };\n\n    // Create lexer and parser - these will be dropped when they go out of scope\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    // Parse module immediately and process to avoid keeping AST in memory\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(e) =\u003e {\n            // Clean up parser and lexer before returning error\n            drop(parser);\n            return Err(miette::miette!(\"Syntax Error: {:?}\", e));\n        }\n    };\n\n    let file_path_str = path.to_string_lossy().to_lowercase();\n\n    // Process all imports and class definitions, then drop AST\n    let result = process_module_items(cm, \u0026fm, \u0026module, \u0026file_path_str, ctx);\n\n    // Explicitly drop AST objects to free memory\n    drop(module);\n    drop(parser);\n\n    result\n}\n\n/// Helper function to process module items and extract analysis data\nfn process_module_items(\n    _cm: \u0026SourceMap,\n    fm: \u0026swc_common::SourceFile,\n    module: \u0026swc_ecma_ast::Module,\n    file_path_str: \u0026str,\n    ctx: \u0026LinterContext,\n) -\u003e Result\u003c()\u003e {\n    for item in \u0026module.body {\n        // --- VALIDACIÓN DE IMPORTACIONES DINÁMICAS ---\n        if let swc_ecma_ast::ModuleItem::ModuleDecl(swc_ecma_ast::ModuleDecl::Import(import)) = item\n        {\n            let source = import.src.value.to_string().to_lowercase();\n\n            // 1. Validamos las reglas dinámicas del JSON\n            for rule in \u0026ctx.forbidden_imports {\n                // Normalizar patrones: quitar '**', '*', y '/' al final para matching flexible\n                let from_pattern = normalize_pattern(\u0026rule.from);\n                let to_pattern = normalize_pattern(\u0026rule.to);\n\n                // Verificar si el archivo coincide con el patrón 'from'\n                let file_matches = matches_pattern(\u0026file_path_str, \u0026from_pattern);\n\n                // Verificar si el import coincide con el patrón 'to'\n                let import_matches = matches_pattern(\u0026source, \u0026to_pattern);\n\n                if file_matches \u0026\u0026 import_matches {\n                    return Err(create_error(\n                        \u0026fm,\n                        import.span,\n                        \u0026format!(\n                            \"Restricción: Archivos en '{}' no pueden importar de '{}'.\",\n                            rule.from, rule.to\n                        ),\n                    ));\n                }\n            }\n\n            // 2. Regla extra: Siempre prohibir Repository en Controller (Standard NestJS)\n            if file_path_str.contains(\"controller\") \u0026\u0026 source.contains(\".repository\") {\n                return Err(create_error(\n                    \u0026fm,\n                    import.span,\n                    \"MVC: Prohibido importar Repositorios en Controladores.\",\n                ));\n            }\n        }\n\n        // --- VALIDACIÓN DE LÍNEAS POR MÉTODO ---\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(m) = member {\n                    let lo = fm.start_pos.0 as usize + m.span.lo.0 as usize;\n                    let hi = fm.start_pos.0 as usize + m.span.hi.0 as usize;\n                    let lines = (hi / 80) - (lo / 80); // Approximate line count\n\n                    if lines \u003e ctx.max_lines {\n                        return Err(create_error(\n                            \u0026fm,\n                            m.span,\n                            \u0026format!(\n                                \"Método demasiado largo ({} líneas). Máximo: {}.\",\n                                lines, ctx.max_lines\n                            ),\n                        ));\n                    }\n                }\n            }\n        }\n    }\n    Ok(())\n}\n\n/// Validate method length for TypeScript/JavaScript files using swc\n/// Ensures AST is properly scoped and dropped after analysis\npub fn validate_method_length(cm: \u0026SourceMap, path: \u0026PathBuf, ctx: \u0026LinterContext) -\u003e Result\u003c()\u003e {\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(()),\n    };\n\n    // Create lexer and parser - these will be dropped when they go out of scope\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    // Parse module and immediately extract required information\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(()), // Skip on syntax error\n    };\n\n    // Process the AST and immediately drop references to large structures\n    let _functions_extracted = count_methods_in_module(\u0026fm, \u0026module, ctx);\n\n    // Explicitly drop the module to free memory\n    drop(module);\n\n    // Additional cleanup - ensure no references remain to AST structures\n    drop(parser);\n\n    // Return result based on extracted functions\n    Ok(())\n}\n\n/// Helper function to count methods in a module and extract analysis data\nfn count_methods_in_module(\n    fm: \u0026swc_common::SourceFile,\n    module: \u0026swc_ecma_ast::Module,\n    ctx: \u0026LinterContext,\n) -\u003e usize {\n    let mut method_count = 0;\n\n    for item in \u0026module.body {\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(m) = member {\n                    let lo = fm.start_pos.0 as usize + m.span.lo.0 as usize;\n                    let hi = fm.start_pos.0 as usize + m.span.hi.0 as usize;\n                    let lines = (hi / 80) - (lo / 80); // Approximate line count\n\n                    if lines \u003e ctx.max_lines {\n                        // Just count the method, don't return error\n                        println!(\"Method too long: {} lines\", lines);\n                    }\n                    method_count += 1;\n                }\n            }\n        }\n    }\n\n    method_count\n}\n\n/// Create a miette error from SWC span\npub fn create_error(\n    fm: \u0026swc_common::SourceFile,\n    span: swc_common::Span,\n    msg: \u0026str,\n) -\u003e miette::Report {\n    let start = (span.lo.0 - fm.start_pos.0) as usize;\n    let end = (span.hi.0 - fm.start_pos.0) as usize;\n\n    ArchError {\n        src: fm.src.to_string(),\n        span: SourceSpan::new(start.into(), (end - start).into()),\n        message: msg.to_string(),\n    }\n    .into()\n}\n\n/// Create a miette error from a Violation\npub fn create_error_from_violation(\n    fm: \u0026swc_common::SourceFile,\n    violation: \u0026Violation,\n) -\u003e miette::Report {\n    // Try to find the import line in the source\n    let lines: Vec\u003c\u0026str\u003e = fm.src.lines().collect();\n    let line_idx = violation.line_number.saturating_sub(1);\n\n    if line_idx \u003c lines.len() {\n        let line_content = lines[line_idx];\n        // Find the position of the import statement in the file\n        let mut char_offset = 0;\n        for (idx, line) in lines.iter().enumerate() {\n            if idx == line_idx {\n                break;\n            }\n            char_offset += line.len() + 1; // +1 for newline\n        }\n\n        ArchError {\n            src: fm.src.to_string(),\n            span: SourceSpan::new(char_offset.into(), line_content.len().into()),\n            message: format!(\n                \"Restricción: Archivos en '{}' no pueden importar de '{}'.\",\n                violation.rule.from, violation.rule.to\n            ),\n        }\n        .into()\n    } else {\n        // Fallback if line number is out of bounds\n        miette::miette!(\n            \"Restricción: Archivos en '{}' no pueden importar de '{}' (línea {}).\",\n            violation.rule.from,\n            violation.rule.to,\n            violation.line_number\n        )\n    }\n}\n\n/// Collect violations from a file without failing\n/// Useful for --fix mode where we want to process all violations\npub fn collect_violations_from_file(\n    _cm: \u0026SourceMap,\n    path: \u0026PathBuf,\n    ctx: \u0026LinterContext,\n) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n    // Try to use multi-language parser first\n    if let Some(parser) = parsers::get_parser_for_file(path) {\n        let source_code = fs::read_to_string(path).into_diagnostic()?;\n        return parser.find_violations(\u0026source_code, path, ctx);\n    }\n\n    // Fallback: return empty violations for unsupported files\n    Ok(Vec::new())\n}\n","traces":[{"line":15,"address":[24633472,24635840,24635111],"length":1,"stats":{"Line":0}},{"line":17,"address":[24633546],"length":1,"stats":{"Line":0}},{"line":18,"address":[24633666,24633825,24635814],"length":1,"stats":{"Line":0}},{"line":19,"address":[24634172,24634025,24635780],"length":1,"stats":{"Line":0}},{"line":21,"address":[24634446,24634541],"length":1,"stats":{"Line":0}},{"line":23,"address":[24635125,24634720,24634639],"length":1,"stats":{"Line":0}},{"line":24,"address":[24634948,24635035],"length":1,"stats":{"Line":0}},{"line":28,"address":[24635151,24634670],"length":1,"stats":{"Line":0}},{"line":29,"address":[24635325],"length":1,"stats":{"Line":0}},{"line":30,"address":[24635593],"length":1,"stats":{"Line":0}},{"line":33,"address":[24635552],"length":1,"stats":{"Line":0}},{"line":37,"address":[24633696,24635853],"length":1,"stats":{"Line":0}},{"line":40,"address":[24373040,24373054],"length":1,"stats":{"Line":0}},{"line":42,"address":[24636890,24636156,24636296],"length":1,"stats":{"Line":0}},{"line":44,"address":[24636253],"length":1,"stats":{"Line":0}},{"line":45,"address":[24636812],"length":1,"stats":{"Line":0}},{"line":47,"address":[24636442,24636630,24636302],"length":1,"stats":{"Line":0}},{"line":49,"address":[24636399],"length":1,"stats":{"Line":0}},{"line":50,"address":[24636616],"length":1,"stats":{"Line":0}},{"line":52,"address":[24636448],"length":1,"stats":{"Line":0}},{"line":56,"address":[24636555,24636996],"length":1,"stats":{"Line":0}},{"line":57,"address":[24637133],"length":1,"stats":{"Line":0}},{"line":60,"address":[24637167,24637235],"length":1,"stats":{"Line":0}},{"line":61,"address":[24637358],"length":1,"stats":{"Line":0}},{"line":62,"address":[24637272],"length":1,"stats":{"Line":0}},{"line":64,"address":[24637288],"length":1,"stats":{"Line":0}},{"line":65,"address":[24638142],"length":1,"stats":{"Line":0}},{"line":69,"address":[24637462,24637538],"length":1,"stats":{"Line":0}},{"line":72,"address":[24637707],"length":1,"stats":{"Line":0}},{"line":75,"address":[24637820],"length":1,"stats":{"Line":0}},{"line":76,"address":[24637939],"length":1,"stats":{"Line":0}},{"line":78,"address":[24637998],"length":1,"stats":{"Line":0}},{"line":82,"address":[24641126,24639024,24641132],"length":1,"stats":{"Line":0}},{"line":89,"address":[24639106,24639128],"length":1,"stats":{"Line":0}},{"line":91,"address":[24639306,24639205],"length":1,"stats":{"Line":0}},{"line":93,"address":[24639366],"length":1,"stats":{"Line":0}},{"line":96,"address":[24639666],"length":1,"stats":{"Line":0}},{"line":98,"address":[24639823,24640153],"length":1,"stats":{"Line":0}},{"line":99,"address":[24640263,24640168],"length":1,"stats":{"Line":0}},{"line":102,"address":[24640270,24640409],"length":1,"stats":{"Line":0}},{"line":105,"address":[24640447],"length":1,"stats":{"Line":0}},{"line":107,"address":[24640633,24640603],"length":1,"stats":{"Line":0}},{"line":108,"address":[24641023],"length":1,"stats":{"Line":0}},{"line":109,"address":[24640655],"length":1,"stats":{"Line":0}},{"line":110,"address":[24640671],"length":1,"stats":{"Line":0}},{"line":111,"address":[24640693,24640773],"length":1,"stats":{"Line":0}},{"line":120,"address":[24639935,24639849],"length":1,"stats":{"Line":0}},{"line":121,"address":[24640055],"length":1,"stats":{"Line":0}},{"line":122,"address":[24640025],"length":1,"stats":{"Line":0}},{"line":123,"address":[24640033],"length":1,"stats":{"Line":0}},{"line":130,"address":[24639281,24641177],"length":1,"stats":{"Line":0}},{"line":131,"address":[24641214],"length":1,"stats":{"Line":0}},{"line":134,"address":[24641237,24641347],"length":1,"stats":{"Line":0}},{"line":135,"address":[24641425],"length":1,"stats":{"Line":0}},{"line":136,"address":[24641570,24641480],"length":1,"stats":{"Line":0}},{"line":137,"address":[24641655,24641533,24641588],"length":1,"stats":{"Line":0}},{"line":138,"address":[24641596,24641681,24641708],"length":1,"stats":{"Line":0}},{"line":140,"address":[24641689],"length":1,"stats":{"Line":0}},{"line":141,"address":[24642029],"length":1,"stats":{"Line":0}},{"line":142,"address":[24641734],"length":1,"stats":{"Line":0}},{"line":143,"address":[24641747],"length":1,"stats":{"Line":0}},{"line":144,"address":[24641769],"length":1,"stats":{"Line":0}},{"line":154,"address":[24639230],"length":1,"stats":{"Line":0}},{"line":159,"address":[24642096,24644079,24643992],"length":1,"stats":{"Line":0}},{"line":160,"address":[24642164],"length":1,"stats":{"Line":0}},{"line":162,"address":[24373072,24373086],"length":1,"stats":{"Line":0}},{"line":164,"address":[24642517,24643122,24642642],"length":1,"stats":{"Line":0}},{"line":166,"address":[24642605],"length":1,"stats":{"Line":0}},{"line":167,"address":[24643053],"length":1,"stats":{"Line":0}},{"line":169,"address":[24642648,24642770,24642826],"length":1,"stats":{"Line":0}},{"line":171,"address":[24642736],"length":1,"stats":{"Line":0}},{"line":172,"address":[24642815],"length":1,"stats":{"Line":0}},{"line":174,"address":[24642776],"length":1,"stats":{"Line":0}},{"line":178,"address":[24643228,24643003],"length":1,"stats":{"Line":0}},{"line":179,"address":[24643356],"length":1,"stats":{"Line":0}},{"line":182,"address":[24643458,24643390],"length":1,"stats":{"Line":0}},{"line":183,"address":[24643553],"length":1,"stats":{"Line":0}},{"line":184,"address":[24643495],"length":1,"stats":{"Line":0}},{"line":188,"address":[24643669,24643755],"length":1,"stats":{"Line":0}},{"line":191,"address":[24643780],"length":1,"stats":{"Line":0}},{"line":194,"address":[24643855],"length":1,"stats":{"Line":0}},{"line":197,"address":[24643912],"length":1,"stats":{"Line":0}},{"line":201,"address":[24644096],"length":1,"stats":{"Line":0}},{"line":206,"address":[24644150],"length":1,"stats":{"Line":0}},{"line":208,"address":[24644175,24644159],"length":1,"stats":{"Line":0}},{"line":209,"address":[24644313,24644261],"length":1,"stats":{"Line":0}},{"line":210,"address":[24644344],"length":1,"stats":{"Line":0}},{"line":213,"address":[24644367,24644477],"length":1,"stats":{"Line":0}},{"line":214,"address":[24644981,24644555],"length":1,"stats":{"Line":0}},{"line":215,"address":[24644615,24644694],"length":1,"stats":{"Line":0}},{"line":216,"address":[24644665,24644779,24644712],"length":1,"stats":{"Line":0}},{"line":217,"address":[24644720,24644802,24644826],"length":1,"stats":{"Line":0}},{"line":219,"address":[24644810],"length":1,"stats":{"Line":0}},{"line":221,"address":[24644863],"length":1,"stats":{"Line":0}},{"line":223,"address":[24644986,24644839,24644976],"length":1,"stats":{"Line":0}},{"line":229,"address":[24644271],"length":1,"stats":{"Line":0}},{"line":233,"address":[24638416,24638990],"length":1,"stats":{"Line":0}},{"line":238,"address":[24638539,24638467],"length":1,"stats":{"Line":0}},{"line":239,"address":[24638561,24638628,24638516],"length":1,"stats":{"Line":0}},{"line":242,"address":[24638576],"length":1,"stats":{"Line":0}},{"line":243,"address":[24638695,24638605],"length":1,"stats":{"Line":0}},{"line":244,"address":[24638820],"length":1,"stats":{"Line":0}},{"line":250,"address":[24645008,24646779,24646773],"length":1,"stats":{"Line":0}},{"line":255,"address":[24645047],"length":1,"stats":{"Line":0}},{"line":256,"address":[24645204,24645128],"length":1,"stats":{"Line":0}},{"line":258,"address":[24645212],"length":1,"stats":{"Line":0}},{"line":259,"address":[24645345,24645692],"length":1,"stats":{"Line":0}},{"line":261,"address":[24645731],"length":1,"stats":{"Line":0}},{"line":262,"address":[24645743,24646226],"length":1,"stats":{"Line":0}},{"line":263,"address":[24646074],"length":1,"stats":{"Line":0}},{"line":266,"address":[24646231,24646121],"length":1,"stats":{"Line":0}},{"line":270,"address":[24646087],"length":1,"stats":{"Line":0}},{"line":271,"address":[24646340,24646249],"length":1,"stats":{"Line":0}},{"line":272,"address":[24646439],"length":1,"stats":{"Line":0}},{"line":280,"address":[24645382,24645268],"length":1,"stats":{"Line":0}},{"line":291,"address":[24647511,24646800,24647490],"length":1,"stats":{"Line":0}},{"line":297,"address":[24646859],"length":1,"stats":{"Line":0}},{"line":298,"address":[24646945,24647496,24647067],"length":1,"stats":{"Line":0}},{"line":299,"address":[24647264,24647384],"length":1,"stats":{"Line":0}},{"line":303,"address":[24646964],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":120},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","autofix.rs"],"content":"use crate::config::{AIConfig, ForbiddenRule};\nuse miette::{IntoDiagnostic, Result};\nuse serde::{Deserialize, Serialize};\nuse std::fs;\nuse std::path::{Path, PathBuf};\n\n/// Representa una violación arquitectónica detectada\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Violation {\n    /// Ruta del archivo con la violación\n    pub file_path: PathBuf,\n    /// Contenido completo del archivo\n    pub file_content: String,\n    /// Import ofensivo que causa la violación\n    pub offensive_import: String,\n    /// Regla que fue violada\n    pub rule: ForbiddenRule,\n    /// Línea donde ocurre la violación\n    pub line_number: usize,\n}\n\n/// Tipo de fix sugerido por la IA\n#[derive(Debug, Deserialize, Serialize)]\n#[serde(tag = \"fix_type\", rename_all = \"snake_case\")]\npub enum FixType {\n    /// Refactorizar código (cambiar imports, crear interfaces)\n    Refactor { old_code: String, new_code: String },\n    /// Mover archivo a otra capa\n    MoveFile { from: String, to: String },\n    /// Crear nueva interfaz/abstracción\n    CreateInterface {\n        interface_path: String,\n        interface_code: String,\n        updated_import: String,\n    },\n}\n\n/// Respuesta estructurada de la IA\n#[derive(Debug, Deserialize, Serialize)]\npub struct FixSuggestion {\n    pub fix_type: FixType,\n    pub explanation: String,\n    pub confidence: String, // \"high\", \"medium\", \"low\"\n}\n\n/// Consulta a la IA para obtener una sugerencia de fix\npub async fn suggest_fix(\n    violation: \u0026Violation,\n    project_root: \u0026Path,\n    ai_configs: \u0026[AIConfig],\n) -\u003e Result\u003cFixSuggestion\u003e {\n    // Obtener estructura de carpetas del proyecto\n    let folder_structure = get_project_structure(project_root);\n\n    // Construir prompt estructurado\n    let prompt = format!(\n        r#\"Eres un arquitecto de software experto. Analiza esta violación arquitectónica y sugiere una refactorización.\n\n**CONTEXTO DEL PROYECTO:**\nEstructura de carpetas:\n{}\n\n**VIOLACIÓN DETECTADA:**\nArchivo: {}\nRegla violada: Archivos en '{}' no pueden importar de '{}'\nImport ofensivo (línea {}): {}\n\n**CÓDIGO DEL ARCHIVO:**\n```typescript\n{}\n```\n\n**TAREA:**\nSugiere la mejor refactorización para resolver esta violación. Responde ÚNICAMENTE con un objeto JSON válido usando uno de estos formatos:\n\n1. Para refactorizar código:\n{{\n  \"fix_type\": \"refactor\",\n  \"old_code\": \"import {{ X }} from '../infrastructure/...'\",\n  \"new_code\": \"import {{ X }} from '../domain/interfaces/...'\",\n  \"explanation\": \"Crear una interfaz en la capa de dominio...\",\n  \"confidence\": \"high\"\n}}\n\n2. Para mover archivo:\n{{\n  \"fix_type\": \"move_file\",\n  \"from\": \"src/domain/user.entity.ts\",\n  \"to\": \"src/infrastructure/models/user.entity.ts\",\n  \"explanation\": \"Este archivo pertenece a la capa de infraestructura...\",\n  \"confidence\": \"medium\"\n}}\n\n3. Para crear interfaz:\n{{\n  \"fix_type\": \"create_interface\",\n  \"interface_path\": \"src/domain/interfaces/IUserRepository.ts\",\n  \"interface_code\": \"export interface IUserRepository {{ ... }}\",\n  \"updated_import\": \"import {{ IUserRepository }} from './interfaces/IUserRepository'\",\n  \"explanation\": \"Crear una abstracción para desacoplar...\",\n  \"confidence\": \"high\"\n}}\n\nResponde SOLO con el JSON, sin texto adicional.\"#,\n        folder_structure,\n        violation.file_path.display(),\n        violation.rule.from,\n        violation.rule.to,\n        violation.line_number,\n        violation.offensive_import,\n        violation.file_content\n    );\n\n    // Hacer la petición a la IA usando el sistema de fallback\n    let content = crate::ai::consultar_ia_con_fallback(prompt, ai_configs)\n        .map_err(|e| miette::miette!(\"No se pudo obtener sugerencia de ningún modelo: {}\", e))?;\n\n    // Limpiar markdown code blocks si existen\n    let json_content = content\n        .trim()\n        .trim_start_matches(\"```json\")\n        .trim_start_matches(\"```\")\n        .trim_end_matches(\"```\")\n        .trim();\n\n    // Buscar el primer '{' y el último '}' para casos donde la IA añade texto\n    let json_start = json_content.find('{').ok_or_else(|| {\n        miette::miette!(\"No se encontró JSON en la respuesta de la IA: {}\", content)\n    })?;\n    let json_end = json_content.rfind('}').unwrap_or(json_content.len() - 1) + 1;\n    let clean_json = \u0026json_content[json_start..json_end];\n\n    // Parsear la respuesta JSON\n    let suggestion: FixSuggestion =\n        serde_json::from_str(clean_json)\n            .into_diagnostic()\n            .map_err(|e| {\n                miette::miette!(\n                    \"Error parseando respuesta de IA: {}. Contenido: {}\",\n                    e,\n                    clean_json\n                )\n            })?;\n\n    Ok(suggestion)\n}\n\n/// Aplica un fix sugerido\npub fn apply_fix(\n    suggestion: \u0026FixSuggestion,\n    violation: \u0026Violation,\n    project_root: \u0026Path,\n) -\u003e Result\u003cString\u003e {\n    match \u0026suggestion.fix_type {\n        FixType::Refactor { old_code, new_code } =\u003e apply_refactor(violation, old_code, new_code),\n        FixType::MoveFile { from, to } =\u003e apply_move_file(project_root, from, to),\n        FixType::CreateInterface {\n            interface_path,\n            interface_code,\n            updated_import,\n        } =\u003e apply_create_interface(\n            project_root,\n            violation,\n            interface_path,\n            interface_code,\n            updated_import,\n        ),\n    }\n}\n\n/// Aplica una refactorización de código\nfn apply_refactor(violation: \u0026Violation, old_code: \u0026str, new_code: \u0026str) -\u003e Result\u003cString\u003e {\n    let content = fs::read_to_string(\u0026violation.file_path).into_diagnostic()?;\n\n    // Reemplazar el código antiguo por el nuevo\n    let updated_content = content.replace(old_code.trim(), new_code.trim());\n\n    if content == updated_content {\n        return Err(miette::miette!(\n            \"No se pudo aplicar el fix: el código antiguo no se encontró exactamente\"\n        ));\n    }\n\n    // Escribir el archivo actualizado\n    fs::write(\u0026violation.file_path, \u0026updated_content).into_diagnostic()?;\n\n    Ok(format!(\n        \"✅ Refactorizado: {}\",\n        violation.file_path.display()\n    ))\n}\n\n/// Aplica el movimiento de un archivo\nfn apply_move_file(project_root: \u0026Path, from: \u0026str, to: \u0026str) -\u003e Result\u003cString\u003e {\n    let from_path = project_root.join(from);\n    let to_path = project_root.join(to);\n\n    // Crear el directorio destino si no existe\n    if let Some(parent) = to_path.parent() {\n        fs::create_dir_all(parent).into_diagnostic()?;\n    }\n\n    // Mover el archivo\n    fs::rename(\u0026from_path, \u0026to_path).into_diagnostic()?;\n\n    Ok(format!(\"✅ Archivo movido: {} → {}\", from, to))\n}\n\n/// Crea una nueva interfaz y actualiza el import\nfn apply_create_interface(\n    project_root: \u0026Path,\n    violation: \u0026Violation,\n    interface_path: \u0026str,\n    interface_code: \u0026str,\n    updated_import: \u0026str,\n) -\u003e Result\u003cString\u003e {\n    let interface_full_path = project_root.join(interface_path);\n\n    // Crear el directorio si no existe\n    if let Some(parent) = interface_full_path.parent() {\n        fs::create_dir_all(parent).into_diagnostic()?;\n    }\n\n    // Crear el archivo de interfaz\n    fs::write(\u0026interface_full_path, interface_code).into_diagnostic()?;\n\n    // Actualizar el import en el archivo original\n    let content = fs::read_to_string(\u0026violation.file_path).into_diagnostic()?;\n    let updated_content = content.replace(\u0026violation.offensive_import, updated_import);\n    fs::write(\u0026violation.file_path, updated_content).into_diagnostic()?;\n\n    Ok(format!(\n        \"✅ Interfaz creada: {} y import actualizado en {}\",\n        interface_path,\n        violation.file_path.display()\n    ))\n}\n\n/// Obtiene la estructura de carpetas del proyecto\nfn get_project_structure(root: \u0026Path) -\u003e String {\n    let mut structure = String::new();\n\n    if let Ok(entries) = fs::read_dir(root) {\n        for entry in entries.flatten() {\n            if let Ok(metadata) = entry.metadata() {\n                let name = entry.file_name().to_string_lossy().to_string();\n\n                // Ignorar node_modules, .git, etc.\n                if name.starts_with('.') || name == \"node_modules\" {\n                    continue;\n                }\n\n                if metadata.is_dir() {\n                    structure.push_str(\u0026format!(\"  📁 {}/\\n\", name));\n\n                    // Listar subdirectorios (máximo 2 niveles)\n                    if let Ok(sub_entries) = fs::read_dir(entry.path()) {\n                        for sub_entry in sub_entries.flatten().take(5) {\n                            let sub_name = sub_entry.file_name().to_string_lossy().to_string();\n                            if !sub_name.starts_with('.') {\n                                structure.push_str(\u0026format!(\"    - {}\\n\", sub_name));\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    structure\n}\n","traces":[{"line":47,"address":[24419104],"length":1,"stats":{"Line":0}},{"line":53,"address":[24402869],"length":1,"stats":{"Line":0}},{"line":56,"address":[24403108],"length":1,"stats":{"Line":0}},{"line":106,"address":[24403045,24402965],"length":1,"stats":{"Line":0}},{"line":115,"address":[24403629,24403715,24403795,24405354],"length":1,"stats":{"Line":0}},{"line":116,"address":[24403688,24405568,24405585,24403779],"length":1,"stats":{"Line":0}},{"line":119,"address":[24403896,24404222],"length":1,"stats":{"Line":0}},{"line":127,"address":[24405327,24404421,24405392,24404257],"length":1,"stats":{"Line":0}},{"line":128,"address":[24405410],"length":1,"stats":{"Line":0}},{"line":130,"address":[24404709,24404484],"length":1,"stats":{"Line":0}},{"line":131,"address":[24404682,24404736],"length":1,"stats":{"Line":0}},{"line":134,"address":[24405306,24404752,24404849,24404929],"length":1,"stats":{"Line":0}},{"line":137,"address":[24405856,24406175,24406181,24404814],"length":1,"stats":{"Line":0}},{"line":138,"address":[24405967,24405886],"length":1,"stats":{"Line":0}},{"line":145,"address":[24405086],"length":1,"stats":{"Line":0}},{"line":149,"address":[24426288],"length":1,"stats":{"Line":0}},{"line":154,"address":[24426368],"length":1,"stats":{"Line":0}},{"line":155,"address":[24426461],"length":1,"stats":{"Line":0}},{"line":156,"address":[24426568],"length":1,"stats":{"Line":0}},{"line":157,"address":[24426695],"length":1,"stats":{"Line":0}},{"line":164,"address":[24426735],"length":1,"stats":{"Line":0}},{"line":165,"address":[24426755],"length":1,"stats":{"Line":0}},{"line":166,"address":[24426773],"length":1,"stats":{"Line":0}},{"line":172,"address":[24420516,24420510,24419168],"length":1,"stats":{"Line":0}},{"line":173,"address":[24419271],"length":1,"stats":{"Line":0}},{"line":176,"address":[24419480,24419595],"length":1,"stats":{"Line":0}},{"line":178,"address":[24419831,24419772],"length":1,"stats":{"Line":0}},{"line":179,"address":[24419869,24420371],"length":1,"stats":{"Line":0}},{"line":185,"address":[24419845,24419906,24420329],"length":1,"stats":{"Line":0}},{"line":187,"address":[24420118],"length":1,"stats":{"Line":0}},{"line":189,"address":[24420040],"length":1,"stats":{"Line":0}},{"line":194,"address":[24421571,24421577,24420544],"length":1,"stats":{"Line":0}},{"line":195,"address":[24420630],"length":1,"stats":{"Line":0}},{"line":196,"address":[24420692],"length":1,"stats":{"Line":0}},{"line":199,"address":[24420840,24420772],"length":1,"stats":{"Line":0}},{"line":200,"address":[24420950,24421006],"length":1,"stats":{"Line":0}},{"line":204,"address":[24421550,24421155,24420966],"length":1,"stats":{"Line":0}},{"line":206,"address":[24421286],"length":1,"stats":{"Line":0}},{"line":210,"address":[24424544,24426247,24426263],"length":1,"stats":{"Line":0}},{"line":217,"address":[24424720],"length":1,"stats":{"Line":0}},{"line":220,"address":[24424769,24424852],"length":1,"stats":{"Line":0}},{"line":221,"address":[24425044,24424974],"length":1,"stats":{"Line":0}},{"line":225,"address":[24425009,24426258,24425197],"length":1,"stats":{"Line":0}},{"line":228,"address":[24426253,24425331],"length":1,"stats":{"Line":0}},{"line":229,"address":[24425558,24425653],"length":1,"stats":{"Line":0}},{"line":230,"address":[24425684],"length":1,"stats":{"Line":0}},{"line":232,"address":[24425957],"length":1,"stats":{"Line":0}},{"line":235,"address":[24425879],"length":1,"stats":{"Line":0}},{"line":240,"address":[24424275,24421600,24424529],"length":1,"stats":{"Line":0}},{"line":241,"address":[24421663],"length":1,"stats":{"Line":0}},{"line":243,"address":[24421747,24421810,24421684],"length":1,"stats":{"Line":0}},{"line":244,"address":[24421918,24421843,24422042],"length":1,"stats":{"Line":0}},{"line":245,"address":[24422121,24422214,24422307],"length":1,"stats":{"Line":0}},{"line":246,"address":[24422309,24422388],"length":1,"stats":{"Line":0}},{"line":249,"address":[24422682,24422791],"length":1,"stats":{"Line":0}},{"line":253,"address":[24422805],"length":1,"stats":{"Line":0}},{"line":254,"address":[24422856],"length":1,"stats":{"Line":0}},{"line":257,"address":[24423100,24423217],"length":1,"stats":{"Line":0}},{"line":258,"address":[24423481,24423250,24423325],"length":1,"stats":{"Line":0}},{"line":259,"address":[24423560,24423661],"length":1,"stats":{"Line":0}},{"line":260,"address":[24423943],"length":1,"stats":{"Line":0}},{"line":261,"address":[24424008,24424057],"length":1,"stats":{"Line":0}},{"line":270,"address":[24424486],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":63},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","cache.rs"],"content":"use crate::analysis_result::{CategorizedViolation, LongFunction};\nuse crate::config::LinterContext;\nuse crate::memory_cache::MemoryCache;\nuse serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse std::fs;\nuse std::io;\nuse std::path::{Path, PathBuf};\n\nconst CACHE_VERSION: u32 = 1;\nconst CACHE_DIR: \u0026str = \".architect-cache\";\nconst CACHE_FILE: \u0026str = \"cache.json\";\n\n/// Per-file cached analysis data\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct FileCacheEntry {\n    pub content_hash: String,\n    pub violations: Vec\u003cCategorizedViolation\u003e,\n    pub long_functions: Vec\u003cLongFunction\u003e,\n    pub import_count: usize,\n    pub function_count: usize,\n}\n\n/// Disk-persisted analysis cache\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AnalysisCache {\n    pub version: u32,\n    pub config_hash: String,\n    pub files: HashMap\u003cString, FileCacheEntry\u003e,\n}\n\n/// Compute xxh3-64 hash of raw bytes, returned as hex string\npub fn hash_content(bytes: \u0026[u8]) -\u003e String {\n    format!(\"{:016x}\", xxhash_rust::xxh3::xxh3_64(bytes))\n}\n\n/// Compute a config hash from the fields that affect analysis results.\n/// If this changes, the entire cache is invalidated.\npub fn hash_config(ctx: \u0026LinterContext) -\u003e String {\n    let mut data = format!(\"max_lines={};imports=\", ctx.max_lines);\n    for rule in \u0026ctx.forbidden_imports {\n        data.push_str(\u0026rule.from);\n        data.push(':');\n        data.push_str(\u0026rule.to);\n        data.push(';');\n    }\n    hash_content(data.as_bytes())\n}\n\nimpl AnalysisCache {\n    /// Create a new empty cache with the given config hash\n    pub fn new(config_hash: String) -\u003e Self {\n        Self {\n            version: CACHE_VERSION,\n            config_hash,\n            files: HashMap::new(),\n        }\n    }\n\n    /// Load cache from disk. Returns None if the file doesn't exist,\n    /// can't be parsed, or has a version/config mismatch.\n    pub fn load(project_root: \u0026Path, config_hash: \u0026str) -\u003e Option\u003cSelf\u003e {\n        let cache_path = project_root.join(CACHE_DIR).join(CACHE_FILE);\n        let data = fs::read_to_string(\u0026cache_path).ok()?;\n        let cache: Self = serde_json::from_str(\u0026data).ok()?;\n\n        if cache.version != CACHE_VERSION || cache.config_hash != config_hash {\n            return None;\n        }\n\n        Some(cache)\n    }\n\n    /// Persist cache to disk\n    pub fn save(\u0026self, project_root: \u0026Path) -\u003e io::Result\u003c()\u003e {\n        let cache_dir = project_root.join(CACHE_DIR);\n        fs::create_dir_all(\u0026cache_dir)?;\n        let cache_path = cache_dir.join(CACHE_FILE);\n        let json =\n            serde_json::to_string(self).map_err(|e| io::Error::new(io::ErrorKind::Other, e))?;\n        fs::write(\u0026cache_path, json)\n    }\n\n    /// Convert an absolute path to a normalized relative key (forward slashes)\n    pub fn normalize_path(path: \u0026Path, project_root: \u0026Path) -\u003e String {\n        path.strip_prefix(project_root)\n            .unwrap_or(path)\n            .to_string_lossy()\n            .replace('\\\\', \"/\")\n    }\n\n    /// Look up a cached entry. Returns Some only if the content hash matches.\n    pub fn get(\u0026self, key: \u0026str, content_hash: \u0026str) -\u003e Option\u003c\u0026FileCacheEntry\u003e {\n        self.files\n            .get(key)\n            .filter(|e| e.content_hash == content_hash)\n    }\n\n    /// Insert or update a cache entry\n    pub fn insert(\u0026mut self, key: String, entry: FileCacheEntry) {\n        self.files.insert(key, entry);\n    }\n\n    /// Remove a file from the cache (e.g. when a watched file changes)\n    pub fn remove(\u0026mut self, key: \u0026str) {\n        self.files.remove(key);\n    }\n}\n\n/// Hybrid cache combining memory (LRU) and disk cache layers\npub struct HybridCache {\n    memory: MemoryCache,\n    disk: AnalysisCache,\n}\n\nimpl HybridCache {\n    pub fn new(\n        memory_capacity: usize,\n        project_root: \u0026Path,\n        config_hash: String,\n    ) -\u003e Result\u003cSelf, Box\u003cdyn std::error::Error\u003e\u003e {\n        // Load disk cache from disk if it exists, otherwise create new\n        let disk = AnalysisCache::load(project_root, \u0026config_hash)\n            .unwrap_or_else(|| AnalysisCache::new(config_hash));\n\n        Ok(Self {\n            memory: MemoryCache::new(memory_capacity),\n            disk,\n        })\n    }\n\n    pub fn get(\u0026self, path: \u0026PathBuf) -\u003e Option\u003cString\u003e {\n        // Layer 1: Memory cache\n        if let Some(content) = self.memory.get(path) {\n            return Some(content);\n        }\n\n        // Layer 2: Disk cache\n        let key = path.to_string_lossy().replace('\\\\', \"/\");\n        if let Some(entry) = self.disk.files.get(\u0026key) {\n            // Promote to memory cache\n            self.memory.put(path.clone(), entry.content_hash.clone());\n            return Some(entry.content_hash.clone());\n        }\n\n        None\n    }\n\n    pub fn put(\u0026mut self, path: PathBuf, entry: FileCacheEntry) {\n        let key = path.to_string_lossy().replace('\\\\', \"/\");\n        // Update both layers\n        self.memory.put(path, entry.content_hash.clone());\n        self.disk.files.insert(key, entry);\n    }\n\n    pub fn clear_memory(\u0026self) {\n        self.memory.clear();\n    }\n\n    pub fn save(\u0026self, project_root: \u0026Path) -\u003e io::Result\u003c()\u003e {\n        self.disk.save(project_root)\n    }\n}\n","traces":[{"line":33,"address":[25243072],"length":1,"stats":{"Line":0}},{"line":34,"address":[25243120],"length":1,"stats":{"Line":0}},{"line":39,"address":[25243051,25243045,25242528],"length":1,"stats":{"Line":0}},{"line":40,"address":[25242558],"length":1,"stats":{"Line":0}},{"line":41,"address":[25242672,25242744],"length":1,"stats":{"Line":0}},{"line":42,"address":[25242849,25242953],"length":1,"stats":{"Line":0}},{"line":43,"address":[25242970],"length":1,"stats":{"Line":0}},{"line":44,"address":[25242982],"length":1,"stats":{"Line":0}},{"line":45,"address":[25243033],"length":1,"stats":{"Line":0}},{"line":47,"address":[25242871],"length":1,"stats":{"Line":0}},{"line":52,"address":[25243616,25243760],"length":1,"stats":{"Line":0}},{"line":56,"address":[25243646],"length":1,"stats":{"Line":0}},{"line":62,"address":[25244825,25243776,25244783],"length":1,"stats":{"Line":0}},{"line":63,"address":[25243819],"length":1,"stats":{"Line":0}},{"line":64,"address":[25244823,25244010],"length":1,"stats":{"Line":0}},{"line":65,"address":[25244287,25244808,25244216],"length":1,"stats":{"Line":0}},{"line":67,"address":[25244590,25244468],"length":1,"stats":{"Line":0}},{"line":68,"address":[25244517],"length":1,"stats":{"Line":0}},{"line":71,"address":[25244601],"length":1,"stats":{"Line":0}},{"line":75,"address":[25244848,25245666,25245601],"length":1,"stats":{"Line":0}},{"line":76,"address":[25244884],"length":1,"stats":{"Line":0}},{"line":77,"address":[25244991,25244929,25245659],"length":1,"stats":{"Line":0}},{"line":78,"address":[25245089],"length":1,"stats":{"Line":0}},{"line":79,"address":[24281600,24281612],"length":1,"stats":{"Line":0}},{"line":81,"address":[25245415,25245526],"length":1,"stats":{"Line":0}},{"line":85,"address":[25243530,25243248,25243524],"length":1,"stats":{"Line":0}},{"line":86,"address":[25243340,25243397],"length":1,"stats":{"Line":0}},{"line":87,"address":[25243365],"length":1,"stats":{"Line":0}},{"line":93,"address":[25243552],"length":1,"stats":{"Line":0}},{"line":94,"address":[25243580],"length":1,"stats":{"Line":0}},{"line":95,"address":[25243584],"length":1,"stats":{"Line":0}},{"line":96,"address":[24281572,24281552],"length":1,"stats":{"Line":0}},{"line":100,"address":[25245680],"length":1,"stats":{"Line":0}},{"line":101,"address":[25245705],"length":1,"stats":{"Line":0}},{"line":105,"address":[25245824],"length":1,"stats":{"Line":0}},{"line":106,"address":[25245852],"length":1,"stats":{"Line":0}},{"line":117,"address":[25241633,25241216],"length":1,"stats":{"Line":0}},{"line":123,"address":[25241379,25241285],"length":1,"stats":{"Line":0}},{"line":124,"address":[24281488,24281500],"length":1,"stats":{"Line":0}},{"line":126,"address":[25241563],"length":1,"stats":{"Line":0}},{"line":127,"address":[25241478],"length":1,"stats":{"Line":0}},{"line":128,"address":[25241535],"length":1,"stats":{"Line":0}},{"line":132,"address":[25241188,25240400,25241194],"length":1,"stats":{"Line":0}},{"line":134,"address":[25240443],"length":1,"stats":{"Line":0}},{"line":135,"address":[25240538],"length":1,"stats":{"Line":0}},{"line":139,"address":[25240574,25240639],"length":1,"stats":{"Line":0}},{"line":140,"address":[25240798],"length":1,"stats":{"Line":0}},{"line":142,"address":[25240967,25240994,25240901,25241166],"length":1,"stats":{"Line":0}},{"line":143,"address":[25241088],"length":1,"stats":{"Line":0}},{"line":146,"address":[25240930],"length":1,"stats":{"Line":0}},{"line":149,"address":[25241680,25242467,25242414],"length":1,"stats":{"Line":0}},{"line":150,"address":[25241723,25241844],"length":1,"stats":{"Line":0}},{"line":152,"address":[25242039,25242392],"length":1,"stats":{"Line":0}},{"line":153,"address":[25242205],"length":1,"stats":{"Line":0}},{"line":156,"address":[25240368],"length":1,"stats":{"Line":0}},{"line":157,"address":[25240373],"length":1,"stats":{"Line":0}},{"line":160,"address":[25242496],"length":1,"stats":{"Line":0}},{"line":161,"address":[25242514],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":58},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","circular.rs"],"content":"use miette::{IntoDiagnostic, Result};\nuse serde::{Deserialize, Serialize};\nuse std::collections::{HashMap, HashSet};\nuse std::path::{Path, PathBuf};\nuse swc_common::SourceMap;\nuse swc_ecma_parser::{lexer::Lexer, EsConfig, Parser, StringInput, Syntax, TsConfig};\n\n/// Representa una dependencia cíclica detectada\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct CircularDependency {\n    /// El ciclo completo de dependencias\n    pub cycle: Vec\u003cString\u003e,\n    /// Descripción legible del problema\n    pub description: String,\n}\n\n/// Analizador de dependencias cíclicas\npub struct CircularDependencyAnalyzer {\n    /// Grafo de dependencias: node -\u003e [nodes que importa]\n    graph: HashMap\u003cString, Vec\u003cString\u003e\u003e,\n    /// Directorio raíz del proyecto\n    project_root: PathBuf,\n    /// Grafo inverso: node -\u003e [nodes que lo importan]\n    reverse_graph: HashMap\u003cString, Vec\u003cString\u003e\u003e,\n}\n\nimpl CircularDependencyAnalyzer {\n    /// Crea un nuevo analizador de dependencias cíclicas\n    pub fn new(project_root: \u0026Path) -\u003e Self {\n        Self {\n            graph: HashMap::new(),\n            project_root: project_root.to_path_buf(),\n            reverse_graph: HashMap::new(),\n        }\n    }\n\n    /// Analiza todos los archivos y construye el grafo de dependencias\n    pub fn build_graph(\u0026mut self, files: \u0026[PathBuf], cm: \u0026SourceMap) -\u003e Result\u003c()\u003e {\n        for file_path in files {\n            // Extraer imports del archivo\n            let imports = self.extract_imports(file_path, cm)?;\n\n            // Normalizar la ruta del archivo actual\n            let normalized_current = self.normalize_file_path(file_path);\n            let current_key = normalized_current.clone();\n\n            // Insertar en el grafo\n            self.graph\n                .entry(current_key.clone())\n                .or_insert_with(Vec::new);\n\n            // Procesar cada import\n            for import_path in imports {\n                if let Some(resolved) = self.resolve_import_path(file_path, \u0026import_path) {\n                    let normalized_import = self.normalize_file_path(\u0026resolved);\n\n                    // Solo agregar dependencias internas del proyecto\n                    if self.is_internal_dependency(\u0026normalized_import) {\n                        self.graph\n                            .entry(current_key.clone())\n                            .or_insert_with(Vec::new)\n                            .push(normalized_import.clone());\n\n                        // Actualizar grafo inverso\n                        self.reverse_graph\n                            .entry(normalized_import)\n                            .or_insert_with(Vec::new)\n                            .push(current_key.clone());\n                    }\n                }\n            }\n        }\n\n        Ok(())\n    }\n\n    /// Detecta todos los ciclos en el grafo de dependencias\n    pub fn detect_cycles(\u0026self) -\u003e Vec\u003cCircularDependency\u003e {\n        let mut cycles = Vec::new();\n        let mut visited = HashSet::new();\n        let mut rec_stack = HashSet::new();\n        let mut path = Vec::new();\n\n        for node in self.graph.keys() {\n            if !visited.contains(node) {\n                self.dfs_detect_cycles(node, \u0026mut visited, \u0026mut rec_stack, \u0026mut path, \u0026mut cycles);\n            }\n        }\n\n        cycles\n    }\n\n    /// DFS para detectar ciclos en el grafo\n    fn dfs_detect_cycles(\n        \u0026self,\n        node: \u0026str,\n        visited: \u0026mut HashSet\u003cString\u003e,\n        rec_stack: \u0026mut HashSet\u003cString\u003e,\n        path: \u0026mut Vec\u003cString\u003e,\n        cycles: \u0026mut Vec\u003cCircularDependency\u003e,\n    ) {\n        visited.insert(node.to_string());\n        rec_stack.insert(node.to_string());\n        path.push(node.to_string());\n\n        if let Some(neighbors) = self.graph.get(node) {\n            for neighbor in neighbors {\n                if !visited.contains(neighbor) {\n                    self.dfs_detect_cycles(neighbor, visited, rec_stack, path, cycles);\n                } else if rec_stack.contains(neighbor) {\n                    // Encontramos un ciclo\n                    let cycle_start = path.iter().position(|x| x == neighbor).unwrap_or(0);\n                    let mut cycle = path[cycle_start..].to_vec();\n                    cycle.push(neighbor.clone());\n\n                    cycles.push(CircularDependency {\n                        cycle: cycle.clone(),\n                        description: self.format_cycle_description(\u0026cycle),\n                    });\n                }\n            }\n        }\n\n        path.pop();\n        rec_stack.remove(node);\n    }\n\n    /// Extrae todos los imports de un archivo\n    fn extract_imports(\u0026self, file_path: \u0026Path, cm: \u0026SourceMap) -\u003e Result\u003cVec\u003cString\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parsear según la extensión\n        let extension = file_path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n        let syntax = match extension {\n            \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n                decorators: true,\n                tsx: extension == \"tsx\",\n                ..Default::default()\n            }),\n            \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n                decorators: true,\n                jsx: extension == \"jsx\",\n                ..Default::default()\n            }),\n            _ =\u003e Syntax::Typescript(TsConfig::default()),\n        };\n\n        let fm = cm.load_file(file_path).into_diagnostic()?;\n        let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n        let mut parser = Parser::new_from(lexer);\n\n        let module = parser\n            .parse_module()\n            .map_err(|e| miette::miette!(\"Error parsing {}: {:?}\", file_path.display(), e))?;\n\n        // Extraer imports estáticos\n        for item in \u0026module.body {\n            if let swc_ecma_ast::ModuleItem::ModuleDecl(swc_ecma_ast::ModuleDecl::Import(import)) =\n                item\n            {\n                imports.push(import.src.value.to_string());\n            }\n        }\n\n        Ok(imports)\n    }\n\n    /// Resuelve un path de import a una ruta de archivo real\n    fn resolve_import_path(\u0026self, current_file: \u0026Path, import_path: \u0026str) -\u003e Option\u003cPathBuf\u003e {\n        // Ignorar imports externos (node_modules, @/aliases si no se resuelven, etc.)\n        if import_path.starts_with('@')\n            || import_path.starts_with(\"node_modules\")\n            || (!import_path.starts_with('.') \u0026\u0026 !import_path.starts_with('/'))\n        {\n            // Podríamos agregar lógica para resolver alias de TypeScript aquí\n            // Por ahora, solo procesamos imports relativos\n            return None;\n        }\n\n        // Resolver path relativo\n        let current_dir = current_file.parent()?;\n        let resolved = current_dir.join(import_path);\n\n        // Intentar diferentes extensiones\n        let extensions = [\"ts\", \"tsx\", \"js\", \"jsx\"];\n        for ext in \u0026extensions {\n            let with_ext = resolved.with_extension(ext);\n            if with_ext.exists() {\n                return Some(with_ext);\n            }\n        }\n\n        // Intentar index.ts/js en directorios\n        let index_ts = resolved.join(\"index.ts\");\n        let index_js = resolved.join(\"index.js\");\n\n        if index_ts.exists() {\n            return Some(index_ts);\n        }\n        if index_js.exists() {\n            return Some(index_js);\n        }\n\n        // Si el archivo existe tal cual (sin cambiar extensión)\n        if resolved.exists() {\n            Some(resolved)\n        } else {\n            None\n        }\n    }\n\n    /// Normaliza una ruta de archivo a una representación canónica\n    fn normalize_file_path(\u0026self, path: \u0026Path) -\u003e String {\n        // Canonicalizar el path para limpiar ./ y ../\n        let canonical = if let Ok(canon) = path.canonicalize() {\n            canon\n        } else {\n            // Si falla la canonicalización, limpiar manualmente\n            let cleaned = path\n                .components()\n                .filter(|c| !matches!(c, std::path::Component::CurDir))\n                .collect::\u003cPathBuf\u003e();\n            cleaned\n        };\n\n        // Obtener ruta relativa al directorio raíz del proyecto\n        if let Ok(relative) = canonical.strip_prefix(\u0026self.project_root) {\n            relative.to_string_lossy().replace('\\\\', \"/\").to_lowercase()\n        } else {\n            canonical\n                .to_string_lossy()\n                .replace('\\\\', \"/\")\n                .to_lowercase()\n        }\n    }\n\n    /// Verifica si una dependencia es interna del proyecto\n    fn is_internal_dependency(\u0026self, path: \u0026str) -\u003e bool {\n        // Es interna si no contiene node_modules\n        !path.contains(\"node_modules\")\n    }\n\n    /// Formatea una descripción legible del ciclo\n    fn format_cycle_description(\u0026self, cycle: \u0026[String]) -\u003e String {\n        if cycle.is_empty() {\n            return \"Ciclo vacío\".to_string();\n        }\n\n        let mut desc = String::from(\"Dependencia cíclica detectada:\\n\");\n        for (i, node) in cycle.iter().enumerate() {\n            if i \u003c cycle.len() - 1 {\n                desc.push_str(\u0026format!(\"  {} → {}\\n\", node, cycle[i + 1]));\n            }\n        }\n        desc.push_str(\u0026format!(\n            \"\\n  ⚠️  Esto rompe la jerarquía de capas y crea acoplamiento circular.\"\n        ));\n\n        desc\n    }\n\n    /// Actualiza un archivo específico en el grafo (para watch mode)\n    pub fn update_file(\u0026mut self, file_path: \u0026Path, cm: \u0026SourceMap) -\u003e Result\u003c()\u003e {\n        let normalized_current = self.normalize_file_path(file_path);\n\n        // Eliminar aristas antiguas del nodo\n        self.invalidate_node(\u0026normalized_current);\n\n        // Re-extraer imports\n        let imports = self.extract_imports(file_path, cm)?;\n\n        // Reconstruir aristas\n        self.graph\n            .entry(normalized_current.clone())\n            .or_insert_with(Vec::new);\n\n        for import_path in imports {\n            if let Some(resolved) = self.resolve_import_path(file_path, \u0026import_path) {\n                let normalized_import = self.normalize_file_path(\u0026resolved);\n\n                if self.is_internal_dependency(\u0026normalized_import) {\n                    self.graph\n                        .entry(normalized_current.clone())\n                        .or_insert_with(Vec::new)\n                        .push(normalized_import.clone());\n\n                    // Actualizar grafo inverso\n                    self.reverse_graph\n                        .entry(normalized_import)\n                        .or_insert_with(Vec::new)\n                        .push(normalized_current.clone());\n                }\n            }\n        }\n\n        Ok(())\n    }\n\n    /// Invalida un nodo en el grafo (elimina sus aristas)\n    pub fn invalidate_node(\u0026mut self, node: \u0026str) {\n        // Eliminar aristas salientes del grafo directo\n        if let Some(deps) = self.graph.get(node) {\n            // Eliminar referencias en el grafo inverso\n            for dep in deps {\n                if let Some(reverse_deps) = self.reverse_graph.get_mut(dep) {\n                    reverse_deps.retain(|n| n != node);\n                }\n            }\n        }\n        self.graph.remove(node);\n\n        // Eliminar aristas entrantes del grafo inverso\n        if let Some(reverse_deps) = self.reverse_graph.get(node) {\n            // Eliminar referencias en el grafo directo\n            for dep in reverse_deps.clone() {\n                if let Some(forward_deps) = self.graph.get_mut(\u0026dep) {\n                    forward_deps.retain(|n| n != node);\n                }\n            }\n        }\n        self.reverse_graph.remove(node);\n    }\n\n    /// Obtiene todos los nodos conectados a un nodo dado (componente fuertemente conexo aproximado)\n    /// Útil para re-analizar solo la parte del grafo afectada por un cambio\n    pub fn get_affected_nodes(\u0026self, start_node: \u0026str) -\u003e HashSet\u003cString\u003e {\n        let mut affected = HashSet::new();\n        let mut to_visit = vec![start_node.to_string()];\n\n        while let Some(node) = to_visit.pop() {\n            if affected.contains(\u0026node) {\n                continue;\n            }\n            affected.insert(node.clone());\n\n            // Agregar dependencias directas (hacia adelante)\n            if let Some(deps) = self.graph.get(\u0026node) {\n                for dep in deps {\n                    if !affected.contains(dep) {\n                        to_visit.push(dep.clone());\n                    }\n                }\n            }\n\n            // Agregar dependencias inversas (hacia atrás)\n            if let Some(reverse_deps) = self.reverse_graph.get(\u0026node) {\n                for dep in reverse_deps {\n                    if !affected.contains(dep) {\n                        to_visit.push(dep.clone());\n                    }\n                }\n            }\n        }\n\n        affected\n    }\n\n    /// Detecta ciclos solo en un subconjunto del grafo (para análisis incremental)\n    pub fn detect_cycles_in_subgraph(\u0026self, nodes: \u0026HashSet\u003cString\u003e) -\u003e Vec\u003cCircularDependency\u003e {\n        let mut cycles = Vec::new();\n        let mut visited = HashSet::new();\n        let mut rec_stack = HashSet::new();\n        let mut path = Vec::new();\n\n        for node in nodes {\n            if !visited.contains(node) {\n                self.dfs_detect_cycles_filtered(\n                    node,\n                    nodes,\n                    \u0026mut visited,\n                    \u0026mut rec_stack,\n                    \u0026mut path,\n                    \u0026mut cycles,\n                );\n            }\n        }\n\n        cycles\n    }\n\n    /// DFS para detectar ciclos solo en un subgrafo específico\n    fn dfs_detect_cycles_filtered(\n        \u0026self,\n        node: \u0026str,\n        allowed_nodes: \u0026HashSet\u003cString\u003e,\n        visited: \u0026mut HashSet\u003cString\u003e,\n        rec_stack: \u0026mut HashSet\u003cString\u003e,\n        path: \u0026mut Vec\u003cString\u003e,\n        cycles: \u0026mut Vec\u003cCircularDependency\u003e,\n    ) {\n        visited.insert(node.to_string());\n        rec_stack.insert(node.to_string());\n        path.push(node.to_string());\n\n        if let Some(neighbors) = self.graph.get(node) {\n            for neighbor in neighbors {\n                // Solo seguir nodos que están en el subgrafo permitido\n                if !allowed_nodes.contains(neighbor) {\n                    continue;\n                }\n\n                if !visited.contains(neighbor) {\n                    self.dfs_detect_cycles_filtered(\n                        neighbor,\n                        allowed_nodes,\n                        visited,\n                        rec_stack,\n                        path,\n                        cycles,\n                    );\n                } else if rec_stack.contains(neighbor) {\n                    // Encontramos un ciclo\n                    let cycle_start = path.iter().position(|x| x == neighbor).unwrap_or(0);\n                    let mut cycle = path[cycle_start..].to_vec();\n                    cycle.push(neighbor.clone());\n\n                    cycles.push(CircularDependency {\n                        cycle: cycle.clone(),\n                        description: self.format_cycle_description(\u0026cycle),\n                    });\n                }\n            }\n        }\n\n        path.pop();\n        rec_stack.remove(node);\n    }\n}\n\n/// Función pública para analizar dependencias cíclicas en un proyecto\npub fn analyze_circular_dependencies(\n    files: \u0026[PathBuf],\n    project_root: \u0026Path,\n    cm: \u0026SourceMap,\n) -\u003e Result\u003cVec\u003cCircularDependency\u003e\u003e {\n    let mut analyzer = CircularDependencyAnalyzer::new(project_root);\n    analyzer.build_graph(files, cm)?;\n    Ok(analyzer.detect_cycles())\n}\n\n/// Imprime un reporte de dependencias cíclicas\npub fn print_circular_dependency_report(cycles: \u0026[CircularDependency]) {\n    if cycles.is_empty() {\n        println!(\"✅ No se detectaron dependencias cíclicas.\");\n        return;\n    }\n\n    println!(\"\\n🔴 DEPENDENCIAS CÍCLICAS DETECTADAS\\n\");\n    println!(\n        \"Se encontraron {} ciclo(s) de dependencias:\\n\",\n        cycles.len()\n    );\n\n    for (i, cycle) in cycles.iter().enumerate() {\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n        println!(\"Ciclo #{}\", i + 1);\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n\n        // Mostrar el ciclo completo usando el campo cycle\n        println!(\"📂 Rutas del ciclo:\");\n        for (j, path) in cycle.cycle.iter().enumerate() {\n            if j \u003c cycle.cycle.len() - 1 {\n                println!(\"  {} →\", path);\n            } else {\n                println!(\"  {} ↑ (cierra el ciclo)\", path);\n            }\n        }\n        println!();\n\n        println!(\"{}\", cycle.description);\n        println!();\n    }\n\n    println!(\"💡 Soluciones sugeridas:\");\n    println!(\"  1. Aplicar Inyección de Dependencias para romper el ciclo\");\n    println!(\"  2. Extraer la lógica compartida a un tercer módulo\");\n    println!(\"  3. Usar eventos/observadores en lugar de llamadas directas\");\n    println!(\"  4. Aplicar el principio de inversión de dependencias (DIP)\");\n}\n","traces":[{"line":29,"address":[25398854,25398592,25398860],"length":1,"stats":{"Line":0}},{"line":31,"address":[25398634],"length":1,"stats":{"Line":0}},{"line":32,"address":[25398658],"length":1,"stats":{"Line":0}},{"line":33,"address":[25398715],"length":1,"stats":{"Line":0}},{"line":38,"address":[25383483,25383477,25381488],"length":1,"stats":{"Line":0}},{"line":39,"address":[25381581,25382637],"length":1,"stats":{"Line":0}},{"line":41,"address":[25381842,25381700,25381897],"length":1,"stats":{"Line":0}},{"line":44,"address":[25382065,25381969],"length":1,"stats":{"Line":0}},{"line":45,"address":[25382072],"length":1,"stats":{"Line":0}},{"line":48,"address":[25382148],"length":1,"stats":{"Line":0}},{"line":49,"address":[25382157,25382230],"length":1,"stats":{"Line":0}},{"line":50,"address":[25382257],"length":1,"stats":{"Line":0}},{"line":53,"address":[25382276,25382478],"length":1,"stats":{"Line":0}},{"line":54,"address":[25382555,25382714],"length":1,"stats":{"Line":0}},{"line":55,"address":[25382851,25382960],"length":1,"stats":{"Line":0}},{"line":58,"address":[25383056,25382983],"length":1,"stats":{"Line":0}},{"line":59,"address":[25383104],"length":1,"stats":{"Line":0}},{"line":60,"address":[25383113],"length":1,"stats":{"Line":0}},{"line":61,"address":[25383172],"length":1,"stats":{"Line":0}},{"line":62,"address":[25383196],"length":1,"stats":{"Line":0}},{"line":65,"address":[25383401,25383255],"length":1,"stats":{"Line":0}},{"line":66,"address":[25383259],"length":1,"stats":{"Line":0}},{"line":67,"address":[25383326],"length":1,"stats":{"Line":0}},{"line":68,"address":[25383350],"length":1,"stats":{"Line":0}},{"line":74,"address":[25381814],"length":1,"stats":{"Line":0}},{"line":78,"address":[25385977,25385983,25385312],"length":1,"stats":{"Line":0}},{"line":79,"address":[25385342],"length":1,"stats":{"Line":0}},{"line":80,"address":[25385372],"length":1,"stats":{"Line":0}},{"line":81,"address":[25385429],"length":1,"stats":{"Line":0}},{"line":82,"address":[25385486],"length":1,"stats":{"Line":0}},{"line":84,"address":[25385551,25385615],"length":1,"stats":{"Line":0}},{"line":85,"address":[25385886,25385757],"length":1,"stats":{"Line":0}},{"line":86,"address":[25385901],"length":1,"stats":{"Line":0}},{"line":90,"address":[25385782],"length":1,"stats":{"Line":0}},{"line":94,"address":[25389440,25390462,25390468],"length":1,"stats":{"Line":0}},{"line":102,"address":[25389538],"length":1,"stats":{"Line":0}},{"line":103,"address":[25389575],"length":1,"stats":{"Line":0}},{"line":104,"address":[25389612],"length":1,"stats":{"Line":0}},{"line":106,"address":[25389660],"length":1,"stats":{"Line":0}},{"line":107,"address":[25389725,25389811],"length":1,"stats":{"Line":0}},{"line":108,"address":[25389885],"length":1,"stats":{"Line":0}},{"line":109,"address":[25389903],"length":1,"stats":{"Line":0}},{"line":110,"address":[25389963],"length":1,"stats":{"Line":0}},{"line":112,"address":[25389991],"length":1,"stats":{"Line":0}},{"line":113,"address":[25390091],"length":1,"stats":{"Line":0}},{"line":114,"address":[25390198,25390127],"length":1,"stats":{"Line":0}},{"line":116,"address":[25390360],"length":1,"stats":{"Line":0}},{"line":117,"address":[25390225],"length":1,"stats":{"Line":0}},{"line":118,"address":[25390348,25390252],"length":1,"stats":{"Line":0}},{"line":124,"address":[25389754],"length":1,"stats":{"Line":0}},{"line":125,"address":[25389797],"length":1,"stats":{"Line":0}},{"line":129,"address":[25388523,25386016,25388450],"length":1,"stats":{"Line":0}},{"line":130,"address":[25386095],"length":1,"stats":{"Line":0}},{"line":133,"address":[25386144,25386228],"length":1,"stats":{"Line":0}},{"line":136,"address":[25386337,25387054,25386477],"length":1,"stats":{"Line":0}},{"line":138,"address":[25386434],"length":1,"stats":{"Line":0}},{"line":139,"address":[25386982],"length":1,"stats":{"Line":0}},{"line":141,"address":[25386483,25386800,25386623],"length":1,"stats":{"Line":0}},{"line":143,"address":[25386580],"length":1,"stats":{"Line":0}},{"line":144,"address":[25386786],"length":1,"stats":{"Line":0}},{"line":146,"address":[25386629],"length":1,"stats":{"Line":0}},{"line":149,"address":[25388521,25387170,25386754],"length":1,"stats":{"Line":0}},{"line":150,"address":[25387422,25387331],"length":1,"stats":{"Line":0}},{"line":151,"address":[25387550],"length":1,"stats":{"Line":0}},{"line":153,"address":[25387778,25387690],"length":1,"stats":{"Line":0}},{"line":155,"address":[25379184,25379212],"length":1,"stats":{"Line":0}},{"line":158,"address":[25387895,25387978],"length":1,"stats":{"Line":0}},{"line":159,"address":[25388098,25388291],"length":1,"stats":{"Line":0}},{"line":162,"address":[25388321],"length":1,"stats":{"Line":0}},{"line":166,"address":[25388119],"length":1,"stats":{"Line":0}},{"line":170,"address":[25395413,25395124,25393376],"length":1,"stats":{"Line":0}},{"line":172,"address":[25393493],"length":1,"stats":{"Line":0}},{"line":173,"address":[25393548],"length":1,"stats":{"Line":0}},{"line":174,"address":[25393614],"length":1,"stats":{"Line":0}},{"line":178,"address":[25393580],"length":1,"stats":{"Line":0}},{"line":182,"address":[25393678],"length":1,"stats":{"Line":0}},{"line":183,"address":[25393810],"length":1,"stats":{"Line":0}},{"line":186,"address":[25393835],"length":1,"stats":{"Line":0}},{"line":187,"address":[25394035,25393943],"length":1,"stats":{"Line":0}},{"line":188,"address":[25394157,25395176],"length":1,"stats":{"Line":0}},{"line":189,"address":[25395274,25395203],"length":1,"stats":{"Line":0}},{"line":190,"address":[25395325],"length":1,"stats":{"Line":0}},{"line":195,"address":[25394191],"length":1,"stats":{"Line":0}},{"line":196,"address":[25394266,25394334],"length":1,"stats":{"Line":0}},{"line":198,"address":[25394453,25394382],"length":1,"stats":{"Line":0}},{"line":199,"address":[25394507],"length":1,"stats":{"Line":0}},{"line":201,"address":[25394482,25394613],"length":1,"stats":{"Line":0}},{"line":202,"address":[25394667],"length":1,"stats":{"Line":0}},{"line":206,"address":[25394815,25394642,25394773],"length":1,"stats":{"Line":0}},{"line":207,"address":[25394825],"length":1,"stats":{"Line":0}},{"line":209,"address":[25394802],"length":1,"stats":{"Line":0}},{"line":214,"address":[25392016,25393048,25393338],"length":1,"stats":{"Line":0}},{"line":216,"address":[25392498,25392103,25392188],"length":1,"stats":{"Line":0}},{"line":217,"address":[25392236],"length":1,"stats":{"Line":0}},{"line":222,"address":[25379760,25379770],"length":1,"stats":{"Line":0}},{"line":224,"address":[25392450],"length":1,"stats":{"Line":0}},{"line":228,"address":[25392530,25392609,25392715],"length":1,"stats":{"Line":0}},{"line":229,"address":[25392969,25392755,25392845],"length":1,"stats":{"Line":0}},{"line":231,"address":[25393079,25393207,25392695],"length":1,"stats":{"Line":0}},{"line":239,"address":[25395456],"length":1,"stats":{"Line":0}},{"line":241,"address":[25395499],"length":1,"stats":{"Line":0}},{"line":245,"address":[25396758,25395536,25396289],"length":1,"stats":{"Line":0}},{"line":246,"address":[25395621],"length":1,"stats":{"Line":0}},{"line":247,"address":[25395704],"length":1,"stats":{"Line":0}},{"line":250,"address":[25395631],"length":1,"stats":{"Line":0}},{"line":251,"address":[25395784,25395672],"length":1,"stats":{"Line":0}},{"line":252,"address":[25396009,25396305],"length":1,"stats":{"Line":0}},{"line":253,"address":[25396340],"length":1,"stats":{"Line":0}},{"line":256,"address":[25396036,25396204],"length":1,"stats":{"Line":0}},{"line":260,"address":[25396238],"length":1,"stats":{"Line":0}},{"line":264,"address":[25385227,25385295,25383520],"length":1,"stats":{"Line":0}},{"line":265,"address":[25383594],"length":1,"stats":{"Line":0}},{"line":268,"address":[25383639,25383727],"length":1,"stats":{"Line":0}},{"line":271,"address":[25383769,25385260],"length":1,"stats":{"Line":0}},{"line":274,"address":[25383959],"length":1,"stats":{"Line":0}},{"line":275,"address":[25383968,25384041],"length":1,"stats":{"Line":0}},{"line":276,"address":[25384068],"length":1,"stats":{"Line":0}},{"line":278,"address":[25384289,25384087],"length":1,"stats":{"Line":0}},{"line":279,"address":[25384366,25384529],"length":1,"stats":{"Line":0}},{"line":280,"address":[25384613,25384719],"length":1,"stats":{"Line":0}},{"line":282,"address":[25384742,25384812],"length":1,"stats":{"Line":0}},{"line":283,"address":[25384857],"length":1,"stats":{"Line":0}},{"line":284,"address":[25384866],"length":1,"stats":{"Line":0}},{"line":285,"address":[25384925],"length":1,"stats":{"Line":0}},{"line":286,"address":[25384949],"length":1,"stats":{"Line":0}},{"line":289,"address":[25385005,25385151],"length":1,"stats":{"Line":0}},{"line":290,"address":[25385009],"length":1,"stats":{"Line":0}},{"line":291,"address":[25385076],"length":1,"stats":{"Line":0}},{"line":292,"address":[25385100],"length":1,"stats":{"Line":0}},{"line":297,"address":[25384402],"length":1,"stats":{"Line":0}},{"line":301,"address":[25388560,25389423,25389417],"length":1,"stats":{"Line":0}},{"line":303,"address":[25388590],"length":1,"stats":{"Line":0}},{"line":305,"address":[25388656,25388782],"length":1,"stats":{"Line":0}},{"line":306,"address":[25388848],"length":1,"stats":{"Line":0}},{"line":307,"address":[25379664,25379678],"length":1,"stats":{"Line":0}},{"line":311,"address":[25388679],"length":1,"stats":{"Line":0}},{"line":314,"address":[25388920,25388720],"length":1,"stats":{"Line":0}},{"line":316,"address":[25388933,25389152,25389081],"length":1,"stats":{"Line":0}},{"line":317,"address":[25389226,25389322],"length":1,"stats":{"Line":0}},{"line":318,"address":[25389415,25389377],"length":1,"stats":{"Line":0}},{"line":322,"address":[25389031],"length":1,"stats":{"Line":0}},{"line":327,"address":[25390496,25391935,25391970],"length":1,"stats":{"Line":0}},{"line":328,"address":[25390561],"length":1,"stats":{"Line":0}},{"line":329,"address":[25390678,25391965,25390604],"length":1,"stats":{"Line":0}},{"line":331,"address":[25390963,25390892],"length":1,"stats":{"Line":0}},{"line":332,"address":[25391184,25391032],"length":1,"stats":{"Line":0}},{"line":335,"address":[25391239,25391190],"length":1,"stats":{"Line":0}},{"line":338,"address":[25391274],"length":1,"stats":{"Line":0}},{"line":339,"address":[25391362,25391432],"length":1,"stats":{"Line":0}},{"line":340,"address":[25391541],"length":1,"stats":{"Line":0}},{"line":341,"address":[25391579],"length":1,"stats":{"Line":0}},{"line":347,"address":[25391635,25391391],"length":1,"stats":{"Line":0}},{"line":348,"address":[25391690,25391743],"length":1,"stats":{"Line":0}},{"line":349,"address":[25391847],"length":1,"stats":{"Line":0}},{"line":350,"address":[25391884],"length":1,"stats":{"Line":0}},{"line":356,"address":[25391071],"length":1,"stats":{"Line":0}},{"line":360,"address":[25396784,25397440,25397446],"length":1,"stats":{"Line":0}},{"line":361,"address":[25396827],"length":1,"stats":{"Line":0}},{"line":362,"address":[25396857],"length":1,"stats":{"Line":0}},{"line":363,"address":[25396914],"length":1,"stats":{"Line":0}},{"line":364,"address":[25396971],"length":1,"stats":{"Line":0}},{"line":366,"address":[25397036,25397096],"length":1,"stats":{"Line":0}},{"line":367,"address":[25397211,25397340],"length":1,"stats":{"Line":0}},{"line":368,"address":[25397392],"length":1,"stats":{"Line":0}},{"line":369,"address":[25397355],"length":1,"stats":{"Line":0}},{"line":379,"address":[25397236],"length":1,"stats":{"Line":0}},{"line":383,"address":[25398558,25397488,25398564],"length":1,"stats":{"Line":0}},{"line":392,"address":[25397599],"length":1,"stats":{"Line":0}},{"line":393,"address":[25397636],"length":1,"stats":{"Line":0}},{"line":394,"address":[25397673],"length":1,"stats":{"Line":0}},{"line":396,"address":[25397721],"length":1,"stats":{"Line":0}},{"line":397,"address":[25397786,25397872],"length":1,"stats":{"Line":0}},{"line":399,"address":[25397946],"length":1,"stats":{"Line":0}},{"line":403,"address":[25397971],"length":1,"stats":{"Line":0}},{"line":404,"address":[25398035],"length":1,"stats":{"Line":0}},{"line":405,"address":[25397989],"length":1,"stats":{"Line":0}},{"line":412,"address":[25398059],"length":1,"stats":{"Line":0}},{"line":414,"address":[25379822,25379808],"length":1,"stats":{"Line":0}},{"line":415,"address":[25398187],"length":1,"stats":{"Line":0}},{"line":416,"address":[25398294,25398223],"length":1,"stats":{"Line":0}},{"line":418,"address":[25398456],"length":1,"stats":{"Line":0}},{"line":419,"address":[25398321],"length":1,"stats":{"Line":0}},{"line":420,"address":[25398444,25398348],"length":1,"stats":{"Line":0}},{"line":426,"address":[25397815],"length":1,"stats":{"Line":0}},{"line":427,"address":[25397858],"length":1,"stats":{"Line":0}},{"line":432,"address":[25399285,25398880,25399279],"length":1,"stats":{"Line":0}},{"line":437,"address":[25398978],"length":1,"stats":{"Line":0}},{"line":438,"address":[25399079,25399017],"length":1,"stats":{"Line":0}},{"line":439,"address":[25399178],"length":1,"stats":{"Line":0}},{"line":443,"address":[25399312],"length":1,"stats":{"Line":0}},{"line":444,"address":[25399345],"length":1,"stats":{"Line":0}},{"line":445,"address":[25399570],"length":1,"stats":{"Line":0}},{"line":449,"address":[25399359],"length":1,"stats":{"Line":0}},{"line":450,"address":[25399393],"length":1,"stats":{"Line":0}},{"line":455,"address":[25399487,25399604],"length":1,"stats":{"Line":0}},{"line":456,"address":[25399707],"length":1,"stats":{"Line":0}},{"line":457,"address":[25400206,25399925,25399741],"length":1,"stats":{"Line":0}},{"line":458,"address":[25400036],"length":1,"stats":{"Line":0}},{"line":461,"address":[25400065],"length":1,"stats":{"Line":0}},{"line":462,"address":[25400099,25400219],"length":1,"stats":{"Line":0}},{"line":463,"address":[25400524,25400322],"length":1,"stats":{"Line":0}},{"line":464,"address":[25400652],"length":1,"stats":{"Line":0}},{"line":466,"address":[25400544],"length":1,"stats":{"Line":0}},{"line":469,"address":[25400355],"length":1,"stats":{"Line":0}},{"line":471,"address":[25400389],"length":1,"stats":{"Line":0}},{"line":472,"address":[25400480],"length":1,"stats":{"Line":0}},{"line":475,"address":[25399767],"length":1,"stats":{"Line":0}},{"line":476,"address":[25399796],"length":1,"stats":{"Line":0}},{"line":477,"address":[25399825],"length":1,"stats":{"Line":0}},{"line":478,"address":[25399854],"length":1,"stats":{"Line":0}},{"line":479,"address":[25399883],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":211},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","cli.rs"],"content":"/// Módulo CLI - Funciones relacionadas con la interfaz de línea de comandos\nuse std::env;\n\nconst VERSION: \u0026str = env!(\"CARGO_PKG_VERSION\");\n\n/// Formato de reporte para exportación\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum ReportFormat {\n    Json,\n    Markdown,\n}\n\nimpl ReportFormat {\n    pub fn from_str(s: \u0026str) -\u003e Option\u003cSelf\u003e {\n        match s.to_lowercase().as_str() {\n            \"json\" =\u003e Some(ReportFormat::Json),\n            \"markdown\" | \"md\" =\u003e Some(ReportFormat::Markdown),\n            _ =\u003e None,\n        }\n    }\n}\n\n/// Argumentos procesados de la línea de comandos\n#[derive(Debug, Clone)]\npub struct CliArgs {\n    /// Ruta del proyecto a analizar (None = modo interactivo)\n    pub project_path: Option\u003cString\u003e,\n    /// Activar modo watch\n    pub watch_mode: bool,\n    /// Activar modo fix (auto-reparación con IA)\n    pub fix_mode: bool,\n    /// Solo analizar archivos staged en git\n    pub staged_mode: bool,\n    /// Analizar solo archivos modificados (Git-based)\n    pub incremental_mode: bool,\n    /// Formato de reporte para exportar (json, markdown)\n    pub report_format: Option\u003cReportFormat\u003e,\n    /// Ruta del archivo de salida para el reporte\n    pub output_path: Option\u003cString\u003e,\n    /// Disable analysis cache\n    pub no_cache: bool,\n    /// Ejecutar en segundo plano (modo daemon)\n    pub daemon_mode: bool,\n}\n\n/// Muestra la ayuda del CLI\npub fn print_help() {\n    println!(\"architect-linter-pro {}\", VERSION);\n    println!();\n    println!(\"Linter de arquitectura de software con Architecture Health Score\");\n    println!(\"Soporte multi-lenguaje: TypeScript, JavaScript, Python, Go, PHP, Java\");\n    println!();\n    println!(\"USO:\");\n    println!(\"  architect-linter-pro [OPCIONES] [RUTA]\");\n    println!();\n    println!(\"ARGUMENTOS:\");\n    println!(\"  [RUTA]    Ruta del proyecto a analizar (opcional, modo interactivo si se omite)\");\n    println!();\n    println!(\"OPCIONES:\");\n    println!(\"  -h, --help           Muestra esta ayuda\");\n    println!(\"  -v, --version        Muestra la versión\");\n    println!(\"  -w, --watch          Modo watch: observa cambios y re-analiza automáticamente\");\n    println!(\"  -f, --fix            Modo fix: sugiere y aplica correcciones automáticas con IA\");\n    println!(\"  -s, --staged         Solo analizar archivos staged (git)\");\n    println!(\"  -i, --incremental     Analizar solo archivos modificados (Git-based)\");\n    println!(\"  -r, --report \u003cFMT\u003e   Exportar reporte: json, markdown\");\n    println!(\"  -o, --output \u003cPATH\u003e  Archivo de salida para el reporte\");\n    println!(\"  --no-cache           Disable analysis cache\");\n    println!();\n    println!(\"EJEMPLOS:\");\n    println!(\"  architect-linter-pro                         # Modo interactivo\");\n    println!(\"  architect-linter-pro .                       # Analizar directorio actual\");\n    println!(\"  architect-linter-pro /ruta/a/proyecto        # Analizar proyecto específico\");\n    println!(\"  architect-linter-pro --watch .               # Modo watch en directorio actual\");\n    println!(\"  architect-linter-pro --fix .                 # Analizar y auto-corregir con IA\");\n    println!(\"  architect-linter-pro --staged .              # Solo archivos staged\");\n    println!(\"  architect-linter-pro --incremental .        # Solo archivos modificados\");\n    println!(\"  architect-linter-pro --report json .         # Exportar reporte JSON a stdout\");\n    println!(\n        \"  architect-linter-pro -r md -o report.md .    # Exportar reporte Markdown a archivo\"\n    );\n    println!();\n    println!(\"INTERACTIVE WATCH MODE:\");\n    println!(\"  When running with --watch, type a command + Enter:\");\n    println!(\"    f  Fix: auto-fix violations with AI\");\n    println!(\"    r  Report: generate JSON report\");\n    println!(\"    m  Markdown: generate Markdown report\");\n    println!(\"    a  Analyze: full analysis with dashboard\");\n    println!(\"    v  Violations: list all current violations\");\n    println!(\"    d  Dashboard: show health score\");\n    println!(\"    c  Clear: clear terminal screen\");\n    println!(\"    h  Help: show available commands\");\n    println!(\"    q  Quit: exit watch mode\");\n    println!();\n    println!(\"SCORE GRADES:\");\n    println!(\"  A (90-100)  - Excellent architecture health\");\n    println!(\"  B (80-89)   - Good architecture health\");\n    println!(\"  C (70-79)   - Fair architecture health\");\n    println!(\"  D (60-69)   - Needs improvement\");\n    println!(\"  F (0-59)    - Critical issues\");\n    println!();\n    println!(\"DOCUMENTACIÓN:\");\n    println!(\"  https://github.com/sergiogswv/architect-linter-pro\");\n}\n\n/// Muestra la versión del linter\npub fn print_version() {\n    println!(\"architect-linter-pro {}\", VERSION);\n}\n\n/// Procesa los argumentos de línea de comandos\n/// Retorna None si se procesó un flag especial (--help, --version)\n/// Retorna Some(CliArgs) si hay que continuar con el análisis\npub fn process_args() -\u003e Option\u003cCliArgs\u003e {\n    let args: Vec\u003cString\u003e = env::args().collect();\n\n    let mut watch_mode = false;\n    let mut fix_mode = false;\n    let mut staged_mode = false;\n    let mut incremental_mode = false;\n    let mut no_cache = false;\n    let mut daemon_mode = false;\n    let mut report_format: Option\u003cReportFormat\u003e = None;\n    let mut output_path: Option\u003cString\u003e = None;\n    let mut project_path: Option\u003cString\u003e = None;\n\n    // Procesar argumentos\n    let mut i = 1;\n    while i \u003c args.len() {\n        match args[i].as_str() {\n            \"--version\" | \"-v\" =\u003e {\n                print_version();\n                return None;\n            }\n            \"--help\" | \"-h\" =\u003e {\n                print_help();\n                return None;\n            }\n            \"--watch\" | \"-w\" =\u003e {\n                watch_mode = true;\n            }\n            \"--fix\" | \"-f\" =\u003e {\n                fix_mode = true;\n            }\n            \"--staged\" | \"-s\" =\u003e {\n                staged_mode = true;\n            }\n            \"--incremental\" | \"-i\" =\u003e {\n                incremental_mode = true;\n            }\n            \"--no-cache\" =\u003e {\n                no_cache = true;\n            }\n            \"--daemon\" | \"-d\" =\u003e {\n                daemon_mode = true;\n            }\n            \"--report\" | \"-r\" =\u003e {\n                // Next argument should be the format\n                if i + 1 \u003c args.len() {\n                    i += 1;\n                    if let Some(fmt) = ReportFormat::from_str(\u0026args[i]) {\n                        report_format = Some(fmt);\n                    } else {\n                        eprintln!(\n                            \"Error: Formato de reporte inválido '{}'. Usa 'json' o 'markdown'.\",\n                            args[i]\n                        );\n                        return None;\n                    }\n                } else {\n                    eprintln!(\"Error: --report requiere un formato (json o markdown)\");\n                    return None;\n                }\n            }\n            \"--output\" | \"-o\" =\u003e {\n                // Next argument should be the output path\n                if i + 1 \u003c args.len() {\n                    i += 1;\n                    output_path = Some(args[i].clone());\n                } else {\n                    eprintln!(\"Error: --output requiere una ruta de archivo\");\n                    return None;\n                }\n            }\n            _ =\u003e {\n                // Si no es un flag, asumimos que es la ruta del proyecto\n                if !args[i].starts_with('-') {\n                    project_path = Some(args[i].clone());\n                }\n            }\n        }\n        i += 1;\n    }\n\n    Some(CliArgs {\n        project_path,\n        watch_mode,\n        fix_mode,\n        staged_mode,\n        incremental_mode,\n        no_cache,\n        daemon_mode,\n        report_format,\n        output_path,\n    })\n}\n","traces":[{"line":14,"address":[25121214,25120928,25121208],"length":1,"stats":{"Line":0}},{"line":15,"address":[25120948,25121034],"length":1,"stats":{"Line":0}},{"line":16,"address":[25121050,25121116],"length":1,"stats":{"Line":0}},{"line":17,"address":[25121093,25121127],"length":1,"stats":{"Line":0}},{"line":18,"address":[25121183],"length":1,"stats":{"Line":0}},{"line":47,"address":[25119296],"length":1,"stats":{"Line":0}},{"line":48,"address":[25119300],"length":1,"stats":{"Line":0}},{"line":49,"address":[25119377],"length":1,"stats":{"Line":0}},{"line":50,"address":[25119406],"length":1,"stats":{"Line":0}},{"line":51,"address":[25119435],"length":1,"stats":{"Line":0}},{"line":52,"address":[25119464],"length":1,"stats":{"Line":0}},{"line":53,"address":[25119493],"length":1,"stats":{"Line":0}},{"line":54,"address":[25119522],"length":1,"stats":{"Line":0}},{"line":55,"address":[25119551],"length":1,"stats":{"Line":0}},{"line":56,"address":[25119580],"length":1,"stats":{"Line":0}},{"line":57,"address":[25119609],"length":1,"stats":{"Line":0}},{"line":58,"address":[25119638],"length":1,"stats":{"Line":0}},{"line":59,"address":[25119667],"length":1,"stats":{"Line":0}},{"line":60,"address":[25119696],"length":1,"stats":{"Line":0}},{"line":61,"address":[25119725],"length":1,"stats":{"Line":0}},{"line":62,"address":[25119754],"length":1,"stats":{"Line":0}},{"line":63,"address":[25119783],"length":1,"stats":{"Line":0}},{"line":64,"address":[25119812],"length":1,"stats":{"Line":0}},{"line":65,"address":[25119841],"length":1,"stats":{"Line":0}},{"line":66,"address":[25119870],"length":1,"stats":{"Line":0}},{"line":67,"address":[25119899],"length":1,"stats":{"Line":0}},{"line":68,"address":[25119928],"length":1,"stats":{"Line":0}},{"line":69,"address":[25119957],"length":1,"stats":{"Line":0}},{"line":70,"address":[25119986],"length":1,"stats":{"Line":0}},{"line":71,"address":[25120015],"length":1,"stats":{"Line":0}},{"line":72,"address":[25120044],"length":1,"stats":{"Line":0}},{"line":73,"address":[25120073],"length":1,"stats":{"Line":0}},{"line":74,"address":[25120102],"length":1,"stats":{"Line":0}},{"line":75,"address":[25120131],"length":1,"stats":{"Line":0}},{"line":76,"address":[25120160],"length":1,"stats":{"Line":0}},{"line":77,"address":[25120189],"length":1,"stats":{"Line":0}},{"line":78,"address":[25120218],"length":1,"stats":{"Line":0}},{"line":79,"address":[25120247],"length":1,"stats":{"Line":0}},{"line":82,"address":[25120276],"length":1,"stats":{"Line":0}},{"line":83,"address":[25120305],"length":1,"stats":{"Line":0}},{"line":84,"address":[25120334],"length":1,"stats":{"Line":0}},{"line":85,"address":[25120363],"length":1,"stats":{"Line":0}},{"line":86,"address":[25120392],"length":1,"stats":{"Line":0}},{"line":87,"address":[25120421],"length":1,"stats":{"Line":0}},{"line":88,"address":[25120450],"length":1,"stats":{"Line":0}},{"line":89,"address":[25120479],"length":1,"stats":{"Line":0}},{"line":90,"address":[25120508],"length":1,"stats":{"Line":0}},{"line":91,"address":[25120537],"length":1,"stats":{"Line":0}},{"line":92,"address":[25120566],"length":1,"stats":{"Line":0}},{"line":93,"address":[25120595],"length":1,"stats":{"Line":0}},{"line":94,"address":[25120624],"length":1,"stats":{"Line":0}},{"line":95,"address":[25120653],"length":1,"stats":{"Line":0}},{"line":96,"address":[25120682],"length":1,"stats":{"Line":0}},{"line":97,"address":[25120711],"length":1,"stats":{"Line":0}},{"line":98,"address":[25120740],"length":1,"stats":{"Line":0}},{"line":99,"address":[25120769],"length":1,"stats":{"Line":0}},{"line":100,"address":[25120798],"length":1,"stats":{"Line":0}},{"line":101,"address":[25120827],"length":1,"stats":{"Line":0}},{"line":102,"address":[25120856],"length":1,"stats":{"Line":0}},{"line":103,"address":[25120885],"length":1,"stats":{"Line":0}},{"line":107,"address":[25124848],"length":1,"stats":{"Line":0}},{"line":108,"address":[25124852],"length":1,"stats":{"Line":0}},{"line":114,"address":[25124819,25121232,25124825],"length":1,"stats":{"Line":0}},{"line":115,"address":[25121255],"length":1,"stats":{"Line":0}},{"line":117,"address":[25121291],"length":1,"stats":{"Line":0}},{"line":118,"address":[25121299],"length":1,"stats":{"Line":0}},{"line":119,"address":[25121307],"length":1,"stats":{"Line":0}},{"line":120,"address":[25121315],"length":1,"stats":{"Line":0}},{"line":121,"address":[25121323],"length":1,"stats":{"Line":0}},{"line":122,"address":[25121331],"length":1,"stats":{"Line":0}},{"line":123,"address":[25121339],"length":1,"stats":{"Line":0}},{"line":124,"address":[25121347],"length":1,"stats":{"Line":0}},{"line":125,"address":[25121365],"length":1,"stats":{"Line":0}},{"line":128,"address":[25121383],"length":1,"stats":{"Line":0}},{"line":129,"address":[25121498,25124621,25121395],"length":1,"stats":{"Line":0}},{"line":130,"address":[25121934,25121868],"length":1,"stats":{"Line":0}},{"line":131,"address":[25122097,25121995],"length":1,"stats":{"Line":0}},{"line":132,"address":[25122076],"length":1,"stats":{"Line":0}},{"line":133,"address":[25124681],"length":1,"stats":{"Line":0}},{"line":135,"address":[25122221,25122119],"length":1,"stats":{"Line":0}},{"line":136,"address":[25122200],"length":1,"stats":{"Line":0}},{"line":137,"address":[25124655],"length":1,"stats":{"Line":0}},{"line":139,"address":[25122243,25122332],"length":1,"stats":{"Line":0}},{"line":140,"address":[25122324],"length":1,"stats":{"Line":0}},{"line":142,"address":[25122366,25122455],"length":1,"stats":{"Line":0}},{"line":143,"address":[25122447],"length":1,"stats":{"Line":0}},{"line":145,"address":[25122578,25122489],"length":1,"stats":{"Line":0}},{"line":146,"address":[25122570],"length":1,"stats":{"Line":0}},{"line":148,"address":[25122701,25122612],"length":1,"stats":{"Line":0}},{"line":149,"address":[25122693],"length":1,"stats":{"Line":0}},{"line":151,"address":[25122735,25122824],"length":1,"stats":{"Line":0}},{"line":152,"address":[25122816],"length":1,"stats":{"Line":0}},{"line":154,"address":[25122836,25122892,25122790],"length":1,"stats":{"Line":0}},{"line":155,"address":[25122884],"length":1,"stats":{"Line":0}},{"line":157,"address":[25122926,25123051],"length":1,"stats":{"Line":0}},{"line":159,"address":[25123007,25124078],"length":1,"stats":{"Line":0}},{"line":160,"address":[25124170,25124249,25124296],"length":1,"stats":{"Line":0}},{"line":161,"address":[25124322,25124257],"length":1,"stats":{"Line":0}},{"line":162,"address":[25124421],"length":1,"stats":{"Line":0}},{"line":164,"address":[25124479],"length":1,"stats":{"Line":0}},{"line":168,"address":[25124587],"length":1,"stats":{"Line":0}},{"line":171,"address":[25124207,25124141],"length":1,"stats":{"Line":0}},{"line":172,"address":[25124226],"length":1,"stats":{"Line":0}},{"line":175,"address":[25123198,25123073],"length":1,"stats":{"Line":0}},{"line":177,"address":[25123614,25123154],"length":1,"stats":{"Line":0}},{"line":178,"address":[25123711,25123807,25123854],"length":1,"stats":{"Line":0}},{"line":179,"address":[25123880,25123815,25123950],"length":1,"stats":{"Line":0}},{"line":181,"address":[25123748,25123682],"length":1,"stats":{"Line":0}},{"line":182,"address":[25123767],"length":1,"stats":{"Line":0}},{"line":187,"address":[25123609,25123204],"length":1,"stats":{"Line":0}},{"line":188,"address":[25123416,25123329,25123486],"length":1,"stats":{"Line":0}},{"line":192,"address":[25123371,25124626,25124613],"length":1,"stats":{"Line":0}},{"line":195,"address":[25121664],"length":1,"stats":{"Line":0}},{"line":196,"address":[25121515],"length":1,"stats":{"Line":0}},{"line":197,"address":[25121563],"length":1,"stats":{"Line":0}},{"line":198,"address":[25121571],"length":1,"stats":{"Line":0}},{"line":199,"address":[25121579],"length":1,"stats":{"Line":0}},{"line":200,"address":[25121587],"length":1,"stats":{"Line":0}},{"line":201,"address":[25121595],"length":1,"stats":{"Line":0}},{"line":202,"address":[25121602],"length":1,"stats":{"Line":0}},{"line":203,"address":[25121609],"length":1,"stats":{"Line":0}},{"line":204,"address":[25121616],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":122},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","husky.rs"],"content":"use miette::{IntoDiagnostic, Result};\nuse std::fs;\nuse std::path::Path;\nuse std::process::Command;\n\n/// Configura husky y el hook pre-commit en el proyecto destino\npub fn setup_husky_pre_commit(root: \u0026Path) -\u003e Result\u003c()\u003e {\n    let package_json_path = root.join(\"package.json\");\n\n    // Verificar si el proyecto tiene package.json\n    if !package_json_path.exists() {\n        println!(\"⚠️  No se encontró package.json, omitiendo configuración de husky.\");\n        return Ok(());\n    }\n\n    println!(\"🔧 Configurando husky y pre-commit hook...\");\n\n    // Ejecutar npx husky-init\n    let husky_init_output = Command::new(\"npx\")\n        .args([\"husky-init\"])\n        .current_dir(root)\n        .output();\n\n    match husky_init_output {\n        Ok(output) =\u003e {\n            if output.status.success() {\n                println!(\"✅ husky-init ejecutado correctamente.\");\n\n                // Crear el hook pre-commit\n                let pre_commit_path = root.join(\".husky\").join(\"pre-commit\");\n                let pre_commit_content = r#\"#!/bin/sh\n. \"$(dirname \"$0\")/_/husky.sh\"\n\necho \"🏗️  Ejecutando Architect Linter Pro...\"\n\n# Ejecutar architect-linter-pro en el directorio actual (.)\narchitect-linter-pro .\n\n# Si el linter encuentra errores, el commit se cancelará\nif [ $? -ne 0 ]; then\n  echo \"\"\n  echo \"❌ El commit fue cancelado debido a violaciones de arquitectura\"\n  echo \"💡 Corrige los errores reportados arriba y vuelve a intentar el commit\"\n  exit 1\nfi\n\necho \"✅ Validación de arquitectura exitosa\"\nexit 0\n\"#\n                .to_string();\n\n                // Escribir el hook\n                fs::write(\u0026pre_commit_path, pre_commit_content).into_diagnostic()?;\n\n                // Dar permisos de ejecución al hook (Unix-like systems)\n                #[cfg(unix)]\n                {\n                    let _ = Command::new(\"chmod\")\n                        .args([\"+x\", pre_commit_path.to_str().unwrap()])\n                        .status();\n                }\n\n                // Crear también versión para Windows si es necesario\n                #[cfg(windows)]\n                {\n                    let pre_commit_bat = root.join(\".husky\").join(\"pre-commit.bat\");\n                    let pre_commit_bat_content = r#\"@echo off\necho 🏗️  Ejecutando Architect Linter Pro...\n\nREM Ejecutar architect-linter-pro en el directorio actual (.)\narchitect-linter-pro .\n\nREM Si el linter encuentra errores, el commit se cancelará\nif errorlevel 1 (\n    echo.\n    echo ❌ El commit fue cancelado debido a violaciones de arquitectura\n    echo 💡 Corrige los errores reportados arriba y vuelve a intentar el commit\n    exit /b 1\n)\n\necho ✅ Validación de arquitectura exitosa\nexit /b 0\n\"#\n                    .to_string();\n                    let _ = fs::write(\u0026pre_commit_bat, pre_commit_bat_content);\n                }\n\n                println!(\"✅ Hook pre-commit configurado exitosamente.\");\n                println!(\"💡 Ahora architect-linter se ejecutará automáticamente en cada commit.\");\n            } else {\n                let stderr = String::from_utf8_lossy(\u0026output.stderr);\n                println!(\"⚠️  Error al ejecutar husky-init: {}\", stderr);\n                println!(\"💡 Puedes configurar husky manualmente con: npx husky-init\");\n            }\n        }\n        Err(e) =\u003e {\n            println!(\"⚠️  No se pudo ejecutar npx husky-init: {}\", e);\n            println!(\"💡 Asegúrate de tener Node.js y npm instalados.\");\n            println!(\"💡 Para configurar husky manualmente, ejecuta: npx husky-init\");\n        }\n    }\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","ignored_paths.rs"],"content":"use crate::config::Framework;\n\n/// Valores por defecto para ignored_paths\npub fn default_ignored_paths() -\u003e Vec\u003cString\u003e {\n    vec![\n        \"node_modules/\".to_string(),\n        \"dist/\".to_string(),\n        \"build/\".to_string(),\n        \".git/\".to_string(),\n        \"coverage/\".to_string(),\n        \".next/\".to_string(),\n        \"out/\".to_string(),\n        \".nuxt/\".to_string(),\n        \".output/\".to_string(),\n        \".vite/\".to_string(),            // Vite cache\n        \".turbo/\".to_string(),           // Turborepo cache\n        \".parcel-cache/\".to_string(),    // Parcel cache\n        \".cache/\".to_string(),           // Generic cache\n        \".architect-cache/\".to_string(), // Architect Linter cache\n        \"target/\".to_string(),           // Rust\n        \"__pycache__/\".to_string(),      // Python\n        \".vscode/\".to_string(),          // VSCode\n        \".idea/\".to_string(),            // IntelliJ\n        \"venv/\".to_string(),             // Python venv\n        \".venv/\".to_string(),            // Python venv\n        \"vendor/\".to_string(),           // PHP/Go vendor\n        \".gradle/\".to_string(),          // Gradle\n    ]\n}\n\n/// Obtiene los patrones de exclusión según el framework detectado\npub fn get_framework_ignored_paths(framework: \u0026Framework) -\u003e Vec\u003cString\u003e {\n    let mut paths = vec![\n        \"node_modules/\".to_string(),\n        \".git/\".to_string(),\n        \"coverage/\".to_string(),\n        \".vscode/\".to_string(),\n        \".idea/\".to_string(),\n    ];\n\n    match framework {\n        Framework::React =\u003e {\n            paths.extend(vec![\n                \"build/\".to_string(),\n                \"dist/\".to_string(),\n                \".next/\".to_string(), // Next.js\n                \"out/\".to_string(),\n                \".vite/\".to_string(),         // Vite\n                \".turbo/\".to_string(),        // Turborepo\n                \".parcel-cache/\".to_string(), // Parcel\n            ]);\n        }\n        Framework::NestJS =\u003e {\n            paths.extend(vec![\"dist/\".to_string(), \"build/\".to_string()]);\n        }\n        Framework::Angular =\u003e {\n            paths.extend(vec![\"dist/\".to_string(), \".angular/\".to_string()]);\n        }\n        Framework::Express =\u003e {\n            paths.extend(vec![\"dist/\".to_string(), \"build/\".to_string()]);\n        }\n        // Python frameworks\n        Framework::Django | Framework::Flask | Framework::FastAPI =\u003e {\n            paths.extend(vec![\n                \"venv/\".to_string(),\n                \".venv/\".to_string(),\n                \"env/\".to_string(),\n                \".env/\".to_string(),\n                \"__pycache__/\".to_string(),\n                \"*.pyc\".to_string(),\n                \".pytest_cache/\".to_string(),\n                \".mypy_cache/\".to_string(),\n                \"htmlcov/\".to_string(),\n                \"*.egg-info/\".to_string(),\n            ]);\n        }\n        // Go frameworks\n        Framework::Gin | Framework::Echo =\u003e {\n            paths.extend(vec![\n                \"vendor/\".to_string(),\n                \"bin/\".to_string(),\n                \"*.exe\".to_string(),\n                \"*.exe~\".to_string(),\n                \"*.dll\".to_string(),\n                \"*.so\".to_string(),\n                \"*.dylib\".to_string(),\n            ]);\n        }\n        // Java frameworks\n        Framework::Spring =\u003e {\n            paths.extend(vec![\n                \"target/\".to_string(),\n                \".gradle/\".to_string(),\n                \"build/\".to_string(),\n                \"out/\".to_string(),\n                \"*.class\".to_string(),\n                \"*.jar\".to_string(),\n                \"*.war\".to_string(),\n            ]);\n        }\n        // PHP frameworks\n        Framework::Laravel | Framework::Symfony =\u003e {\n            paths.extend(vec![\n                \"vendor/\".to_string(),\n                \"storage/\".to_string(),\n                \"bootstrap/cache/\".to_string(),\n                \"*.log\".to_string(),\n            ]);\n        }\n        Framework::Unknown =\u003e {\n            paths.extend(vec![\n                \"dist/\".to_string(),\n                \"build/\".to_string(),\n                \"out/\".to_string(),\n                \".vite/\".to_string(),\n                \".cache/\".to_string(),\n            ]);\n        }\n    }\n\n    paths\n}\n","traces":[{"line":4,"address":[24866849,24866855,24864224],"length":1,"stats":{"Line":0}},{"line":5,"address":[24864289,24865821,24866836,24865348,24865492,24864844,24864988,24865564,24865636,24864251,24864490,24865132,24865204,24864358,24864700,24864772,24864916,24864559,24865060,24865276,24864628,24864424,24865420,24865708,24865780],"length":1,"stats":{"Line":0}},{"line":6,"address":[24864261],"length":1,"stats":{"Line":0}},{"line":7,"address":[24864330],"length":1,"stats":{"Line":0}},{"line":8,"address":[24864396],"length":1,"stats":{"Line":0}},{"line":9,"address":[24864462],"length":1,"stats":{"Line":0}},{"line":10,"address":[24864528],"length":1,"stats":{"Line":0}},{"line":11,"address":[24864597],"length":1,"stats":{"Line":0}},{"line":12,"address":[24864669],"length":1,"stats":{"Line":0}},{"line":13,"address":[24864741],"length":1,"stats":{"Line":0}},{"line":14,"address":[24864813],"length":1,"stats":{"Line":0}},{"line":15,"address":[24864885],"length":1,"stats":{"Line":0}},{"line":16,"address":[24864957],"length":1,"stats":{"Line":0}},{"line":17,"address":[24865029],"length":1,"stats":{"Line":0}},{"line":18,"address":[24865101],"length":1,"stats":{"Line":0}},{"line":19,"address":[24865173],"length":1,"stats":{"Line":0}},{"line":20,"address":[24865245],"length":1,"stats":{"Line":0}},{"line":21,"address":[24865317],"length":1,"stats":{"Line":0}},{"line":22,"address":[24865389],"length":1,"stats":{"Line":0}},{"line":23,"address":[24865461],"length":1,"stats":{"Line":0}},{"line":24,"address":[24865533],"length":1,"stats":{"Line":0}},{"line":25,"address":[24865605],"length":1,"stats":{"Line":0}},{"line":26,"address":[24865677],"length":1,"stats":{"Line":0}},{"line":27,"address":[24865749],"length":1,"stats":{"Line":0}},{"line":32,"address":[24868291,24873957,24866880],"length":1,"stats":{"Line":0}},{"line":33,"address":[24873970,24867192,24867048,24866973,24867585,24867120,24867305,24866929,24867264],"length":1,"stats":{"Line":0}},{"line":34,"address":[24866942],"length":1,"stats":{"Line":0}},{"line":35,"address":[24867017],"length":1,"stats":{"Line":0}},{"line":36,"address":[24867089],"length":1,"stats":{"Line":0}},{"line":37,"address":[24867161],"length":1,"stats":{"Line":0}},{"line":38,"address":[24867233],"length":1,"stats":{"Line":0}},{"line":41,"address":[24867598,24867550],"length":1,"stats":{"Line":0}},{"line":43,"address":[24868424,24868568,24868640,24868825,24867638,24868310,24868496,24868349,24868784,24868712],"length":1,"stats":{"Line":0}},{"line":44,"address":[24868318],"length":1,"stats":{"Line":0}},{"line":45,"address":[24868393],"length":1,"stats":{"Line":0}},{"line":46,"address":[24868465],"length":1,"stats":{"Line":0}},{"line":47,"address":[24868537],"length":1,"stats":{"Line":0}},{"line":48,"address":[24868609],"length":1,"stats":{"Line":0}},{"line":49,"address":[24868681],"length":1,"stats":{"Line":0}},{"line":50,"address":[24868753],"length":1,"stats":{"Line":0}},{"line":54,"address":[24867610,24867883,24868297],"length":1,"stats":{"Line":0}},{"line":57,"address":[24867666,24869164],"length":1,"stats":{"Line":0}},{"line":60,"address":[24869526,24867691],"length":1,"stats":{"Line":0}},{"line":64,"address":[24869888,24870362,24869927,24870434,24870002,24870218,24867716,24870290,24870506,24870578,24870619,24870146,24870074],"length":1,"stats":{"Line":0}},{"line":65,"address":[24869896],"length":1,"stats":{"Line":0}},{"line":66,"address":[24869971],"length":1,"stats":{"Line":0}},{"line":67,"address":[24870043],"length":1,"stats":{"Line":0}},{"line":68,"address":[24870115],"length":1,"stats":{"Line":0}},{"line":69,"address":[24870187],"length":1,"stats":{"Line":0}},{"line":70,"address":[24870259],"length":1,"stats":{"Line":0}},{"line":71,"address":[24870331],"length":1,"stats":{"Line":0}},{"line":72,"address":[24870403],"length":1,"stats":{"Line":0}},{"line":73,"address":[24870475],"length":1,"stats":{"Line":0}},{"line":74,"address":[24870547],"length":1,"stats":{"Line":0}},{"line":79,"address":[24867741,24871048,24871306,24871087,24871162,24871378,24871450,24871234,24871563,24871522],"length":1,"stats":{"Line":0}},{"line":80,"address":[24871056],"length":1,"stats":{"Line":0}},{"line":81,"address":[24871131],"length":1,"stats":{"Line":0}},{"line":82,"address":[24871203],"length":1,"stats":{"Line":0}},{"line":83,"address":[24871275],"length":1,"stats":{"Line":0}},{"line":84,"address":[24871347],"length":1,"stats":{"Line":0}},{"line":85,"address":[24871419],"length":1,"stats":{"Line":0}},{"line":86,"address":[24871491],"length":1,"stats":{"Line":0}},{"line":91,"address":[24872417,24872304,24871941,24872376,24867766,24872016,24872088,24872232,24872160,24871902],"length":1,"stats":{"Line":0}},{"line":92,"address":[24871910],"length":1,"stats":{"Line":0}},{"line":93,"address":[24871985],"length":1,"stats":{"Line":0}},{"line":94,"address":[24872057],"length":1,"stats":{"Line":0}},{"line":95,"address":[24872129],"length":1,"stats":{"Line":0}},{"line":96,"address":[24872201],"length":1,"stats":{"Line":0}},{"line":97,"address":[24872273],"length":1,"stats":{"Line":0}},{"line":98,"address":[24872345],"length":1,"stats":{"Line":0}},{"line":103,"address":[24872756,24867791,24872870,24873055,24872795,24872942,24873014],"length":1,"stats":{"Line":0}},{"line":104,"address":[24872764],"length":1,"stats":{"Line":0}},{"line":105,"address":[24872839],"length":1,"stats":{"Line":0}},{"line":106,"address":[24872911],"length":1,"stats":{"Line":0}},{"line":107,"address":[24872983],"length":1,"stats":{"Line":0}},{"line":111,"address":[24873313,24867816,24873684,24873427,24873643,24873571,24873352,24873499],"length":1,"stats":{"Line":0}},{"line":112,"address":[24873321],"length":1,"stats":{"Line":0}},{"line":113,"address":[24873396],"length":1,"stats":{"Line":0}},{"line":114,"address":[24873468],"length":1,"stats":{"Line":0}},{"line":115,"address":[24873540],"length":1,"stats":{"Line":0}},{"line":116,"address":[24873612],"length":1,"stats":{"Line":0}},{"line":121,"address":[24868248],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":82},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","loader.rs"],"content":"use miette::{Diagnostic, IntoDiagnostic, Result};\nuse serde::{Deserialize, Serialize};\nuse std::fs;\nuse std::path::Path;\nuse thiserror::Error;\n\nuse super::types::{AIConfig, ArchPattern, ForbiddenRule, Framework, LinterContext};\n\n/// Estructura para mapear el architect.json tal cual está en el disco\n#[derive(Debug, Serialize, Deserialize)]\npub struct ConfigFile {\n    pub max_lines_per_function: usize,\n    pub architecture_pattern: ArchPattern,\n    pub forbidden_imports: Vec\u003cForbiddenRule\u003e,\n    #[serde(default = \"super::ignored_paths::default_ignored_paths\")]\n    pub ignored_paths: Vec\u003cString\u003e,\n}\n\n/// Estructura para el archivo de configuración de IA (ahora soporta múltiples)\n#[derive(Debug, Serialize, Deserialize)]\npub struct AIConfigFile {\n    pub configs: Vec\u003cAIConfig\u003e,\n    pub selected_name: String,\n}\n\n#[derive(Error, Debug, Diagnostic)]\n#[error(\"{details}\")]\n#[diagnostic(code(config::invalid), severity(error))]\npub struct ConfigError {\n    #[help]\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub help: String,\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub details: String,\n}\n\nimpl ConfigError {\n    pub fn new(details: String, help: String) -\u003e Self {\n        Self { details, help }\n    }\n}\n\n/// CARGA SILENCIOSA: Lee architect.json y .architect.ai.json y los convierte en contexto\npub fn load_config(root: \u0026Path) -\u003e Result\u003cLinterContext\u003e {\n    let config_path = root.join(\"architect.json\");\n\n    // Leer el archivo de reglas\n    let content = fs::read_to_string(\u0026config_path).map_err(|e| {\n        ConfigError::new(\n            format!(\"No se pudo leer architect.json: {}\", e),\n            format!(\n                \"Asegúrate de que el archivo existe en: {}\",\n                config_path.display()\n            ),\n        )\n    })?;\n\n    // Validar que es JSON válido\n    let json_value: serde_json::Value = serde_json::from_str(\u0026content)\n        .map_err(|e| ConfigError::new(\n            format!(\"JSON inválido: {}\", e),\n            \"Verifica que el archivo architect.json tenga sintaxis JSON válida. Usa un validador JSON online si es necesario.\".to_string()\n        ))?;\n\n    // Validar el esquema antes de deserializar\n    validate_schema(\u0026json_value)?;\n\n    // Ahora sí deserializar con mejor manejo de errores\n    let config: ConfigFile = serde_json::from_value(json_value).map_err(|e| {\n        ConfigError::new(\n            format!(\"Error en la estructura: {}\", e),\n            \"Revisa que todos los campos tengan el tipo correcto.\".to_string(),\n        )\n    })?;\n\n    // Validar los valores\n    validate_config_values(\u0026config)?;\n\n    // Cargar configuración de IA (si existe, es opcional)\n    let ai_config_path = root.join(\".architect.ai.json\");\n    let ai_configs = if ai_config_path.exists() {\n        let ai_content = fs::read_to_string(\u0026ai_config_path).into_diagnostic()?;\n        let ai_file: AIConfigFile = serde_json::from_str(\u0026ai_content).into_diagnostic()?;\n\n        let mut configs = ai_file.configs;\n        // Mover la configuración seleccionada al principio de la lista\n        if let Some(pos) = configs.iter().position(|c| c.name == ai_file.selected_name) {\n            let selected = configs.remove(pos);\n            configs.insert(0, selected);\n        }\n        configs\n    } else {\n        Vec::new()\n    };\n\n    // Re-detectamos el framework para el contexto actual\n    let framework = crate::detector::detect_framework(root);\n\n    Ok(LinterContext {\n        max_lines: config.max_lines_per_function,\n        framework,\n        pattern: config.architecture_pattern,\n        forbidden_imports: config.forbidden_imports,\n        ignored_paths: config.ignored_paths,\n        ai_configs,\n    })\n}\n\n/// Valida que el JSON tenga todos los campos requeridos\nfn validate_schema(json: \u0026serde_json::Value) -\u003e Result\u003c()\u003e {\n    let obj = json.as_object().ok_or_else(|| {\n        ConfigError::new(\n            \"El archivo debe ser un objeto JSON\".to_string(),\n            \"El archivo architect.json debe empezar y terminar con llaves { }\".to_string(),\n        )\n    })?;\n\n    // Validar campo: max_lines_per_function\n    if !obj.contains_key(\"max_lines_per_function\") {\n        return Err(ConfigError::new(\n            \"Falta el campo requerido: max_lines_per_function\".to_string(),\n            \"Agrega este campo con un número, ejemplo: \\\"max_lines_per_function\\\": 40\".to_string(),\n        )\n        .into());\n    }\n\n    if !obj[\"max_lines_per_function\"].is_number() {\n        return Err(ConfigError::new(\n            \"El campo 'max_lines_per_function' debe ser un número\".to_string(),\n            \"Ejemplo correcto: \\\"max_lines_per_function\\\": 40\".to_string(),\n        )\n        .into());\n    }\n\n    // Validar campo: architecture_pattern\n    if !obj.contains_key(\"architecture_pattern\") {\n        return Err(ConfigError::new(\n            \"Falta el campo requerido: architecture_pattern\".to_string(),\n            \"Agrega este campo. Valores válidos: \\\"Hexagonal\\\", \\\"Clean\\\", \\\"MVC\\\", \\\"Ninguno\\\"\"\n                .to_string(),\n        )\n        .into());\n    }\n\n    if !obj[\"architecture_pattern\"].is_string() {\n        return Err(ConfigError::new(\n            \"El campo 'architecture_pattern' debe ser un string\".to_string(),\n            \"Valores válidos: \\\"Hexagonal\\\", \\\"Clean\\\", \\\"MVC\\\", \\\"Ninguno\\\"\".to_string(),\n        )\n        .into());\n    }\n\n    // Validar que el patrón sea uno de los valores aceptados\n    let pattern_str = obj[\"architecture_pattern\"].as_str().unwrap_or(\"Ninguno\");\n    let valid_patterns = [\"Hexagonal\", \"Clean\", \"MVC\", \"Ninguno\"];\n    if !valid_patterns.contains(\u0026pattern_str) {\n        return Err(ConfigError::new(\n            format!(\"Patrón arquitectónico inválido: '{}'\", pattern_str),\n            format!(\"Valores válidos: {}\", valid_patterns.join(\", \")),\n        )\n        .into());\n    }\n\n    // Validar cada regla en forbidden_imports\n    let rules = match obj[\"forbidden_imports\"].as_array() {\n        Some(r) =\u003e r,\n        None =\u003e {\n            return Err(ConfigError::new(\n                \"El campo 'forbidden_imports' debe ser un array\".to_string(),\n                \"Ejemplo: \\\"forbidden_imports\\\": []\".to_string(),\n            )\n            .into())\n        }\n    };\n    for (index, rule) in rules.iter().enumerate() {\n        if !rule.is_object() {\n            return Err(ConfigError::new(\n                format!(\n                    \"La regla #{} en forbidden_imports no es un objeto\",\n                    index + 1\n                ),\n                \"Cada regla debe tener la forma: {\\\"from\\\": \\\"patrón1\\\", \\\"to\\\": \\\"patrón2\\\"}\"\n                    .to_string(),\n            )\n            .into());\n        }\n\n        let rule_obj = rule.as_object().unwrap_or_else(|| unreachable!());\n\n        if !rule_obj.contains_key(\"from\") {\n            return Err(ConfigError::new(\n                format!(\"La regla #{} no tiene el campo 'from'\", index + 1),\n                \"Ejemplo: {\\\"from\\\": \\\"src/components/**\\\", \\\"to\\\": \\\"src/services/**\\\"}\"\n                    .to_string(),\n            )\n            .into());\n        }\n\n        if !rule_obj.contains_key(\"to\") {\n            return Err(ConfigError::new(\n                format!(\"La regla #{} no tiene el campo 'to'\", index + 1),\n                \"Ejemplo: {\\\"from\\\": \\\"src/components/**\\\", \\\"to\\\": \\\"src/services/**\\\"}\"\n                    .to_string(),\n            )\n            .into());\n        }\n\n        if !rule_obj[\"from\"].is_string() {\n            return Err(ConfigError::new(\n                format!(\n                    \"El campo 'from' en la regla #{} debe ser un string\",\n                    index + 1\n                ),\n                \"Ejemplo: \\\"from\\\": \\\"src/components/**\\\"\".to_string(),\n            )\n            .into());\n        }\n\n        if !rule_obj[\"to\"].is_string() {\n            return Err(ConfigError::new(\n                format!(\n                    \"El campo 'to' en la regla #{} debe ser un string\",\n                    index + 1\n                ),\n                \"Ejemplo: \\\"to\\\": \\\"src/services/**\\\"\".to_string(),\n            )\n            .into());\n        }\n    }\n\n    Ok(())\n}\n\n/// Valida los valores de la configuración (rangos, lógica, etc.)\nfn validate_config_values(config: \u0026ConfigFile) -\u003e Result\u003c()\u003e {\n    // Validar que max_lines_per_function esté en un rango razonable\n    if config.max_lines_per_function == 0 {\n        return Err(ConfigError::new(\n            \"max_lines_per_function no puede ser 0\".to_string(),\n            \"Usa un valor entre 10 y 500. Recomendado: 20-60 según tu framework.\".to_string(),\n        )\n        .into());\n    }\n\n    if config.max_lines_per_function \u003e 1000 {\n        return Err(ConfigError::new(\n            format!(\n                \"max_lines_per_function es muy alto: {}\",\n                config.max_lines_per_function\n            ),\n            \"Un valor tan alto desactiva efectivamente esta validación. Máximo recomendado: 500\"\n                .to_string(),\n        )\n        .into());\n    }\n\n    // Validar que forbidden_imports tenga reglas únicas (no duplicadas)\n    for (i, rule1) in config.forbidden_imports.iter().enumerate() {\n        for (j, rule2) in config.forbidden_imports.iter().enumerate() {\n            if i != j \u0026\u0026 rule1.from == rule2.from \u0026\u0026 rule1.to == rule2.to {\n                return Err(ConfigError::new(\n                    format!(\"Regla duplicada: from '{}' to '{}'\", rule1.from, rule1.to),\n                    \"Elimina una de las reglas duplicadas en forbidden_imports.\".to_string(),\n                )\n                .into());\n            }\n        }\n    }\n\n    // Advertencia si no hay reglas (aunque técnicamente válido)\n    if config.forbidden_imports.is_empty() {\n        eprintln!(\"⚠️  Advertencia: No hay reglas en forbidden_imports. El linter solo validará la longitud de funciones.\");\n    }\n\n    Ok(())\n}\n\n/// Detecta el framework del proyecto (wrapper público)\n#[allow(dead_code)]\npub fn detect_project_framework(root: \u0026Path) -\u003e Framework {\n    crate::detector::detect_framework(root)\n}\n","traces":[{"line":40,"address":[25401760],"length":1,"stats":{"Line":0}},{"line":46,"address":[25405593,25405286,25401824],"length":1,"stats":{"Line":0}},{"line":47,"address":[25401879],"length":1,"stats":{"Line":0}},{"line":50,"address":[24860224,24860780,24860786],"length":1,"stats":{"Line":0}},{"line":51,"address":[24860701],"length":1,"stats":{"Line":0}},{"line":52,"address":[24860259,24860340],"length":1,"stats":{"Line":0}},{"line":53,"address":[24860567],"length":1,"stats":{"Line":0}},{"line":55,"address":[24860516,24860448],"length":1,"stats":{"Line":0}},{"line":61,"address":[25402411,25402328,25402457,25402581,25405570],"length":1,"stats":{"Line":0}},{"line":62,"address":[24860208,24860123,24859856,24860202],"length":1,"stats":{"Line":0}},{"line":63,"address":[24859878,24859956],"length":1,"stats":{"Line":0}},{"line":64,"address":[24860050],"length":1,"stats":{"Line":0}},{"line":68,"address":[25402796,25402738,25405500],"length":1,"stats":{"Line":0}},{"line":71,"address":[24860800,24861146,24861152],"length":1,"stats":{"Line":0}},{"line":72,"address":[24861067],"length":1,"stats":{"Line":0}},{"line":73,"address":[24860900,24860822],"length":1,"stats":{"Line":0}},{"line":74,"address":[24860994],"length":1,"stats":{"Line":0}},{"line":79,"address":[25403406,25403348,25405410],"length":1,"stats":{"Line":0}},{"line":82,"address":[25403527],"length":1,"stats":{"Line":0}},{"line":83,"address":[25403567,25403638],"length":1,"stats":{"Line":0}},{"line":84,"address":[25405389,25403741,25403678],"length":1,"stats":{"Line":0}},{"line":85,"address":[25403949,25404020],"length":1,"stats":{"Line":0}},{"line":87,"address":[25404279],"length":1,"stats":{"Line":0}},{"line":89,"address":[24859808,24859833],"length":1,"stats":{"Line":0}},{"line":90,"address":[25404542],"length":1,"stats":{"Line":0}},{"line":91,"address":[25404630],"length":1,"stats":{"Line":0}},{"line":93,"address":[25404576],"length":1,"stats":{"Line":0}},{"line":95,"address":[25403659,25403705],"length":1,"stats":{"Line":0}},{"line":99,"address":[25403723,25404871],"length":1,"stats":{"Line":0}},{"line":101,"address":[25405005],"length":1,"stats":{"Line":0}},{"line":102,"address":[25404878],"length":1,"stats":{"Line":0}},{"line":104,"address":[25404886],"length":1,"stats":{"Line":0}},{"line":105,"address":[25404893],"length":1,"stats":{"Line":0}},{"line":106,"address":[25404933],"length":1,"stats":{"Line":0}},{"line":107,"address":[25404973],"length":1,"stats":{"Line":0}},{"line":112,"address":[25406195,25405616,25406227],"length":1,"stats":{"Line":0}},{"line":113,"address":[25405827,25405631],"length":1,"stats":{"Line":0}},{"line":114,"address":[24861311],"length":1,"stats":{"Line":0}},{"line":115,"address":[24861214],"length":1,"stats":{"Line":0}},{"line":116,"address":[24861260],"length":1,"stats":{"Line":0}},{"line":121,"address":[25405911],"length":1,"stats":{"Line":0}},{"line":122,"address":[25406171,25406103],"length":1,"stats":{"Line":0}},{"line":123,"address":[25405933],"length":1,"stats":{"Line":0}},{"line":124,"address":[25405986],"length":1,"stats":{"Line":0}},{"line":126,"address":[25406150],"length":1,"stats":{"Line":0}},{"line":129,"address":[25406018],"length":1,"stats":{"Line":0}},{"line":130,"address":[25406386,25406454],"length":1,"stats":{"Line":0}},{"line":131,"address":[25406233],"length":1,"stats":{"Line":0}},{"line":132,"address":[25406286],"length":1,"stats":{"Line":0}},{"line":134,"address":[25406433],"length":1,"stats":{"Line":0}},{"line":138,"address":[25406318],"length":1,"stats":{"Line":0}},{"line":139,"address":[25406726,25406658],"length":1,"stats":{"Line":0}},{"line":140,"address":[25406489],"length":1,"stats":{"Line":0}},{"line":142,"address":[25406542],"length":1,"stats":{"Line":0}},{"line":144,"address":[25406705],"length":1,"stats":{"Line":0}},{"line":147,"address":[25406574],"length":1,"stats":{"Line":0}},{"line":148,"address":[25407108,25407176],"length":1,"stats":{"Line":0}},{"line":149,"address":[25406761],"length":1,"stats":{"Line":0}},{"line":150,"address":[25406814],"length":1,"stats":{"Line":0}},{"line":152,"address":[25407155],"length":1,"stats":{"Line":0}},{"line":156,"address":[25406849],"length":1,"stats":{"Line":0}},{"line":157,"address":[25406923],"length":1,"stats":{"Line":0}},{"line":158,"address":[25407031],"length":1,"stats":{"Line":0}},{"line":159,"address":[25407725,25407793],"length":1,"stats":{"Line":0}},{"line":160,"address":[25407219],"length":1,"stats":{"Line":0}},{"line":161,"address":[25407341,25407528],"length":1,"stats":{"Line":0}},{"line":163,"address":[25407772],"length":1,"stats":{"Line":0}},{"line":167,"address":[25407397],"length":1,"stats":{"Line":0}},{"line":168,"address":[25407828],"length":1,"stats":{"Line":0}},{"line":170,"address":[25408062,25408130],"length":1,"stats":{"Line":0}},{"line":171,"address":[25407954],"length":1,"stats":{"Line":0}},{"line":172,"address":[25408001],"length":1,"stats":{"Line":0}},{"line":174,"address":[25408109],"length":1,"stats":{"Line":0}},{"line":177,"address":[25407844,25408165],"length":1,"stats":{"Line":0}},{"line":178,"address":[25408268],"length":1,"stats":{"Line":0}},{"line":179,"address":[25408685,25408617],"length":1,"stats":{"Line":0}},{"line":180,"address":[25408420],"length":1,"stats":{"Line":0}},{"line":182,"address":[25408302,25408404,25408567],"length":1,"stats":{"Line":0}},{"line":185,"address":[25408536],"length":1,"stats":{"Line":0}},{"line":187,"address":[25408664],"length":1,"stats":{"Line":0}},{"line":190,"address":[24861168,24861169],"length":1,"stats":{"Line":0}},{"line":192,"address":[25408368],"length":1,"stats":{"Line":0}},{"line":193,"address":[25409002,25409070],"length":1,"stats":{"Line":0}},{"line":194,"address":[25408725,25408789,25408952],"length":1,"stats":{"Line":0}},{"line":196,"address":[25408921],"length":1,"stats":{"Line":0}},{"line":198,"address":[25409049],"length":1,"stats":{"Line":0}},{"line":201,"address":[25408753],"length":1,"stats":{"Line":0}},{"line":202,"address":[25409403,25409471],"length":1,"stats":{"Line":0}},{"line":203,"address":[25409353,25409110,25409190],"length":1,"stats":{"Line":0}},{"line":205,"address":[25409322],"length":1,"stats":{"Line":0}},{"line":207,"address":[25409450],"length":1,"stats":{"Line":0}},{"line":210,"address":[25409138],"length":1,"stats":{"Line":0}},{"line":211,"address":[25409872,25409804],"length":1,"stats":{"Line":0}},{"line":212,"address":[25409607],"length":1,"stats":{"Line":0}},{"line":214,"address":[25409591,25409754,25409511],"length":1,"stats":{"Line":0}},{"line":216,"address":[25409723],"length":1,"stats":{"Line":0}},{"line":218,"address":[25409851],"length":1,"stats":{"Line":0}},{"line":221,"address":[25409539],"length":1,"stats":{"Line":0}},{"line":222,"address":[25410151,25410219],"length":1,"stats":{"Line":0}},{"line":223,"address":[25409954],"length":1,"stats":{"Line":0}},{"line":225,"address":[25409912,25410101],"length":1,"stats":{"Line":0}},{"line":227,"address":[25410070],"length":1,"stats":{"Line":0}},{"line":229,"address":[25410198],"length":1,"stats":{"Line":0}},{"line":233,"address":[25408280],"length":1,"stats":{"Line":0}},{"line":237,"address":[25411488,25410256,25411456],"length":1,"stats":{"Line":0}},{"line":239,"address":[25410276],"length":1,"stats":{"Line":0}},{"line":240,"address":[25411727,25411665],"length":1,"stats":{"Line":0}},{"line":241,"address":[25410328],"length":1,"stats":{"Line":0}},{"line":242,"address":[25410375],"length":1,"stats":{"Line":0}},{"line":244,"address":[25411709],"length":1,"stats":{"Line":0}},{"line":247,"address":[25410312],"length":1,"stats":{"Line":0}},{"line":248,"address":[25411528,25411596],"length":1,"stats":{"Line":0}},{"line":249,"address":[25410522],"length":1,"stats":{"Line":0}},{"line":254,"address":[25410642],"length":1,"stats":{"Line":0}},{"line":256,"address":[25411575],"length":1,"stats":{"Line":0}},{"line":260,"address":[25410676,25410407],"length":1,"stats":{"Line":0}},{"line":261,"address":[25410788,25410965],"length":1,"stats":{"Line":0}},{"line":262,"address":[25411072],"length":1,"stats":{"Line":0}},{"line":263,"address":[25411378,25411446],"length":1,"stats":{"Line":0}},{"line":264,"address":[25411138],"length":1,"stats":{"Line":0}},{"line":265,"address":[25411313],"length":1,"stats":{"Line":0}},{"line":267,"address":[25411425],"length":1,"stats":{"Line":0}},{"line":273,"address":[25410900],"length":1,"stats":{"Line":0}},{"line":274,"address":[25410921],"length":1,"stats":{"Line":0}},{"line":277,"address":[25410910],"length":1,"stats":{"Line":0}},{"line":282,"address":[25411760],"length":1,"stats":{"Line":0}},{"line":283,"address":[25411774],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":127},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","mod.rs"],"content":"//! Configuración del Architect Linter Pro\n//!\n//! Este módulo contiene toda la lógica relacionada con:\n//! - Tipos de configuración (Framework, ArchPattern, etc.)\n//! - Carga y validación de architect.json\n//! - Wizard de configuración con IA\n//! - Gestión de ignored_paths\n//! - Setup de hooks de git (husky)\n\nmod husky;\nmod ignored_paths;\nmod loader;\nmod types;\nmod wizard;\n\n// Re-export tipos públicos\npub use types::{\n    AIConfig, AIProvider, ArchError, ArchPattern, ForbiddenRule, Framework, LinterContext,\n};\n\n// Re-export funciones de loader\npub use loader::load_config;\n\n// Re-export funciones de wizard\npub use wizard::setup_or_load_config;\n\n// Re-export funciones de ignored_paths\npub use ignored_paths::default_ignored_paths;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","types.rs"],"content":"use miette::{Diagnostic, SourceSpan};\nuse serde::{Deserialize, Serialize};\nuse thiserror::Error;\n\n#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]\npub enum Framework {\n    NestJS,\n    React,\n    Angular,\n    Express,\n    // Python frameworks\n    Django,\n    Flask,\n    FastAPI,\n    // Go frameworks\n    Gin,\n    Echo,\n    // Java frameworks\n    Spring,\n    // PHP frameworks\n    Laravel,\n    Symfony,\n    Unknown,\n}\n\nimpl Framework {\n    pub fn as_str(\u0026self) -\u003e \u0026str {\n        match self {\n            Framework::NestJS =\u003e \"NestJS\",\n            Framework::React =\u003e \"React\",\n            Framework::Angular =\u003e \"Angular\",\n            Framework::Express =\u003e \"Express\",\n            // Python\n            Framework::Django =\u003e \"Django\",\n            Framework::Flask =\u003e \"Flask\",\n            Framework::FastAPI =\u003e \"FastAPI\",\n            // Go\n            Framework::Gin =\u003e \"Gin\",\n            Framework::Echo =\u003e \"Echo\",\n            // Java\n            Framework::Spring =\u003e \"Spring\",\n            // PHP\n            Framework::Laravel =\u003e \"Laravel\",\n            Framework::Symfony =\u003e \"Symfony\",\n            Framework::Unknown =\u003e \"Unknown\",\n        }\n    }\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]\npub enum ArchPattern {\n    Hexagonal,\n    Clean,\n    MVC,\n    Ninguno,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ForbiddenRule {\n    pub from: String,\n    pub to: String,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]\npub enum AIProvider {\n    Claude,\n    Gemini,\n    OpenAI,\n    Groq,\n    Ollama,\n    Kimi,\n    DeepSeek,\n}\n\nimpl AIProvider {\n    pub fn as_str(\u0026self) -\u003e \u0026str {\n        match self {\n            AIProvider::Claude =\u003e \"Claude\",\n            AIProvider::Gemini =\u003e \"Gemini\",\n            AIProvider::OpenAI =\u003e \"OpenAI\",\n            AIProvider::Groq =\u003e \"Groq\",\n            AIProvider::Ollama =\u003e \"Ollama\",\n            AIProvider::Kimi =\u003e \"Kimi\",\n            AIProvider::DeepSeek =\u003e \"DeepSeek\",\n        }\n    }\n}\n\n/// Configuración de IA para análisis arquitectónico\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AIConfig {\n    pub name: String,\n    pub provider: AIProvider,\n    pub api_url: String,\n    pub api_key: String,\n    pub model: String,\n}\n\nimpl Default for AIConfig {\n    fn default() -\u003e Self {\n        Self {\n            name: \"Default Claude\".to_string(),\n            provider: AIProvider::Claude,\n            api_url: \"https://api.anthropic.com\".to_string(),\n            api_key: String::new(),\n            model: \"claude-3-7-sonnet-20250219\".to_string(),\n        }\n    }\n}\n\npub struct LinterContext {\n    pub max_lines: usize,\n    #[allow(dead_code)]\n    pub framework: Framework,\n    #[allow(dead_code)]\n    pub pattern: ArchPattern,\n    pub forbidden_imports: Vec\u003cForbiddenRule\u003e,\n    pub ignored_paths: Vec\u003cString\u003e,\n    #[allow(dead_code)]\n    pub ai_configs: Vec\u003cAIConfig\u003e,\n}\n\n#[derive(Error, Debug, Diagnostic)]\n#[error(\"Violación de Arquitectura\")]\n#[diagnostic(code(arch::violation), severity(error))]\npub struct ArchError {\n    #[source_code]\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub src: String,\n    #[label(\"{message}\")]\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub span: SourceSpan,\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub message: String,\n}\n","traces":[{"line":27,"address":[25304016],"length":1,"stats":{"Line":0}},{"line":28,"address":[25304021],"length":1,"stats":{"Line":0}},{"line":29,"address":[25304052],"length":1,"stats":{"Line":0}},{"line":30,"address":[25304078],"length":1,"stats":{"Line":0}},{"line":31,"address":[25304104],"length":1,"stats":{"Line":0}},{"line":32,"address":[25304130],"length":1,"stats":{"Line":0}},{"line":34,"address":[25304156],"length":1,"stats":{"Line":0}},{"line":35,"address":[25304182],"length":1,"stats":{"Line":0}},{"line":36,"address":[25304208],"length":1,"stats":{"Line":0}},{"line":38,"address":[25304234],"length":1,"stats":{"Line":0}},{"line":39,"address":[25304257],"length":1,"stats":{"Line":0}},{"line":41,"address":[25304280],"length":1,"stats":{"Line":0}},{"line":43,"address":[25304303],"length":1,"stats":{"Line":0}},{"line":44,"address":[25304326],"length":1,"stats":{"Line":0}},{"line":45,"address":[25304349],"length":1,"stats":{"Line":0}},{"line":76,"address":[25303792],"length":1,"stats":{"Line":0}},{"line":77,"address":[25303797],"length":1,"stats":{"Line":0}},{"line":78,"address":[25303828],"length":1,"stats":{"Line":0}},{"line":79,"address":[25303854],"length":1,"stats":{"Line":0}},{"line":80,"address":[25303877],"length":1,"stats":{"Line":0}},{"line":81,"address":[25303900],"length":1,"stats":{"Line":0}},{"line":82,"address":[25303923],"length":1,"stats":{"Line":0}},{"line":83,"address":[25303946],"length":1,"stats":{"Line":0}},{"line":84,"address":[25303969],"length":1,"stats":{"Line":0}},{"line":100,"address":[25307171,25307165,25306816],"length":1,"stats":{"Line":0}},{"line":102,"address":[25306832],"length":1,"stats":{"Line":0}},{"line":104,"address":[25306868],"length":1,"stats":{"Line":0}},{"line":105,"address":[25306932],"length":1,"stats":{"Line":0}},{"line":106,"address":[25306974],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":29},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","wizard.rs"],"content":"use crate::ai::SuggestedRule;\nuse miette::{IntoDiagnostic, Result};\nuse std::fs;\nuse std::path::Path;\nuse std::sync::Arc;\n\nuse super::husky::setup_husky_pre_commit;\nuse super::ignored_paths::get_framework_ignored_paths;\nuse super::loader::{AIConfigFile, ConfigFile};\nuse super::types::{AIConfig, ArchPattern, ForbiddenRule, LinterContext};\n\n/// Orquestador de configuración: Carga silenciosa o Wizard con IA\npub fn setup_or_load_config(root: \u0026Path) -\u003e Result\u003cArc\u003cLinterContext\u003e\u003e {\n    let config_path = root.join(\"architect.json\");\n\n    if config_path.exists() {\n        // MODO AUTOMÁTICO: carga silenciosa\n        let ctx = super::loader::load_config(root)?;\n        return Ok(Arc::new(ctx));\n    }\n\n    // MODO CONFIGURACIÓN (IA Discovery)\n    println!(\"📝 No encontré 'architect.json'. Iniciando descubrimiento asistido por IA...\\n\");\n\n    // 0. Pedir configuración de IA si no existe\n    let ai_configs = crate::ui::ask_ai_configs()?;\n\n    // Seleccionar cuál usar para el descubrimiento inicial\n    let ai_config = if ai_configs.len() \u003e 1 {\n        let names: Vec\u003cString\u003e = ai_configs.iter().map(|c| c.name.clone()).collect();\n        let selection = dialoguer::Select::with_theme(\u0026dialoguer::theme::ColorfulTheme::default())\n            .with_prompt(\"¿Qué modelo deseas usar para el descubrimiento inicial?\")\n            .items(\u0026names)\n            .default(0)\n            .interact()\n            .into_diagnostic()?;\n        ai_configs[selection].clone()\n    } else {\n        ai_configs[0].clone()\n    };\n\n    // 1. Discovery (Input local)\n    let project_info = crate::discovery::get_architecture_snapshot(root);\n\n    // 2. IA (Procesamiento inteligente)\n    let suggestions = crate::ai::sugerir_arquitectura_inicial(project_info, ai_configs.clone())\n        .map_err(|e| miette::miette!(\"Error consultando la IA: {}\", e))?;\n\n    // 3. UI (Wizard de confirmación)\n    let (selected_rules, max_lines) = crate::ui::ask_user_to_confirm_rules(suggestions)?;\n\n    // 4. Config (Persistencia)\n    let final_ctx = save_config_from_wizard(\n        root,\n        selected_rules,\n        max_lines,\n        ai_configs,\n        ai_config.name.clone(),\n    )?;\n\n    println!(\"✅ Configuración guardada exitosamente.\\n\");\n    Ok(Arc::new(final_ctx))\n}\n\n/// PERSISTENCIA: Guarda las reglas de la IA y devuelve el contexto nuevo\npub fn save_config_from_wizard(\n    root: \u0026Path,\n    rules: Vec\u003cSuggestedRule\u003e,\n    max_lines: usize,\n    ai_configs: Vec\u003cAIConfig\u003e,\n    selected_name: String,\n) -\u003e Result\u003cLinterContext\u003e {\n    // 1. Guardar architect.json (reglas - compartible en el repo)\n    let config_path = root.join(\"architect.json\");\n\n    // Convertimos de SuggestedRule (IA) a ForbiddenRule (Linter)\n    let forbidden_imports: Vec\u003cForbiddenRule\u003e = rules\n        .into_iter()\n        .map(|r| ForbiddenRule {\n            from: r.from,\n            to: r.to,\n        })\n        .collect();\n\n    let framework = crate::detector::detect_framework(root);\n\n    // Obtener ignored_paths según el framework\n    let ignored_paths = get_framework_ignored_paths(\u0026framework);\n\n    // Valores por defecto para el primer architect.json\n    let config = ConfigFile {\n        max_lines_per_function: max_lines,\n        architecture_pattern: ArchPattern::MVC, // O el que detecte la IA\n        forbidden_imports: forbidden_imports.clone(),\n        ignored_paths: ignored_paths.clone(),\n    };\n\n    let json = serde_json::to_string_pretty(\u0026config).into_diagnostic()?;\n    fs::write(\u0026config_path, json).into_diagnostic()?;\n\n    // 2. Guardar .architect.ai.json (config de IA - PRIVADO, en .gitignore)\n    if !ai_configs.is_empty() {\n        let ai_config_path = root.join(\".architect.ai.json\");\n        let ai_config_file = AIConfigFile {\n            configs: ai_configs.clone(),\n            selected_name: selected_name.clone(),\n        };\n        let ai_json = serde_json::to_string_pretty(\u0026ai_config_file).into_diagnostic()?;\n        fs::write(\u0026ai_config_path, ai_json).into_diagnostic()?;\n\n        println!(\"🔐 Configuraciones de IA guardadas en: .architect.ai.json\");\n        println!(\"⚠️  Este archivo contiene API keys y NO debe ser compartido en el repositorio.\");\n\n        // Actualizar .gitignore automáticamente\n        update_gitignore(root)?;\n\n        println!();\n    }\n\n    // Instalar husky y pre-commit hook después de guardar la configuración\n    setup_husky_pre_commit(root)?;\n\n    Ok(LinterContext {\n        max_lines: config.max_lines_per_function,\n        framework,\n        pattern: config.architecture_pattern,\n        forbidden_imports,\n        ignored_paths,\n        ai_configs,\n    })\n}\n\n/// Actualiza el .gitignore del proyecto para incluir .architect.ai.json\nfn update_gitignore(root: \u0026Path) -\u003e Result\u003c()\u003e {\n    let gitignore_path = root.join(\".gitignore\");\n    let entry_to_add =\n        \"# Architect Linter - AI Configuration (contains API keys)\\n.architect.ai.json\";\n\n    // Verificar si el archivo existe\n    if gitignore_path.exists() {\n        // Leer el contenido actual\n        let content = fs::read_to_string(\u0026gitignore_path).into_diagnostic()?;\n\n        // Verificar si ya contiene la entrada\n        if content.contains(\".architect.ai.json\") {\n            println!(\"✅ .architect.ai.json ya está en el .gitignore\");\n            return Ok(());\n        }\n\n        // Agregar la entrada al final\n        let mut updated_content = content;\n        if !updated_content.ends_with('\\n') {\n            updated_content.push('\\n');\n        }\n        updated_content.push_str(entry_to_add);\n        updated_content.push('\\n');\n\n        fs::write(\u0026gitignore_path, updated_content).into_diagnostic()?;\n        println!(\"✅ .architect.ai.json agregado al .gitignore\");\n    } else {\n        // Crear el .gitignore con la entrada\n        let mut gitignore_content =\n            String::from(\"# Architect Linter - AI Configuration (contains API keys)\\n\");\n        gitignore_content.push_str(\".architect.ai.json\\n\");\n\n        fs::write(\u0026gitignore_path, gitignore_content).into_diagnostic()?;\n        println!(\"✅ .gitignore creado con .architect.ai.json\");\n    }\n\n    Ok(())\n}\n","traces":[{"line":30,"address":[24599251,24599216],"length":1,"stats":{"Line":0}},{"line":47,"address":[24598945,24598928],"length":1,"stats":{"Line":0}},{"line":79,"address":[24599280,24599361],"length":1,"stats":{"Line":0}},{"line":80,"address":[24599308],"length":1,"stats":{"Line":0}},{"line":81,"address":[24599334],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","detector.rs"],"content":"use crate::config::Framework;\nuse std::fs;\nuse std::path::Path;\n\n/// Analiza los archivos de dependencias para determinar el framework del proyecto.\n/// Soporta: JavaScript/TypeScript (package.json), Python (requirements.txt/pyproject.toml/Pipfile),\n/// Go (go.mod), PHP (composer.json), Java (pom.xml/build.gradle)\npub fn detect_framework(root: \u0026Path) -\u003e Framework {\n    // 1. Check JavaScript/TypeScript (package.json)\n    let pkg_path = root.join(\"package.json\");\n    if let Ok(content) = fs::read_to_string(\u0026pkg_path) {\n        if content.contains(\"@nestjs/core\") {\n            return Framework::NestJS;\n        }\n        if content.contains(\"\\\"react\\\"\") {\n            return Framework::React;\n        }\n        if content.contains(\"@angular/core\") {\n            return Framework::Angular;\n        }\n        if content.contains(\"\\\"express\\\"\") {\n            return Framework::Express;\n        }\n    }\n\n    // 2. Check Python (requirements.txt)\n    let requirements_path = root.join(\"requirements.txt\");\n    if let Ok(content) = fs::read_to_string(\u0026requirements_path) {\n        let content_lower = content.to_lowercase();\n        if content_lower.contains(\"django\") {\n            return Framework::Django;\n        }\n        if content_lower.contains(\"fastapi\") {\n            return Framework::FastAPI;\n        }\n        if content_lower.contains(\"flask\") {\n            return Framework::Flask;\n        }\n    }\n\n    // 3. Check Python (pyproject.toml)\n    let pyproject_path = root.join(\"pyproject.toml\");\n    if let Ok(content) = fs::read_to_string(\u0026pyproject_path) {\n        let content_lower = content.to_lowercase();\n        if content_lower.contains(\"django\") {\n            return Framework::Django;\n        }\n        if content_lower.contains(\"fastapi\") {\n            return Framework::FastAPI;\n        }\n        if content_lower.contains(\"flask\") {\n            return Framework::Flask;\n        }\n    }\n\n    // 4. Check Python (Pipfile)\n    let pipfile_path = root.join(\"Pipfile\");\n    if let Ok(content) = fs::read_to_string(\u0026pipfile_path) {\n        let content_lower = content.to_lowercase();\n        if content_lower.contains(\"django\") {\n            return Framework::Django;\n        }\n        if content_lower.contains(\"fastapi\") {\n            return Framework::FastAPI;\n        }\n        if content_lower.contains(\"flask\") {\n            return Framework::Flask;\n        }\n    }\n\n    // 5. Check Go (go.mod)\n    let go_mod_path = root.join(\"go.mod\");\n    if let Ok(content) = fs::read_to_string(\u0026go_mod_path) {\n        if content.contains(\"gin-gonic/gin\") || content.contains(\"github.com/gin-gonic/gin\") {\n            return Framework::Gin;\n        }\n        if content.contains(\"labstack/echo\") || content.contains(\"github.com/labstack/echo\") {\n            return Framework::Echo;\n        }\n    }\n\n    // 6. Check PHP (composer.json)\n    let composer_path = root.join(\"composer.json\");\n    if let Ok(content) = fs::read_to_string(\u0026composer_path) {\n        if content.contains(\"laravel/framework\") {\n            return Framework::Laravel;\n        }\n        if content.contains(\"symfony/framework-bundle\")\n            || content.contains(\"symfony/flex\")\n            || content.contains(\"\\\"symfony/\")\n        {\n            return Framework::Symfony;\n        }\n    }\n\n    // 7. Check Java (pom.xml - Maven)\n    let pom_path = root.join(\"pom.xml\");\n    if let Ok(content) = fs::read_to_string(\u0026pom_path) {\n        if content.contains(\"spring-boot\") || content.contains(\"org.springframework\") {\n            return Framework::Spring;\n        }\n    }\n\n    // 8. Check Java (build.gradle - Gradle)\n    let gradle_path = root.join(\"build.gradle\");\n    if !gradle_path.exists() {\n        // Also check build.gradle.kts\n        let _ = root.join(\"build.gradle.kts\");\n    }\n    if let Ok(content) = fs::read_to_string(\u0026gradle_path) {\n        if content.contains(\"spring-boot\") || content.contains(\"org.springframework\") {\n            return Framework::Spring;\n        }\n    }\n    let gradle_kts_path = root.join(\"build.gradle.kts\");\n    if let Ok(content) = fs::read_to_string(\u0026gradle_kts_path) {\n        if content.contains(\"spring-boot\") || content.contains(\"org.springframework\") {\n            return Framework::Spring;\n        }\n    }\n\n    Framework::Unknown\n}\n\n/// Sugiere un límite de líneas de código (LOC) basado en el framework detectado.\n#[allow(dead_code)]\npub fn get_loc_suggestion(framework: \u0026Framework) -\u003e usize {\n    match framework {\n        Framework::NestJS =\u003e 40,  // Métodos de clase\n        Framework::React =\u003e 25,   // Componentes funcionales pequeños\n        Framework::Angular =\u003e 50, // Componentes con lógica más extensa\n        Framework::Express =\u003e 60, // Middlewares y handlers\n        // Python frameworks\n        Framework::Django =\u003e 50,  // Views, models\n        Framework::Flask =\u003e 50,   // Route handlers\n        Framework::FastAPI =\u003e 40, // Endpoint functions\n        // Go frameworks\n        Framework::Gin =\u003e 40,  // Handler functions\n        Framework::Echo =\u003e 40, // Handler functions\n        // Java frameworks\n        Framework::Spring =\u003e 50, // Service methods, controllers\n        // PHP frameworks\n        Framework::Laravel =\u003e 50, // Controller methods\n        Framework::Symfony =\u003e 50, // Controller methods\n        Framework::Unknown =\u003e 50, // Estándar general\n    }\n}\n","traces":[{"line":8,"address":[25363728,25364629,25371643],"length":1,"stats":{"Line":0}},{"line":10,"address":[25363773],"length":1,"stats":{"Line":0}},{"line":11,"address":[25363965,25363819,25363882],"length":1,"stats":{"Line":0}},{"line":12,"address":[25364005,25364088],"length":1,"stats":{"Line":0}},{"line":13,"address":[25364162],"length":1,"stats":{"Line":0}},{"line":15,"address":[25364139,25364191],"length":1,"stats":{"Line":0}},{"line":16,"address":[25364265],"length":1,"stats":{"Line":0}},{"line":18,"address":[25364242,25364294],"length":1,"stats":{"Line":0}},{"line":19,"address":[25364368],"length":1,"stats":{"Line":0}},{"line":21,"address":[25364397,25364345],"length":1,"stats":{"Line":0}},{"line":22,"address":[25364462],"length":1,"stats":{"Line":0}},{"line":27,"address":[25364692],"length":1,"stats":{"Line":0}},{"line":28,"address":[25364795,25364878,25364724],"length":1,"stats":{"Line":0}},{"line":29,"address":[25365001,25364918],"length":1,"stats":{"Line":0}},{"line":30,"address":[25365111,25365028],"length":1,"stats":{"Line":0}},{"line":31,"address":[25365185],"length":1,"stats":{"Line":0}},{"line":33,"address":[25365162,25365214],"length":1,"stats":{"Line":0}},{"line":34,"address":[25365288],"length":1,"stats":{"Line":0}},{"line":36,"address":[25365317,25365265],"length":1,"stats":{"Line":0}},{"line":37,"address":[25365379],"length":1,"stats":{"Line":0}},{"line":42,"address":[25365650],"length":1,"stats":{"Line":0}},{"line":43,"address":[25365836,25365682,25365753],"length":1,"stats":{"Line":0}},{"line":44,"address":[25365876,25365959],"length":1,"stats":{"Line":0}},{"line":45,"address":[25365986,25366069],"length":1,"stats":{"Line":0}},{"line":46,"address":[25366143],"length":1,"stats":{"Line":0}},{"line":48,"address":[25366172,25366120],"length":1,"stats":{"Line":0}},{"line":49,"address":[25366246],"length":1,"stats":{"Line":0}},{"line":51,"address":[25366275,25366223],"length":1,"stats":{"Line":0}},{"line":52,"address":[25366337],"length":1,"stats":{"Line":0}},{"line":57,"address":[25366608],"length":1,"stats":{"Line":0}},{"line":58,"address":[25366794,25366711,25366640],"length":1,"stats":{"Line":0}},{"line":59,"address":[25366917,25366834],"length":1,"stats":{"Line":0}},{"line":60,"address":[25366944,25367027],"length":1,"stats":{"Line":0}},{"line":61,"address":[25367101],"length":1,"stats":{"Line":0}},{"line":63,"address":[25367078,25367130],"length":1,"stats":{"Line":0}},{"line":64,"address":[25367204],"length":1,"stats":{"Line":0}},{"line":66,"address":[25367233,25367181],"length":1,"stats":{"Line":0}},{"line":67,"address":[25367295],"length":1,"stats":{"Line":0}},{"line":72,"address":[25367566],"length":1,"stats":{"Line":0}},{"line":73,"address":[25367598,25367752,25367669],"length":1,"stats":{"Line":0}},{"line":74,"address":[25367875,25367978,25367792],"length":1,"stats":{"Line":0}},{"line":75,"address":[25367949],"length":1,"stats":{"Line":0}},{"line":77,"address":[25368029,25368171],"length":1,"stats":{"Line":0}},{"line":78,"address":[25368142],"length":1,"stats":{"Line":0}},{"line":83,"address":[25368453],"length":1,"stats":{"Line":0}},{"line":84,"address":[25368639,25368556,25368485],"length":1,"stats":{"Line":0}},{"line":85,"address":[25368762,25368679],"length":1,"stats":{"Line":0}},{"line":86,"address":[25368836],"length":1,"stats":{"Line":0}},{"line":88,"address":[25368865,25368813],"length":1,"stats":{"Line":0}},{"line":89,"address":[25368916,25368968],"length":1,"stats":{"Line":0}},{"line":90,"address":[25369019],"length":1,"stats":{"Line":0}},{"line":92,"address":[25368939],"length":1,"stats":{"Line":0}},{"line":97,"address":[25369344],"length":1,"stats":{"Line":0}},{"line":98,"address":[25369376,25369447,25369530],"length":1,"stats":{"Line":0}},{"line":99,"address":[25369653,25369570,25369773],"length":1,"stats":{"Line":0}},{"line":100,"address":[25369727],"length":1,"stats":{"Line":0}},{"line":105,"address":[25370030],"length":1,"stats":{"Line":0}},{"line":106,"address":[25370141,25370070],"length":1,"stats":{"Line":0}},{"line":108,"address":[25370178,25370237],"length":1,"stats":{"Line":0}},{"line":110,"address":[25370339,25370210,25370256],"length":1,"stats":{"Line":0}},{"line":111,"address":[25370552,25370450,25370379],"length":1,"stats":{"Line":0}},{"line":112,"address":[25370512],"length":1,"stats":{"Line":0}},{"line":115,"address":[25370809],"length":1,"stats":{"Line":0}},{"line":116,"address":[25370912,25370995,25370841],"length":1,"stats":{"Line":0}},{"line":117,"address":[25371106,25371208,25371035],"length":1,"stats":{"Line":0}},{"line":118,"address":[25371168],"length":1,"stats":{"Line":0}},{"line":122,"address":[25371464],"length":1,"stats":{"Line":0}},{"line":127,"address":[25371664],"length":1,"stats":{"Line":0}},{"line":128,"address":[25371669],"length":1,"stats":{"Line":0}},{"line":129,"address":[25371700],"length":1,"stats":{"Line":0}},{"line":130,"address":[25371714],"length":1,"stats":{"Line":0}},{"line":131,"address":[25371725],"length":1,"stats":{"Line":0}},{"line":132,"address":[25371736],"length":1,"stats":{"Line":0}},{"line":134,"address":[25371747],"length":1,"stats":{"Line":0}},{"line":135,"address":[25371758],"length":1,"stats":{"Line":0}},{"line":136,"address":[25371769],"length":1,"stats":{"Line":0}},{"line":138,"address":[25371780],"length":1,"stats":{"Line":0}},{"line":139,"address":[25371791],"length":1,"stats":{"Line":0}},{"line":141,"address":[25371802],"length":1,"stats":{"Line":0}},{"line":143,"address":[25371813],"length":1,"stats":{"Line":0}},{"line":144,"address":[25371824],"length":1,"stats":{"Line":0}},{"line":145,"address":[25371835],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":82},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","discovery.rs"],"content":"use crate::config::default_ignored_paths;\nuse crate::detector;\nuse crate::parsers;\nuse serde::Serialize;\nuse std::fs;\nuse std::path::{Path, PathBuf};\nuse walkdir::{DirEntry, WalkDir};\n\n#[derive(Serialize)]\npub struct ProjectContext {\n    pub framework: String,\n    pub dependencies: Vec\u003cString\u003e,\n    pub folder_structure: Vec\u003cString\u003e,\n    pub key_files: Vec\u003cString\u003e,\n}\n\n/// Recolecta todos los archivos soportados que el linter debe analizar.\n/// Incluye: TypeScript (.ts, .tsx), JavaScript (.js, .jsx), Python (.py), Go (.go), PHP (.php), Java (.java)\n/// Respeta los patrones de exclusión definidos en ignored_paths.\npub fn collect_files(root: \u0026Path, ignored_paths: \u0026[String]) -\u003e Vec\u003cPathBuf\u003e {\n    let supported_exts = parsers::supported_extensions();\n\n    WalkDir::new(root)\n        .into_iter()\n        .filter_entry(|e| is_not_ignored_with_patterns(e, root, ignored_paths))\n        .filter_map(|e| e.ok())\n        .filter(|e| {\n            let path_str = e.path().to_string_lossy();\n\n            // Ignorar archivos de definición TypeScript\n            if path_str.ends_with(\".d.ts\") {\n                return false;\n            }\n\n            // Verificar si la extensión está en la lista de soportadas\n            e.path().extension().map_or(false, |ext| {\n                supported_exts.iter().any(|\u0026supported| ext == supported)\n            })\n        })\n        .map(|e| e.path().to_path_buf())\n        .collect()\n}\n\n/// Genera un resumen completo del proyecto para que la IA tome decisiones arquitectónicas.\npub fn get_architecture_snapshot(root: \u0026Path) -\u003e ProjectContext {\n    let mut folders = Vec::new();\n    let mut key_files = Vec::new();\n\n    let framework_enum = detector::detect_framework(root);\n    let framework = framework_enum.as_str().to_string();\n    let dependencies = get_dependency_list(root);\n\n    let src_path = root.join(\"src\");\n    let scan_path = if src_path.exists() {\n        src_path\n    } else {\n        root.to_path_buf()\n    };\n\n    // Use default_ignored_paths instead of hardcoded filter\n    let ignored = default_ignored_paths();\n\n    let walker = WalkDir::new(scan_path)\n        .into_iter()\n        .filter_entry(|e| is_not_ignored_with_patterns(e, root, \u0026ignored));\n\n    for entry in walker.filter_map(|e| e.ok()) {\n        let path = entry.path();\n        let relative_path = path.strip_prefix(root).unwrap_or(path);\n        let path_str = relative_path.to_string_lossy().into_owned();\n\n        if path.is_dir() {\n            if path_str != \".\" \u0026\u0026 !path_str.is_empty() {\n                folders.push(path_str);\n            }\n        } else if is_architectural_file(path) {\n            key_files.push(path_str);\n        }\n    }\n\n    ProjectContext {\n        framework,\n        dependencies,\n        folder_structure: folders,\n        key_files,\n    }\n}\n\nfn get_dependency_list(root: \u0026Path) -\u003e Vec\u003cString\u003e {\n    let mut deps_list = Vec::new();\n\n    // 1. JavaScript/TypeScript: package.json\n    let pkg_path = root.join(\"package.json\");\n    if let Ok(content) = fs::read_to_string(\u0026pkg_path) {\n        if let Ok(json) = serde_json::from_str::\u003cserde_json::Value\u003e(\u0026content) {\n            if let Some(deps) = json.get(\"dependencies\").and_then(|d| d.as_object()) {\n                deps_list.extend(deps.keys().cloned());\n            }\n            if let Some(dev_deps) = json.get(\"devDependencies\").and_then(|d| d.as_object()) {\n                deps_list.extend(dev_deps.keys().cloned());\n            }\n        }\n    }\n\n    // 2. Python: requirements.txt\n    let requirements_path = root.join(\"requirements.txt\");\n    if let Ok(content) = fs::read_to_string(\u0026requirements_path) {\n        for line in content.lines() {\n            let line = line.trim();\n            // Skip comments and empty lines\n            if line.is_empty() || line.starts_with('#') {\n                continue;\n            }\n            // Extract package name (strip version specifiers like ==, \u003e=, \u003c=, ~=, !=, etc.)\n            let pkg_name = line\n                .split(\u0026['=', '\u003c', '\u003e', '~', '!', ';'][..])\n                .next()\n                .unwrap_or(line)\n                .trim()\n                .to_string();\n            if !pkg_name.is_empty() {\n                deps_list.push(pkg_name);\n            }\n        }\n    }\n\n    // 3. Python: pyproject.toml (simple line-by-line parsing)\n    let pyproject_path = root.join(\"pyproject.toml\");\n    if let Ok(content) = fs::read_to_string(\u0026pyproject_path) {\n        let mut in_dependencies = false;\n        let mut bracket_count = 0;\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Detect dependencies section start\n            if trimmed.starts_with(\"dependencies\") \u0026\u0026 trimmed.contains('[') {\n                in_dependencies = true;\n                bracket_count =\n                    trimmed.matches('[').count() as i32 - trimmed.matches(']').count() as i32;\n                continue;\n            }\n\n            if in_dependencies {\n                // Track brackets for multi-line arrays\n                bracket_count += trimmed.matches('[').count() as i32;\n                bracket_count -= trimmed.matches(']').count() as i32;\n\n                if bracket_count \u003c= 0 \u0026\u0026 trimmed.ends_with(']') {\n                    in_dependencies = false;\n                    continue;\n                }\n\n                // Extract quoted package names\n                if trimmed.starts_with('\"') || trimmed.starts_with(\"'\") {\n                    let pkg = trimmed\n                        .trim_start_matches('\"')\n                        .trim_start_matches('\\'')\n                        .split(\u0026['\"', '\\'', ' ', '\u003e', '\u003c', '=', '~', '^'][..])\n                        .next()\n                        .unwrap_or(\"\")\n                        .to_string();\n                    if !pkg.is_empty() {\n                        deps_list.push(pkg);\n                    }\n                }\n            }\n        }\n    }\n\n    // 4. Go: go.mod\n    let go_mod_path = root.join(\"go.mod\");\n    if let Ok(content) = fs::read_to_string(\u0026go_mod_path) {\n        let mut in_require = false;\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Detect require block\n            if trimmed == \"require (\" {\n                in_require = true;\n                continue;\n            }\n            if in_require \u0026\u0026 trimmed == \")\" {\n                in_require = false;\n                continue;\n            }\n\n            // Parse require entries\n            if in_require \u0026\u0026 !trimmed.is_empty() \u0026\u0026 !trimmed.starts_with(\"//\") {\n                // Format: module/path version\n                if let Some(module) = trimmed.split_whitespace().next() {\n                    deps_list.push(module.to_string());\n                }\n            }\n\n            // Single-line require: require module/path version\n            if trimmed.starts_with(\"require \") \u0026\u0026 !trimmed.starts_with(\"require (\") {\n                if let Some(rest) = trimmed.strip_prefix(\"require \") {\n                    if let Some(module) = rest.split_whitespace().next() {\n                        deps_list.push(module.to_string());\n                    }\n                }\n            }\n        }\n    }\n\n    // 5. PHP: composer.json\n    let composer_path = root.join(\"composer.json\");\n    if let Ok(content) = fs::read_to_string(\u0026composer_path) {\n        if let Ok(json) = serde_json::from_str::\u003cserde_json::Value\u003e(\u0026content) {\n            if let Some(deps) = json.get(\"require\").and_then(|d| d.as_object()) {\n                deps_list.extend(deps.keys().cloned());\n            }\n            if let Some(dev_deps) = json.get(\"require-dev\").and_then(|d| d.as_object()) {\n                deps_list.extend(dev_deps.keys().cloned());\n            }\n        }\n    }\n\n    // 6. Java: pom.xml (Maven) - simple line scan for artifactId\n    let pom_path = root.join(\"pom.xml\");\n    if let Ok(content) = fs::read_to_string(\u0026pom_path) {\n        let mut in_dependencies = false;\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            if trimmed == \"\u003cdependencies\u003e\" {\n                in_dependencies = true;\n                continue;\n            }\n            if trimmed == \"\u003c/dependencies\u003e\" {\n                in_dependencies = false;\n                continue;\n            }\n\n            if in_dependencies\n                \u0026\u0026 trimmed.starts_with(\"\u003cartifactId\u003e\")\n                \u0026\u0026 trimmed.ends_with(\"\u003c/artifactId\u003e\")\n            {\n                let artifact = trimmed\n                    .trim_start_matches(\"\u003cartifactId\u003e\")\n                    .trim_end_matches(\"\u003c/artifactId\u003e\");\n                if !artifact.is_empty() {\n                    deps_list.push(artifact.to_string());\n                }\n            }\n        }\n    }\n\n    // 7. Java: build.gradle (Gradle) - simple line scan\n    let gradle_path = root.join(\"build.gradle\");\n    if let Ok(content) = fs::read_to_string(\u0026gradle_path) {\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Match: implementation 'group:artifact:version' or implementation \"group:artifact:version\"\n            if trimmed.starts_with(\"implementation \") || trimmed.starts_with(\"api \") {\n                let quote_char = if trimmed.contains('\\'') { '\\'' } else { '\"' };\n                if let Some(start) = trimmed.find(quote_char) {\n                    if let Some(end) = trimmed.rfind(quote_char) {\n                        if start \u003c end {\n                            let dep = \u0026trimmed[start + 1..end];\n                            // Extract artifact name (last part before version)\n                            if let Some(artifact) = dep.split(':').nth(1) {\n                                deps_list.push(artifact.to_string());\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // Also check build.gradle.kts\n    let gradle_kts_path = root.join(\"build.gradle.kts\");\n    if let Ok(content) = fs::read_to_string(\u0026gradle_kts_path) {\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Match: implementation(\"group:artifact:version\")\n            if trimmed.starts_with(\"implementation(\") || trimmed.starts_with(\"api(\") {\n                if let Some(start) = trimmed.find('\"') {\n                    if let Some(end) = trimmed.rfind('\"') {\n                        if start \u003c end {\n                            let dep = \u0026trimmed[start + 1..end];\n                            if let Some(artifact) = dep.split(':').nth(1) {\n                                deps_list.push(artifact.to_string());\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    deps_list\n}\n\n/// Verifica si una entrada debe ser ignorada según los patrones configurados\npub fn is_not_ignored_with_patterns(\n    entry: \u0026DirEntry,\n    root: \u0026Path,\n    ignored_paths: \u0026[String],\n) -\u003e bool {\n    // Obtener la ruta relativa al root del proyecto\n    let entry_path = entry.path();\n    let relative_path = entry_path\n        .strip_prefix(root)\n        .unwrap_or(entry_path)\n        .to_string_lossy()\n        .replace('\\\\', \"/\"); // Normalizar separadores para Windows\n\n    // Verificar si la ruta coincide con algún patrón de exclusión\n    for pattern in ignored_paths {\n        let normalized_pattern = pattern.replace('\\\\', \"/\");\n\n        // Coincidencia exacta o si la ruta comienza con el patrón\n        if relative_path == normalized_pattern.trim_end_matches('/')\n            || relative_path.starts_with(\u0026normalized_pattern)\n            || relative_path.starts_with(\u0026format!(\"{}/\", normalized_pattern.trim_end_matches('/')))\n        {\n            return false;\n        }\n\n        // También verificar el nombre del directorio/archivo directamente\n        if let Some(file_name) = entry.file_name().to_str() {\n            if file_name == normalized_pattern.trim_end_matches('/')\n                || format!(\"{}/\", file_name) == normalized_pattern\n            {\n                return false;\n            }\n        }\n    }\n\n    true\n}\n\nfn is_architectural_file(path: \u0026Path) -\u003e bool {\n    let s = path.to_string_lossy().to_lowercase();\n\n    // TypeScript/JavaScript patterns\n    let ts_js_patterns = [\n        \".controller.ts\",\n        \".controller.js\",\n        \".service.ts\",\n        \".service.js\",\n        \".entity.ts\",\n        \".entity.js\",\n        \".repository.ts\",\n        \".repository.js\",\n        \".dto.ts\",\n        \".dto.js\",\n        \".module.ts\",\n        \".module.js\",\n        \".handler.ts\",\n        \".handler.js\",\n    ];\n\n    // Python patterns\n    let py_patterns = [\n        \"_controller.py\",\n        \"_service.py\",\n        \"_repository.py\",\n        \"_model.py\",\n        \"_view.py\",\n        \"_handler.py\",\n    ];\n\n    // Go patterns\n    let go_patterns = [\n        \"_controller.go\",\n        \"_service.go\",\n        \"_repository.go\",\n        \"_handler.go\",\n        \"_model.go\",\n    ];\n\n    // PHP patterns\n    let php_patterns = [\n        \"controller.php\",\n        \"service.php\",\n        \"repository.php\",\n        \"model.php\",\n        \"handler.php\",\n        \"entity.php\",\n    ];\n\n    // Java patterns\n    let java_patterns = [\n        \"controller.java\",\n        \"service.java\",\n        \"repository.java\",\n        \"model.java\",\n        \"handler.java\",\n        \"entity.java\",\n        \"dao.java\",\n    ];\n\n    ts_js_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || py_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || go_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || php_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || java_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n}\n","traces":[{"line":20,"address":[25345072,25345467,25345473],"length":1,"stats":{"Line":0}},{"line":21,"address":[25345141],"length":1,"stats":{"Line":0}},{"line":23,"address":[25345165],"length":1,"stats":{"Line":0}},{"line":25,"address":[25309952,25309977],"length":1,"stats":{"Line":0}},{"line":26,"address":[25310016,25310046],"length":1,"stats":{"Line":0}},{"line":27,"address":[25310588,25310594,25310256],"length":1,"stats":{"Line":0}},{"line":28,"address":[25310302],"length":1,"stats":{"Line":0}},{"line":31,"address":[25310406,25310334],"length":1,"stats":{"Line":0}},{"line":32,"address":[25310469],"length":1,"stats":{"Line":0}},{"line":36,"address":[25310608,25310448,25310497],"length":1,"stats":{"Line":0}},{"line":37,"address":[25310626,25310688,25310702],"length":1,"stats":{"Line":0}},{"line":40,"address":[25310096,25310128],"length":1,"stats":{"Line":0}},{"line":45,"address":[25359136,25361493,25361609],"length":1,"stats":{"Line":0}},{"line":46,"address":[25359191],"length":1,"stats":{"Line":0}},{"line":47,"address":[25359296],"length":1,"stats":{"Line":0}},{"line":49,"address":[25359428,25359357],"length":1,"stats":{"Line":0}},{"line":50,"address":[25359435],"length":1,"stats":{"Line":0}},{"line":51,"address":[25359589,25359525],"length":1,"stats":{"Line":0}},{"line":53,"address":[25359597,25359667],"length":1,"stats":{"Line":0}},{"line":54,"address":[25359683,25359748,25359868],"length":1,"stats":{"Line":0}},{"line":55,"address":[25359804],"length":1,"stats":{"Line":0}},{"line":57,"address":[25359870,25359785],"length":1,"stats":{"Line":0}},{"line":61,"address":[25359878],"length":1,"stats":{"Line":0}},{"line":63,"address":[25359938],"length":1,"stats":{"Line":0}},{"line":65,"address":[25311280,25311298],"length":1,"stats":{"Line":0}},{"line":67,"address":[25311360,25311390],"length":1,"stats":{"Line":0}},{"line":68,"address":[25360920,25360424],"length":1,"stats":{"Line":0}},{"line":69,"address":[25360952],"length":1,"stats":{"Line":0}},{"line":70,"address":[25361048],"length":1,"stats":{"Line":0}},{"line":72,"address":[25361100,25361160],"length":1,"stats":{"Line":0}},{"line":73,"address":[25361187,25361315],"length":1,"stats":{"Line":0}},{"line":74,"address":[25361350],"length":1,"stats":{"Line":0}},{"line":76,"address":[25361176,25361217],"length":1,"stats":{"Line":0}},{"line":77,"address":[25361242],"length":1,"stats":{"Line":0}},{"line":89,"address":[25345488,25346603,25357250],"length":1,"stats":{"Line":0}},{"line":90,"address":[25345558],"length":1,"stats":{"Line":0}},{"line":93,"address":[25345623],"length":1,"stats":{"Line":0}},{"line":94,"address":[25345847,25345696,25345764],"length":1,"stats":{"Line":0}},{"line":95,"address":[25345970,25346052,25345887],"length":1,"stats":{"Line":0}},{"line":96,"address":[25310752,25310761],"length":1,"stats":{"Line":0}},{"line":97,"address":[25346311,25346265],"length":1,"stats":{"Line":0}},{"line":99,"address":[25346375,25346272],"length":1,"stats":{"Line":0}},{"line":100,"address":[25346465,25346494],"length":1,"stats":{"Line":0}},{"line":106,"address":[25346792],"length":1,"stats":{"Line":0}},{"line":107,"address":[25346978,25346895,25346824],"length":1,"stats":{"Line":0}},{"line":108,"address":[25347980,25347018,25347109],"length":1,"stats":{"Line":0}},{"line":109,"address":[25347295,25347422],"length":1,"stats":{"Line":0}},{"line":111,"address":[25347460],"length":1,"stats":{"Line":0}},{"line":116,"address":[25347547],"length":1,"stats":{"Line":0}},{"line":118,"address":[25347706],"length":1,"stats":{"Line":0}},{"line":121,"address":[25347885,25347823],"length":1,"stats":{"Line":0}},{"line":122,"address":[25347891,25347970],"length":1,"stats":{"Line":0}},{"line":128,"address":[25348083],"length":1,"stats":{"Line":0}},{"line":129,"address":[25348186,25348269,25348115],"length":1,"stats":{"Line":0}},{"line":130,"address":[25348301],"length":1,"stats":{"Line":0}},{"line":131,"address":[25348309],"length":1,"stats":{"Line":0}},{"line":132,"address":[25348328,25348419],"length":1,"stats":{"Line":0}},{"line":133,"address":[25348732,25348605],"length":1,"stats":{"Line":0}},{"line":136,"address":[25348844,25348770],"length":1,"stats":{"Line":0}},{"line":137,"address":[25348896],"length":1,"stats":{"Line":0}},{"line":138,"address":[25350084],"length":1,"stats":{"Line":0}},{"line":139,"address":[25350096,25348904,25349939],"length":1,"stats":{"Line":0}},{"line":143,"address":[25348813],"length":1,"stats":{"Line":0}},{"line":145,"address":[25348947,25349079],"length":1,"stats":{"Line":0}},{"line":146,"address":[25349183,25349055,25349099],"length":1,"stats":{"Line":0}},{"line":148,"address":[25349171,25349256],"length":1,"stats":{"Line":0}},{"line":149,"address":[25349292],"length":1,"stats":{"Line":0}},{"line":154,"address":[25349312,25349217,25349419,25349893],"length":1,"stats":{"Line":0}},{"line":158,"address":[25349508],"length":1,"stats":{"Line":0}},{"line":162,"address":[25349736,25349798],"length":1,"stats":{"Line":0}},{"line":163,"address":[25349804,25349883],"length":1,"stats":{"Line":0}},{"line":171,"address":[25350174],"length":1,"stats":{"Line":0}},{"line":172,"address":[25350277,25350360,25350206],"length":1,"stats":{"Line":0}},{"line":173,"address":[25350392],"length":1,"stats":{"Line":0}},{"line":174,"address":[25350408,25350499],"length":1,"stats":{"Line":0}},{"line":175,"address":[25350685,25350812],"length":1,"stats":{"Line":0}},{"line":178,"address":[25350828],"length":1,"stats":{"Line":0}},{"line":179,"address":[25350886],"length":1,"stats":{"Line":0}},{"line":182,"address":[25350874,25350911],"length":1,"stats":{"Line":0}},{"line":183,"address":[25350957],"length":1,"stats":{"Line":0}},{"line":188,"address":[25351019,25350899],"length":1,"stats":{"Line":0}},{"line":190,"address":[25351125],"length":1,"stats":{"Line":0}},{"line":191,"address":[25351286],"length":1,"stats":{"Line":0}},{"line":196,"address":[25350970,25351344],"length":1,"stats":{"Line":0}},{"line":197,"address":[25351416],"length":1,"stats":{"Line":0}},{"line":198,"address":[25351578],"length":1,"stats":{"Line":0}},{"line":199,"address":[25351715],"length":1,"stats":{"Line":0}},{"line":207,"address":[25351823],"length":1,"stats":{"Line":0}},{"line":208,"address":[25351926,25351855,25352009],"length":1,"stats":{"Line":0}},{"line":209,"address":[25352132,25352214,25352049],"length":1,"stats":{"Line":0}},{"line":210,"address":[25352337,25352246],"length":1,"stats":{"Line":0}},{"line":211,"address":[25352427,25352473],"length":1,"stats":{"Line":0}},{"line":213,"address":[25352434,25352537],"length":1,"stats":{"Line":0}},{"line":214,"address":[25352656,25352627],"length":1,"stats":{"Line":0}},{"line":220,"address":[25352948],"length":1,"stats":{"Line":0}},{"line":221,"address":[25352980,25353051,25353134],"length":1,"stats":{"Line":0}},{"line":222,"address":[25353166],"length":1,"stats":{"Line":0}},{"line":223,"address":[25353273,25353182],"length":1,"stats":{"Line":0}},{"line":224,"address":[25353586,25353459],"length":1,"stats":{"Line":0}},{"line":226,"address":[25353602],"length":1,"stats":{"Line":0}},{"line":227,"address":[25353681],"length":1,"stats":{"Line":0}},{"line":230,"address":[25353648,25353701],"length":1,"stats":{"Line":0}},{"line":231,"address":[25353722],"length":1,"stats":{"Line":0}},{"line":235,"address":[25353707],"length":1,"stats":{"Line":0}},{"line":236,"address":[25353735],"length":1,"stats":{"Line":0}},{"line":237,"address":[25353797],"length":1,"stats":{"Line":0}},{"line":239,"address":[25353859,25353985],"length":1,"stats":{"Line":0}},{"line":242,"address":[25354023],"length":1,"stats":{"Line":0}},{"line":243,"address":[25354070],"length":1,"stats":{"Line":0}},{"line":250,"address":[25354178],"length":1,"stats":{"Line":0}},{"line":251,"address":[25354281,25354364,25354210],"length":1,"stats":{"Line":0}},{"line":252,"address":[25354404,25354495],"length":1,"stats":{"Line":0}},{"line":253,"address":[25354808,25354681],"length":1,"stats":{"Line":0}},{"line":256,"address":[25354846,25354981],"length":1,"stats":{"Line":0}},{"line":257,"address":[25354951,25354997],"length":1,"stats":{"Line":0}},{"line":258,"address":[25355043],"length":1,"stats":{"Line":0}},{"line":259,"address":[25355167],"length":1,"stats":{"Line":0}},{"line":260,"address":[25355283],"length":1,"stats":{"Line":0}},{"line":261,"address":[25355300],"length":1,"stats":{"Line":0}},{"line":263,"address":[25355439],"length":1,"stats":{"Line":0}},{"line":264,"address":[25355602],"length":1,"stats":{"Line":0}},{"line":274,"address":[25355710],"length":1,"stats":{"Line":0}},{"line":275,"address":[25355896,25355742,25355813],"length":1,"stats":{"Line":0}},{"line":276,"address":[25355936,25356027],"length":1,"stats":{"Line":0}},{"line":277,"address":[25356340,25356213],"length":1,"stats":{"Line":0}},{"line":280,"address":[25356486,25356372],"length":1,"stats":{"Line":0}},{"line":281,"address":[25356456,25356505],"length":1,"stats":{"Line":0}},{"line":282,"address":[25356570],"length":1,"stats":{"Line":0}},{"line":283,"address":[25356666],"length":1,"stats":{"Line":0}},{"line":284,"address":[25356680],"length":1,"stats":{"Line":0}},{"line":285,"address":[25356792],"length":1,"stats":{"Line":0}},{"line":286,"address":[25356943],"length":1,"stats":{"Line":0}},{"line":295,"address":[25357043],"length":1,"stats":{"Line":0}},{"line":299,"address":[25363712,25361648,25363687],"length":1,"stats":{"Line":0}},{"line":305,"address":[25361735],"length":1,"stats":{"Line":0}},{"line":306,"address":[25361870],"length":1,"stats":{"Line":0}},{"line":307,"address":[25361798],"length":1,"stats":{"Line":0}},{"line":308,"address":[25361829],"length":1,"stats":{"Line":0}},{"line":313,"address":[25362073],"length":1,"stats":{"Line":0}},{"line":314,"address":[25362300,25362222],"length":1,"stats":{"Line":0}},{"line":317,"address":[25362345,25362428],"length":1,"stats":{"Line":0}},{"line":318,"address":[25362612,25362543],"length":1,"stats":{"Line":0}},{"line":319,"address":[25362659],"length":1,"stats":{"Line":0}},{"line":321,"address":[25362566],"length":1,"stats":{"Line":0}},{"line":325,"address":[25363106],"length":1,"stats":{"Line":0}},{"line":326,"address":[25363251,25363300],"length":1,"stats":{"Line":0}},{"line":327,"address":[25363458,25363401],"length":1,"stats":{"Line":0}},{"line":329,"address":[25363428],"length":1,"stats":{"Line":0}},{"line":334,"address":[25362245],"length":1,"stats":{"Line":0}},{"line":337,"address":[25359103,25359109,25357296],"length":1,"stats":{"Line":0}},{"line":338,"address":[25357338],"length":1,"stats":{"Line":0}},{"line":341,"address":[25357517],"length":1,"stats":{"Line":0}},{"line":359,"address":[25357895],"length":1,"stats":{"Line":0}},{"line":369,"address":[25358057],"length":1,"stats":{"Line":0}},{"line":378,"address":[25358192],"length":1,"stats":{"Line":0}},{"line":388,"address":[25358354],"length":1,"stats":{"Line":0}},{"line":398,"address":[25311134,25311120],"length":1,"stats":{"Line":0}},{"line":399,"address":[25310960,25310974],"length":1,"stats":{"Line":0}},{"line":400,"address":[25311214,25311200],"length":1,"stats":{"Line":0}},{"line":401,"address":[25310880,25310894],"length":1,"stats":{"Line":0}},{"line":402,"address":[25311054,25311040],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":161},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","git.rs"],"content":"//! Git operations for --staged flag support\n//!\n//! This module provides functions to interact with git repositories\n//! and get information about staged files.\n\nuse git2::{Repository, Status, StatusOptions, StatusShow};\nuse miette::Result;\nuse std::path::{Path, PathBuf};\n\n/// Check if the given path is inside a git repository\npub fn is_git_repo(path: \u0026Path) -\u003e bool {\n    Repository::discover(path).is_ok()\n}\n\n/// Get all staged files in the repository\n/// Returns a list of absolute paths to staged files\npub fn get_staged_files(repo_path: \u0026Path) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e {\n    let repo = Repository::discover(repo_path)\n        .map_err(|e| miette::miette!(\"No se encontró repositorio git: {}\", e))?;\n\n    let workdir = repo\n        .workdir()\n        .ok_or_else(|| miette::miette!(\"El repositorio no tiene directorio de trabajo\"))?;\n\n    let mut opts = StatusOptions::new();\n    opts.include_untracked(false)\n        .include_ignored(false)\n        .include_unmodified(false)\n        .show(StatusShow::Index); // Only staged files\n\n    let statuses = repo\n        .statuses(Some(\u0026mut opts))\n        .map_err(|e| miette::miette!(\"Error al obtener estados de git: {}\", e))?;\n\n    let staged_files: Vec\u003cPathBuf\u003e = statuses\n        .iter()\n        .filter(|entry| {\n            let status = entry.status();\n            // Include files that are staged (added, modified, renamed, etc.)\n            status.contains(Status::INDEX_NEW)\n                || status.contains(Status::INDEX_MODIFIED)\n                || status.contains(Status::INDEX_RENAMED)\n                || status.contains(Status::INDEX_TYPECHANGE)\n        })\n        .filter_map(|entry| {\n            let path = entry.path()?;\n            let full_path = workdir.join(path);\n            // Only include existing files\n            if full_path.exists() {\n                Some(full_path)\n            } else {\n                None\n            }\n        })\n        .collect();\n\n    Ok(staged_files)\n}\n\n/// Filter files to only include those that are staged\npub fn filter_staged_files(all_files: \u0026[PathBuf], repo_path: \u0026Path) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e {\n    let staged = get_staged_files(repo_path)?;\n    let staged_set: std::collections::HashSet\u003c_\u003e = staged.iter().collect();\n\n    Ok(all_files\n        .iter()\n        .filter(|f| staged_set.contains(f))\n        .cloned()\n        .collect())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_is_git_repo() {\n        // This test depends on running from within a git repo\n        if let Ok(current_dir) = std::env::current_dir() {\n            // Just verify the function doesn't panic\n            let _ = is_git_repo(\u0026current_dir);\n        }\n    }\n}\n","traces":[{"line":19,"address":[24265312,24265327],"length":1,"stats":{"Line":0}},{"line":23,"address":[24265216,24265223],"length":1,"stats":{"Line":0}},{"line":33,"address":[24265759,24265744],"length":1,"stats":{"Line":0}},{"line":37,"address":[24265600],"length":1,"stats":{"Line":0}},{"line":38,"address":[24265627],"length":1,"stats":{"Line":0}},{"line":40,"address":[24265677,24265637],"length":1,"stats":{"Line":0}},{"line":41,"address":[24265656],"length":1,"stats":{"Line":0}},{"line":42,"address":[24265684],"length":1,"stats":{"Line":0}},{"line":43,"address":[24265703],"length":1,"stats":{"Line":0}},{"line":45,"address":[24266452,24266032,24266446],"length":1,"stats":{"Line":0}},{"line":46,"address":[24266067],"length":1,"stats":{"Line":0}},{"line":47,"address":[24266183],"length":1,"stats":{"Line":0}},{"line":49,"address":[24266290,24266329,24266222],"length":1,"stats":{"Line":0}},{"line":50,"address":[24266336],"length":1,"stats":{"Line":0}},{"line":52,"address":[24266316],"length":1,"stats":{"Line":0}},{"line":67,"address":[24266480,24266494],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":16},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","git_changes.rs"],"content":"use git2::{Error, Repository};\nuse std::path::{Path, PathBuf};\n\n/// Get list of files changed since last commit\npub fn get_changed_files(repo_path: \u0026Path) -\u003e Result\u003cVec\u003cPathBuf\u003e, Error\u003e {\n    let repo = Repository::discover(repo_path)?;\n\n    // Get HEAD commit\n    let head = repo\n        .head()?\n        .target()\n        .ok_or_else(|| Error::from_str(\"No HEAD commit\"))?;\n\n    let head_commit = repo.find_commit(head)?;\n    let head_tree = head_commit.tree()?;\n\n    // Get parent commit (if exists)\n    let changed_files = if head_commit.parent_count() \u003e 0 {\n        let parent = head_commit.parent(0)?;\n        let parent_tree = parent.tree()?;\n\n        // Diff parent vs HEAD\n        let diff = repo.diff_tree_to_tree(Some(\u0026parent_tree), Some(\u0026head_tree), None)?;\n\n        collect_diff_files(\u0026diff, \u0026repo)\n    } else {\n        // First commit, all files are \"changed\"\n        collect_all_files(\u0026head_tree, \u0026repo)\n    };\n\n    Ok(changed_files)\n}\n\nfn collect_diff_files(diff: \u0026git2::Diff, repo: \u0026Repository) -\u003e Vec\u003cPathBuf\u003e {\n    let mut files = Vec::new();\n    let workdir = repo.workdir().unwrap_or(Path::new(\".\"));\n\n    let _ = diff.foreach(\n        \u0026mut |delta, _| {\n            if let Some(path) = delta.new_file().path() {\n                if is_typescript_file(path) {\n                    files.push(workdir.join(path));\n                }\n            }\n            true\n        },\n        None,\n        None,\n        None,\n    );\n\n    files\n}\n\nfn collect_all_files(tree: \u0026git2::Tree, repo: \u0026Repository) -\u003e Vec\u003cPathBuf\u003e {\n    let mut files = Vec::new();\n    let workdir = repo.workdir().unwrap_or(Path::new(\".\"));\n\n    let _ = tree.walk(git2::TreeWalkMode::PreOrder, |root, entry| {\n        if let Some(name) = entry.name() {\n            let path = Path::new(name);\n            if is_typescript_file(path) {\n                files.push(workdir.join(root).join(name));\n            }\n        }\n        git2::TreeWalkResult::Ok\n    });\n\n    files\n}\n\nfn is_typescript_file(path: \u0026Path) -\u003e bool {\n    path.extension()\n        .and_then(|s| s.to_str())\n        .map(|s| s == \"ts\" || s == \"tsx\" || s == \"js\" || s == \"jsx\")\n        .unwrap_or(false)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::path::PathBuf;\n\n    #[test]\n    fn test_git_detection_in_crate() {\n        let repo_path = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n        let result = get_changed_files(\u0026repo_path);\n        assert!(result.is_ok());\n    }\n}\n","traces":[{"line":5,"address":[25321177,25318848,25321301],"length":1,"stats":{"Line":0}},{"line":6,"address":[25318881],"length":1,"stats":{"Line":0}},{"line":9,"address":[25319397,25319472,25319214,25321299,25319119],"length":1,"stats":{"Line":0}},{"line":12,"address":[25318048,25318060],"length":1,"stats":{"Line":0}},{"line":14,"address":[25319579,25321278],"length":1,"stats":{"Line":0}},{"line":15,"address":[25319821,25319892,25321263],"length":1,"stats":{"Line":0}},{"line":18,"address":[25320072,25320145],"length":1,"stats":{"Line":0}},{"line":19,"address":[25320179,25320302,25321242],"length":1,"stats":{"Line":0}},{"line":20,"address":[25320482,25320553,25321221],"length":1,"stats":{"Line":0}},{"line":23,"address":[25320822,25320733],"length":1,"stats":{"Line":0}},{"line":25,"address":[25321023],"length":1,"stats":{"Line":0}},{"line":28,"address":[25320172,25320210],"length":1,"stats":{"Line":0}},{"line":31,"address":[25320217],"length":1,"stats":{"Line":0}},{"line":34,"address":[25321328,25321750,25321744],"length":1,"stats":{"Line":0}},{"line":35,"address":[25321371],"length":1,"stats":{"Line":0}},{"line":36,"address":[25321478,25321393],"length":1,"stats":{"Line":0}},{"line":38,"address":[25321615],"length":1,"stats":{"Line":0}},{"line":39,"address":[25318096],"length":1,"stats":{"Line":0}},{"line":40,"address":[25318121],"length":1,"stats":{"Line":0}},{"line":41,"address":[25318216],"length":1,"stats":{"Line":0}},{"line":42,"address":[25318249],"length":1,"stats":{"Line":0}},{"line":52,"address":[25321701],"length":1,"stats":{"Line":0}},{"line":55,"address":[25318832,25318464,25318826],"length":1,"stats":{"Line":0}},{"line":56,"address":[25318507],"length":1,"stats":{"Line":0}},{"line":57,"address":[25318608,25318526],"length":1,"stats":{"Line":0}},{"line":59,"address":[25318018,25317632,25318024],"length":1,"stats":{"Line":0}},{"line":60,"address":[25317699],"length":1,"stats":{"Line":0}},{"line":61,"address":[25317779],"length":1,"stats":{"Line":0}},{"line":62,"address":[25317807],"length":1,"stats":{"Line":0}},{"line":63,"address":[25317841],"length":1,"stats":{"Line":0}},{"line":69,"address":[25318792],"length":1,"stats":{"Line":0}},{"line":72,"address":[25321776],"length":1,"stats":{"Line":0}},{"line":73,"address":[25321790],"length":1,"stats":{"Line":0}},{"line":74,"address":[25318318,25318304],"length":1,"stats":{"Line":0}},{"line":75,"address":[25318336,25318349],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":35},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","lib.rs"],"content":"// Library exports for testing and potential programmatic use\n//\n// This module exposes the internal modules publicly so they can be tested\n// and potentially used as a library.\n\npub mod ai;\n// Note: main module is only available in binary context\n// Functions from main are re-exported individually for testing\npub mod analysis_result;\npub mod analyzer;\npub mod autofix;\npub mod cache;\npub mod circular;\npub mod cli;\npub mod config;\npub mod detector;\npub mod discovery;\npub mod git;\npub mod git_changes;\npub mod memory_cache;\npub mod metrics;\npub mod notification;\npub mod output;\npub mod parsers;\npub mod report;\npub mod scoring;\npub mod ui;\npub mod watch;\n\n// Re-export commonly used types for convenience\npub use analysis_result::AnalysisResult;\npub use circular::CircularDependency;\npub use config::ArchPattern;\npub use metrics::{\n    ComplexityStats, HealthGrade, HealthScore, LayerStats, PerformanceMetrics, ScoreComponents,\n};\npub use scoring::{apply_severity_multiplier, calculate_health_score, Violation, ViolationType};\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","main.rs"],"content":"use indicatif::{ProgressBar, ProgressStyle};\nuse miette::{GraphicalReportHandler, IntoDiagnostic, Result};\nuse std::path::{Path, PathBuf};\nuse std::sync::{Arc, Mutex};\nuse swc_common::SourceMap;\n\nmod ai;\nmod analysis_result;\nmod analyzer;\nmod autofix;\nmod cache;\nmod circular;\nmod cli;\nmod config;\nmod detector;\nmod discovery;\nmod git;\nmod git_changes;\nmod memory_cache;\nmod metrics;\nmod notification;\nmod output;\nmod parsers;\nmod report;\nmod scoring;\nmod ui;\nmod watch;\n\n#[cfg(unix)]\nfn run_as_daemon(project_root: \u0026std::path::Path) -\u003e Result\u003c()\u003e {\n    use daemonize::Daemonize;\n    use std::fs::File;\n\n    let stdout = File::create(\"/tmp/architect-linter.out\").into_diagnostic()?;\n    let stderr = File::create(\"/tmp/architect-linter.err\").into_diagnostic()?;\n\n    let daemonize = Daemonize::new()\n        .pid_file(\"/tmp/architect-linter.pid\")\n        .umask(0o027)\n        .working_directory(project_root)\n        .stdout(stdout)\n        .stderr(stderr)\n        .privileged_action(|| {\n            println!(\"Architect Linter Pro running in background...\");\n        });\n\n    daemonize\n        .start()\n        .map_err(|e| miette::miette!(\"Failed to daemonize: {}\", e))?;\n    Ok(())\n}\n\n/// Analyzes only changed files since last commit (incremental analysis)\n/// This function is defined in main.rs to avoid circular import issues\npub fn analyze_changed_files(\n    project_root: \u0026Path,\n    analysis_cache: Option\u003c\u0026mut cache::AnalysisCache\u003e,\n) -\u003e Result\u003canalysis_result::AnalysisResult\u003e {\n    // Use the collector function but we need to handle the circular dependency\n    // So we'll implement the logic directly here\n    let changed_files = match git_changes::get_changed_files(project_root) {\n        Ok(files) =\u003e files,\n        Err(e) =\u003e {\n            return Err(miette::miette!(\n                \"Failed to get changed files from git: {}\",\n                e\n            ));\n        }\n    };\n\n    if changed_files.is_empty() {\n        println!(\"✅ No changed files detected\");\n        println!(\"   Incremental analysis completed (no changes to analyze)\");\n\n        // Return empty analysis result\n        let project_name = project_root\n            .file_name()\n            .and_then(|n| n.to_str())\n            .unwrap_or(\"project\")\n            .to_string();\n\n        let config = config::load_config(project_root)\n            .map_err(|e| miette::miette!(\"Failed to load config: {}\", e))?;\n\n        let mut result = analysis_result::AnalysisResult::new(project_name, config.pattern);\n        result.files_analyzed = 0;\n        result.complexity_stats = metrics::ComplexityStats {\n            total_functions: 0,\n            long_functions: 0,\n            max_lines_threshold: config.max_lines,\n        };\n\n        return Ok(result);\n    }\n\n    println!(\"🔍 Found {} changed files to analyze\", changed_files.len());\n\n    // Load config\n    let config = config::load_config(project_root)\n        .map_err(|e| miette::miette!(\"Failed to load config: {}\", e))?;\n\n    let linter_context: config::LinterContext = config;\n    let cm = Arc::new(SourceMap::default());\n\n    // Analyze only changed files\n    analyzer::analyze_all_files(\n        \u0026changed_files,\n        project_root,\n        linter_context.pattern.clone(),\n        \u0026linter_context,\n        \u0026cm,\n        analysis_cache,\n    )\n}\n\nfn main() -\u003e Result\u003c()\u003e {\n    // 1. Procesar argumentos de línea de comandos\n    let cli_args = match cli::process_args() {\n        Some(args) =\u003e args,\n        None =\u003e return Ok(()), // Se procesó --help o --version\n    };\n\n    ui::print_banner();\n\n    // 2. Obtener la ruta del proyecto\n    let project_root = if let Some(ref path) = cli_args.project_path {\n        PathBuf::from(path).canonicalize().into_diagnostic()?\n    } else {\n        ui::get_interactive_path()?\n    };\n\n    // 3. Cargar o crear configuración asistida por IA\n    let ctx = Arc::new(config::setup_or_load_config(\u0026project_root)?);\n\n    let no_cache = cli_args.no_cache;\n\n    // 3.5 Check for daemon mode\n    if cli_args.daemon_mode {\n        #[cfg(unix)]\n        {\n            println!(\"🚀 Entrando en modo daemon. Revisa /tmp/architect-linter.err para errores.\");\n            run_as_daemon(\u0026project_root)?;\n        }\n        #[cfg(windows)]\n        {\n            println!(\n                \"⚠️  Modo daemon nativo no soportado aún en Windows. Corriendo en modo normal.\"\n            );\n        }\n    }\n\n    // 4. Decidir entre modo normal, watch o fix\n    if cli_args.fix_mode {\n        run_fix_mode(\u0026project_root, Arc::clone(\u0026ctx))?;\n    } else if cli_args.watch_mode {\n        run_watch_mode(\u0026project_root, Arc::clone(\u0026ctx), no_cache)?;\n    } else if cli_args.incremental_mode {\n        run_incremental_mode(\u0026project_root, Arc::clone(\u0026ctx), \u0026cli_args)?;\n    } else {\n        run_normal_mode(\u0026project_root, Arc::clone(\u0026ctx), \u0026cli_args)?;\n    }\n\n    Ok(())\n}\n\n/// Ejecuta el análisis en modo normal (una sola vez)\nfn run_normal_mode(\n    project_root: \u0026Path,\n    ctx: Arc\u003cconfig::LinterContext\u003e,\n    cli_args: \u0026cli::CliArgs,\n) -\u003e Result\u003c()\u003e {\n    // Recolectar archivos de todos los lenguajes soportados\n    let mut files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n\n    // Filter to staged files if --staged flag is set\n    if cli_args.staged_mode {\n        if !git::is_git_repo(project_root) {\n            return Err(miette::miette!(\n                \"El flag --staged requiere un repositorio git.\"\n            ));\n        }\n        files = git::filter_staged_files(\u0026files, project_root)?;\n        if files.is_empty() {\n            println!(\"✅ No hay archivos staged para analizar.\");\n            return Ok(());\n        }\n        println!(\"🔍 Analizando {} archivos staged...\", files.len());\n    }\n\n    // Mostrar información de directorios ignorados\n    if !ctx.ignored_paths.is_empty() \u0026\u0026 !cli_args.staged_mode {\n        println!(\"📂 Ignorando directorios: {}\", ctx.ignored_paths.join(\", \"));\n    }\n\n    if files.is_empty() {\n        println!(\"✅ No se encontraron archivos para analizar (TypeScript, JavaScript, Python, Go, PHP, Java).\");\n        return Ok(());\n    }\n\n    // Barra de progreso y Análisis Paralelo con Rayon\n    let pb = ProgressBar::new(files.len() as u64);\n    pb.set_style(\n        ProgressStyle::default_bar()\n            .template(\"{spinner:.green} [{bar:40.cyan/blue}] {pos}/{len} {msg}\")\n            .into_diagnostic()?,\n    );\n    pb.set_message(\"Analyzing...\");\n\n    let cm = Arc::new(SourceMap::default());\n\n    // Load or create analysis cache\n    let use_cache = !cli_args.no_cache;\n    let config_hash = cache::hash_config(\u0026ctx);\n    let mut analysis_cache = if use_cache {\n        cache::AnalysisCache::load(project_root, \u0026config_hash)\n            .unwrap_or_else(|| cache::AnalysisCache::new(config_hash.clone()))\n    } else {\n        cache::AnalysisCache::new(config_hash.clone())\n    };\n\n    // v4.0: Use aggregated analysis for scoring\n    let mut analysis_result = analyzer::analyze_all_files(\n        \u0026files,\n        project_root,\n        ctx.pattern.clone(),\n        \u0026ctx,\n        \u0026cm,\n        if use_cache {\n            Some(\u0026mut analysis_cache)\n        } else {\n            None\n        },\n    )?;\n\n    // Save cache to disk\n    if use_cache {\n        if let Err(e) = analysis_cache.save(project_root) {\n            eprintln!(\"⚠️  Could not save analysis cache: {}\", e);\n        }\n    }\n\n    // Análisis de Dependencias Cíclicas\n    pb.set_message(\"Checking circular deps...\");\n    let cycles = circular::analyze_circular_dependencies(\u0026files, project_root, \u0026cm);\n\n    match cycles {\n        Ok(detected_cycles) =\u003e {\n            for cycle in \u0026detected_cycles {\n                analysis_result.add_circular_dependency(cycle.clone());\n            }\n        }\n        Err(e) =\u003e {\n            eprintln!(\"⚠️  No se pudo analizar dependencias cíclicas: {}\", e);\n        }\n    }\n\n    pb.finish_and_clear();\n\n    // Calculate health score\n    let health_score = scoring::calculate(\u0026analysis_result);\n    analysis_result.health_score = Some(health_score.clone());\n\n    // Handle report export if requested\n    if let Some(format) = cli_args.report_format {\n        let report_content = report::generate_report(\u0026analysis_result, format);\n\n        if let Some(output_path) = \u0026cli_args.output_path {\n            let path = std::path::Path::new(output_path);\n            report::write_report(\u0026report_content, path)?;\n            println!(\"📄 Report saved to: {}\", output_path);\n        } else {\n            report::write_stdout(\u0026report_content)?;\n        }\n\n        // Exit with appropriate code\n        if analysis_result.has_critical_issues() {\n            std::process::exit(1);\n        }\n        return Ok(());\n    }\n\n    // Print dashboard\n    output::print_dashboard(\u0026analysis_result);\n\n    // Print summary\n    output::dashboard::print_summary(\u0026analysis_result);\n\n    // Print circular dependency details if any\n    if !analysis_result.circular_dependencies.is_empty() {\n        println!();\n        circular::print_circular_dependency_report(\u0026analysis_result.circular_dependencies);\n    }\n\n    // Exit with appropriate code\n    if analysis_result.has_critical_issues() {\n        std::process::exit(1);\n    } else {\n        std::process::exit(0);\n    }\n}\n\n/// Run a full analysis and return the AnalysisResult (reused by watch commands)\nfn run_full_analysis(\n    project_root: \u0026Path,\n    ctx: \u0026config::LinterContext,\n    analysis_cache: Option\u003c\u0026mut cache::AnalysisCache\u003e,\n) -\u003e Result\u003canalysis_result::AnalysisResult\u003e {\n    let files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n    let cm = Arc::new(SourceMap::default());\n\n    let mut analysis_result = analyzer::analyze_all_files(\n        \u0026files,\n        project_root,\n        ctx.pattern.clone(),\n        ctx,\n        \u0026cm,\n        analysis_cache,\n    )?;\n\n    // Circular dependencies\n    match circular::analyze_circular_dependencies(\u0026files, project_root, \u0026cm) {\n        Ok(detected_cycles) =\u003e {\n            for cycle in \u0026detected_cycles {\n                analysis_result.add_circular_dependency(cycle.clone());\n            }\n        }\n        Err(e) =\u003e {\n            eprintln!(\"⚠️  No se pudo analizar dependencias cíclicas: {}\", e);\n        }\n    }\n\n    // Health score\n    let health_score = scoring::calculate(\u0026analysis_result);\n    analysis_result.health_score = Some(health_score);\n\n    Ok(analysis_result)\n}\n\n/// Run the AI auto-fix flow (reused by watch commands)\nfn run_fix_flow(project_root: \u0026Path, ctx: \u0026config::LinterContext) -\u003e Result\u003c()\u003e {\n    use dialoguer::Confirm;\n\n    if ctx.ai_configs.is_empty() {\n        println!(\"⚠️  No se encontró configuración de IA (.architect.ai.json).\");\n        println!(\"   El modo fix requiere configuración de IA para funcionar.\");\n        return Ok(());\n    }\n\n    let files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n    if files.is_empty() {\n        println!(\"✅ No se encontraron archivos para analizar.\");\n        return Ok(());\n    }\n\n    println!(\"📊 Analizando {} archivos...\\n\", files.len());\n\n    let cm = Arc::new(SourceMap::default());\n    let mut all_violations = Vec::new();\n\n    for file_path in \u0026files {\n        match analyzer::collect_violations_from_file(\u0026cm, file_path, ctx) {\n            Ok(violations) =\u003e all_violations.extend(violations),\n            Err(e) =\u003e eprintln!(\"⚠️  Error analizando {}: {}\", file_path.display(), e),\n        }\n    }\n\n    if all_violations.is_empty() {\n        println!(\"✨ ¡No se encontraron violaciones! Tu código está perfecto.\");\n        return Ok(());\n    }\n\n    println!(\n        \"🔍 Encontradas {} violación(es) arquitectónicas\\n\",\n        all_violations.len()\n    );\n\n    let mut fixed_count = 0;\n    let mut skipped_count = 0;\n\n    for (index, violation) in all_violations.iter().enumerate() {\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n        println!(\"Violación #{}/{}\", index + 1, all_violations.len());\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n        println!(\"📄 Archivo: {}\", violation.file_path.display());\n        println!(\"📍 Línea: {}\", violation.line_number);\n        println!(\n            \"🚫 Regla violada: '{}' no puede importar de '{}'\",\n            violation.rule.from, violation.rule.to\n        );\n        println!(\"💥 Import ofensivo: {}\", violation.offensive_import);\n        println!();\n\n        println!(\"🤖 Consultando sugerencia de fix (usando sistema de fallback multimodelo)...\");\n\n        let runtime = tokio::runtime::Runtime::new().into_diagnostic()?;\n        let suggestion = match runtime.block_on(autofix::suggest_fix(\n            violation,\n            project_root,\n            \u0026ctx.ai_configs,\n        )) {\n            Ok(s) =\u003e s,\n            Err(_e) =\u003e {\n                eprintln!(\"❌ No se pudo obtener ninguna sugerencia de los modelos configurados.\");\n                println!(\"⏭️  Saltando esta violación...\\n\");\n                skipped_count += 1;\n                continue;\n            }\n        };\n\n        println!();\n        println!(\n            \"💡 Sugerencia de la IA (confianza: {}):\",\n            suggestion.confidence\n        );\n        println!(\"{}\", suggestion.explanation);\n        println!();\n\n        match \u0026suggestion.fix_type {\n            autofix::FixType::Refactor { old_code, new_code } =\u003e {\n                println!(\"📝 Tipo: Refactorización de código\");\n                println!(\"Cambiar:\");\n                println!(\"  ❌ {}\", old_code);\n                println!(\"Por:\");\n                println!(\"  ✅ {}\", new_code);\n            }\n            autofix::FixType::MoveFile { from, to } =\u003e {\n                println!(\"📦 Tipo: Mover archivo\");\n                println!(\"  De: {}\", from);\n                println!(\"  A:  {}\", to);\n            }\n            autofix::FixType::CreateInterface {\n                interface_path,\n                interface_code,\n                updated_import,\n            } =\u003e {\n                println!(\"🎯 Tipo: Crear interfaz\");\n                println!(\"  Nueva interfaz: {}\", interface_path);\n                println!(\"  Código: {} líneas\", interface_code.lines().count());\n                println!(\"  Nuevo import: {}\", updated_import);\n            }\n        }\n\n        println!();\n\n        let should_apply = Confirm::new()\n            .with_prompt(\"¿Aplicar este fix?\")\n            .default(false)\n            .interact()\n            .into_diagnostic()?;\n\n        if should_apply {\n            match autofix::apply_fix(\u0026suggestion, violation, project_root) {\n                Ok(message) =\u003e {\n                    println!(\"{}\", message);\n                    fixed_count += 1;\n                }\n                Err(e) =\u003e {\n                    eprintln!(\"❌ Error aplicando fix: {}\", e);\n                    skipped_count += 1;\n                }\n            }\n        } else {\n            println!(\"⏭️  Fix omitido\");\n            skipped_count += 1;\n        }\n\n        println!();\n    }\n\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"📊 RESUMEN\");\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"✅ Fixes aplicados: {}\", fixed_count);\n    println!(\"⏭️  Omitidos: {}\", skipped_count);\n    println!(\"📝 Total violaciones: {}\", all_violations.len());\n    println!();\n\n    if fixed_count \u003e 0 {\n        println!(\"🎉 ¡Se aplicaron {} fix(es) exitosamente!\", fixed_count);\n        println!(\"💡 Tip: Ejecuta el linter nuevamente para verificar que todo esté correcto.\");\n    }\n\n    Ok(())\n}\n\n/// Ejecuta el análisis en modo watch (observación continua e interactiva)\nfn run_watch_mode(\n    project_root: \u0026Path,\n    ctx: Arc\u003cconfig::LinterContext\u003e,\n    no_cache: bool,\n) -\u003e Result\u003c()\u003e {\n    let project_name_notification = Arc::new(\n        project_root\n            .file_name()\n            .map(|n| n.to_string_lossy().into_owned())\n            .unwrap_or_else(|| \"project\".to_string()),\n    );\n\n    println!(\"🚀 Iniciando modo watch...\\n\");\n\n    // Análisis inicial completo\n    let files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n\n    if !ctx.ignored_paths.is_empty() {\n        println!(\"📂 Ignorando directorios: {}\", ctx.ignored_paths.join(\", \"));\n    }\n\n    if files.is_empty() {\n        println!(\"✅ No se encontraron archivos para analizar (TypeScript, JavaScript, Python, Go, PHP, Java).\");\n        return Ok(());\n    }\n\n    println!(\"📊 Análisis inicial de {} archivos...\", files.len());\n    let cm = Arc::new(SourceMap::default());\n\n    // Construir grafo de dependencias inicial\n    let mut dep_analyzer = circular::CircularDependencyAnalyzer::new(project_root);\n    dep_analyzer.build_graph(\u0026files, \u0026cm)?;\n\n    // Análisis inicial de violaciones\n    let mut error_count = 0;\n    for file_path in \u0026files {\n        if let Err(e) = analyzer::analyze_file(\u0026cm, file_path, \u0026ctx) {\n            error_count += 1;\n            let mut out = String::new();\n            let _ = GraphicalReportHandler::new().render_report(\u0026mut out, e.as_ref());\n            println!(\"\\n📌 Violación en: {}\", file_path.display());\n            println!(\"{}\", out);\n        }\n    }\n\n    // Análisis de ciclos inicial\n    let cycles = dep_analyzer.detect_cycles();\n    if !cycles.is_empty() {\n        circular::print_circular_dependency_report(\u0026cycles);\n        println!(\n            \"\\n⚠️  Se encontraron {} dependencias cíclicas.\",\n            cycles.len()\n        );\n    }\n\n    if error_count \u003e 0 {\n        println!(\n            \"\\n❌ Se encontraron {} violaciones arquitectónicas.\",\n            error_count\n        );\n    } else {\n        println!(\"\\n✨ ¡Proyecto impecable! La arquitectura se respeta.\");\n    }\n\n    println!();\n\n    // Initialize analysis cache for watch session\n    let config_hash = cache::hash_config(\u0026ctx);\n    let watch_cache: Arc\u003cMutex\u003cOption\u003ccache::AnalysisCache\u003e\u003e\u003e = if no_cache {\n        Arc::new(Mutex::new(None))\n    } else {\n        let c = cache::AnalysisCache::load(project_root, \u0026config_hash)\n            .unwrap_or_else(|| cache::AnalysisCache::new(config_hash));\n        Arc::new(Mutex::new(Some(c)))\n    };\n\n    // Shared state for the watch loop\n    let dep_analyzer = Arc::new(Mutex::new(dep_analyzer));\n    let project_root_arc = Arc::new(project_root.to_path_buf());\n    let ignored_paths = ctx.ignored_paths.clone();\n\n    // Clone Arcs for the on_command closure\n    let cmd_ctx = Arc::clone(\u0026ctx);\n    let cmd_project_root = Arc::clone(\u0026project_root_arc);\n    let cmd_cache = Arc::clone(\u0026watch_cache);\n\n    let change_cache = Arc::clone(\u0026watch_cache);\n\n    watch::start_watch_mode(\n        project_root_arc.as_ref(),\n        ignored_paths,\n        // on_change: incremental analysis for file changes\n        |changed_files| {\n            let dep_analyzer = Arc::clone(\u0026dep_analyzer);\n            let ctx = Arc::clone(\u0026ctx);\n            let cm = Arc::clone(\u0026cm);\n            let project_root = Arc::clone(\u0026project_root_arc);\n            let change_cache = Arc::clone(\u0026change_cache);\n            let project_name_notification = Arc::clone(\u0026project_name_notification);\n\n            // Invalidate changed files in cache\n            {\n                let mut cache_guard = change_cache.lock().expect(\"Failed to lock mutex\");\n                if let Some(ref mut c) = *cache_guard {\n                    for file_path in changed_files {\n                        let key = cache::AnalysisCache::normalize_path(file_path, \u0026project_root);\n                        c.remove(\u0026key);\n                    }\n                }\n            }\n\n            let mut error_count = 0;\n            for file_path in changed_files {\n                if let Err(e) = analyzer::analyze_file(\u0026cm, file_path, \u0026ctx) {\n                    error_count += 1;\n                    let mut out = String::new();\n                    let _ = GraphicalReportHandler::new().render_report(\u0026mut out, e.as_ref());\n                    println!(\"\\n📌 Violación en: {}\", file_path.display());\n                    println!(\"{}\", out);\n                }\n\n                let mut dep_analyzer = dep_analyzer.lock().expect(\"Failed to lock mutex\");\n                if let Err(e) = dep_analyzer.update_file(file_path, \u0026cm) {\n                    eprintln!(\"⚠️  Error actualizando grafo: {}\", e);\n                    continue;\n                }\n\n                let normalized_path =\n                    if let Ok(relative) = file_path.strip_prefix(project_root.as_ref()) {\n                        relative.to_string_lossy().replace('\\\\', \"/\").to_lowercase()\n                    } else {\n                        file_path\n                            .to_string_lossy()\n                            .replace('\\\\', \"/\")\n                            .to_lowercase()\n                    };\n\n                let affected_nodes = dep_analyzer.get_affected_nodes(\u0026normalized_path);\n\n                if !affected_nodes.is_empty() {\n                    let cycles = dep_analyzer.detect_cycles_in_subgraph(\u0026affected_nodes);\n                    if !cycles.is_empty() {\n                        circular::print_circular_dependency_report(\u0026cycles);\n                        println!(\n                            \"\\n⚠️  Se encontraron {} dependencias cíclicas.\",\n                            cycles.len()\n                        );\n                        notification::send_cycle_alert(\u0026project_name_notification, cycles.len());\n                    }\n                }\n            }\n\n            if error_count \u003e 0 {\n                println!(\n                    \"\\n❌ Se encontraron {} violaciones arquitectónicas.\",\n                    error_count\n                );\n                notification::send_violation_alert(\u0026project_name_notification, error_count);\n            } else {\n                println!(\"\\n✨ Todo correcto!\");\n                notification::send_success_notification(\u0026project_name_notification);\n            }\n\n            Ok(())\n        },\n        // on_command: handle interactive commands\n        |cmd| {\n            let ctx = Arc::clone(\u0026cmd_ctx);\n            let project_root = cmd_project_root.as_ref();\n            let cmd_cache = Arc::clone(\u0026cmd_cache);\n\n            // Helper: run full analysis with cache, then save\n            let run_cached_analysis = |cache_arc: \u0026Arc\u003cMutex\u003cOption\u003ccache::AnalysisCache\u003e\u003e\u003e| -\u003e Result\u003canalysis_result::AnalysisResult\u003e {\n                let mut guard = cache_arc.lock().expect(\"Failed to lock mutex\");\n                let result = run_full_analysis(\n                    project_root,\n                    \u0026ctx,\n                    guard.as_mut(),\n                )?;\n                // Save cache after analysis\n                if let Some(ref c) = *guard {\n                    if let Err(e) = c.save(project_root) {\n                        eprintln!(\"⚠️  Could not save analysis cache: {}\", e);\n                    }\n                }\n                Ok(result)\n            };\n\n            match cmd {\n                watch::WatchCommand::Fix =\u003e {\n                    println!(\"\\n🔧 Ejecutando auto-fix con IA...\\n\");\n                    run_fix_flow(project_root, \u0026ctx)?;\n                }\n                watch::WatchCommand::ReportJson =\u003e {\n                    println!(\"\\n📄 Generando reporte JSON...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    let content = report::generate_report(\u0026result, cli::ReportFormat::Json);\n                    let path = project_root.join(\"report.json\");\n                    report::write_report(\u0026content, \u0026path)?;\n                    println!(\"📄 Reporte guardado en: {}\", path.display());\n                }\n                watch::WatchCommand::ReportMarkdown =\u003e {\n                    println!(\"\\n📄 Generando reporte Markdown...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    let content = report::generate_report(\u0026result, cli::ReportFormat::Markdown);\n                    let path = project_root.join(\"report.md\");\n                    report::write_report(\u0026content, \u0026path)?;\n                    println!(\"📄 Reporte guardado en: {}\", path.display());\n                }\n                watch::WatchCommand::FullAnalysis =\u003e {\n                    println!(\"\\n📊 Ejecutando análisis completo...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    output::print_dashboard(\u0026result);\n                    output::dashboard::print_summary(\u0026result);\n                    if !result.circular_dependencies.is_empty() {\n                        println!();\n                        circular::print_circular_dependency_report(\u0026result.circular_dependencies);\n                    }\n                }\n                watch::WatchCommand::Violations =\u003e {\n                    println!(\"\\n🔍 Escaneando todas las violaciones...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n\n                    if result.violations.is_empty() \u0026\u0026 result.circular_dependencies.is_empty() {\n                        println!(\"✨ ¡No se encontraron violaciones! La arquitectura se respeta.\");\n                    } else {\n                        // Violations\n                        if !result.violations.is_empty() {\n                            println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n                            println!(\n                                \"  🚫 {} violación(es) arquitectónicas\",\n                                result.violations.len()\n                            );\n                            println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n                            for (i, cv) in result.violations.iter().enumerate() {\n                                let icon = match cv.category {\n                                    analysis_result::ViolationCategory::Blocked =\u003e \"❌\",\n                                    analysis_result::ViolationCategory::Warning =\u003e \"⚠️\",\n                                    analysis_result::ViolationCategory::Info =\u003e \"ℹ️\",\n                                };\n                                println!(\n                                    \"\\n  {} #{} [{}]\",\n                                    icon,\n                                    i + 1,\n                                    cv.category.as_str().to_uppercase()\n                                );\n                                println!(\n                                    \"     📄 {}:{}\",\n                                    cv.violation.file_path.display(),\n                                    cv.violation.line_number\n                                );\n                                println!(\n                                    \"     🚫 '{}' no puede importar de '{}'\",\n                                    cv.violation.rule.from, cv.violation.rule.to\n                                );\n                                println!(\"     💥 {}\", cv.violation.offensive_import);\n                            }\n                            println!();\n                        }\n\n                        // Circular dependencies\n                        if !result.circular_dependencies.is_empty() {\n                            circular::print_circular_dependency_report(\n                                \u0026result.circular_dependencies,\n                            );\n                        }\n\n                        // Summary line\n                        println!(\n                            \"📊 Total: {} violaciones, {} dependencias cíclicas\",\n                            result.violations.len(),\n                            result.circular_dependencies.len()\n                        );\n                    }\n                }\n                watch::WatchCommand::Dashboard =\u003e {\n                    println!(\"\\n📊 Calculando health score...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    output::print_dashboard(\u0026result);\n                }\n                watch::WatchCommand::Clear =\u003e {\n                    // ANSI escape to clear screen and move cursor to top\n                    print!(\"\\x1B[2J\\x1B[1;1H\");\n                    println!(\"👁️  Modo Watch activo\");\n                }\n                watch::WatchCommand::Help =\u003e {\n                    println!();\n                    watch::print_watch_help();\n                }\n                watch::WatchCommand::Quit =\u003e {\n                    return Ok(false);\n                }\n            }\n\n            Ok(true)\n        },\n    )?;\n\n    Ok(())\n}\n\n/// Ejecuta el análisis en modo fix (auto-reparación con IA)\nfn run_fix_mode(project_root: \u0026Path, ctx: Arc\u003cconfig::LinterContext\u003e) -\u003e Result\u003c()\u003e {\n    println!(\"🔧 Modo Fix: Auto-reparación con IA\\n\");\n\n    if ctx.ai_configs.is_empty() {\n        return Err(miette::miette!(\n            \"No se encontró configuración de IA (.architect.ai.json).\\n\\\n             El modo --fix requiere configuración de IA para funcionar.\"\n        ));\n    }\n\n    run_fix_flow(project_root, \u0026ctx)\n}\n\n/// Ejecuta el análisis en modo incremental (solo archivos modificados)\nfn run_incremental_mode(\n    project_root: \u0026Path,\n    __ctx: Arc\u003cconfig::LinterContext\u003e,\n    cli_args: \u0026cli::CliArgs,\n) -\u003e Result\u003c()\u003e {\n    println!(\"🚀 Modo Incremental: Analizando solo archivos modificados\\n\");\n\n    if !git::is_git_repo(project_root) {\n        return Err(miette::miette!(\n            \"El flag --incremental requiere un repositorio git.\"\n        ));\n    }\n\n    // Get changed files from Git\n    let changed_files = git_changes::get_changed_files(project_root)\n        .map_err(|e| miette::miette!(\"Failed to get changed files from git: {}\", e))?;\n\n    if changed_files.is_empty() {\n        println!(\"No changed files detected\");\n        println!(\"✅ Análisis incremental completado (sin cambios)\");\n        std::process::exit(0);\n    }\n\n    println!(\n        \"🔍 Analizando {} archivos modificados incrementalmente\",\n        changed_files.len()\n    );\n\n    // Load config\n    let config = config::load_config(\u0026project_root.join(\"architect.json\"))?;\n    let linter_context: config::LinterContext = config;\n\n    // Analyze only changed files\n    let cm = Arc::new(SourceMap::default());\n    let mut analysis_result = analyzer::analyze_all_files(\n        \u0026changed_files,\n        project_root,\n        linter_context.pattern.clone(),\n        \u0026linter_context,\n        \u0026cm,\n        None,\n    )?;\n\n    // Handle circular dependencies\n    if !analysis_result.circular_dependencies.is_empty() {\n        circular::print_circular_dependency_report(\u0026analysis_result.circular_dependencies);\n    }\n\n    // Calculate health score\n    let health_score = scoring::calculate(\u0026analysis_result);\n    analysis_result.health_score = Some(health_score.clone());\n\n    // Handle report export if requested\n    if let Some(format) = cli_args.report_format {\n        let report_content = report::generate_report(\u0026analysis_result, format);\n\n        if let Some(output_path) = \u0026cli_args.output_path {\n            let path = std::path::Path::new(output_path);\n            report::write_report(\u0026report_content, path)?;\n            println!(\"📄 Report saved to: {}\", output_path);\n        } else {\n            report::write_stdout(\u0026report_content)?;\n        }\n\n        // Exit with appropriate code\n        if analysis_result.has_critical_issues() {\n            std::process::exit(1);\n        }\n        return Ok(());\n    }\n\n    // Print dashboard\n    output::print_dashboard(\u0026analysis_result);\n\n    // Print summary\n    output::dashboard::print_summary(\u0026analysis_result);\n\n    // Print circular dependency details if any\n    if !analysis_result.circular_dependencies.is_empty() {\n        println!();\n        circular::print_circular_dependency_report(\u0026analysis_result.circular_dependencies);\n    }\n\n    // Exit with appropriate code\n    if analysis_result.has_critical_issues() {\n        std::process::exit(1);\n    } else {\n        std::process::exit(0);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","memory_cache.rs"],"content":"use lru::LruCache;\nuse std::num::NonZeroUsize;\nuse std::path::PathBuf;\nuse std::sync::{Arc, Mutex};\n\n/// Thread-safe LRU memory cache for file analysis results\n#[derive(Clone)]\npub struct MemoryCache {\n    cache: Arc\u003cMutex\u003cLruCache\u003cPathBuf, String\u003e\u003e\u003e,\n}\n\nimpl MemoryCache {\n    /// Create a new memory cache with specified capacity\n    pub fn new(capacity: usize) -\u003e Self {\n        Self {\n            cache: Arc::new(Mutex::new(LruCache::new(\n                NonZeroUsize::new(capacity).expect(\"Capacity must be \u003e 0\"),\n            ))),\n        }\n    }\n\n    /// Get a cached value\n    pub fn get(\u0026self, path: \u0026PathBuf) -\u003e Option\u003cString\u003e {\n        let mut cache = self.cache.lock().unwrap();\n        cache.get(path).cloned()\n    }\n\n    /// Put a value in the cache\n    pub fn put(\u0026self, path: PathBuf, content: String) {\n        let mut cache = self.cache.lock().unwrap();\n        cache.put(path, content);\n    }\n\n    /// Clear the cache\n    pub fn clear(\u0026self) {\n        let mut cache = self.cache.lock().unwrap();\n        cache.clear();\n    }\n\n    /// Get cache size\n    pub fn len(\u0026self) -\u003e usize {\n        let cache = self.cache.lock().unwrap();\n        cache.len()\n    }\n\n    /// Check if cache is empty\n    pub fn is_empty(\u0026self) -\u003e bool {\n        self.len() == 0\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_put_and_get() {\n        let cache = MemoryCache::new(2);\n        let path = PathBuf::from(\"test.ts\");\n        cache.put(path.clone(), \"content\".to_string());\n        assert_eq!(cache.get(\u0026path), Some(\"content\".to_string()));\n    }\n}\n","traces":[{"line":14,"address":[25234336],"length":1,"stats":{"Line":0}},{"line":16,"address":[25234388],"length":1,"stats":{"Line":0}},{"line":23,"address":[25234124,25234130,25233888],"length":1,"stats":{"Line":0}},{"line":24,"address":[25233933],"length":1,"stats":{"Line":0}},{"line":25,"address":[25233997,25234063],"length":1,"stats":{"Line":0}},{"line":29,"address":[25234838,25234872,25234448],"length":1,"stats":{"Line":0}},{"line":30,"address":[25234567,25234473],"length":1,"stats":{"Line":0}},{"line":31,"address":[25234710,25234635],"length":1,"stats":{"Line":0}},{"line":35,"address":[25235070,25234912,25235076],"length":1,"stats":{"Line":0}},{"line":36,"address":[25234921],"length":1,"stats":{"Line":0}},{"line":37,"address":[25235043,25234985],"length":1,"stats":{"Line":0}},{"line":41,"address":[25234144,25234316,25234310],"length":1,"stats":{"Line":0}},{"line":42,"address":[25234153],"length":1,"stats":{"Line":0}},{"line":43,"address":[25234275,25234217],"length":1,"stats":{"Line":0}},{"line":47,"address":[25235088],"length":1,"stats":{"Line":0}},{"line":48,"address":[25235093],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":16},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","metrics.rs"],"content":"//! Metrics and scoring data structures for Architecture Health Score\n//!\n//! This module defines all the types needed for the v4.0 scoring system.\n\nuse serde::{Deserialize, Serialize};\n\n/// Health grade based on score ranges\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\npub enum HealthGrade {\n    A, // 90-100\n    B, // 80-89\n    C, // 70-79\n    D, // 60-69\n    F, // 0-59\n}\n\nimpl HealthGrade {\n    pub fn from_score(score: u8) -\u003e Self {\n        match score {\n            90..=100 =\u003e HealthGrade::A,\n            80..=89 =\u003e HealthGrade::B,\n            70..=79 =\u003e HealthGrade::C,\n            60..=69 =\u003e HealthGrade::D,\n            _ =\u003e HealthGrade::F,\n        }\n    }\n\n    pub fn as_str(\u0026self) -\u003e \u0026'static str {\n        match self {\n            HealthGrade::A =\u003e \"A\",\n            HealthGrade::B =\u003e \"B\",\n            HealthGrade::C =\u003e \"C\",\n            HealthGrade::D =\u003e \"D\",\n            HealthGrade::F =\u003e \"F\",\n        }\n    }\n\n    pub fn emoji(\u0026self) -\u003e \u0026'static str {\n        match self {\n            HealthGrade::A =\u003e \"🏆\",\n            HealthGrade::B =\u003e \"✨\",\n            HealthGrade::C =\u003e \"👍\",\n            HealthGrade::D =\u003e \"⚠️\",\n            HealthGrade::F =\u003e \"❌\",\n        }\n    }\n}\n\n/// Individual score components\n#[derive(Debug, Clone, Copy, Serialize, Deserialize)]\npub struct ScoreComponents {\n    /// Layer isolation score (0-100)\n    /// Formula: 100 - (blocked_violations / total_imports * 100)\n    pub layer_isolation: u8,\n\n    /// Circular dependencies score (0 or 100)\n    /// 100 if no cycles, 0 if cycles exist\n    pub circular_deps: u8,\n\n    /// Code complexity score (0-100)\n    /// Formula: 100 - (long_functions / total_functions * 100)\n    pub complexity: u8,\n\n    /// Violations score (0-100)\n    /// Formula: 100 - ((blocked * 2 + warnings) / total_checks * 100)\n    pub violations: u8,\n}\n\nimpl ScoreComponents {\n    /// Calculate weighted total score\n    /// Weights: Layer Isolation (30%), Circular Deps (25%), Complexity (20%), Violations (25%)\n    pub fn calculate_total(\u0026self) -\u003e u8 {\n        let total = (self.layer_isolation as f64 * 0.30)\n            + (self.circular_deps as f64 * 0.25)\n            + (self.complexity as f64 * 0.20)\n            + (self.violations as f64 * 0.25);\n        total.round() as u8\n    }\n}\n\n/// Complete health score with all components\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct HealthScore {\n    /// Total score (0-100)\n    pub total: u8,\n\n    /// Grade (A-F)\n    pub grade: HealthGrade,\n\n    /// Individual component scores\n    pub components: ScoreComponents,\n\n    /// Status indicators for each component\n    pub layer_isolation_status: ComponentStatus,\n    pub circular_deps_status: ComponentStatus,\n    pub complexity_status: ComponentStatus,\n    pub violations_status: ComponentStatus,\n}\n\nimpl HealthScore {\n    pub fn new(components: ScoreComponents) -\u003e Self {\n        let total = components.calculate_total();\n        let grade = HealthGrade::from_score(total);\n\n        Self {\n            total,\n            grade,\n            components,\n            layer_isolation_status: ComponentStatus::from_score(components.layer_isolation),\n            circular_deps_status: ComponentStatus::from_score(components.circular_deps),\n            complexity_status: ComponentStatus::from_score(components.complexity),\n            violations_status: ComponentStatus::from_score(components.violations),\n        }\n    }\n\n    /// Get the status indicator string for display\n    #[allow(dead_code)] // Used by integration tests\n    pub fn status_indicator(\u0026self) -\u003e \u0026'static str {\n        match self.grade {\n            HealthGrade::A =\u003e \"✅ Excellent\",\n            HealthGrade::B =\u003e \"✓ Good\",\n            HealthGrade::C =\u003e \"! Fair\",\n            HealthGrade::D =\u003e \"⚠ Needs Work\",\n            HealthGrade::F =\u003e \"✗ Critical\",\n        }\n    }\n}\n\n/// Status of an individual component\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\npub enum ComponentStatus {\n    Ok,      // No issues\n    Warning, // Minor issues\n    Blocked, // Critical issues\n}\n\nimpl ComponentStatus {\n    pub fn from_score(score: u8) -\u003e Self {\n        match score {\n            90..=100 =\u003e ComponentStatus::Ok,\n            60..=89 =\u003e ComponentStatus::Warning,\n            _ =\u003e ComponentStatus::Blocked,\n        }\n    }\n\n    pub fn emoji(\u0026self) -\u003e \u0026'static str {\n        match self {\n            ComponentStatus::Ok =\u003e \"[OK]\",\n            ComponentStatus::Warning =\u003e \"[!]\",\n            ComponentStatus::Blocked =\u003e \"[X]\",\n        }\n    }\n}\n\n/// Statistics for layer isolation scoring\n#[derive(Debug, Clone, Default, Serialize, Deserialize)]\npub struct LayerStats {\n    pub total_imports: usize,\n    pub blocked_violations: usize,\n}\n\n/// Statistics for complexity scoring\n#[derive(Debug, Clone, Default, Serialize, Deserialize)]\npub struct ComplexityStats {\n    pub total_functions: usize,\n    pub long_functions: usize, // Functions exceeding max_lines\n    pub max_lines_threshold: usize,\n}\n\n/// Performance metrics for architecture analysis\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct PerformanceMetrics {\n    pub total_time_ms: u64,\n    pub files_analyzed: u32,\n    pub files_from_cache: u32,\n    pub memory_cache_hits: u32,\n    pub disk_cache_hits: u32,\n    pub peak_memory_mb: u32,\n    pub threads_used: u8,\n}\n\nimpl PerformanceMetrics {\n    pub fn new() -\u003e Self {\n        PerformanceMetrics {\n            total_time_ms: 0,\n            files_analyzed: 0,\n            files_from_cache: 0,\n            memory_cache_hits: 0,\n            disk_cache_hits: 0,\n            peak_memory_mb: 0,\n            threads_used: 0,\n        }\n    }\n\n    pub fn cache_hit_rate(\u0026self) -\u003e f64 {\n        if self.files_analyzed == 0 {\n            return 0.0;\n        }\n\n        let total_hits = self.memory_cache_hits as f64 + self.disk_cache_hits as f64;\n        let total_files = self.files_analyzed as f64;\n\n        (total_hits / total_files) * 100.0\n    }\n}\n\nimpl std::fmt::Display for PerformanceMetrics {\n    fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n        write!(\n            f,\n            \"PerformanceMetrics(total_time_ms: {}, files_analyzed: {}, files_from_cache: {}, memory_cache_hits: {}, disk_cache_hits: {}, peak_memory_mb: {}, threads_used: {}, cache_hit_rate: {:.2}%)\",\n            self.total_time_ms,\n            self.files_analyzed,\n            self.files_from_cache,\n            self.memory_cache_hits,\n            self.disk_cache_hits,\n            self.peak_memory_mb,\n            self.threads_used,\n            self.cache_hit_rate()\n        )\n    }\n}\n","traces":[{"line":18,"address":[24682960],"length":1,"stats":{"Line":0}},{"line":20,"address":[24682993,24682971],"length":1,"stats":{"Line":0}},{"line":21,"address":[24683020,24682981],"length":1,"stats":{"Line":0}},{"line":22,"address":[24683047,24683008],"length":1,"stats":{"Line":0}},{"line":23,"address":[24683069,24683035],"length":1,"stats":{"Line":0}},{"line":24,"address":[24683058],"length":1,"stats":{"Line":0}},{"line":28,"address":[24683248],"length":1,"stats":{"Line":0}},{"line":29,"address":[24683253],"length":1,"stats":{"Line":0}},{"line":30,"address":[24683284],"length":1,"stats":{"Line":0}},{"line":31,"address":[24683307],"length":1,"stats":{"Line":0}},{"line":32,"address":[24683330],"length":1,"stats":{"Line":0}},{"line":33,"address":[24683353],"length":1,"stats":{"Line":0}},{"line":34,"address":[24683376],"length":1,"stats":{"Line":0}},{"line":38,"address":[24683088],"length":1,"stats":{"Line":0}},{"line":39,"address":[24683093],"length":1,"stats":{"Line":0}},{"line":40,"address":[24683124],"length":1,"stats":{"Line":0}},{"line":41,"address":[24683147],"length":1,"stats":{"Line":0}},{"line":42,"address":[24683170],"length":1,"stats":{"Line":0}},{"line":43,"address":[24683193],"length":1,"stats":{"Line":0}},{"line":44,"address":[24683216],"length":1,"stats":{"Line":0}},{"line":72,"address":[24683984],"length":1,"stats":{"Line":0}},{"line":73,"address":[24683993,24684032,24684080,24684056],"length":1,"stats":{"Line":0}},{"line":74,"address":[24684012],"length":1,"stats":{"Line":0}},{"line":75,"address":[24684036],"length":1,"stats":{"Line":0}},{"line":76,"address":[24684060],"length":1,"stats":{"Line":0}},{"line":77,"address":[24684090],"length":1,"stats":{"Line":0}},{"line":101,"address":[24683584],"length":1,"stats":{"Line":0}},{"line":102,"address":[24683610],"length":1,"stats":{"Line":0}},{"line":103,"address":[24683629],"length":1,"stats":{"Line":0}},{"line":109,"address":[24683646],"length":1,"stats":{"Line":0}},{"line":110,"address":[24683661],"length":1,"stats":{"Line":0}},{"line":111,"address":[24683676],"length":1,"stats":{"Line":0}},{"line":112,"address":[24683691],"length":1,"stats":{"Line":0}},{"line":118,"address":[24683408],"length":1,"stats":{"Line":0}},{"line":119,"address":[24683413],"length":1,"stats":{"Line":0}},{"line":120,"address":[24683445],"length":1,"stats":{"Line":0}},{"line":121,"address":[24683468],"length":1,"stats":{"Line":0}},{"line":122,"address":[24683491],"length":1,"stats":{"Line":0}},{"line":123,"address":[24683514],"length":1,"stats":{"Line":0}},{"line":124,"address":[24683537],"length":1,"stats":{"Line":0}},{"line":138,"address":[24683776],"length":1,"stats":{"Line":0}},{"line":140,"address":[24683809,24683787],"length":1,"stats":{"Line":0}},{"line":141,"address":[24683831,24683797],"length":1,"stats":{"Line":0}},{"line":142,"address":[24683820],"length":1,"stats":{"Line":0}},{"line":146,"address":[24683856],"length":1,"stats":{"Line":0}},{"line":147,"address":[24683861],"length":1,"stats":{"Line":0}},{"line":148,"address":[24683893],"length":1,"stats":{"Line":0}},{"line":149,"address":[24683916],"length":1,"stats":{"Line":0}},{"line":150,"address":[24683939],"length":1,"stats":{"Line":0}},{"line":183,"address":[24684240],"length":1,"stats":{"Line":0}},{"line":195,"address":[24684128],"length":1,"stats":{"Line":0}},{"line":196,"address":[24684138],"length":1,"stats":{"Line":0}},{"line":197,"address":[24684213],"length":1,"stats":{"Line":0}},{"line":200,"address":[24684149],"length":1,"stats":{"Line":0}},{"line":201,"address":[24684175],"length":1,"stats":{"Line":0}},{"line":203,"address":[24684189],"length":1,"stats":{"Line":0}},{"line":208,"address":[24686416],"length":1,"stats":{"Line":0}},{"line":209,"address":[24686448,24686569],"length":1,"stats":{"Line":0}},{"line":219,"address":[24686520],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":59},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","notification.rs"],"content":"//! OS Native Notifications for Architect Linter Pro\n\nuse notify_rust::Notification;\n\npub fn send_violation_alert(project_name: \u0026str, violation_count: usize) {\n    let summary = format!(\"🚫 Arquitectura Violada - {}\", project_name);\n    let body = format!(\n        \"Se detectaron {} violaciones arquitectónicas. Haz commit para ver los detalles.\",\n        violation_count\n    );\n\n    let _ = Notification::new()\n        .summary(\u0026summary)\n        .body(\u0026body)\n        .icon(\"dialog-error\")\n        .show();\n}\n\npub fn send_cycle_alert(project_name: \u0026str, cycle_count: usize) {\n    let summary = format!(\"🔄 Ciclo Detectado - {}\", project_name);\n    let body = format!(\n        \"Se encontraron {} dependencias cíclicas críticas.\",\n        cycle_count\n    );\n\n    let _ = Notification::new()\n        .summary(\u0026summary)\n        .body(\u0026body)\n        .icon(\"dialog-warning\")\n        .show();\n}\n\npub fn send_success_notification(project_name: \u0026str) {\n    let _ = Notification::new()\n        .summary(\u0026format!(\"✅ Arquitectura OK - {}\", project_name))\n        .body(\"Tu proyecto cumple con las reglas arquitectónicas.\")\n        .icon(\"dialog-information\")\n        .show();\n}\n","traces":[{"line":23,"address":[38853003,38852945],"length":1,"stats":{"Line":0}},{"line":26,"address":[38853102],"length":1,"stats":{"Line":0}},{"line":27,"address":[38853140],"length":1,"stats":{"Line":0}},{"line":28,"address":[38853167],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":4},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","output","dashboard.rs"],"content":"//! Visual dashboard for Architecture Health Score display\n//!\n//! This module provides rich terminal output with box drawing characters\n//! and progress bars.\n\nuse crate::analysis_result::{AnalysisResult, CategorizedViolation};\nuse crate::metrics::{ComponentStatus, HealthGrade};\nuse crate::scoring::{get_grade_color, get_progress_bar, reset_color};\n\nconst BOX_TOP_LEFT: \u0026str = \"+\";\nconst BOX_TOP_RIGHT: \u0026str = \"+\";\nconst BOX_BOTTOM_LEFT: \u0026str = \"+\";\nconst BOX_BOTTOM_RIGHT: \u0026str = \"+\";\nconst BOX_HORIZONTAL: \u0026str = \"=\";\nconst BOX_VERTICAL: \u0026str = \"|\";\nconst BOX_T_LEFT: \u0026str = \"+\";\nconst BOX_T_RIGHT: \u0026str = \"+\";\n\nconst DASHBOARD_WIDTH: usize = 79;\n\n/// Print the full analysis dashboard\npub fn print_dashboard(result: \u0026AnalysisResult) {\n    print_header(\n        \u0026result.project_name,\n        result.pattern_display(),\n        result.files_analyzed,\n    );\n\n    if let Some(ref score) = result.health_score {\n        print_health_score(score.total, score.grade);\n        print_components(\n            score.components.layer_isolation,\n            score.layer_isolation_status,\n            \"Layer isolation\",\n            \u0026format_layer_details(result),\n        );\n        print_components(\n            score.components.circular_deps,\n            score.circular_deps_status,\n            \"No circular deps\",\n            \u0026format_circular_details(result),\n        );\n        print_components(\n            score.components.complexity,\n            score.complexity_status,\n            \"Complexity\",\n            \u0026format_complexity_details(result),\n        );\n        print_components(\n            score.components.violations,\n            score.violations_status,\n            \"Violations\",\n            \u0026format_violations_details(result),\n        );\n    }\n\n    print_violations_list(\u0026result.violations);\n}\n\n/// Print the dashboard header with project info\nfn print_header(project_name: \u0026str, pattern: \u0026str, files_analyzed: usize) {\n    println!();\n    print_horizontal_line(BOX_TOP_LEFT, BOX_TOP_RIGHT, BOX_HORIZONTAL);\n    print_centered_line(\u0026format!(\"ARCHITECT LINTER PRO v4.0\"));\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n    print_info_line(\"Project:\", project_name);\n    print_info_line(\"Pattern:\", pattern);\n    print_info_line(\"Files:\", \u0026format!(\"{} analyzed\", files_analyzed));\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n}\n\n/// Print the health score section\nfn print_health_score(score: u8, grade: HealthGrade) {\n    let color = get_grade_color(grade);\n    let reset = reset_color();\n\n    println!(\n        \"{}{}{}  {}\",\n        BOX_VERTICAL,\n        \" \".repeat(DASHBOARD_WIDTH - 2),\n        BOX_VERTICAL,\n        \"\"\n    );\n    println!(\n        \"{}  ARCHITECTURE HEALTH: {}{}/100{}  {}  {}  {}{}\",\n        BOX_VERTICAL,\n        color,\n        score,\n        reset,\n        get_progress_bar(score, 14),\n        grade.emoji(),\n        grade.as_str(),\n        \" \".repeat(DASHBOARD_WIDTH - 50)\n    );\n    println!(\n        \"{}{}{}\",\n        BOX_VERTICAL,\n        \" \".repeat(DASHBOARD_WIDTH - 2),\n        BOX_VERTICAL\n    );\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n}\n\n/// Print a component status line\nfn print_components(score: u8, status: ComponentStatus, name: \u0026str, details: \u0026str) {\n    let status_emoji = status.emoji();\n    let details_suffix = if details.is_empty() {\n        String::new()\n    } else {\n        format!(\" ({})\", details)\n    };\n\n    let line = format!(\n        \"  +-- {} {}: {}%{}{}\",\n        status_emoji,\n        name,\n        score,\n        details_suffix,\n        \" \".repeat(DASHBOARD_WIDTH.saturating_sub(20 + name.len() + details_suffix.len()))\n    );\n\n    // Truncate if too long\n    if line.len() \u003e DASHBOARD_WIDTH {\n        println!(\n            \"{}{}{}\",\n            BOX_VERTICAL,\n            \u0026line[..DASHBOARD_WIDTH - 2],\n            BOX_VERTICAL\n        );\n    } else {\n        println!(\"{}{}{}\", BOX_VERTICAL, line, BOX_VERTICAL);\n    }\n}\n\n/// Format layer isolation details\nfn format_layer_details(result: \u0026AnalysisResult) -\u003e String {\n    let blocked = result.blocked_count();\n    if blocked \u003e 0 {\n        format!(\"{} violations\", blocked)\n    } else {\n        \"100%\".to_string()\n    }\n}\n\n/// Format circular dependencies details\nfn format_circular_details(result: \u0026AnalysisResult) -\u003e String {\n    let cycles = result.circular_dependencies.len();\n    if cycles \u003e 0 {\n        format!(\"{} cycles\", cycles)\n    } else {\n        \"Pass\".to_string()\n    }\n}\n\n/// Format complexity details\nfn format_complexity_details(result: \u0026AnalysisResult) -\u003e String {\n    let long = result.long_functions.len();\n    if long \u003e 0 {\n        format!(\n            \"{} functions \u003e {}\",\n            long, result.complexity_stats.max_lines_threshold\n        )\n    } else {\n        \"OK\".to_string()\n    }\n}\n\n/// Format violations details\nfn format_violations_details(result: \u0026AnalysisResult) -\u003e String {\n    let blocked = result.blocked_count();\n    let warnings = result.warning_count();\n\n    if blocked == 0 \u0026\u0026 warnings == 0 {\n        \"None\".to_string()\n    } else if warnings == 0 {\n        format!(\"{} blocked\", blocked)\n    } else if blocked == 0 {\n        format!(\"{} warnings\", warnings)\n    } else {\n        format!(\"{} blocked, {} warnings\", blocked, warnings)\n    }\n}\n\n/// Print the violations list section\nfn print_violations_list(violations: \u0026[CategorizedViolation]) {\n    if violations.is_empty() {\n        return;\n    }\n\n    let blocked_count = violations\n        .iter()\n        .filter(|v| v.category == crate::analysis_result::ViolationCategory::Blocked)\n        .count();\n    let warning_count = violations\n        .iter()\n        .filter(|v| v.category == crate::analysis_result::ViolationCategory::Warning)\n        .count();\n\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n    let header_text_len = 30 + blocked_count.to_string().len() + warning_count.to_string().len();\n    let header_padding = DASHBOARD_WIDTH.saturating_sub(header_text_len);\n    println!(\n        \"{}  VIOLATIONS ({} blocked, {} warnings){}\",\n        BOX_VERTICAL,\n        blocked_count,\n        warning_count,\n        \" \".repeat(header_padding)\n    );\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n\n    for (i, categorized) in violations.iter().enumerate() {\n        let v = \u0026categorized.violation;\n        let file_line_len =\n            10 + v.file_path.to_string_lossy().len() + v.line_number.to_string().len();\n        let file_padding = DASHBOARD_WIDTH.saturating_sub(file_line_len);\n        println!(\n            \"{}  {}. {}:{}{}\",\n            BOX_VERTICAL,\n            i + 1,\n            v.file_path.display(),\n            v.line_number,\n            \" \".repeat(file_padding)\n        );\n        let rule_line_len = 20 + v.rule.from.len() + v.rule.to.len();\n        let rule_padding = DASHBOARD_WIDTH.saturating_sub(rule_line_len);\n        println!(\n            \"{}     Rule: {} cannot import from {}{}\",\n            BOX_VERTICAL,\n            v.rule.from,\n            v.rule.to,\n            \" \".repeat(rule_padding)\n        );\n\n        if i \u003c violations.len() - 1 {\n            println!(\n                \"{}{}\",\n                BOX_VERTICAL,\n                \" \".repeat(DASHBOARD_WIDTH.saturating_sub(1))\n            );\n        }\n    }\n\n    print_horizontal_line(BOX_BOTTOM_LEFT, BOX_BOTTOM_RIGHT, BOX_HORIZONTAL);\n}\n\n/// Print a horizontal line\nfn print_horizontal_line(left: \u0026str, right: \u0026str, fill: \u0026str) {\n    let middle = fill.repeat(DASHBOARD_WIDTH - 2);\n    println!(\"{}{}{}\", left, middle, right);\n}\n\n/// Print a centered line\nfn print_centered_line(text: \u0026str) {\n    let padding = (DASHBOARD_WIDTH - 2 - text.len()) / 2;\n    let extra = (DASHBOARD_WIDTH - 2 - text.len()) % 2;\n    println!(\n        \"{}{}{}{}{}{}\",\n        BOX_VERTICAL,\n        \" \".repeat(padding),\n        text,\n        \" \".repeat(padding + extra),\n        \"\",\n        BOX_VERTICAL\n    );\n}\n\n/// Print an info line with label and value\nfn print_info_line(label: \u0026str, value: \u0026str) {\n    let content_len = label.len() + 1 + value.len();\n    let padding = DASHBOARD_WIDTH - 2 - content_len;\n    println!(\n        \"{}  {} {}{}{}\",\n        BOX_VERTICAL,\n        label,\n        value,\n        \" \".repeat(padding),\n        BOX_VERTICAL\n    );\n}\n\n/// Print a summary message\npub fn print_summary(result: \u0026AnalysisResult) {\n    println!();\n\n    if result.has_critical_issues() {\n        let score = result.health_score.as_ref().map(|s| s.total).unwrap_or(0);\n        println!(\n            \"❌ Architecture Health: {}/100 - Critical issues found\",\n            score\n        );\n        println!();\n        println!(\"💡 Fix the blocked violations and circular dependencies to improve your score.\");\n    } else {\n        let score = result.health_score.as_ref().map(|s| s.total).unwrap_or(100);\n        let grade = result\n            .health_score\n            .as_ref()\n            .map(|s| s.grade)\n            .unwrap_or(HealthGrade::A);\n\n        if score \u003e= 90 {\n            println!(\n                \"✨ Architecture Health: {}/100 ({}) - Excellent!\",\n                score,\n                grade.as_str()\n            );\n        } else if score \u003e= 70 {\n            println!(\n                \"✓ Architecture Health: {}/100 ({}) - Good\",\n                score,\n                grade.as_str()\n            );\n        } else {\n            println!(\n                \"⚠ Architecture Health: {}/100 ({}) - Needs improvement\",\n                score,\n                grade.as_str()\n            );\n        }\n    }\n}\n","traces":[{"line":192,"address":[24348254,24348240],"length":1,"stats":{"Line":0}},{"line":196,"address":[24348192,24348206],"length":1,"stats":{"Line":0}},{"line":286,"address":[24348144,24348149],"length":1,"stats":{"Line":0}},{"line":294,"address":[24348181,24348176],"length":1,"stats":{"Line":0}},{"line":298,"address":[24348160,24348165],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","output","mod.rs"],"content":"//! Output module for Architect Linter v4.0\n//!\n//! This module provides visual dashboard rendering and report generation.\n\npub mod dashboard;\n\npub use dashboard::print_dashboard;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","go.rs"],"content":"//! Go parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct GoParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl GoParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_go::language())\n            .expect(\"Failed to load Go grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (Go-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        if normalized_path.contains(\u0026normalized_pattern) {\n            return true;\n        }\n\n        // Go imports are package paths: github.com/user/repo/pkg\n        // Check if import ends with pattern folder\n        if let Some(last_segment) = normalized_path.split('/').last() {\n            if let Some(pattern_last) = normalized_pattern.split('/').last() {\n                if last_segment.contains(pattern_last) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for GoParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse Go\"))?;\n\n        // Query for import declarations\n        // Go has both single and grouped imports\n        let query_source = r#\"\n            [\n              (import_declaration\n                (import_spec\n                  path: (interpreted_string_literal) @import_path))\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_go::language(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path_raw = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n\n                // Remove quotes from Go string literal\n                let import_path = import_path_raw.trim_matches('\"');\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"import_spec\" || p.kind() == \"import_declaration\" {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"import \\\"{}\\\"\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // Go-specific rules\n            // Example: handlers shouldn't import database directly\n            if file_path_str.contains(\"handlers\") \u0026\u0026 import.source.contains(\"database\") {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"handlers\".to_string(),\n                        to: \"database\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[24800976,24801254,24801260],"length":1,"stats":{"Line":3}},{"line":17,"address":[24800990],"length":1,"stats":{"Line":3}},{"line":19,"address":[24801067,24801014],"length":1,"stats":{"Line":6}},{"line":23,"address":[24801191],"length":1,"stats":{"Line":3}},{"line":28,"address":[24800954,24799472,24800948],"length":1,"stats":{"Line":0}},{"line":29,"address":[24799536],"length":1,"stats":{"Line":0}},{"line":30,"address":[24799795,24800062,24799923],"length":1,"stats":{"Line":0}},{"line":36,"address":[24800365],"length":1,"stats":{"Line":0}},{"line":37,"address":[24800450],"length":1,"stats":{"Line":0}},{"line":42,"address":[24800433,24800473],"length":1,"stats":{"Line":0}},{"line":43,"address":[24800633,24800690],"length":1,"stats":{"Line":0}},{"line":44,"address":[24800846],"length":1,"stats":{"Line":0}},{"line":45,"address":[24800874],"length":1,"stats":{"Line":0}},{"line":50,"address":[24800650],"length":1,"stats":{"Line":0}},{"line":55,"address":[24796376,24792848,24796229],"length":1,"stats":{"Line":2}},{"line":56,"address":[24792962],"length":1,"stats":{"Line":2}},{"line":59,"address":[24793408,24793311,24793127],"length":1,"stats":{"Line":5}},{"line":63,"address":[24793239],"length":1,"stats":{"Line":3}},{"line":64,"address":[24348887,24348880],"length":1,"stats":{"Line":4}},{"line":68,"address":[24792935],"length":1,"stats":{"Line":2}},{"line":76,"address":[24793516,24796311],"length":1,"stats":{"Line":2}},{"line":78,"address":[24794051],"length":1,"stats":{"Line":1}},{"line":79,"address":[24794086,24794170],"length":1,"stats":{"Line":2}},{"line":81,"address":[24794252,24794456],"length":1,"stats":{"Line":4}},{"line":82,"address":[24796202,24794768,24794535],"length":1,"stats":{"Line":3}},{"line":83,"address":[24794894],"length":1,"stats":{"Line":1}},{"line":84,"address":[24794917],"length":1,"stats":{"Line":1}},{"line":87,"address":[24795145],"length":1,"stats":{"Line":1}},{"line":88,"address":[24795289,24795203],"length":1,"stats":{"Line":1}},{"line":91,"address":[24795262,24795309],"length":1,"stats":{"Line":2}},{"line":92,"address":[24795627,24795311],"length":1,"stats":{"Line":1}},{"line":93,"address":[24795419,24795357],"length":1,"stats":{"Line":2}},{"line":96,"address":[24795574],"length":1,"stats":{"Line":0}},{"line":99,"address":[24795648,24796004,24795386],"length":1,"stats":{"Line":2}},{"line":100,"address":[24795745,24795680],"length":1,"stats":{"Line":2}},{"line":101,"address":[24795788],"length":1,"stats":{"Line":1}},{"line":104,"address":[24795705,24795892],"length":1,"stats":{"Line":0}},{"line":107,"address":[24796095],"length":1,"stats":{"Line":1}},{"line":108,"address":[24795854],"length":1,"stats":{"Line":1}},{"line":110,"address":[24796055],"length":1,"stats":{"Line":1}},{"line":115,"address":[24794608],"length":1,"stats":{"Line":1}},{"line":118,"address":[24796416,24799440,24798559],"length":1,"stats":{"Line":1}},{"line":124,"address":[24796535],"length":1,"stats":{"Line":1}},{"line":125,"address":[24796616,24796676],"length":1,"stats":{"Line":2}},{"line":126,"address":[24796929,24796881],"length":1,"stats":{"Line":2}},{"line":128,"address":[24797305,24797103],"length":1,"stats":{"Line":2}},{"line":130,"address":[24797414,24797645],"length":1,"stats":{"Line":0}},{"line":131,"address":[24797767,24798599],"length":1,"stats":{"Line":0}},{"line":132,"address":[24798668],"length":1,"stats":{"Line":0}},{"line":134,"address":[24798783],"length":1,"stats":{"Line":0}},{"line":135,"address":[24799199],"length":1,"stats":{"Line":0}},{"line":136,"address":[24798821],"length":1,"stats":{"Line":0}},{"line":137,"address":[24798856],"length":1,"stats":{"Line":0}},{"line":138,"address":[24798919],"length":1,"stats":{"Line":0}},{"line":139,"address":[24799127],"length":1,"stats":{"Line":0}},{"line":140,"address":[24798995],"length":1,"stats":{"Line":0}},{"line":141,"address":[24799063],"length":1,"stats":{"Line":0}},{"line":143,"address":[24799191],"length":1,"stats":{"Line":0}},{"line":150,"address":[24797801,24797913],"length":1,"stats":{"Line":0}},{"line":151,"address":[24798375],"length":1,"stats":{"Line":0}},{"line":152,"address":[24797993],"length":1,"stats":{"Line":0}},{"line":153,"address":[24798028],"length":1,"stats":{"Line":0}},{"line":154,"address":[24798091],"length":1,"stats":{"Line":0}},{"line":155,"address":[24798303],"length":1,"stats":{"Line":0}},{"line":156,"address":[24798159],"length":1,"stats":{"Line":0}},{"line":157,"address":[24798231],"length":1,"stats":{"Line":0}},{"line":159,"address":[24798367],"length":1,"stats":{"Line":0}},{"line":164,"address":[24797471],"length":1,"stats":{"Line":1}}],"covered":35,"coverable":68},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","java.rs"],"content":"//! Java parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct JavaParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl JavaParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_java::language())\n            .expect(\"Failed to load Java grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (Java-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        if normalized_path.contains(\u0026normalized_pattern) {\n            return true;\n        }\n\n        // Java uses dot notation: com.example.package.ClassName\n        // Convert between dots and slashes for matching\n        let path_with_dots = normalized_path.replace('/', \".\");\n        let pattern_with_dots = normalized_pattern.replace('/', \".\");\n\n        if path_with_dots.contains(\u0026pattern_with_dots) {\n            return true;\n        }\n\n        // Check if import ends with pattern folder\n        if let Some(last_segment) = path_with_dots.split('.').last() {\n            if let Some(pattern_last) = pattern_with_dots.split('.').last() {\n                if last_segment.contains(pattern_last) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for JavaParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse Java\"))?;\n\n        // Query for import declarations\n        let query_source = r#\"\n            [\n              (import_declaration\n                (scoped_identifier) @import_path)\n              (import_declaration\n                (identifier) @import_path)\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_java::language(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"import_declaration\" {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"import {};\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // Java-specific rules\n            // Example: Controllers shouldn't import Repositories directly\n            if file_path_str.contains(\"controller\")\n                \u0026\u0026 (import.source.to_lowercase().contains(\"repository\")\n                    || import.source.to_lowercase().contains(\".repo.\"))\n            {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"controller\".to_string(),\n                        to: \"repository\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[24220880,24221158,24221164],"length":1,"stats":{"Line":1}},{"line":17,"address":[24220894],"length":1,"stats":{"Line":1}},{"line":19,"address":[24220918,24220971],"length":1,"stats":{"Line":2}},{"line":23,"address":[24221095],"length":1,"stats":{"Line":1}},{"line":28,"address":[24220863,24220841,24218944],"length":1,"stats":{"Line":1}},{"line":29,"address":[24219008],"length":1,"stats":{"Line":1}},{"line":30,"address":[24219534,24219395,24219267],"length":1,"stats":{"Line":3}},{"line":36,"address":[24219843],"length":1,"stats":{"Line":1}},{"line":37,"address":[24219952],"length":1,"stats":{"Line":1}},{"line":42,"address":[24219981,24219929],"length":1,"stats":{"Line":2}},{"line":43,"address":[24220109,24220026],"length":1,"stats":{"Line":2}},{"line":45,"address":[24220154,24220225],"length":1,"stats":{"Line":2}},{"line":46,"address":[24220283],"length":1,"stats":{"Line":1}},{"line":50,"address":[24220266,24220306],"length":1,"stats":{"Line":0}},{"line":51,"address":[24220523,24220466],"length":1,"stats":{"Line":0}},{"line":52,"address":[24220679],"length":1,"stats":{"Line":0}},{"line":53,"address":[24220707],"length":1,"stats":{"Line":0}},{"line":58,"address":[24220483],"length":1,"stats":{"Line":0}},{"line":63,"address":[24212096,24215451,24215304],"length":1,"stats":{"Line":1}},{"line":64,"address":[24212210],"length":1,"stats":{"Line":1}},{"line":67,"address":[24212559,24212656,24212375],"length":1,"stats":{"Line":2}},{"line":71,"address":[24212487],"length":1,"stats":{"Line":1}},{"line":72,"address":[24212640,24212516,24212419,24215432,24212701],"length":1,"stats":{"Line":3}},{"line":75,"address":[24212183],"length":1,"stats":{"Line":1}},{"line":84,"address":[24215386,24212764],"length":1,"stats":{"Line":2}},{"line":86,"address":[24213299],"length":1,"stats":{"Line":1}},{"line":87,"address":[24213418,24213334],"length":1,"stats":{"Line":2}},{"line":89,"address":[24213500,24213704],"length":1,"stats":{"Line":4}},{"line":90,"address":[24214004,24213783,24215277],"length":1,"stats":{"Line":8}},{"line":91,"address":[24214124],"length":1,"stats":{"Line":3}},{"line":92,"address":[24214147],"length":1,"stats":{"Line":3}},{"line":93,"address":[24214379,24214465],"length":1,"stats":{"Line":3}},{"line":96,"address":[24214485,24214438],"length":1,"stats":{"Line":6}},{"line":97,"address":[24214487,24214704],"length":1,"stats":{"Line":3}},{"line":98,"address":[24214533,24214595],"length":1,"stats":{"Line":3}},{"line":101,"address":[24214651],"length":1,"stats":{"Line":0}},{"line":104,"address":[24214562,24214725,24215079],"length":1,"stats":{"Line":3}},{"line":105,"address":[24214822,24214757],"length":1,"stats":{"Line":2}},{"line":106,"address":[24214865],"length":1,"stats":{"Line":2}},{"line":109,"address":[24214782,24214969],"length":1,"stats":{"Line":0}},{"line":112,"address":[24215170],"length":1,"stats":{"Line":2}},{"line":113,"address":[24214931],"length":1,"stats":{"Line":1}},{"line":115,"address":[24215130],"length":1,"stats":{"Line":1}},{"line":120,"address":[24213850],"length":1,"stats":{"Line":1}},{"line":123,"address":[24215488,24218898,24217470],"length":1,"stats":{"Line":1}},{"line":129,"address":[24215607],"length":1,"stats":{"Line":1}},{"line":130,"address":[24215748,24215688],"length":1,"stats":{"Line":2}},{"line":131,"address":[24216001,24215953],"length":1,"stats":{"Line":2}},{"line":133,"address":[24216175,24216377],"length":1,"stats":{"Line":2}},{"line":135,"address":[24216717,24216486],"length":1,"stats":{"Line":2}},{"line":136,"address":[24216839,24218057],"length":1,"stats":{"Line":2}},{"line":137,"address":[24218126],"length":1,"stats":{"Line":1}},{"line":139,"address":[24218241],"length":1,"stats":{"Line":1}},{"line":140,"address":[24218657],"length":1,"stats":{"Line":1}},{"line":141,"address":[24218279],"length":1,"stats":{"Line":1}},{"line":142,"address":[24218314],"length":1,"stats":{"Line":1}},{"line":143,"address":[24218377],"length":1,"stats":{"Line":1}},{"line":144,"address":[24218585],"length":1,"stats":{"Line":1}},{"line":145,"address":[24218453],"length":1,"stats":{"Line":1}},{"line":146,"address":[24218521],"length":1,"stats":{"Line":1}},{"line":148,"address":[24218649],"length":1,"stats":{"Line":1}},{"line":155,"address":[24216873],"length":1,"stats":{"Line":1}},{"line":156,"address":[24216985],"length":1,"stats":{"Line":1}},{"line":157,"address":[24217226],"length":1,"stats":{"Line":0}},{"line":159,"address":[24217839],"length":1,"stats":{"Line":1}},{"line":160,"address":[24217451],"length":1,"stats":{"Line":1}},{"line":161,"address":[24217492],"length":1,"stats":{"Line":1}},{"line":162,"address":[24217555],"length":1,"stats":{"Line":1}},{"line":163,"address":[24217767],"length":1,"stats":{"Line":1}},{"line":164,"address":[24217623],"length":1,"stats":{"Line":1}},{"line":165,"address":[24217695],"length":1,"stats":{"Line":1}},{"line":167,"address":[24217831],"length":1,"stats":{"Line":1}},{"line":172,"address":[24216543],"length":1,"stats":{"Line":1}}],"covered":65,"coverable":73},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","mod.rs"],"content":"//! Parsers module - Multi-language parsing abstraction using Tree-sitter\n//!\n//! This module provides a unified interface for parsing source code across\n//! different programming languages using Tree-sitter.\n\nuse crate::autofix::Violation;\nuse crate::config::LinterContext;\nuse miette::Result;\nuse std::path::Path;\n\npub mod go;\npub mod java;\npub mod php;\npub mod python;\npub mod typescript;\npub mod typescript_pure;\n\n// Re-export pure functions for easier access in tests\npub use typescript_pure::{\n    count_imports_matching,\n    create_violation,\n    extract_folder_from_pattern,\n    extract_imports_from_tree,\n    filter_imports_by_pattern,\n    find_violations_in_imports,\n    generate_import_patterns,\n    has_import_matching,\n    is_controller_to_repository_violation,\n    matches_forbidden_rule,\n    matches_pattern,\n    normalize_path,\n    normalize_pattern,\n    Import as PureImport,\n};\n\n/// Represents an import statement extracted from source code\n#[derive(Debug, Clone)]\npub struct Import {\n    /// The import source/path (e.g., \"../services/user\", \"apps.user.models\")\n    pub source: String,\n    /// Line number where the import appears\n    pub line_number: usize,\n    /// Full import statement text\n    pub raw_statement: String,\n}\n\n/// Language identifier\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum Language {\n    TypeScript,\n    JavaScript,\n    Python,\n    Go,\n    Rust,\n    Php,\n    Java,\n}\n\nimpl Language {\n    /// Get language from file extension\n    pub fn from_extension(ext: \u0026str) -\u003e Option\u003cSelf\u003e {\n        match ext {\n            \"ts\" | \"tsx\" =\u003e Some(Language::TypeScript),\n            \"js\" | \"jsx\" =\u003e Some(Language::JavaScript),\n            \"py\" =\u003e Some(Language::Python),\n            \"go\" =\u003e Some(Language::Go),\n            \"rs\" =\u003e Some(Language::Rust),\n            \"php\" =\u003e Some(Language::Php),\n            \"java\" =\u003e Some(Language::Java),\n            _ =\u003e None,\n        }\n    }\n\n    /// Get file extensions for this language\n    pub fn extensions(\u0026self) -\u003e \u0026'static [\u0026'static str] {\n        match self {\n            Language::TypeScript =\u003e \u0026[\"ts\", \"tsx\"],\n            Language::JavaScript =\u003e \u0026[\"js\", \"jsx\"],\n            Language::Python =\u003e \u0026[\"py\"],\n            Language::Go =\u003e \u0026[\"go\"],\n            Language::Rust =\u003e \u0026[\"rs\"],\n            Language::Php =\u003e \u0026[\"php\"],\n            Language::Java =\u003e \u0026[\"java\"],\n        }\n    }\n}\n\n/// Main trait for language parsers\n///\n/// Implementations of this trait provide language-specific parsing logic\n/// using Tree-sitter to extract imports and detect architectural violations.\npub trait ArchitectParser: Send + Sync {\n    /// Extract all imports from source code\n    fn extract_imports(\u0026self, source_code: \u0026str, file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e;\n\n    /// Find architectural violations in a file\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e;\n}\n\n/// Factory function to get appropriate parser for a file\npub fn get_parser_for_file(file_path: \u0026Path) -\u003e Option\u003cBox\u003cdyn ArchitectParser\u003e\u003e {\n    let ext = file_path.extension()?.to_str()?;\n    let lang = Language::from_extension(ext)?;\n\n    match lang {\n        Language::TypeScript | Language::JavaScript =\u003e {\n            Some(Box::new(typescript::TypeScriptParser::new()))\n        }\n        Language::Python =\u003e Some(Box::new(python::PythonParser::new())),\n        Language::Go =\u003e Some(Box::new(go::GoParser::new())),\n        Language::Php =\u003e Some(Box::new(php::PhpParser::new())),\n        Language::Java =\u003e Some(Box::new(java::JavaParser::new())),\n        Language::Rust =\u003e {\n            // Rust support coming soon\n            None\n        }\n    }\n}\n\n/// Get all supported languages\npub fn supported_languages() -\u003e Vec\u003cLanguage\u003e {\n    vec![\n        Language::TypeScript,\n        Language::JavaScript,\n        Language::Python,\n        Language::Go,\n        Language::Php,\n        Language::Java,\n    ]\n}\n\n/// Get all supported file extensions\npub fn supported_extensions() -\u003e Vec\u003c\u0026'static str\u003e {\n    let mut extensions = Vec::new();\n    for lang in supported_languages() {\n        extensions.extend_from_slice(lang.extensions());\n    }\n    extensions\n}\n","traces":[{"line":61,"address":[25147520],"length":1,"stats":{"Line":8}},{"line":63,"address":[25147543],"length":1,"stats":{"Line":8}},{"line":64,"address":[25147615],"length":1,"stats":{"Line":6}},{"line":65,"address":[25147687,25147740],"length":1,"stats":{"Line":6}},{"line":66,"address":[25147782,25147717],"length":1,"stats":{"Line":5}},{"line":67,"address":[25147821,25147759],"length":1,"stats":{"Line":3}},{"line":68,"address":[25147860,25147798],"length":1,"stats":{"Line":4}},{"line":69,"address":[25147837,25147874],"length":1,"stats":{"Line":3}},{"line":70,"address":[25147867],"length":1,"stats":{"Line":1}},{"line":75,"address":[25147296],"length":1,"stats":{"Line":0}},{"line":76,"address":[25147494,25147301],"length":1,"stats":{"Line":0}},{"line":77,"address":[25147332],"length":1,"stats":{"Line":0}},{"line":78,"address":[25147358],"length":1,"stats":{"Line":0}},{"line":79,"address":[25147381],"length":1,"stats":{"Line":0}},{"line":80,"address":[25147404],"length":1,"stats":{"Line":0}},{"line":81,"address":[25147427],"length":1,"stats":{"Line":0}},{"line":82,"address":[25147450],"length":1,"stats":{"Line":0}},{"line":83,"address":[25147473],"length":1,"stats":{"Line":0}},{"line":106,"address":[25146128],"length":1,"stats":{"Line":8}},{"line":107,"address":[25146151],"length":1,"stats":{"Line":8}},{"line":108,"address":[25146356],"length":1,"stats":{"Line":8}},{"line":110,"address":[25146449],"length":1,"stats":{"Line":2}},{"line":112,"address":[25146460],"length":1,"stats":{"Line":3}},{"line":114,"address":[25146504],"length":1,"stats":{"Line":1}},{"line":115,"address":[25146548],"length":1,"stats":{"Line":1}},{"line":116,"address":[25146600],"length":1,"stats":{"Line":1}},{"line":117,"address":[25146641],"length":1,"stats":{"Line":1}},{"line":120,"address":[25146589],"length":1,"stats":{"Line":0}},{"line":126,"address":[25146704],"length":1,"stats":{"Line":0}},{"line":127,"address":[25146717,25146845],"length":1,"stats":{"Line":0}},{"line":138,"address":[25147273,25147267,25146864],"length":1,"stats":{"Line":0}},{"line":139,"address":[25146881],"length":1,"stats":{"Line":0}},{"line":140,"address":[25146895,25146952,25147096],"length":1,"stats":{"Line":0}},{"line":141,"address":[25147144,25147246],"length":1,"stats":{"Line":0}},{"line":143,"address":[25147202],"length":1,"stats":{"Line":0}}],"covered":18,"coverable":35},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","php.rs"],"content":"//! PHP parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct PhpParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl PhpParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_php::language_php())\n            .expect(\"Failed to load PHP grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (PHP-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        if normalized_path.contains(\u0026normalized_pattern) {\n            return true;\n        }\n\n        // PHP uses namespaces with backslashes: App\\Controllers\\UserController\n        // Also handle PSR-4 autoloading paths\n        let path_with_backslash = normalized_path.replace('/', \"\\\\\");\n        if path_with_backslash.contains(\u0026normalized_pattern.replace('/', \"\\\\\")) {\n            return true;\n        }\n\n        // Check if import contains pattern folder\n        if let Some(last_segment) = normalized_path.split(\u0026['/', '\\\\']).last() {\n            if let Some(pattern_last) = normalized_pattern.split(\u0026['/', '\\\\']).last() {\n                if last_segment.contains(pattern_last) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for PhpParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse PHP\"))?;\n\n        // Query for use declarations and require/include statements\n        let query_source = r#\"\n            [\n              (namespace_use_declaration\n                (namespace_use_clause\n                  (qualified_name) @import_path))\n              (require_expression\n                (string) @import_path)\n              (require_once_expression\n                (string) @import_path)\n              (include_expression\n                (string) @import_path)\n              (include_once_expression\n                (string) @import_path)\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_php::language_php(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path_raw = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n\n                // Remove quotes from string literals (for require/include)\n                let import_path = import_path_raw.trim_matches('\"').trim_matches('\\'');\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"namespace_use_declaration\"\n                        || p.kind() == \"require_expression\"\n                        || p.kind() == \"require_once_expression\"\n                        || p.kind() == \"include_expression\"\n                        || p.kind() == \"include_once_expression\"\n                    {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"use {};\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // PHP-specific rules\n            // Example: Controllers shouldn't import Models directly\n            if file_path_str.contains(\"controller\")\n                \u0026\u0026 import.source.to_lowercase().contains(\"model\")\n            {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"controller\".to_string(),\n                        to: \"model\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[24628172,24628166,24627888],"length":1,"stats":{"Line":1}},{"line":17,"address":[24627902],"length":1,"stats":{"Line":1}},{"line":19,"address":[24627979,24627926],"length":1,"stats":{"Line":2}},{"line":23,"address":[24628103],"length":1,"stats":{"Line":1}},{"line":28,"address":[24627875,24627853,24625920],"length":1,"stats":{"Line":1}},{"line":29,"address":[24625984],"length":1,"stats":{"Line":1}},{"line":30,"address":[24626371,24626510,24626243],"length":1,"stats":{"Line":3}},{"line":36,"address":[24626819],"length":1,"stats":{"Line":1}},{"line":37,"address":[24626928],"length":1,"stats":{"Line":1}},{"line":42,"address":[24626957,24626905],"length":1,"stats":{"Line":0}},{"line":43,"address":[24627002,24627103],"length":1,"stats":{"Line":0}},{"line":44,"address":[24627824],"length":1,"stats":{"Line":0}},{"line":48,"address":[24627315],"length":1,"stats":{"Line":0}},{"line":49,"address":[24627504,24627561],"length":1,"stats":{"Line":0}},{"line":50,"address":[24627719],"length":1,"stats":{"Line":0}},{"line":51,"address":[24627747],"length":1,"stats":{"Line":0}},{"line":56,"address":[24627521],"length":1,"stats":{"Line":0}},{"line":61,"address":[24622511,24622658,24618736],"length":1,"stats":{"Line":1}},{"line":62,"address":[24618850],"length":1,"stats":{"Line":1}},{"line":65,"address":[24619199,24619296,24619015],"length":1,"stats":{"Line":2}},{"line":69,"address":[24619127],"length":1,"stats":{"Line":1}},{"line":70,"address":[24368160,24368167],"length":1,"stats":{"Line":2}},{"line":73,"address":[24618823],"length":1,"stats":{"Line":1}},{"line":89,"address":[24622593,24619404],"length":1,"stats":{"Line":2}},{"line":91,"address":[24619939],"length":1,"stats":{"Line":3}},{"line":92,"address":[24619974,24620058],"length":1,"stats":{"Line":5}},{"line":94,"address":[24620140,24620344],"length":1,"stats":{"Line":6}},{"line":95,"address":[24620656,24620423,24622484],"length":1,"stats":{"Line":7}},{"line":96,"address":[24620782],"length":1,"stats":{"Line":3}},{"line":97,"address":[24620805],"length":1,"stats":{"Line":1}},{"line":100,"address":[24621033],"length":1,"stats":{"Line":1}},{"line":101,"address":[24621145,24621243],"length":1,"stats":{"Line":1}},{"line":104,"address":[24621263,24621216],"length":1,"stats":{"Line":2}},{"line":105,"address":[24621908,24621265],"length":1,"stats":{"Line":3}},{"line":106,"address":[24621311,24621385],"length":1,"stats":{"Line":2}},{"line":107,"address":[24621447],"length":1,"stats":{"Line":2}},{"line":108,"address":[24621558],"length":1,"stats":{"Line":3}},{"line":109,"address":[24621657],"length":1,"stats":{"Line":3}},{"line":110,"address":[24621756],"length":1,"stats":{"Line":3}},{"line":114,"address":[24621855],"length":1,"stats":{"Line":2}},{"line":117,"address":[24621346,24622283,24621929],"length":1,"stats":{"Line":3}},{"line":118,"address":[24622026,24621961],"length":1,"stats":{"Line":3}},{"line":119,"address":[24622069],"length":1,"stats":{"Line":2}},{"line":122,"address":[24621986,24622173],"length":1,"stats":{"Line":0}},{"line":125,"address":[24622377],"length":1,"stats":{"Line":1}},{"line":126,"address":[24622135],"length":1,"stats":{"Line":1}},{"line":128,"address":[24622337],"length":1,"stats":{"Line":2}},{"line":133,"address":[24620496],"length":1,"stats":{"Line":2}},{"line":136,"address":[24624998,24622704,24625879],"length":1,"stats":{"Line":1}},{"line":142,"address":[24622823],"length":1,"stats":{"Line":1}},{"line":143,"address":[24622964,24622904],"length":1,"stats":{"Line":2}},{"line":144,"address":[24623217,24623169],"length":1,"stats":{"Line":2}},{"line":146,"address":[24623391,24623593],"length":1,"stats":{"Line":2}},{"line":148,"address":[24623933,24623702],"length":1,"stats":{"Line":2}},{"line":149,"address":[24624055,24625038],"length":1,"stats":{"Line":2}},{"line":150,"address":[24625107],"length":1,"stats":{"Line":1}},{"line":152,"address":[24625222],"length":1,"stats":{"Line":1}},{"line":153,"address":[24625638],"length":1,"stats":{"Line":1}},{"line":154,"address":[24625260],"length":1,"stats":{"Line":1}},{"line":155,"address":[24625295],"length":1,"stats":{"Line":1}},{"line":156,"address":[24625358],"length":1,"stats":{"Line":1}},{"line":157,"address":[24625566],"length":1,"stats":{"Line":1}},{"line":158,"address":[24625434],"length":1,"stats":{"Line":1}},{"line":159,"address":[24625502],"length":1,"stats":{"Line":1}},{"line":161,"address":[24625630],"length":1,"stats":{"Line":1}},{"line":168,"address":[24624089],"length":1,"stats":{"Line":1}},{"line":169,"address":[24624201],"length":1,"stats":{"Line":0}},{"line":171,"address":[24624814],"length":1,"stats":{"Line":0}},{"line":172,"address":[24624432],"length":1,"stats":{"Line":0}},{"line":173,"address":[24624467],"length":1,"stats":{"Line":0}},{"line":174,"address":[24624530],"length":1,"stats":{"Line":0}},{"line":175,"address":[24624742],"length":1,"stats":{"Line":0}},{"line":176,"address":[24624598],"length":1,"stats":{"Line":0}},{"line":177,"address":[24624670],"length":1,"stats":{"Line":0}},{"line":179,"address":[24624806],"length":1,"stats":{"Line":0}},{"line":184,"address":[24623759],"length":1,"stats":{"Line":1}}],"covered":58,"coverable":76},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","python.rs"],"content":"//! Python parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct PythonParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl PythonParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_python::language())\n            .expect(\"Failed to load Python grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (Python-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        // Python imports use dots: apps.user.models\n        // Convert to path-like for matching: apps/user/models\n        let path_as_dots = normalized_path.replace('/', \".\");\n        let pattern_as_dots = normalized_pattern.replace('/', \".\");\n\n        if path_as_dots.contains(\u0026pattern_as_dots) || normalized_path.contains(\u0026normalized_pattern)\n        {\n            return true;\n        }\n\n        // Check if import contains pattern folder\n        if pattern_as_dots.contains('.') {\n            let parts: Vec\u003c\u0026str\u003e = pattern_as_dots.split('.').collect();\n            for part in parts {\n                if !part.is_empty() \u0026\u0026 path_as_dots.contains(part) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for PythonParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse Python\"))?;\n\n        // Query for different types of imports\n        // 1. import x.y.z\n        // 2. from x.y import z\n        let query_source = r#\"\n            [\n              (import_statement\n                name: (dotted_name) @import_path)\n              (import_from_statement\n                module_name: (dotted_name) @import_path)\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_python::language(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"import_statement\" || p.kind() == \"import_from_statement\" {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"import {}\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // Python-specific rules (similar to Controller → Repository in TS)\n            // Example: views shouldn't import models directly\n            if file_path_str.contains(\"views\") \u0026\u0026 import.source.contains(\"models\") {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"views\".to_string(),\n                        to: \"models\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[25074326,25074332,25074048],"length":1,"stats":{"Line":1}},{"line":17,"address":[25074062],"length":1,"stats":{"Line":1}},{"line":19,"address":[25074139,25074086],"length":1,"stats":{"Line":2}},{"line":23,"address":[25074263],"length":1,"stats":{"Line":1}},{"line":28,"address":[25071936,25073967,25074030],"length":1,"stats":{"Line":1}},{"line":29,"address":[25072000],"length":1,"stats":{"Line":2}},{"line":30,"address":[25072259,25072387,25072526],"length":1,"stats":{"Line":3}},{"line":38,"address":[25072835],"length":1,"stats":{"Line":1}},{"line":39,"address":[25072919,25073002],"length":1,"stats":{"Line":3}},{"line":41,"address":[25073130,25073223,25073047],"length":1,"stats":{"Line":3}},{"line":43,"address":[25073197],"length":1,"stats":{"Line":1}},{"line":47,"address":[25073264],"length":1,"stats":{"Line":1}},{"line":48,"address":[25073359],"length":1,"stats":{"Line":1}},{"line":49,"address":[25073643,25073437],"length":1,"stats":{"Line":2}},{"line":50,"address":[25073838,25073732],"length":1,"stats":{"Line":2}},{"line":51,"address":[25073921],"length":1,"stats":{"Line":1}},{"line":56,"address":[25073321],"length":1,"stats":{"Line":1}},{"line":61,"address":[25068840,25068693,25065360],"length":1,"stats":{"Line":1}},{"line":62,"address":[25065474],"length":1,"stats":{"Line":1}},{"line":65,"address":[25065639,25065823,25065920],"length":1,"stats":{"Line":3}},{"line":69,"address":[25065751],"length":1,"stats":{"Line":2}},{"line":70,"address":[24577111,24577104],"length":1,"stats":{"Line":2}},{"line":75,"address":[25065447],"length":1,"stats":{"Line":1}},{"line":84,"address":[25066028,25068775],"length":1,"stats":{"Line":4}},{"line":86,"address":[25066563],"length":1,"stats":{"Line":1}},{"line":87,"address":[25066598,25066682],"length":1,"stats":{"Line":5}},{"line":89,"address":[25066764,25066968],"length":1,"stats":{"Line":5}},{"line":90,"address":[25068666,25067047,25067280],"length":1,"stats":{"Line":10}},{"line":91,"address":[25067406],"length":1,"stats":{"Line":3}},{"line":92,"address":[25067429],"length":1,"stats":{"Line":4}},{"line":93,"address":[25067753,25067667],"length":1,"stats":{"Line":4}},{"line":96,"address":[25067773,25067726],"length":1,"stats":{"Line":2}},{"line":97,"address":[25068091,25067775],"length":1,"stats":{"Line":1}},{"line":98,"address":[25067821,25067883],"length":1,"stats":{"Line":2}},{"line":101,"address":[25068038],"length":1,"stats":{"Line":0}},{"line":104,"address":[25067850,25068468,25068112],"length":1,"stats":{"Line":2}},{"line":105,"address":[25068144,25068209],"length":1,"stats":{"Line":3}},{"line":106,"address":[25068252],"length":1,"stats":{"Line":2}},{"line":109,"address":[25068169,25068356],"length":1,"stats":{"Line":0}},{"line":112,"address":[25068559],"length":1,"stats":{"Line":2}},{"line":113,"address":[25068318],"length":1,"stats":{"Line":2}},{"line":115,"address":[25068519],"length":1,"stats":{"Line":2}},{"line":120,"address":[25067120],"length":1,"stats":{"Line":1}},{"line":123,"address":[25068880,25071023,25071904],"length":1,"stats":{"Line":1}},{"line":129,"address":[25068999],"length":1,"stats":{"Line":1}},{"line":130,"address":[25069140,25069080],"length":1,"stats":{"Line":2}},{"line":131,"address":[25069345,25069393],"length":1,"stats":{"Line":2}},{"line":133,"address":[25069567,25069769],"length":1,"stats":{"Line":2}},{"line":135,"address":[25069878,25070109],"length":1,"stats":{"Line":2}},{"line":136,"address":[25070231,25071063],"length":1,"stats":{"Line":2}},{"line":137,"address":[25071132],"length":1,"stats":{"Line":1}},{"line":139,"address":[25071247],"length":1,"stats":{"Line":1}},{"line":140,"address":[25071663],"length":1,"stats":{"Line":1}},{"line":141,"address":[25071285],"length":1,"stats":{"Line":1}},{"line":142,"address":[25071320],"length":1,"stats":{"Line":1}},{"line":143,"address":[25071383],"length":1,"stats":{"Line":1}},{"line":144,"address":[25071591],"length":1,"stats":{"Line":1}},{"line":145,"address":[25071459],"length":1,"stats":{"Line":1}},{"line":146,"address":[25071527],"length":1,"stats":{"Line":1}},{"line":148,"address":[25071655],"length":1,"stats":{"Line":1}},{"line":155,"address":[25070377,25070265],"length":1,"stats":{"Line":1}},{"line":156,"address":[25070839],"length":1,"stats":{"Line":0}},{"line":157,"address":[25070457],"length":1,"stats":{"Line":0}},{"line":158,"address":[25070492],"length":1,"stats":{"Line":0}},{"line":159,"address":[25070555],"length":1,"stats":{"Line":0}},{"line":160,"address":[25070767],"length":1,"stats":{"Line":0}},{"line":161,"address":[25070623],"length":1,"stats":{"Line":0}},{"line":162,"address":[25070695],"length":1,"stats":{"Line":0}},{"line":164,"address":[25070831],"length":1,"stats":{"Line":0}},{"line":169,"address":[25069935],"length":1,"stats":{"Line":1}}],"covered":60,"coverable":70},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","typescript.rs"],"content":"//! TypeScript/JavaScript parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::LinterContext;\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\n// Import pure functions for unit testing\nuse super::typescript_pure;\n\npub struct TypeScriptParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl TypeScriptParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_typescript::language_typescript())\n            .expect(\"Failed to load TypeScript grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n}\n\nimpl ArchitectParser for TypeScriptParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse TypeScript\"))?;\n\n        // Use the pure function to extract imports from the AST\n        let pure_imports = typescript_pure::extract_imports_from_tree(\n            \u0026tree,\n            source_code,\n        )?;\n\n        // Convert pure module Import type to parser Import type\n        let imports = pure_imports\n            .into_iter()\n            .map(|pure_import| Import {\n                source: pure_import.source,\n                line_number: pure_import.line_number,\n                raw_statement: pure_import.raw_statement,\n            })\n            .collect();\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        // Extract imports using the parser\n        let imports = self.extract_imports(source_code, file_path)?;\n\n        // Convert parser Import type to pure module Import type\n        let pure_imports: Vec\u003ctypescript_pure::Import\u003e = imports\n            .iter()\n            .map(|import| typescript_pure::Import {\n                source: import.source.clone(),\n                line_number: import.line_number,\n                raw_statement: import.raw_statement.clone(),\n            })\n            .collect();\n\n        // Use the pure function to find violations\n        let violations = typescript_pure::find_violations_in_imports(\n            file_path,\n            source_code,\n            \u0026pure_imports,\n            context,\n        );\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":19,"address":[25443008,25443286,25443292],"length":1,"stats":{"Line":3}},{"line":20,"address":[25443022],"length":1,"stats":{"Line":3}},{"line":22,"address":[25443046,25443099],"length":1,"stats":{"Line":6}},{"line":26,"address":[25443223],"length":1,"stats":{"Line":3}},{"line":32,"address":[25442274,25442301,25441376],"length":1,"stats":{"Line":3}},{"line":34,"address":[25441509,25441443,25441710,25441640],"length":1,"stats":{"Line":4}},{"line":38,"address":[25441586],"length":1,"stats":{"Line":1}},{"line":39,"address":[25441609,25441530,25441697,25441749,25442314],"length":1,"stats":{"Line":4}},{"line":48,"address":[25442018],"length":1,"stats":{"Line":2}},{"line":50,"address":[24891041,24890976],"length":1,"stats":{"Line":4}},{"line":51,"address":[24890984],"length":1,"stats":{"Line":1}},{"line":52,"address":[24891010],"length":1,"stats":{"Line":1}},{"line":53,"address":[24891014],"length":1,"stats":{"Line":1}},{"line":57,"address":[25442185],"length":1,"stats":{"Line":2}},{"line":60,"address":[25442336,25442989,25442995],"length":1,"stats":{"Line":1}},{"line":67,"address":[25442432],"length":1,"stats":{"Line":1}},{"line":70,"address":[25442608],"length":1,"stats":{"Line":1}},{"line":72,"address":[24891104,24891237,24891299,24891305],"length":1,"stats":{"Line":3}},{"line":73,"address":[24891140],"length":1,"stats":{"Line":1}},{"line":74,"address":[24891169],"length":1,"stats":{"Line":1}},{"line":75,"address":[24891178],"length":1,"stats":{"Line":1}},{"line":83,"address":[25442772],"length":1,"stats":{"Line":1}},{"line":87,"address":[25442917],"length":1,"stats":{"Line":1}}],"covered":23,"coverable":23},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","typescript_pure.rs"],"content":"//! Pure functions for TypeScript parser\n//!\n//! This module contains pure functions that can be unit tested independently\n//! of the Tree-sitter parser and file I/O operations.\n\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::IntoDiagnostic;\nuse std::path::Path;\nuse tree_sitter::{Query, QueryCursor, Tree};\n\n/// Represents an import statement extracted from source code\n#[derive(Debug, Clone, PartialEq)]\npub struct Import {\n    /// The import source/path (e.g., \"../services/user\", \"apps/user/models\")\n    pub source: String,\n    /// Line number where the import appears\n    pub line_number: usize,\n    /// Full import statement text\n    pub raw_statement: String,\n}\n\n/// Extract imports from a parsed Tree-sitter tree\n///\n/// This is a pure function that operates on the already-parsed tree,\n/// making it easier to test without needing to set up the full parser.\n///\n/// # Arguments\n/// * `tree` - The parsed Tree-sitter tree\n/// * `source_code` - The source code text (needed for extracting text content)\n///\n/// # Returns\n/// A vector of Import objects extracted from the tree\n///\n/// # Examples\n/// ```\n/// // This would be tested indirectly through the main parser tests\n/// // as it requires a valid Tree-sitter tree\n/// ```\npub fn extract_imports_from_tree(tree: \u0026Tree, source_code: \u0026str) -\u003e miette::Result\u003cVec\u003cImport\u003e\u003e {\n    let mut imports = Vec::new();\n\n    // Query for import declarations\n    let query_source = r#\"\n        (import_statement\n          source: (string (string_fragment) @import_path))\n    \"#;\n\n    let query = Query::new(\u0026tree_sitter_typescript::language_typescript(), query_source)\n        .into_diagnostic()?;\n\n    let mut cursor = QueryCursor::new();\n    let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n    for match_ in matches {\n        for capture in match_.captures {\n            let node = capture.node;\n            let import_path = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n            let line_number = node.start_position().row + 1;\n\n            // Get the full import statement\n            let parent = node.parent();\n            let raw_statement = if let Some(p) = parent {\n                p.utf8_text(source_code.as_bytes())\n                    .unwrap_or(import_path)\n                    .to_string()\n            } else {\n                format!(\"import ... from '{}'\", import_path)\n            };\n\n            imports.push(Import {\n                source: import_path.to_string(),\n                line_number,\n                raw_statement,\n            });\n        }\n    }\n\n    Ok(imports)\n}\n\n/// Normalize a path string for pattern matching\n///\n/// Converts Windows backslashes to forward slashes and converts to lowercase\n/// for case-insensitive matching.\n///\n/// # Arguments\n/// * `path` - The path to normalize\n///\n/// # Returns\n/// A normalized string with consistent separators and case\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::normalize_path;\n///\n/// assert_eq!(normalize_path(\"C:\\\\Project\\\\Src\\\\File.ts\"), \"c:/project/src/file.ts\");\n/// assert_eq!(normalize_path(\"src/Components/Button.tsx\"), \"src/components/button.tsx\");\n/// ```\npub fn normalize_path(path: \u0026str) -\u003e String {\n    path.to_lowercase().replace('\\\\', \"/\")\n}\n\n/// Normalize a glob pattern for pattern matching\n///\n/// Removes glob wildcards (**, *) to create a simpler pattern string.\n///\n/// # Arguments\n/// * `pattern` - The glob pattern to normalize\n///\n/// # Returns\n/// A normalized pattern string with wildcards removed\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::normalize_pattern;\n///\n/// assert_eq!(normalize_pattern(\"src/components/**\"), \"src/components/\");\n/// assert_eq!(normalize_pattern(\"**/*.tsx\"), \"/.tsx\");\n/// ```\npub fn normalize_pattern(pattern: \u0026str) -\u003e String {\n    pattern\n        .to_lowercase()\n        .replace('\\\\', \"/\")\n        .replace(\"**\", \"\")\n        .replace('*', \"\")\n}\n\n/// Extract the folder component from a pattern containing \"src/\"\n///\n/// This is used to match imports against file path patterns.\n/// For example, \"src/services/\" becomes \"services/\" for flexible matching.\n///\n/// # Arguments\n/// * `pattern` - The pattern to extract from\n///\n/// # Returns\n/// The folder component after \"src/\", or None if not found\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::extract_folder_from_pattern;\n///\n/// assert_eq!(extract_folder_from_pattern(\"src/services/\"), Some(\"services/\".to_string()));\n/// assert_eq!(extract_folder_from_pattern(\"src/components/\"), Some(\"components/\".to_string()));\n/// assert_eq!(extract_folder_from_pattern(\"lib/utils/\"), None);\n/// ```\npub fn extract_folder_from_pattern(pattern: \u0026str) -\u003e Option\u003cString\u003e {\n    let normalized = normalize_pattern(pattern);\n    if normalized.contains(\"src/\") {\n        normalized.strip_prefix(\"src/\").map(|s| s.to_string())\n    } else {\n        None\n    }\n}\n\n/// Generate alternative import patterns to check against a folder pattern\n///\n/// When matching imports against file path patterns, we need to check multiple\n/// representations because imports can be relative, absolute, or use aliases.\n///\n/// # Arguments\n/// * `folder` - The folder name to generate patterns for\n///\n/// # Returns\n/// A vector of pattern variations to check\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::generate_import_patterns;\n///\n/// let patterns = generate_import_patterns(\"services/\");\n/// assert!(patterns.contains(\u0026\"/services/\".to_string()));\n/// assert!(patterns.contains(\u0026\"../services/\".to_string()));\n/// assert!(patterns.contains(\u0026\"@/services/\".to_string()));\n/// ```\npub fn generate_import_patterns(folder: \u0026str) -\u003e Vec\u003cString\u003e {\n    vec![\n        format!(\"/{}\", folder),           // Absolute path pattern\n        format!(\"../{}\", folder),         // Relative path pattern\n        format!(\"@/{}\", folder),          // Alias pattern\n        folder.to_string(),               // Direct pattern\n    ]\n}\n\n/// Check if a path matches a given pattern\n///\n/// This performs flexible matching to handle different path formats:\n/// - Absolute paths: \"src/components/button.tsx\"\n/// - Relative imports: \"../services/userservice\"\n/// - Alias imports: \"@/services/api\"\n///\n/// # Arguments\n/// * `path` - The path to check\n/// * `pattern` - The pattern to match against\n///\n/// # Returns\n/// true if the path matches the pattern, false otherwise\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::matches_pattern;\n///\n/// // Direct containment\n/// assert!(matches_pattern(\"src/components/button.tsx\", \"src/components/\"));\n///\n/// // Relative imports\n/// assert!(matches_pattern(\"../services/userservice\", \"src/services/\"));\n///\n/// // Alias imports\n/// assert!(matches_pattern(\"@/services/api\", \"src/services/\"));\n///\n/// // Non-matching\n/// assert!(!matches_pattern(\"src/models/user.ts\", \"src/components/\"));\n/// ```\npub fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n    let normalized_path = normalize_path(path);\n    let normalized_pattern = normalize_pattern(pattern);\n\n    // Empty pattern matches nothing\n    if normalized_pattern.is_empty() {\n        return false;\n    }\n\n    // Direct containment check\n    if normalized_path.contains(\u0026normalized_pattern) {\n        return true;\n    }\n\n    // For patterns with \"src/\", extract folder and check alternatives\n    if let Some(folder_part) = extract_folder_from_pattern(pattern) {\n        // Don't match if the folder_part is empty (e.g., pattern is just \"src/\")\n        if folder_part.is_empty() || folder_part == \"/\" {\n            return false;\n        }\n\n        let import_patterns = generate_import_patterns(\u0026folder_part);\n        for import_pattern in import_patterns {\n            if normalized_path.contains(\u0026import_pattern) {\n                return true;\n            }\n        }\n    }\n\n    false\n}\n\n/// Check if a file path and import source match a forbidden rule\n///\n/// # Arguments\n/// * `file_path` - The path of the file containing the import\n/// * `import_source` - The import path being checked\n/// * `rule` - The forbidden rule to check against\n///\n/// # Returns\n/// true if the combination violates the rule, false otherwise\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::matches_forbidden_rule;\n/// use architect_linter_pro::config::ForbiddenRule;\n///\n/// let rule = ForbiddenRule {\n///     from: \"src/controller/\".to_string(),\n///     to: \"src/repository/\".to_string(),\n/// };\n///\n/// // Violation: controller importing from repository\n/// assert!(matches_forbidden_rule(\n///     \"src/controller/user.controller.ts\",\n///     \"../repository/user\",\n///     \u0026rule\n/// ));\n///\n/// // No violation: service importing from repository\n/// assert!(!matches_forbidden_rule(\n///     \"src/service/user.service.ts\",\n///     \"../repository/user\",\n///     \u0026rule\n/// ));\n/// ```\npub fn matches_forbidden_rule(\n    file_path: \u0026str,\n    import_source: \u0026str,\n    rule: \u0026ForbiddenRule,\n) -\u003e bool {\n    let file_matches = matches_pattern(file_path, \u0026rule.from);\n    let import_matches = matches_pattern(import_source, \u0026rule.to);\n\n    file_matches \u0026\u0026 import_matches\n}\n\n/// Check if a controller file imports from a repository (MVC pattern violation)\n///\n/// This is a special-case rule for common MVC architecture violations.\n/// Checks if the import path contains \"repository\" (with or without a dot prefix).\n///\n/// # Arguments\n/// * `file_path` - The path of the file to check\n/// * `import_source` - The import path being checked\n///\n/// # Returns\n/// true if this is a controller importing a repository, false otherwise\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::is_controller_to_repository_violation;\n///\n/// // Matches: ../repository/user\n/// assert!(is_controller_to_repository_violation(\n///     \"src/controller/user.controller.ts\",\n///     \"../repository/user\"\n/// ));\n///\n/// // Matches: ./user.repository\n/// assert!(is_controller_to_repository_violation(\n///     \"src/controller/user.controller.ts\",\n///     \"./user.repository\"\n/// ));\n///\n/// // Doesn't match: not a repository import\n/// assert!(!is_controller_to_repository_violation(\n///     \"src/controller/user.controller.ts\",\n///     \"../service/user\"\n/// ));\n/// ```\npub fn is_controller_to_repository_violation(file_path: \u0026str, import_source: \u0026str) -\u003e bool {\n    let normalized_file_path = normalize_path(file_path);\n    let normalized_import = normalize_path(import_source);\n\n    let is_controller = normalized_file_path.contains(\"controller\");\n    let is_repository = normalized_import.contains(\"repository\")\n        || normalized_import.contains(\".repository\");\n\n    is_controller \u0026\u0026 is_repository\n}\n\n/// Check all forbidden rules for a single import\n///\n/// # Arguments\n/// * `file_path` - The path of the file containing the import\n/// * `import` - The import to check\n/// * `forbidden_rules` - List of forbidden rules to check against\n///\n/// # Returns\n/// A vector of matching rule indices\npub fn check_import_against_rules(\n    file_path: \u0026str,\n    import: \u0026Import,\n    forbidden_rules: \u0026[ForbiddenRule],\n) -\u003e Vec\u003cusize\u003e {\n    let mut matching_rules = Vec::new();\n\n    for (idx, rule) in forbidden_rules.iter().enumerate() {\n        if matches_forbidden_rule(file_path, \u0026import.source, rule) {\n            matching_rules.push(idx);\n        }\n    }\n\n    matching_rules\n}\n\n/// Create violations for a matching rule\n///\n/// # Arguments\n/// * `file_path` - The path of the file\n/// * `source_code` - The source code content\n/// * `import` - The import that violates the rule\n/// * `rule` - The rule being violated\n///\n/// # Returns\n/// A Violation object representing the violation\npub fn create_violation(\n    file_path: \u0026Path,\n    source_code: \u0026str,\n    import: \u0026Import,\n    rule: ForbiddenRule,\n) -\u003e Violation {\n    Violation {\n        file_path: file_path.to_path_buf(),\n        file_content: source_code.to_string(),\n        offensive_import: import.raw_statement.clone(),\n        rule,\n        line_number: import.line_number,\n    }\n}\n\n/// Find all violations in a set of imports\n///\n/// # Arguments\n/// * `file_path` - The path of the file being checked\n/// * `source_code` - The source code content\n/// * `imports` - List of imports extracted from the file\n/// * `context` - The linter context containing rules\n///\n/// # Returns\n/// A vector of violations found\npub fn find_violations_in_imports(\n    file_path: \u0026Path,\n    source_code: \u0026str,\n    imports: \u0026[Import],\n    context: \u0026LinterContext,\n) -\u003e Vec\u003cViolation\u003e {\n    let mut violations = Vec::new();\n    let file_path_str = file_path.to_string_lossy().to_string();\n\n    for import in imports {\n        // Check against configured forbidden rules\n        for rule in \u0026context.forbidden_imports {\n            if matches_forbidden_rule(\u0026file_path_str, \u0026import.source, rule) {\n                violations.push(create_violation(\n                    file_path,\n                    source_code,\n                    import,\n                    rule.clone(),\n                ));\n            }\n        }\n\n        // Check for controller-to-repository violations\n        if is_controller_to_repository_violation(\u0026file_path_str, \u0026import.source) {\n            violations.push(create_violation(\n                file_path,\n                source_code,\n                import,\n                ForbiddenRule {\n                    from: \"controller\".to_string(),\n                    to: \".repository\".to_string(),\n                },\n            ));\n        }\n    }\n\n    violations\n}\n\n/// Filter imports to find those that match a pattern\n///\n/// # Arguments\n/// * `imports` - List of imports to filter\n/// * `pattern` - Pattern to match against\n///\n/// # Returns\n/// Imports whose source matches the pattern\npub fn filter_imports_by_pattern\u003c'a\u003e(imports: \u0026'a [Import], pattern: \u0026str) -\u003e Vec\u003c\u0026'a Import\u003e {\n    imports\n        .iter()\n        .filter(|import| matches_pattern(\u0026import.source, pattern))\n        .collect()\n}\n\n/// Check if any import matches a pattern\n///\n/// # Arguments\n/// * `imports` - List of imports to check\n/// * `pattern` - Pattern to match against\n///\n/// # Returns\n/// true if any import matches the pattern\npub fn has_import_matching(imports: \u0026[Import], pattern: \u0026str) -\u003e bool {\n    imports\n        .iter()\n        .any(|import| matches_pattern(\u0026import.source, pattern))\n}\n\n/// Count imports matching a pattern\n///\n/// # Arguments\n/// * `imports` - List of imports to count\n/// * `pattern` - Pattern to match against\n///\n/// # Returns\n/// Number of imports matching the pattern\npub fn count_imports_matching(imports: \u0026[Import], pattern: \u0026str) -\u003e usize {\n    imports\n        .iter()\n        .filter(|import| matches_pattern(\u0026import.source, pattern))\n        .count()\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    // =========================================================================\n    // normalize_path tests\n    // =========================================================================\n\n    #[test]\n    fn test_normalize_path_windows_to_unix() {\n        assert_eq!(\n            normalize_path(\"C:\\\\Project\\\\Src\\\\File.ts\"),\n            \"c:/project/src/file.ts\"\n        );\n        assert_eq!(\n            normalize_path(\"src\\\\components\\\\Button.tsx\"),\n            \"src/components/button.tsx\"\n        );\n    }\n\n    #[test]\n    fn test_normalize_path_lowercase() {\n        assert_eq!(normalize_path(\"SRC/Components/Button\"), \"src/components/button\");\n        assert_eq!(normalize_path(\"MyFile.TS\"), \"myfile.ts\");\n    }\n\n    #[test]\n    fn test_normalize_path_mixed_separators() {\n        assert_eq!(\n            normalize_path(\"src\\\\components/Button.tsx\"),\n            \"src/components/button.tsx\"\n        );\n    }\n\n    // =========================================================================\n    // normalize_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_normalize_pattern_wildcards() {\n        assert_eq!(normalize_pattern(\"src/components/**\"), \"src/components/\");\n        assert_eq!(normalize_pattern(\"**/*.tsx\"), \"/.tsx\");\n        assert_eq!(normalize_pattern(\"src/services/*\"), \"src/services/\");\n    }\n\n    #[test]\n    fn test_normalize_pattern_no_wildcards() {\n        assert_eq!(normalize_pattern(\"src/components/\"), \"src/components/\");\n        assert_eq!(normalize_pattern(\"repository\"), \"repository\");\n    }\n\n    // =========================================================================\n    // extract_folder_from_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_extract_folder_from_pattern_with_src() {\n        assert_eq!(\n            extract_folder_from_pattern(\"src/services/\"),\n            Some(\"services/\".to_string())\n        );\n        assert_eq!(\n            extract_folder_from_pattern(\"src/components/**\"),\n            Some(\"components/\".to_string())\n        );\n    }\n\n    #[test]\n    fn test_extract_folder_from_pattern_without_src() {\n        assert_eq!(extract_folder_from_pattern(\"lib/utils/\"), None);\n        assert_eq!(extract_folder_from_pattern(\"repository\"), None);\n    }\n\n    // =========================================================================\n    // generate_import_patterns tests\n    // =========================================================================\n\n    #[test]\n    fn test_generate_import_patterns() {\n        let patterns = generate_import_patterns(\"services/\");\n        assert!(patterns.contains(\u0026\"/services/\".to_string()));\n        assert!(patterns.contains(\u0026\"../services/\".to_string()));\n        assert!(patterns.contains(\u0026\"@/services/\".to_string()));\n        assert!(patterns.contains(\u0026\"services/\".to_string()));\n        assert_eq!(patterns.len(), 4);\n    }\n\n    // =========================================================================\n    // matches_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_matches_pattern_direct_containment() {\n        assert!(matches_pattern(\"src/components/button.tsx\", \"src/components/\"));\n        assert!(matches_pattern(\"src/components/nested/Button.tsx\", \"src/components/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_relative_imports() {\n        assert!(matches_pattern(\"../services/userservice\", \"src/services/\"));\n        assert!(matches_pattern(\"../repository/user\", \"src/repository/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_alias_imports() {\n        assert!(matches_pattern(\"@/services/api\", \"src/services/\"));\n        assert!(matches_pattern(\"@/models/user\", \"src/models/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_case_insensitive() {\n        assert!(matches_pattern(\"SRC/Components/Button\", \"src/components/\"));\n        assert!(matches_pattern(\"src/COMPONENTS/Button\", \"src/components/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_no_match() {\n        assert!(!matches_pattern(\"src/models/user.ts\", \"src/components/\"));\n        assert!(!matches_pattern(\"test.ts\", \"src/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_empty_pattern() {\n        assert!(!matches_pattern(\"src/components/Button.tsx\", \"\"));\n        assert!(!matches_pattern(\"test.ts\", \"\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_windows_paths() {\n        assert!(matches_pattern(\n            \"C:\\\\Project\\\\Src\\\\Components\\\\Button.tsx\",\n            \"src/components/\"\n        ));\n    }\n\n    // =========================================================================\n    // matches_forbidden_rule tests\n    // =========================================================================\n\n    #[test]\n    fn test_matches_forbidden_rule_violation() {\n        let rule = ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        };\n\n        assert!(matches_forbidden_rule(\n            \"src/controller/user.controller.ts\",\n            \"../repository/user\",\n            \u0026rule\n        ));\n\n        assert!(matches_forbidden_rule(\n            \"SRC/CONTROLLER/User.Controller.ts\",\n            \"../repository/user\",\n            \u0026rule\n        ));\n    }\n\n    #[test]\n    fn test_matches_forbidden_rule_no_violation_different_file() {\n        let rule = ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        };\n\n        assert!(!matches_forbidden_rule(\n            \"src/service/user.service.ts\",\n            \"../repository/user\",\n            \u0026rule\n        ));\n    }\n\n    #[test]\n    fn test_matches_forbidden_rule_no_violation_different_import() {\n        let rule = ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        };\n\n        assert!(!matches_forbidden_rule(\n            \"src/controller/user.controller.ts\",\n            \"../service/user\",\n            \u0026rule\n        ));\n    }\n\n    // =========================================================================\n    // is_controller_to_repository_violation tests\n    // =========================================================================\n\n    #[test]\n    fn test_is_controller_to_repository_violation_true() {\n        assert!(is_controller_to_repository_violation(\n            \"src/controller/user.controller.ts\",\n            \"../repository/user\"\n        ));\n\n        assert!(is_controller_to_repository_violation(\n            \"CONTROLLER/User.Controller.ts\",\n            \"./user.repository\"\n        ));\n    }\n\n    #[test]\n    fn test_is_controller_to_repository_violation_false_not_controller() {\n        assert!(!is_controller_to_repository_violation(\n            \"src/service/user.service.ts\",\n            \"../repository/user\"\n        ));\n    }\n\n    #[test]\n    fn test_is_controller_to_repository_violation_false_not_repository() {\n        assert!(!is_controller_to_repository_violation(\n            \"src/controller/user.controller.ts\",\n            \"../service/user\"\n        ));\n    }\n\n    // =========================================================================\n    // filter_imports_by_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_filter_imports_by_pattern() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        let filtered = filter_imports_by_pattern(\u0026imports, \"src/repository/\");\n        assert_eq!(filtered.len(), 1);\n        assert_eq!(filtered[0].source, \"../repository/user\");\n    }\n\n    #[test]\n    fn test_filter_imports_by_pattern_empty() {\n        let imports = vec![\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        let filtered = filter_imports_by_pattern(\u0026imports, \"src/repository/\");\n        assert_eq!(filtered.len(), 0);\n    }\n\n    // =========================================================================\n    // has_import_matching tests\n    // =========================================================================\n\n    #[test]\n    fn test_has_import_matching_true() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        assert!(has_import_matching(\u0026imports, \"src/repository/\"));\n    }\n\n    #[test]\n    fn test_has_import_matching_false() {\n        let imports = vec![\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        assert!(!has_import_matching(\u0026imports, \"src/repository/\"));\n    }\n\n    // =========================================================================\n    // count_imports_matching tests\n    // =========================================================================\n\n    #[test]\n    fn test_count_imports_matching() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../repository/product\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { Product } from '../repository/product';\".to_string(),\n            },\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 3,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        assert_eq!(count_imports_matching(\u0026imports, \"src/repository/\"), 2);\n        assert_eq!(count_imports_matching(\u0026imports, \"src/service/\"), 1);\n        assert_eq!(count_imports_matching(\u0026imports, \"src/controller/\"), 0);\n    }\n\n    // =========================================================================\n    // check_import_against_rules tests\n    // =========================================================================\n\n    #[test]\n    fn test_check_import_against_rules_single_match() {\n        let rules = vec![\n            ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            },\n            ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/service/\".to_string(),\n            },\n        ];\n\n        let import = Import {\n            source: \"../repository/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { User } from '../repository/user';\".to_string(),\n        };\n\n        let matching = check_import_against_rules(\"src/controller/user.controller.ts\", \u0026import, \u0026rules);\n        assert_eq!(matching, vec![0]);\n    }\n\n    #[test]\n    fn test_check_import_against_rules_multiple_matches() {\n        let rules = vec![\n            ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            },\n            ForbiddenRule {\n                from: \"src/*/\".to_string(),\n                to: \"src/**/repository/\".to_string(),\n            },\n        ];\n\n        let import = Import {\n            source: \"../repository/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { User } from '../repository/user';\".to_string(),\n        };\n\n        let matching = check_import_against_rules(\"src/controller/user.controller.ts\", \u0026import, \u0026rules);\n        // Should match both rules (if pattern matching allows it)\n        assert!(!matching.is_empty());\n    }\n\n    #[test]\n    fn test_check_import_against_rules_no_match() {\n        let rules = vec![ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        }];\n\n        let import = Import {\n            source: \"../service/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n        };\n\n        let matching = check_import_against_rules(\"src/service/user.service.ts\", \u0026import, \u0026rules);\n        assert!(matching.is_empty());\n    }\n\n    // =========================================================================\n    // Integration-style tests\n    // =========================================================================\n\n    #[test]\n    fn test_find_violations_in_imports_multiple_violations() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../repository/product\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { Product } from '../repository/product';\".to_string(),\n            },\n        ];\n\n        let context = LinterContext {\n            max_lines: 100,\n            framework: crate::config::Framework::NestJS,\n            pattern: crate::config::ArchPattern::MVC,\n            forbidden_imports: vec![ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            }],\n            ignored_paths: vec![],\n            ai_configs: vec![],\n        };\n\n        let violations = find_violations_in_imports(\n            Path::new(\"src/controller/user.controller.ts\"),\n            \"source code\",\n            \u0026imports,\n            \u0026context,\n        );\n\n        // Should have 4 violations:\n        // - 2 from the configured forbidden rule (user.repository and product.repository)\n        // - 2 from the controller-to-repository rule (same imports)\n        assert_eq!(violations.len(), 4);\n    }\n\n    #[test]\n    fn test_find_violations_in_imports_no_violations() {\n        let imports = vec![Import {\n            source: \"../service/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n        }];\n\n        let context = LinterContext {\n            max_lines: 100,\n            framework: crate::config::Framework::NestJS,\n            pattern: crate::config::ArchPattern::MVC,\n            forbidden_imports: vec![ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            }],\n            ignored_paths: vec![],\n            ai_configs: vec![],\n        };\n\n        let violations = find_violations_in_imports(\n            Path::new(\"src/controller/user.controller.ts\"),\n            \"source code\",\n            \u0026imports,\n            \u0026context,\n        );\n\n        assert_eq!(violations.len(), 0);\n    }\n}\n","traces":[{"line":40,"address":[25088027,25085440,25087918],"length":1,"stats":{"Line":2}},{"line":41,"address":[25085538],"length":1,"stats":{"Line":1}},{"line":44,"address":[25085511],"length":1,"stats":{"Line":1}},{"line":49,"address":[25085844,25085647,25085762,25085579],"length":1,"stats":{"Line":6}},{"line":52,"address":[25086152],"length":1,"stats":{"Line":2}},{"line":53,"address":[25086195,25086271],"length":1,"stats":{"Line":6}},{"line":55,"address":[25086341,25086545],"length":1,"stats":{"Line":6}},{"line":56,"address":[25086826,25086624,25087891],"length":1,"stats":{"Line":3}},{"line":57,"address":[25086946],"length":1,"stats":{"Line":1}},{"line":58,"address":[25086969],"length":1,"stats":{"Line":1}},{"line":59,"address":[25087201,25087287],"length":1,"stats":{"Line":1}},{"line":62,"address":[25087260],"length":1,"stats":{"Line":1}},{"line":63,"address":[25087307,25087693],"length":1,"stats":{"Line":1}},{"line":64,"address":[25087434,25087369],"length":1,"stats":{"Line":2}},{"line":65,"address":[25087477],"length":1,"stats":{"Line":1}},{"line":68,"address":[25087581,25087394],"length":1,"stats":{"Line":0}},{"line":71,"address":[25087784],"length":1,"stats":{"Line":2}},{"line":72,"address":[25087543],"length":1,"stats":{"Line":1}},{"line":74,"address":[25087744],"length":1,"stats":{"Line":1}},{"line":79,"address":[25086691],"length":1,"stats":{"Line":2}},{"line":100,"address":[25082008,25081840,25082002],"length":1,"stats":{"Line":1}},{"line":101,"address":[25081952,25081864],"length":1,"stats":{"Line":2}},{"line":121,"address":[25084108,25084114,25083664],"length":1,"stats":{"Line":1}},{"line":122,"address":[25083724,25083949,25083834],"length":1,"stats":{"Line":3}},{"line":148,"address":[25090272,25090560,25090566],"length":1,"stats":{"Line":0}},{"line":149,"address":[25090299],"length":1,"stats":{"Line":0}},{"line":150,"address":[25090388,25090443,25090323],"length":1,"stats":{"Line":0}},{"line":151,"address":[25090501,25090450],"length":1,"stats":{"Line":0}},{"line":153,"address":[25090430],"length":1,"stats":{"Line":0}},{"line":177,"address":[25084512,25085407,25085413],"length":1,"stats":{"Line":0}},{"line":178,"address":[25085394,25084759,25084549,25085113,25085157,25084591,25084936],"length":1,"stats":{"Line":0}},{"line":179,"address":[25084632,25084564],"length":1,"stats":{"Line":0}},{"line":180,"address":[25084800,25084732],"length":1,"stats":{"Line":0}},{"line":181,"address":[25084980,25084909],"length":1,"stats":{"Line":0}},{"line":182,"address":[25085084],"length":1,"stats":{"Line":0}},{"line":216,"address":[25083187,25082032,25083124],"length":1,"stats":{"Line":1}},{"line":217,"address":[25082090],"length":1,"stats":{"Line":1}},{"line":218,"address":[25082114],"length":1,"stats":{"Line":1}},{"line":221,"address":[25082182,25082238],"length":1,"stats":{"Line":2}},{"line":222,"address":[25082266],"length":1,"stats":{"Line":0}},{"line":226,"address":[25082249,25082286],"length":1,"stats":{"Line":2}},{"line":227,"address":[25082348],"length":1,"stats":{"Line":1}},{"line":231,"address":[25082358,25082329],"length":1,"stats":{"Line":0}},{"line":233,"address":[25082567,25082521,25082435],"length":1,"stats":{"Line":0}},{"line":234,"address":[25082553],"length":1,"stats":{"Line":0}},{"line":237,"address":[25082581],"length":1,"stats":{"Line":0}},{"line":238,"address":[25082821,25082627],"length":1,"stats":{"Line":0}},{"line":239,"address":[25082895,25083007],"length":1,"stats":{"Line":0}},{"line":240,"address":[25083062],"length":1,"stats":{"Line":0}},{"line":245,"address":[25082446],"length":1,"stats":{"Line":0}},{"line":282,"address":[25084304],"length":1,"stats":{"Line":1}},{"line":287,"address":[25084369],"length":1,"stats":{"Line":1}},{"line":288,"address":[25084418],"length":1,"stats":{"Line":1}},{"line":290,"address":[25084473],"length":1,"stats":{"Line":1}},{"line":327,"address":[25091071,25091065,25090576],"length":1,"stats":{"Line":1}},{"line":328,"address":[25090634],"length":1,"stats":{"Line":1}},{"line":329,"address":[25090676],"length":1,"stats":{"Line":1}},{"line":331,"address":[25090726,25090794],"length":1,"stats":{"Line":2}},{"line":332,"address":[25090842,25090931],"length":1,"stats":{"Line":2}},{"line":333,"address":[25090914,25090951],"length":1,"stats":{"Line":0}},{"line":335,"address":[25090995],"length":1,"stats":{"Line":1}},{"line":347,"address":[25088755,25088192,25088761],"length":1,"stats":{"Line":0}},{"line":352,"address":[25088274],"length":1,"stats":{"Line":0}},{"line":354,"address":[25088376,25088301],"length":1,"stats":{"Line":0}},{"line":355,"address":[25088603,25088698],"length":1,"stats":{"Line":0}},{"line":356,"address":[25088731],"length":1,"stats":{"Line":0}},{"line":360,"address":[25088630],"length":1,"stats":{"Line":0}},{"line":373,"address":[25083638,25083200],"length":1,"stats":{"Line":1}},{"line":380,"address":[25083285],"length":1,"stats":{"Line":1}},{"line":381,"address":[25083352],"length":1,"stats":{"Line":1}},{"line":382,"address":[25083411],"length":1,"stats":{"Line":1}},{"line":384,"address":[25083502],"length":1,"stats":{"Line":1}},{"line":398,"address":[25090004,25090236,25088784],"length":1,"stats":{"Line":1}},{"line":404,"address":[25088927],"length":1,"stats":{"Line":1}},{"line":405,"address":[25089032,25088984],"length":1,"stats":{"Line":2}},{"line":407,"address":[25089179],"length":1,"stats":{"Line":1}},{"line":409,"address":[25089469,25089344],"length":1,"stats":{"Line":2}},{"line":410,"address":[25090041,25089588],"length":1,"stats":{"Line":2}},{"line":411,"address":[25090171],"length":1,"stats":{"Line":1}},{"line":415,"address":[25090124],"length":1,"stats":{"Line":1}},{"line":421,"address":[25089619],"length":1,"stats":{"Line":1}},{"line":422,"address":[25089939],"length":1,"stats":{"Line":1}},{"line":426,"address":[25089875],"length":1,"stats":{"Line":1}},{"line":427,"address":[25089729],"length":1,"stats":{"Line":1}},{"line":428,"address":[25089760],"length":1,"stats":{"Line":1}},{"line":434,"address":[25089379],"length":1,"stats":{"Line":1}},{"line":445,"address":[25088064],"length":1,"stats":{"Line":0}},{"line":446,"address":[],"length":0,"stats":{"Line":0}},{"line":448,"address":[24618304,24618322],"length":1,"stats":{"Line":0}},{"line":460,"address":[25084128],"length":1,"stats":{"Line":0}},{"line":463,"address":[24618160,24618192],"length":1,"stats":{"Line":0}},{"line":474,"address":[25084224],"length":1,"stats":{"Line":0}},{"line":477,"address":[24618240,24618258],"length":1,"stats":{"Line":0}}],"covered":58,"coverable":93},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","report.rs"],"content":"//! Report generation for Architect Linter v4.0\n//!\n//! This module provides JSON and Markdown report export functionality.\n\nuse crate::analysis_result::AnalysisResult;\nuse crate::cli::ReportFormat;\nuse miette::{IntoDiagnostic, Result};\nuse serde_json::json;\nuse std::fs;\nuse std::io::{self, Write};\nuse std::path::Path;\n\n/// Generate a report in the specified format\npub fn generate_report(result: \u0026AnalysisResult, format: ReportFormat) -\u003e String {\n    match format {\n        ReportFormat::Json =\u003e to_json(result),\n        ReportFormat::Markdown =\u003e to_markdown(result),\n    }\n}\n\n/// Export analysis result to JSON format\npub fn to_json(result: \u0026AnalysisResult) -\u003e String {\n    let health_score = result.health_score.as_ref();\n\n    let report = json!({\n        \"version\": \"4.0.0\",\n        \"timestamp\": result.timestamp.to_rfc3339(),\n        \"project\": {\n            \"name\": result.project_name,\n            \"pattern\": result.pattern_display(),\n            \"files_analyzed\": result.files_analyzed,\n        },\n        \"health_score\": health_score.map(|s| json!({\n            \"total\": s.total,\n            \"grade\": s.grade.as_str(),\n            \"components\": {\n                \"layer_isolation\": s.components.layer_isolation,\n                \"circular_deps\": s.components.circular_deps,\n                \"complexity\": s.components.complexity,\n                \"violations\": s.components.violations,\n            }\n        })),\n        \"summary\": {\n            \"total_violations\": result.violations.len(),\n            \"blocked_violations\": result.blocked_count(),\n            \"warning_violations\": result.warning_count(),\n            \"circular_dependencies\": result.circular_dependencies.len(),\n            \"long_functions\": result.long_functions.len(),\n        },\n        \"violations\": result.violations.iter().map(|cv| {\n            json!({\n                \"file\": cv.violation.file_path.to_string_lossy().to_string(),\n                \"line\": cv.violation.line_number,\n                \"category\": cv.category.as_str(),\n                \"rule\": {\n                    \"from\": cv.violation.rule.from,\n                    \"to\": cv.violation.rule.to,\n                },\n                \"import\": cv.violation.offensive_import,\n            })\n        }).collect::\u003cVec\u003c_\u003e\u003e(),\n        \"circular_dependencies\": result.circular_dependencies.iter().map(|cd| {\n            json!({\n                \"cycle\": cd.cycle,\n                \"description\": cd.description,\n            })\n        }).collect::\u003cVec\u003c_\u003e\u003e(),\n        \"long_functions\": result.long_functions.iter().map(|lf| {\n            json!({\n                \"file\": lf.file_path.to_string_lossy().to_string(),\n                \"name\": lf.name,\n                \"line_start\": lf.line_start,\n                \"lines\": lf.lines,\n                \"threshold\": lf.threshold,\n            })\n        }).collect::\u003cVec\u003c_\u003e\u003e(),\n    });\n\n    serde_json::to_string_pretty(\u0026report).unwrap_or_else(|_| \"{}\".to_string())\n}\n\n/// Export analysis result to Markdown format\npub fn to_markdown(result: \u0026AnalysisResult) -\u003e String {\n    let mut md = String::new();\n\n    // Header\n    md.push_str(\"# Architect Linter Pro Report\\n\\n\");\n    md.push_str(\u0026format!(\n        \"\u003e Generated: {}\\n\\n\",\n        result.timestamp.format(\"%Y-%m-%d %H:%M:%S UTC\")\n    ));\n\n    // Project info\n    md.push_str(\"## Project\\n\\n\");\n    md.push_str(\u0026format!(\"- **Name:** {}\\n\", result.project_name));\n    md.push_str(\u0026format!(\"- **Pattern:** {}\\n\", result.pattern_display()));\n    md.push_str(\u0026format!(\n        \"- **Files Analyzed:** {}\\n\\n\",\n        result.files_analyzed\n    ));\n\n    // Health Score\n    if let Some(ref score) = result.health_score {\n        md.push_str(\"## Architecture Health Score\\n\\n\");\n        md.push_str(\u0026format!(\n            \"# {} Score: {}/100\\n\\n\",\n            score.grade.as_str(),\n            score.total\n        ));\n\n        md.push_str(\"| Component | Score | Status |\\n\");\n        md.push_str(\"|-----------|-------|--------|\\n\");\n        md.push_str(\u0026format!(\n            \"| Layer Isolation | {}% | {} |\\n\",\n            score.components.layer_isolation,\n            score.layer_isolation_status.emoji()\n        ));\n        md.push_str(\u0026format!(\n            \"| Circular Deps | {}% | {} |\\n\",\n            score.components.circular_deps,\n            score.circular_deps_status.emoji()\n        ));\n        md.push_str(\u0026format!(\n            \"| Complexity | {}% | {} |\\n\",\n            score.components.complexity,\n            score.complexity_status.emoji()\n        ));\n        md.push_str(\u0026format!(\n            \"| Violations | {}% | {} |\\n\\n\",\n            score.components.violations,\n            score.violations_status.emoji()\n        ));\n    }\n\n    // Summary\n    md.push_str(\"## Summary\\n\\n\");\n    md.push_str(\u0026format!(\n        \"- **Total Violations:** {}\\n\",\n        result.violations.len()\n    ));\n    md.push_str(\u0026format!(\"- **Blocked:** {}\\n\", result.blocked_count()));\n    md.push_str(\u0026format!(\"- **Warnings:** {}\\n\", result.warning_count()));\n    md.push_str(\u0026format!(\n        \"- **Circular Dependencies:** {}\\n\",\n        result.circular_dependencies.len()\n    ));\n    md.push_str(\u0026format!(\n        \"- **Long Functions:** {}\\n\\n\",\n        result.long_functions.len()\n    ));\n\n    // Violations\n    if !result.violations.is_empty() {\n        md.push_str(\"## Violations\\n\\n\");\n        for (i, cv) in result.violations.iter().enumerate() {\n            md.push_str(\u0026format!(\n                \"### {}. {} (Line {})\\n\\n\",\n                i + 1,\n                cv.violation.file_path.display(),\n                cv.violation.line_number\n            ));\n            md.push_str(\u0026format!(\"- **Category:** {}\\n\", cv.category.as_str()));\n            md.push_str(\u0026format!(\n                \"- **Rule:** `{}` cannot import from `{}`\\n\",\n                cv.violation.rule.from, cv.violation.rule.to\n            ));\n            md.push_str(\u0026format!(\n                \"- **Import:** `{}`\\n\\n\",\n                cv.violation.offensive_import\n            ));\n        }\n    }\n\n    // Circular Dependencies\n    if !result.circular_dependencies.is_empty() {\n        md.push_str(\"## Circular Dependencies\\n\\n\");\n        for (i, cd) in result.circular_dependencies.iter().enumerate() {\n            md.push_str(\u0026format!(\"### Cycle #{}\\n\\n```\\n\", i + 1));\n            for (j, node) in cd.cycle.iter().enumerate() {\n                if j \u003c cd.cycle.len() - 1 {\n                    md.push_str(\u0026format!(\"{} →\\n\", node));\n                } else {\n                    md.push_str(\u0026format!(\"{} ↑\\n\", node));\n                }\n            }\n            md.push_str(\"```\\n\\n\");\n        }\n    }\n\n    // Long Functions\n    if !result.long_functions.is_empty() {\n        md.push_str(\"## Long Functions\\n\\n\");\n        md.push_str(\"| File | Function | Lines | Threshold |\\n\");\n        md.push_str(\"|------|----------|-------|----------|\\n\");\n        for lf in \u0026result.long_functions {\n            md.push_str(\u0026format!(\n                \"| {} | {} | {} | {} |\\n\",\n                lf.file_path.display(),\n                lf.name,\n                lf.lines,\n                lf.threshold\n            ));\n        }\n        md.push_str(\"\\n\");\n    }\n\n    md\n}\n\n/// Write report to file\npub fn write_report(content: \u0026str, path: \u0026Path) -\u003e Result\u003c()\u003e {\n    // Create parent directories if needed\n    if let Some(parent) = path.parent() {\n        fs::create_dir_all(parent).into_diagnostic()?;\n    }\n\n    fs::write(path, content).into_diagnostic()\n}\n\n/// Write report to stdout\npub fn write_stdout(content: \u0026str) -\u003e Result\u003c()\u003e {\n    let mut stdout = io::stdout();\n    stdout.write_all(content.as_bytes()).into_diagnostic()?;\n    stdout.flush().into_diagnostic()\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::config::ArchPattern;\n    use crate::metrics::{HealthScore, ScoreComponents};\n\n    #[test]\n    fn test_json_report_structure() {\n        let mut result = AnalysisResult::new(\"test-project\".to_string(), ArchPattern::MVC);\n        result.files_analyzed = 10;\n        result.health_score = Some(HealthScore::new(ScoreComponents {\n            layer_isolation: 100,\n            circular_deps: 100,\n            complexity: 80,\n            violations: 90,\n        }));\n\n        let json = to_json(\u0026result);\n        assert!(json.contains(\"test-project\"));\n        assert!(json.contains(\"MVC\"));\n    }\n\n    #[test]\n    fn test_markdown_report_structure() {\n        let mut result = AnalysisResult::new(\"test-project\".to_string(), ArchPattern::Hexagonal);\n        result.files_analyzed = 5;\n\n        let md = to_markdown(\u0026result);\n        assert!(md.contains(\"# Architect Linter Pro Report\"));\n        assert!(md.contains(\"test-project\"));\n        assert!(md.contains(\"Hexagonal\"));\n    }\n}\n","traces":[{"line":28,"address":[53458736,53458384,53458409,53458746],"length":1,"stats":{"Line":0}},{"line":33,"address":[25150588,25149396,25148720,25149552,25148928,25149137,25148750,25149772,25149203,25150218,25149995],"length":1,"stats":{"Line":0}},{"line":34,"address":[53458610],"length":1,"stats":{"Line":0}},{"line":35,"address":[25149187,25149113],"length":1,"stats":{"Line":0}},{"line":48,"address":[53460512,53460608,53460620,53460544],"length":1,"stats":{"Line":0}},{"line":50,"address":[25155320,25153136,25155458],"length":1,"stats":{"Line":0}},{"line":51,"address":[25153442,25153174,25155074,25154139,25153847,25154488,25153349,25155326,25154708,25154332,25155298,25154072,25153513],"length":1,"stats":{"Line":0}},{"line":52,"address":[25153408,25153332],"length":1,"stats":{"Line":0}},{"line":54,"address":[25154044,25154123],"length":1,"stats":{"Line":0}},{"line":56,"address":[53464336],"length":1,"stats":{"Line":0}},{"line":61,"address":[25155290],"length":1,"stats":{"Line":0}},{"line":62,"address":[25153090,25153115,25152464],"length":1,"stats":{"Line":0}},{"line":63,"address":[25152502,25153096,25152844,25153068,25152636],"length":1,"stats":{"Line":0}},{"line":64,"address":[53464373,53441589],"length":1,"stats":{"Line":0}},{"line":65,"address":[53464380],"length":1,"stats":{"Line":0}},{"line":67,"address":[25153060],"length":1,"stats":{"Line":0}},{"line":68,"address":[25152446,25152355,25150768],"length":1,"stats":{"Line":0}},{"line":69,"address":[25151050,25151669,25152333,25150806,25151449,25151889,25151118,25152109,25152361,25150961],"length":1,"stats":{"Line":0}},{"line":70,"address":[25151016,25150945],"length":1,"stats":{"Line":0}},{"line":72,"address":[53462990,53463014,53462954],"length":1,"stats":{"Line":0}},{"line":73,"address":[53463003],"length":1,"stats":{"Line":0}},{"line":74,"address":[53463090,53463146],"length":1,"stats":{"Line":0}},{"line":76,"address":[25152325],"length":1,"stats":{"Line":0}},{"line":79,"address":[25148624,25148608],"length":1,"stats":{"Line":0}},{"line":83,"address":[53463382],"length":1,"stats":{"Line":0}},{"line":84,"address":[53463394],"length":1,"stats":{"Line":0}},{"line":87,"address":[53463370],"length":1,"stats":{"Line":0}},{"line":89,"address":[53463524],"length":1,"stats":{"Line":0}},{"line":90,"address":[53463592,53463531],"length":1,"stats":{"Line":0}},{"line":94,"address":[53463729,53463657],"length":1,"stats":{"Line":0}},{"line":95,"address":[53463746,53463762],"length":1,"stats":{"Line":0}},{"line":96,"address":[53463771],"length":1,"stats":{"Line":0}},{"line":98,"address":[53463636],"length":1,"stats":{"Line":0}},{"line":99,"address":[53463819,53463880],"length":1,"stats":{"Line":0}},{"line":103,"address":[53463961],"length":1,"stats":{"Line":0}},{"line":104,"address":[53463993,53464054],"length":1,"stats":{"Line":0}},{"line":105,"address":[53464061],"length":1,"stats":{"Line":0}},{"line":107,"address":[53464078],"length":1,"stats":{"Line":0}},{"line":108,"address":[53464173,53464249],"length":1,"stats":{"Line":0}},{"line":111,"address":[53464300],"length":1,"stats":{"Line":0}},{"line":112,"address":[53464309],"length":1,"stats":{"Line":0}},{"line":118,"address":[53464155],"length":1,"stats":{"Line":0}},{"line":119,"address":[53463619,53464163],"length":1,"stats":{"Line":0}},{"line":126,"address":[53438640],"length":1,"stats":{"Line":0}},{"line":130,"address":[53438663],"length":1,"stats":{"Line":0}},{"line":136,"address":[53438889],"length":1,"stats":{"Line":0}},{"line":138,"address":[53438921,53438782,53438989],"length":1,"stats":{"Line":0}},{"line":139,"address":[53438980],"length":1,"stats":{"Line":0}},{"line":143,"address":[53440103,53440087],"length":1,"stats":{"Line":0}},{"line":144,"address":[53440119,53440187],"length":1,"stats":{"Line":0}},{"line":145,"address":[53440194],"length":1,"stats":{"Line":0}},{"line":149,"address":[53439133,53439015,53439105],"length":1,"stats":{"Line":0}},{"line":153,"address":[53439848],"length":1,"stats":{"Line":0}},{"line":158,"address":[53439956,53439917,53439941],"length":1,"stats":{"Line":0}},{"line":159,"address":[53439935],"length":1,"stats":{"Line":0}},{"line":160,"address":[53439953],"length":1,"stats":{"Line":0}},{"line":162,"address":[53440044],"length":1,"stats":{"Line":0}},{"line":164,"address":[53439275,53439159,53439228],"length":1,"stats":{"Line":0}},{"line":165,"address":[53439450,53439470],"length":1,"stats":{"Line":0}},{"line":167,"address":[53439437],"length":1,"stats":{"Line":0}},{"line":168,"address":[53439466,53439453],"length":1,"stats":{"Line":0}},{"line":175,"address":[53439582],"length":1,"stats":{"Line":0}},{"line":176,"address":[53439600],"length":1,"stats":{"Line":0}},{"line":177,"address":[53439684,53439616],"length":1,"stats":{"Line":0}},{"line":178,"address":[53439691],"length":1,"stats":{"Line":0}},{"line":180,"address":[53438704],"length":1,"stats":{"Line":0}},{"line":181,"address":[53439703],"length":1,"stats":{"Line":0}},{"line":186,"address":[53441024],"length":1,"stats":{"Line":0}},{"line":191,"address":[53441143,53441380,53441078],"length":1,"stats":{"Line":0}},{"line":192,"address":[53441209],"length":1,"stats":{"Line":0}},{"line":193,"address":[53441620,53441413,53441300],"length":1,"stats":{"Line":0}},{"line":194,"address":[53441527],"length":1,"stats":{"Line":0}},{"line":195,"address":[53441556],"length":1,"stats":{"Line":0}},{"line":196,"address":[53441605],"length":1,"stats":{"Line":0}},{"line":197,"address":[53441652],"length":1,"stats":{"Line":0}},{"line":198,"address":[53441659],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":76},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","scoring.rs"],"content":"//! Scoring engine for Architecture Health Score\n//!\n//! This module implements the scoring algorithm that converts analysis results\n//! into a 0-100 health score with letter grades.\n\nuse crate::analysis_result::AnalysisResult;\nuse crate::metrics::{HealthGrade, HealthScore, ScoreComponents};\n\n/// Severity level of a violation\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum ViolationType {\n    /// Critical violation that severely impacts architecture\n    Critical,\n    /// Warning that should be reviewed\n    Warning,\n    /// Informational notice\n    Info,\n}\n\n/// A simple violation for unit testing\n#[derive(Debug, Clone)]\npub struct Violation {\n    /// Severity of the violation\n    pub severity: ViolationType,\n    /// File path where the violation occurred\n    pub file_path: String,\n    /// Line number where the violation occurred\n    pub line: usize,\n    /// Violation message\n    pub message: String,\n}\n\n/// Calculate the health score from an analysis result\npub fn calculate(result: \u0026AnalysisResult) -\u003e HealthScore {\n    let components = ScoreComponents {\n        layer_isolation: calculate_layer_isolation_score(result),\n        circular_deps: calculate_circular_deps_score(result),\n        complexity: calculate_complexity_score(result),\n        violations: calculate_violations_score(result),\n    };\n\n    HealthScore::new(components)\n}\n\n/// Calculate layer isolation score\n/// Formula: 100 - (blocked_violations / total_imports * 100)\n/// Minimum score is 0\nfn calculate_layer_isolation_score(result: \u0026AnalysisResult) -\u003e u8 {\n    let blocked = result.layer_stats.blocked_violations;\n    let total = result.layer_stats.total_imports.max(1); // Avoid division by zero\n\n    if blocked == 0 {\n        return 100;\n    }\n\n    let ratio = blocked as f64 / total as f64;\n    let score = 100.0 - (ratio * 100.0);\n    score.max(0.0).min(100.0) as u8\n}\n\n/// Calculate circular dependencies score\n/// Binary: 100 if no cycles, 0 if cycles exist\nfn calculate_circular_deps_score(result: \u0026AnalysisResult) -\u003e u8 {\n    if result.circular_dependencies.is_empty() {\n        100\n    } else {\n        0\n    }\n}\n\n/// Calculate complexity score\n/// Formula: 100 - (long_functions / total_functions * 100)\nfn calculate_complexity_score(result: \u0026AnalysisResult) -\u003e u8 {\n    let long_funcs = result.complexity_stats.long_functions;\n    let total_funcs = result.complexity_stats.total_functions.max(1);\n\n    if long_funcs == 0 {\n        return 100;\n    }\n\n    let ratio = long_funcs as f64 / total_funcs as f64;\n    let score = 100.0 - (ratio * 100.0);\n    score.max(0.0).min(100.0) as u8\n}\n\n/// Calculate violations score\n/// Formula: 100 - ((blocked * 2 + warnings) / total_checks * 100)\n/// Where total_checks is estimated based on files analyzed\nfn calculate_violations_score(result: \u0026AnalysisResult) -\u003e u8 {\n    let blocked = result.blocked_count();\n    let warnings = result.warning_count();\n\n    if blocked == 0 \u0026\u0026 warnings == 0 {\n        return 100;\n    }\n\n    // Estimate total checks as files * 5 (rough average of imports per file)\n    let total_checks = (result.files_analyzed * 5).max(1);\n\n    let penalty = (blocked * 2) as f64 + warnings as f64;\n    let score = 100.0 - (penalty / total_checks as f64 * 100.0);\n    score.max(0.0).min(100.0) as u8\n}\n\n/// Get a visual progress bar for a score\npub fn get_progress_bar(score: u8, width: usize) -\u003e String {\n    let filled = (score as usize * width) / 100;\n    let empty = width - filled;\n\n    let filled_char = \"=\";\n    let empty_char = \" \";\n\n    format!(\n        \"[{}{}]\",\n        filled_char.repeat(filled),\n        empty_char.repeat(empty)\n    )\n}\n\n/// Get grade color code for terminal (ANSI)\npub fn get_grade_color(grade: HealthGrade) -\u003e \u0026'static str {\n    match grade {\n        HealthGrade::A =\u003e \"\\x1b[32m\", // Green\n        HealthGrade::B =\u003e \"\\x1b[36m\", // Cyan\n        HealthGrade::C =\u003e \"\\x1b[33m\", // Yellow\n        HealthGrade::D =\u003e \"\\x1b[35m\", // Magenta\n        HealthGrade::F =\u003e \"\\x1b[31m\", // Red\n    }\n}\n\n/// Reset ANSI color\npub fn reset_color() -\u003e \u0026'static str {\n    \"\\x1b[0m\"\n}\n\n/// Apply severity multipliers to a base score\n///\n/// This function applies various multipliers and bonuses to a base health score:\n/// - Empty project bonus: 10% bonus for projects with 0 files and 0 violations\n/// - Architecture pattern bonus: 5% bonus for detected patterns (e.g., MVC)\n/// - Historical trend factor: adjustment based on improvement/degradation over time\n///\n/// # Arguments\n/// * `violations` - List of violations found in the project\n/// * `base_score` - The base health score (0-100)\n/// * `total_files` - Total number of files in the project\n///\n/// # Returns\n/// Adjusted health score with multipliers applied\npub fn apply_severity_multiplier(\n    violations: \u0026[Violation],\n    base_score: f64,\n    total_files: usize,\n) -\u003e f64 {\n    let mut score = base_score;\n\n    // Empty project bonus: 10% bonus for projects with no files and no violations\n    if total_files == 0 \u0026\u0026 violations.is_empty() {\n        score = base_score * 1.1; // 10% bonus\n    }\n\n    // Architecture pattern bonus: 5% bonus for detected patterns\n    // TODO: This is a placeholder for future implementation. In the full version, this should:\n    // - Detect actual architectural patterns (MVC, Layered, Hexagonal, etc.)\n    // - Use static analysis to identify pattern-specific structures\n    // - Apply bonus based on pattern adherence quality\n    // For now, we apply a simple heuristic based on project size as a temporary approximation\n    if total_files \u003e= 100 \u0026\u0026 violations.is_empty() {\n        score = score * 1.05; // 5% bonus for well-structured large projects\n    }\n\n    // Historical trend factor would be applied here\n    // TODO: This is a placeholder for future functionality. In the full version, this should:\n    // - Accept historical trend data as a parameter\n    // - Compare current results with previous runs\n    // - Apply multiplier based on improvement/degradation trends\n    // For now, we just return the score with applied bonuses\n\n    score.min(100.0) // Cap scores at 100.0 to prevent overflow from multipliers\n}\n\n/// Calculate health score from a list of violations\n///\n/// This is a simplified scoring function for unit testing that takes\n/// a list of violations and returns a 0-100 score.\n///\n/// # Arguments\n/// * `violations` - List of violations found in the project\n/// * `total_files` - Total number of files in the project\n///\n/// # Returns\n/// Health score from 0.0 to 100.0\n///\n/// # Scoring Formula\n/// - Critical violations: -10 points each\n/// - Warning violations: -2 points each\n/// - Info violations: -0.5 points each\n/// - Base score: 100.0\n/// - Final score is clamped to 0.0-100.0\npub fn calculate_health_score(violations: \u0026[Violation], total_files: f64) -\u003e f64 {\n    let mut score = 100.0;\n\n    for violation in violations {\n        match violation.severity {\n            ViolationType::Critical =\u003e score -= 10.0,\n            ViolationType::Warning =\u003e score -= 2.0,\n            ViolationType::Info =\u003e score -= 0.5,\n        }\n    }\n\n    // Normalize by project size (more violations in larger projects have less impact)\n    // This prevents very large projects from being overly penalized\n    let size_factor = (total_files / 100.0).min(5.0); // Cap the reduction\n    let normalized_score = score + (size_factor * 2.0);\n\n    // Clamp to 0-100\n    normalized_score.max(0.0).min(100.0)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_health_grade_from_score() {\n        assert_eq!(HealthGrade::from_score(95), HealthGrade::A);\n        assert_eq!(HealthGrade::from_score(85), HealthGrade::B);\n        assert_eq!(HealthGrade::from_score(75), HealthGrade::C);\n        assert_eq!(HealthGrade::from_score(65), HealthGrade::D);\n        assert_eq!(HealthGrade::from_score(55), HealthGrade::F);\n    }\n\n    #[test]\n    fn test_score_components_calculate_total() {\n        let components = ScoreComponents {\n            layer_isolation: 100,\n            circular_deps: 100,\n            complexity: 100,\n            violations: 100,\n        };\n        assert_eq!(components.calculate_total(), 100);\n\n        let components = ScoreComponents {\n            layer_isolation: 80,\n            circular_deps: 100,\n            complexity: 90,\n            violations: 70,\n        };\n        // (80 * 0.30) + (100 * 0.25) + (90 * 0.20) + (70 * 0.25)\n        // = 24 + 25 + 18 + 17.5 = 84.5 ≈ 85\n        assert_eq!(components.calculate_total(), 85);\n    }\n\n    #[test]\n    fn test_progress_bar() {\n        let bar = get_progress_bar(100, 10);\n        assert_eq!(bar, \"[==========]\");\n\n        let bar = get_progress_bar(50, 10);\n        assert_eq!(bar, \"[=====     ]\");\n\n        let bar = get_progress_bar(0, 10);\n        assert_eq!(bar, \"[          ]\");\n    }\n\n    // Unit tests for calculate_health_score\n    #[test]\n    fn test_calculate_health_score_with_zero_violations() {\n        let violations = vec![];\n        let score = calculate_health_score(\u0026violations, 100.0);\n        assert_eq!(score, 100.0, \"Perfect project should score 100\");\n    }\n\n    #[test]\n    fn test_calculate_health_score_with_critical_violations() {\n        let mut violations = Vec::new();\n        for i in 0..10 {\n            violations.push(Violation {\n                severity: ViolationType::Critical,\n                file_path: format!(\"src/bad{}.rs\", i),\n                line: i,\n                message: \"Critical violation\".to_string(),\n            });\n        }\n\n        let score = calculate_health_score(\u0026violations, 100.0);\n        assert!(\n            score \u003c 50.0,\n            \"Score should be \u003c50 with 10 critical violations\"\n        );\n    }\n\n    #[test]\n    fn test_calculate_health_score_boundary_values() {\n        let violations = vec![];\n        let score_min = calculate_health_score(\u0026violations, 1.0);\n        assert_eq!(\n            score_min, 100.0,\n            \"1 file project should score 100 with no violations\"\n        );\n\n        let score_max = calculate_health_score(\u0026violations, 1000.0);\n        assert_eq!(\n            score_max, 100.0,\n            \"Large project should score 100 with no violations\"\n        );\n    }\n\n    #[test]\n    fn test_calculate_health_score_with_many_files() {\n        let mut violations = Vec::new();\n        for i in 0..1000 {\n            violations.push(Violation {\n                severity: ViolationType::Warning,\n                file_path: format!(\"src/file{}.rs\", i),\n                line: 1,\n                message: \"Warning violation\".to_string(),\n            });\n        }\n\n        let score = calculate_health_score(\u0026violations, 1000.0);\n        assert!(score \u003c 80.0, \"1000 files with warnings should score \u003c80\");\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","ui.rs"],"content":"use crate::ai::{AISuggestionResponse, SuggestedRule};\nuse crate::config::AIConfig;\nuse console::style;\nuse dialoguer::{theme::ColorfulTheme, Input, MultiSelect, Select};\nuse miette::{IntoDiagnostic, Result};\nuse std::env;\nuse std::path::PathBuf;\n\n/// Imprime el banner de bienvenida con ASCII art y estilo de alto impacto\npub fn print_banner() {\n    println!();\n    println!(\n        \"{}\",\n        style(\n            \"╔══════════════════════════════════════════════════════════════════════════════════╗\"\n        )\n        .cyan()\n    );\n    println!(\n        \"{}\",\n        style(\n            r\"\n    ___    ____  ______ __  __________________  ______ ______ \n   /   |  / __ \\/ ____// / / /  _/_  __/ ____/ / ____//_  __/ \n  / /| | / /_/ / /    / /_/ // /  / / / __/   / /      / /    \n / ___ |/ _, _/ /___ / __  // /  / / / /___  / /___   / /     \n/_/  |_/_/ |_|\\____//_/ /_/___/ /_/ /_____/  \\____/  /_/      \n                                                              \n    __     _____  _   __ ______ ______ ____           \n   / /    /  _/ / | / //_  __// ____// __ \\          \n  / /     / /  /  |/ /  / /  / __/  / /_/ /          \n / /___ _/ /  / /|  /  / /  / /___ / _, _/           \n/_____//___/ /_/ |_/  /_/  /_____//_/ |_|            \n\"\n        )\n        .cyan()\n        .bold()\n    );\n    println!(\n        \"{}\",\n        style(\n            \"╚══════════════════════════════════════════════════════════════════════════════════╝\"\n        )\n        .cyan()\n    );\n    println!();\n    println!(\n        \"{}\",\n        style(\"                 Manteniendo la arquitectura de tu código ⚡\")\n            .white()\n            .bold()\n    );\n    println!();\n}\n\n/// Solicita al usuario una o más configuraciones de IA\npub fn ask_ai_configs() -\u003e Result\u003cVec\u003cAIConfig\u003e\u003e {\n    let mut configs = Vec::new();\n\n    loop {\n        println!(\"🤖 CONFIGURACIÓN DE LA IA (#{})\", configs.len() + 1);\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n\n        // Pedir un nombre para esta configuración\n        let name: String = Input::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"Nombre para esta configuración (ej: Claude Pro, Ollama Local)\")\n            .interact_text()\n            .into_diagnostic()?;\n\n        let providers = vec![\n            \"Claude (Anthropic)\",\n            \"Gemini (Google)\",\n            \"OpenAI\",\n            \"Groq\",\n            \"Ollama (Local)\",\n            \"Kimi (Moonshot)\",\n            \"DeepSeek\",\n        ];\n        let selection = Select::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"Selecciona un proveedor de IA\")\n            .items(\u0026providers)\n            .default(0)\n            .interact()\n            .into_diagnostic()?;\n\n        let provider = match selection {\n            0 =\u003e crate::config::AIProvider::Claude,\n            1 =\u003e crate::config::AIProvider::Gemini,\n            2 =\u003e crate::config::AIProvider::OpenAI,\n            3 =\u003e crate::config::AIProvider::Groq,\n            4 =\u003e crate::config::AIProvider::Ollama,\n            5 =\u003e crate::config::AIProvider::Kimi,\n            6 =\u003e crate::config::AIProvider::DeepSeek,\n            _ =\u003e unreachable!(),\n        };\n\n        // URLs base según el proveedor (Hardcoded)\n        let default_url = match provider {\n            crate::config::AIProvider::Claude =\u003e \"https://api.anthropic.com\".to_string(),\n            crate::config::AIProvider::Gemini =\u003e {\n                \"https://generativelanguage.googleapis.com\".to_string()\n            }\n            crate::config::AIProvider::OpenAI =\u003e \"https://api.openai.com/v1\".to_string(),\n            crate::config::AIProvider::Groq =\u003e \"https://api.groq.com/openai/v1\".to_string(),\n            crate::config::AIProvider::Ollama =\u003e \"http://localhost:11434/v1\".to_string(),\n            crate::config::AIProvider::Kimi =\u003e \"https://api.moonshot.ai/v1\".to_string(),\n            crate::config::AIProvider::DeepSeek =\u003e \"https://api.deepseek.com\".to_string(),\n        };\n\n        // Verificar si existen variables de entorno\n        let env_url = env::var(format!(\"{}_BASE_URL\", provider.as_str().to_uppercase())).ok();\n        let env_key = env::var(format!(\"{}_API_KEY\", provider.as_str().to_uppercase())).ok();\n\n        // Solo pedimos la URL si es Ollama, para los demás usamos la hardcoded (o env)\n        let api_url: String = Input::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(format!(\"URL de la API para {}\", provider.as_str()))\n            .default(env_url.unwrap_or(default_url))\n            .interact_text()\n            .into_diagnostic()?;\n\n        let api_key: String = if provider == crate::config::AIProvider::Ollama {\n            Input::with_theme(\u0026ColorfulTheme::default())\n                .with_prompt(\"API Key (opcional para Ollama)\")\n                .allow_empty(true)\n                .default(env_key.unwrap_or_else(|| String::new()))\n                .interact_text()\n                .into_diagnostic()?\n        } else {\n            Input::with_theme(\u0026ColorfulTheme::default())\n                .with_prompt(format!(\"API Key para {}\", provider.as_str()))\n                .default(env_key.unwrap_or_else(|| String::new()))\n                .interact_text()\n                .into_diagnostic()?\n        };\n\n        // Obtener modelos dinámicamente usando los curls\n        println!(\n            \"🔍 Conectando con {} para obtener modelos...\",\n            provider.as_str()\n        );\n        let model: String =\n            match crate::ai::obtener_modelos_disponibles(\u0026provider, \u0026api_url, \u0026api_key) {\n                Ok(mut models) if !models.is_empty() =\u003e {\n                    models.sort();\n                    let selection = Select::with_theme(\u0026ColorfulTheme::default())\n                        .with_prompt(\"Selecciona el modelo\")\n                        .items(\u0026models)\n                        .default(0)\n                        .interact()\n                        .into_diagnostic()?;\n                    models[selection].clone()\n                }\n                Err(e) =\u003e {\n                    println!(\n                        \"⚠️  No se pudieron obtener los modelos automáticamente: {}\",\n                        e\n                    );\n                    Input::with_theme(\u0026ColorfulTheme::default())\n                    .with_prompt(\n                        \"Ingresa el nombre del modelo manualmente (ej: claude-3-5-sonnet-20241022)\",\n                    )\n                    .interact_text()\n                    .into_diagnostic()?\n                }\n                _ =\u003e {\n                    println!(\"⚠️  La lista de modelos está vacía.\");\n                    Input::with_theme(\u0026ColorfulTheme::default())\n                        .with_prompt(\"Ingresa el nombre del modelo manualmente\")\n                        .interact_text()\n                        .into_diagnostic()?\n                }\n            };\n\n        configs.push(crate::config::AIConfig {\n            name,\n            provider,\n            api_url,\n            api_key,\n            model,\n        });\n\n        println!(\"✅ Configuración añadida.\");\n\n        let add_another = dialoguer::Confirm::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"¿Deseas agregar otro modelo de IA?\")\n            .default(false)\n            .interact()\n            .into_diagnostic()?;\n\n        if !add_another {\n            break;\n        }\n    }\n\n    Ok(configs)\n}\n\n/// Permite al usuario elegir qué reglas de las sugeridas por la IA desea aplicar.\npub fn ask_user_to_confirm_rules(\n    suggestions: AISuggestionResponse,\n) -\u003e Result\u003c(Vec\u003cSuggestedRule\u003e, usize)\u003e {\n    println!(\"\\n🤖 El Arquitecto Virtual ha analizado tu proyecto.\");\n    println!(\n        \"\\n🤖 El Arquitecto Virtual sugiere el patrón: {}\",\n        suggestions.pattern\n    );\n\n    let max_lines: usize = Input::with_theme(\u0026ColorfulTheme::default())\n        .with_prompt(\"Límite máximo de líneas por función sugerido\")\n        .default(suggestions.suggested_max_lines)\n        .interact_text()\n        .into_diagnostic()?;\n\n    println!(\"Deseas aplicar las siguientes reglas de importación?\\n\");\n\n    // Preparamos las etiquetas para el menú (Regla + Razón)\n    let items: Vec\u003cString\u003e = suggestions\n        .rules\n        .iter()\n        .map(|r| format!(\"{} -\u003e {} \\n   └─ Razón: {}\", r.from, r.to, r.reason))\n        .collect();\n\n    // Por defecto, todas las reglas están marcadas (true)\n    let defaults = vec![true; items.len()];\n\n    let selections = MultiSelect::with_theme(\u0026ColorfulTheme::default())\n        .with_prompt(\"Usa [Espacio] para marcar/desmarcar y [Enter] para confirmar\")\n        .items(\u0026items)\n        .defaults(\u0026defaults)\n        .interact()\n        .into_diagnostic()?;\n\n    // Filtramos solo las reglas seleccionadas por el usuario\n    let mut selected_rules = Vec::new();\n    for index in selections {\n        selected_rules.push(suggestions.rules[index].clone());\n    }\n\n    Ok((selected_rules, max_lines))\n}\n\npub fn get_interactive_path() -\u003e Result\u003cPathBuf\u003e {\n    let current_dir = env::current_dir().into_diagnostic()?;\n    let search_dir = current_dir.parent().unwrap_or(\u0026current_dir);\n\n    let projects: Vec\u003cPathBuf\u003e = std::fs::read_dir(search_dir)\n        .into_diagnostic()?\n        .filter_map(|e| e.ok())\n        .map(|e| e.path())\n        .filter(|p| p.is_dir() \u0026\u0026 p.join(\"package.json\").exists())\n        .collect();\n\n    let mut options: Vec\u003cString\u003e = projects\n        .iter()\n        .map(|p| {\n            p.file_name()\n                .map(|n| n.to_string_lossy().into_owned())\n                .unwrap_or_else(|| \"Unknown\".to_string())\n        })\n        .collect();\n\n    options.push(\"\u003e\u003e Ingresar ruta manualmente...\".into());\n\n    let selection = Select::with_theme(\u0026ColorfulTheme::default())\n        .with_prompt(\"Selecciona proyecto\")\n        .items(\u0026options)\n        .interact()\n        .into_diagnostic()?;\n\n    if selection == options.len() - 1 {\n        let path: String = Input::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"Ruta completa\")\n            .interact_text()\n            .into_diagnostic()?;\n\n        Ok(PathBuf::from(path))\n    } else {\n        Ok(projects[selection].clone())\n    }\n}\n","traces":[{"line":125,"address":[24331004,24330992],"length":1,"stats":{"Line":0}},{"line":131,"address":[24330960,24330972],"length":1,"stats":{"Line":0}},{"line":220,"address":[24331716,24331680],"length":1,"stats":{"Line":0}},{"line":248,"address":[24331166,24331136],"length":1,"stats":{"Line":0}},{"line":249,"address":[24331484,24331456],"length":1,"stats":{"Line":0}},{"line":250,"address":[24331248,24331216],"length":1,"stats":{"Line":0}},{"line":255,"address":[24331024],"length":1,"stats":{"Line":0}},{"line":256,"address":[24331061],"length":1,"stats":{"Line":0}},{"line":257,"address":[24331616,24331640,24331081],"length":1,"stats":{"Line":0}},{"line":258,"address":[24331568,24331097,24331580],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":10},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","watch.rs"],"content":"use miette::{IntoDiagnostic, Result};\nuse notify::{Config, Event, EventKind, RecommendedWatcher, RecursiveMode, Watcher};\nuse std::io::Write;\nuse std::path::{Path, PathBuf};\nuse std::sync::mpsc::{channel, Sender};\nuse std::time::{Duration, Instant};\n\n/// Commands available in interactive watch mode\n#[derive(Debug, Clone)]\npub enum WatchCommand {\n    Fix,            // 'f' - Run AI auto-fix\n    ReportJson,     // 'r' - Generate JSON report\n    ReportMarkdown, // 'm' - Generate Markdown report\n    FullAnalysis,   // 'a' - Full analysis with dashboard\n    Violations,     // 'v' - List all current violations\n    Dashboard,      // 'd' - Show health score\n    Clear,          // 'c' - Clear screen\n    Help,           // 'h' - Show commands\n    Quit,           // 'q' - Exit\n}\n\n/// Print the interactive watch mode help banner\npub fn print_watch_help() {\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"  Interactive Watch Mode Commands\");\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"  f + Enter  →  Fix: auto-fix violations with AI\");\n    println!(\"  r + Enter  →  Report: generate JSON report\");\n    println!(\"  m + Enter  →  Markdown: generate Markdown report\");\n    println!(\"  a + Enter  →  Analyze: full analysis with dashboard\");\n    println!(\"  v + Enter  →  Violations: list all current violations\");\n    println!(\"  d + Enter  →  Dashboard: show health score\");\n    println!(\"  c + Enter  →  Clear: clear terminal screen\");\n    println!(\"  h + Enter  →  Help: show this menu\");\n    println!(\"  q + Enter  →  Quit: exit watch mode\");\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!();\n    let _ = std::io::stdout().flush();\n}\n\n/// Parse a single character into a WatchCommand\nfn parse_command(input: \u0026str) -\u003e Option\u003cWatchCommand\u003e {\n    match input.trim().to_lowercase().as_str() {\n        \"f\" =\u003e Some(WatchCommand::Fix),\n        \"r\" =\u003e Some(WatchCommand::ReportJson),\n        \"m\" =\u003e Some(WatchCommand::ReportMarkdown),\n        \"a\" =\u003e Some(WatchCommand::FullAnalysis),\n        \"v\" =\u003e Some(WatchCommand::Violations),\n        \"d\" =\u003e Some(WatchCommand::Dashboard),\n        \"c\" =\u003e Some(WatchCommand::Clear),\n        \"h\" =\u003e Some(WatchCommand::Help),\n        \"q\" =\u003e Some(WatchCommand::Quit),\n        _ =\u003e None,\n    }\n}\n\n/// Internal event used to unify file watcher and stdin into one channel\nenum InternalEvent {\n    FileNotify(notify::Result\u003cEvent\u003e),\n    UserInput(WatchCommand),\n}\n\n/// Spawn a thread that reads lines from stdin and sends parsed commands.\n/// Uses `read_line` per iteration instead of holding a persistent `stdin.lock()`\n/// to avoid blocking stdin on Windows.\nfn spawn_stdin_reader(tx: Sender\u003cInternalEvent\u003e) {\n    std::thread::spawn(move || {\n        loop {\n            let mut input = String::new();\n            match std::io::stdin().read_line(\u0026mut input) {\n                Ok(0) =\u003e break, // EOF — stdin closed\n                Ok(_) =\u003e {\n                    if let Some(cmd) = parse_command(\u0026input) {\n                        if tx.send(InternalEvent::UserInput(cmd)).is_err() {\n                            break; // Channel closed, main loop exited\n                        }\n                    } else if !input.trim().is_empty() {\n                        eprintln!(\n                            \"Unknown command: '{}'. Press h + Enter for help.\",\n                            input.trim()\n                        );\n                    }\n                }\n                Err(_) =\u003e break,\n            }\n        }\n    });\n}\n\n/// Inicia el modo watch interactivo para observación continua\npub fn start_watch_mode\u003cF, G\u003e(\n    project_root: \u0026Path,\n    ignored_paths: Vec\u003cString\u003e,\n    mut on_change: F,\n    mut on_command: G,\n) -\u003e Result\u003c()\u003e\nwhere\n    F: FnMut(\u0026[PathBuf]) -\u003e Result\u003c()\u003e,\n    G: FnMut(WatchCommand) -\u003e Result\u003cbool\u003e, // returns false to quit\n{\n    println!(\"👁️  Modo Watch activado\");\n    println!(\"📂 Observando: {}\", project_root.display());\n\n    if !ignored_paths.is_empty() {\n        println!(\"🚫 Ignorando: {}\", ignored_paths.join(\", \"));\n    }\n\n    println!(\"⏱️  Debounce: 300ms\\n\");\n\n    print_watch_help();\n\n    // Unified channel for both file events and user commands\n    let (unified_tx, unified_rx) = channel::\u003cInternalEvent\u003e();\n\n    // Setup file watcher sending to the unified channel\n    let file_tx = unified_tx.clone();\n    let _watcher = {\n        let mut watcher = RecommendedWatcher::new(\n            move |res| {\n                let _ = file_tx.send(InternalEvent::FileNotify(res));\n            },\n            Config::default(),\n        )\n        .into_diagnostic()?;\n\n        watcher\n            .watch(project_root, RecursiveMode::Recursive)\n            .into_diagnostic()?;\n\n        watcher // keep alive by binding to _watcher\n    };\n\n    // Spawn stdin reader thread\n    spawn_stdin_reader(unified_tx);\n\n    // Build file-filtering helpers (reuse FileWatcher logic inline)\n    let project_root_buf = project_root.to_path_buf();\n    let ignored = ignored_paths.clone();\n    let debounce_duration = Duration::from_millis(300);\n\n    let is_relevant_file = |path: \u0026Path| -\u003e bool {\n        if let Some(ext) = path.extension() {\n            matches!(\n                ext.to_str(),\n                Some(\"ts\") | Some(\"tsx\") | Some(\"js\") | Some(\"jsx\")\n            )\n        } else {\n            false\n        }\n    };\n\n    let should_ignore_path = |path: \u0026Path| -\u003e bool {\n        let relative_path = path\n            .strip_prefix(\u0026project_root_buf)\n            .unwrap_or(path)\n            .to_string_lossy()\n            .replace('\\\\', \"/\");\n\n        for pattern in \u0026ignored {\n            let normalized_pattern = pattern.replace('\\\\', \"/\");\n            if relative_path.contains(normalized_pattern.trim_end_matches('/'))\n                || relative_path.starts_with(\u0026normalized_pattern)\n                || relative_path\n                    .starts_with(\u0026format!(\"{}/\", normalized_pattern.trim_end_matches('/')))\n            {\n                return true;\n            }\n        }\n        false\n    };\n\n    let is_relevant_event = |event: \u0026Event| -\u003e bool {\n        matches!(\n            event.kind,\n            EventKind::Modify(_) | EventKind::Create(_) | EventKind::Remove(_)\n        )\n    };\n\n    print!(\"👁️  Esperando cambios o comandos... (h + Enter = ayuda)\\n\u003e \");\n    let _ = std::io::stdout().flush();\n\n    // Main loop with debouncing for file events\n    let mut changed_files: Vec\u003cPathBuf\u003e = Vec::new();\n    let mut last_event_time = Instant::now();\n\n    loop {\n        match unified_rx.recv_timeout(Duration::from_millis(100)) {\n            Ok(InternalEvent::FileNotify(Ok(event))) =\u003e {\n                if is_relevant_event(\u0026event) {\n                    for path in \u0026event.paths {\n                        if is_relevant_file(path) \u0026\u0026 !should_ignore_path(path) {\n                            if !changed_files.contains(path) {\n                                changed_files.push(path.clone());\n                            }\n                        }\n                    }\n                    last_event_time = Instant::now();\n                }\n            }\n            Ok(InternalEvent::FileNotify(Err(e))) =\u003e {\n                eprintln!(\"⚠️  Error en file watcher: {:?}\", e);\n            }\n            Ok(InternalEvent::UserInput(cmd)) =\u003e {\n                match on_command(cmd) {\n                    Ok(true) =\u003e {\n                        print!(\"\\n👁️  Esperando cambios o comandos...\\n\u003e \");\n                        let _ = std::io::stdout().flush();\n                    }\n                    Ok(false) =\u003e {\n                        // Quit requested\n                        println!(\"👋 Saliendo del modo watch...\");\n                        return Ok(());\n                    }\n                    Err(e) =\u003e {\n                        eprintln!(\"❌ Error ejecutando comando: {}\", e);\n                        print!(\"\\n👁️  Esperando cambios o comandos...\\n\u003e \");\n                        let _ = std::io::stdout().flush();\n                    }\n                }\n            }\n            Err(_) =\u003e {\n                // Timeout — check if debounced file changes are ready\n            }\n        }\n\n        // Process accumulated file changes after debounce period\n        if !changed_files.is_empty() \u0026\u0026 last_event_time.elapsed() \u003e= debounce_duration {\n            println!(\n                \"\\n🔄 Cambios detectados en {} archivo(s):\",\n                changed_files.len()\n            );\n            for file in \u0026changed_files {\n                println!(\"   📝 {}\", file.display());\n            }\n            println!();\n\n            if let Err(e) = on_change(\u0026changed_files) {\n                eprintln!(\"❌ Error durante re-análisis: {}\", e);\n            } else {\n                println!(\"✅ Re-análisis completado\");\n            }\n\n            changed_files.clear();\n            print!(\"\\n👁️  Esperando cambios o comandos...\\n\u003e \");\n            let _ = std::io::stdout().flush();\n        }\n    }\n}\n","traces":[{"line":23,"address":[25438976],"length":1,"stats":{"Line":0}},{"line":24,"address":[25438980],"length":1,"stats":{"Line":0}},{"line":25,"address":[25439009],"length":1,"stats":{"Line":0}},{"line":26,"address":[25439038],"length":1,"stats":{"Line":0}},{"line":27,"address":[25439067],"length":1,"stats":{"Line":0}},{"line":28,"address":[25439096],"length":1,"stats":{"Line":0}},{"line":29,"address":[25439125],"length":1,"stats":{"Line":0}},{"line":30,"address":[25439154],"length":1,"stats":{"Line":0}},{"line":31,"address":[25439183],"length":1,"stats":{"Line":0}},{"line":32,"address":[25439212],"length":1,"stats":{"Line":0}},{"line":33,"address":[25439241],"length":1,"stats":{"Line":0}},{"line":34,"address":[25439270],"length":1,"stats":{"Line":0}},{"line":35,"address":[25439299],"length":1,"stats":{"Line":0}},{"line":36,"address":[25439328],"length":1,"stats":{"Line":0}},{"line":37,"address":[25439357],"length":1,"stats":{"Line":0}},{"line":38,"address":[25439386],"length":1,"stats":{"Line":0}},{"line":42,"address":[25438954,25438960,25438352],"length":1,"stats":{"Line":0}},{"line":43,"address":[25438366,25438460],"length":1,"stats":{"Line":0}},{"line":44,"address":[25438542,25438476],"length":1,"stats":{"Line":0}},{"line":45,"address":[25438556,25438595,25438519],"length":1,"stats":{"Line":0}},{"line":46,"address":[25438609,25438648,25438572],"length":1,"stats":{"Line":0}},{"line":47,"address":[25438662,25438701,25438625],"length":1,"stats":{"Line":0}},{"line":48,"address":[25438715,25438754,25438678],"length":1,"stats":{"Line":0}},{"line":49,"address":[25438731,25438768,25438807],"length":1,"stats":{"Line":0}},{"line":50,"address":[25438857,25438818,25438784],"length":1,"stats":{"Line":0}},{"line":51,"address":[25438868,25438906,25438834],"length":1,"stats":{"Line":0}},{"line":52,"address":[25438929,25438884,25438916],"length":1,"stats":{"Line":0}},{"line":53,"address":[25438922],"length":1,"stats":{"Line":0}},{"line":66,"address":[25439440],"length":1,"stats":{"Line":0}},{"line":67,"address":[25438270,25437264,25437908],"length":1,"stats":{"Line":0}},{"line":69,"address":[25437295],"length":1,"stats":{"Line":0}},{"line":70,"address":[25437533,25437414,25437346],"length":1,"stats":{"Line":0}},{"line":73,"address":[25437623,25437552],"length":1,"stats":{"Line":0}},{"line":74,"address":[25437686,25437768],"length":1,"stats":{"Line":0}},{"line":77,"address":[25437748,25437924],"length":1,"stats":{"Line":0}},{"line":78,"address":[25438058],"length":1,"stats":{"Line":0}},{"line":80,"address":[25437980],"length":1,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":118}]};
        var previousData = {"files":[{"path":["/","home","protec","Documentos","dev","architect-linter-pro","benches","parsing_bench.rs"],"content":"//! Parsing performance benchmarks for Architect Linter Pro\n//!\n//! This module benchmarks the parsing performance for different file counts.\n//! It establishes performance baselines for detecting regressions.\n//!\n//! Run with: cargo bench --bench parsing_bench\n\nuse architect_linter_pro::analyzer::swc_parser;\nuse architect_linter_pro::config::{ArchPattern, Framework, LinterContext};\nuse criterion::{black_box, criterion_group, criterion_main, BenchmarkId, Criterion};\nuse std::path::{Path, PathBuf};\nuse swc_common::sync::Lrc;\nuse swc_common::SourceMap;\nuse tempfile::TempDir;\n\n/// Sample TypeScript code for benchmarking\nconst TS_CODE: \u0026str = r#\"\nexport class Service {\n    constructor(private id: number) {}\n\n    getData(): Data {\n        return new Data();\n    }\n\n    processData(input: string): number {\n        let result = 0;\n        for (let i = 0; i \u003c input.length; i++) {\n            result += input.charCodeAt(i);\n        }\n        return result;\n    }\n}\n\nexport class Data {\n    constructor() {}\n\n    validate(): boolean {\n        return true;\n    }\n\n    transform(value: string): string {\n        return value.trim().toLowerCase();\n    }\n}\n\nexport class Controller {\n    constructor(private service: Service) {}\n\n    handleRequest(input: string): number {\n        const data = this.service.getData();\n        return this.service.processData(input);\n    }\n}\n\"#;\n\n/// Create TypeScript files for benchmarking\nfn create_ts_files(n: usize, temp_dir: \u0026Path) {\n    for i in 0..n {\n        let file_path = temp_dir.join(format!(\"test{}.ts\", i));\n        std::fs::write(\u0026file_path, TS_CODE).unwrap();\n    }\n}\n\n/// Create a test LinterContext for benchmarking\nfn create_test_context() -\u003e LinterContext {\n    LinterContext {\n        max_lines: 50,\n        framework: Framework::Unknown,\n        pattern: ArchPattern::MVC,\n        forbidden_imports: vec![],\n        ignored_paths: vec![],\n        ai_configs: vec![],\n    }\n}\n\n/// Benchmark parsing 10 files\nfn bench_parse_10_files(c: \u0026mut Criterion) {\n    let temp_dir = TempDir::new().unwrap();\n    create_ts_files(10, temp_dir.path());\n    let parser_context = create_test_context();\n    let cm = Lrc::new(SourceMap::default());\n    let files: Vec\u003cPathBuf\u003e = (0..10)\n        .map(|i| temp_dir.path().join(format!(\"test{}.ts\", i)))\n        .collect();\n\n    c.bench_function(\"parse_10_files\", |b| {\n        b.iter(|| {\n            for file in \u0026files {\n                black_box(\n                    swc_parser::analyze_file(\u0026cm, file, \u0026parser_context)\n                        .unwrap_or_else(|e| panic!(\"Parse failed: {}\", e)),\n                );\n            }\n        });\n    });\n}\n\n/// Benchmark parsing 100 files\nfn bench_parse_100_files(c: \u0026mut Criterion) {\n    let temp_dir = TempDir::new().unwrap();\n    create_ts_files(100, temp_dir.path());\n    let parser_context = create_test_context();\n    let cm = Lrc::new(SourceMap::default());\n    let files: Vec\u003cPathBuf\u003e = (0..100)\n        .map(|i| temp_dir.path().join(format!(\"test{}.ts\", i)))\n        .collect();\n\n    c.bench_function(\"parse_100_files\", |b| {\n        b.iter(|| {\n            for file in \u0026files {\n                black_box(\n                    swc_parser::analyze_file(\u0026cm, file, \u0026parser_context)\n                        .unwrap_or_else(|e| panic!(\"Parse failed: {}\", e)),\n                );\n            }\n        });\n    });\n}\n\n/// Benchmark parsing with different file counts\nfn bench_parse_scaling(c: \u0026mut Criterion) {\n    let mut group = c.benchmark_group(\"parse_scaling\");\n    let file_counts = vec![10, 50, 100];\n\n    for file_count in file_counts {\n        let temp_dir = TempDir::new().unwrap();\n        create_ts_files(file_count, temp_dir.path());\n        let parser_context = create_test_context();\n        let cm = Lrc::new(SourceMap::default());\n        let files: Vec\u003cPathBuf\u003e = (0..file_count)\n            .map(|i| temp_dir.path().join(format!(\"test{}.ts\", i)))\n            .collect();\n\n        group.bench_with_input(\n            BenchmarkId::from_parameter(file_count),\n            \u0026file_count,\n            |b, \u0026_file_count| {\n                b.iter(|| {\n                    for file in \u0026files {\n                        black_box(\n                            swc_parser::analyze_file(\u0026cm, file, \u0026parser_context)\n                                .unwrap_or_else(|e| panic!(\"Parse failed: {}\", e)),\n                        );\n                    }\n                });\n            },\n        );\n\n        drop(temp_dir);\n    }\n\n    group.finish();\n}\n\ncriterion_group!(\n    benches,\n    bench_parse_10_files,\n    bench_parse_100_files,\n    bench_parse_scaling\n);\ncriterion_main!(benches);\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","benches","performance_bench.rs"],"content":"//! Performance benchmarks for Architect Linter Pro\n//!\n//! This module benchmarks key performance characteristics:\n//! - Parallel vs sequential file analysis\n//! - Cache hit/miss performance\n//!\n//! Run with: cargo bench\n\nuse criterion::{black_box, criterion_group, criterion_main, BenchmarkId, Criterion};\nuse std::fs;\nuse std::path::{Path, PathBuf};\nuse std::sync::Arc;\nuse std::time::Instant;\nuse tempfile::TempDir;\n\n// Import our modules for benchmarking\nuse architect_linter_pro::analyzer::collector::analyze_all_files;\nuse architect_linter_pro::cache::{AnalysisCache, FileCacheEntry};\nuse architect_linter_pro::config::{\n    AIConfig, ArchPattern, ForbiddenRule, Framework, LinterContext,\n};\nuse architect_linter_pro::discovery;\nuse architect_linter_pro::memory_cache::MemoryCache;\nuse swc_common::sync::Lrc;\nuse swc_common::SourceMap;\n\n/// Create a temporary directory with test TypeScript/JavaScript files\nfn create_test_files(count: usize, avg_lines: usize) -\u003e TempDir {\n    let temp_dir = TempDir::new().unwrap();\n    let _files = (0..count)\n        .map(|i| {\n            let file_path = temp_dir.path().join(format!(\"file_{}.ts\", i));\n            let content = generate_ts_file(avg_lines, i);\n            fs::write(\u0026file_path, content).unwrap();\n            file_path\n        })\n        .collect::\u003cVec\u003cPathBuf\u003e\u003e();\n\n    temp_dir\n}\n\n/// Generate a TypeScript file with specified number of lines\nfn generate_ts_file(lines: usize, file_index: usize) -\u003e String {\n    let mut content = String::new();\n    content.push_str(\u0026format!(\"// File {} with {} lines\\n\", file_index, lines));\n\n    if lines \u003e 10 {\n        content.push_str(\"import { Component, Injectable } from '@angular/core';\\n\");\n        content.push_str(\"import { UserService } from './user.service';\\n\\n\");\n    }\n\n    for i in 0..(lines / 5) {\n        content.push_str(\u0026format!(\"export class Component{} {{\\n\", i));\n        content.push_str(\"  constructor(private service: UserService) {}\\n\");\n        content.push_str(\"\\n  public method1() {\\n\");\n        content.push_str(\"    return this.service.getData();\\n\");\n        content.push_str(\"  }\\n\\n\");\n        content.push_str(\"  public method2() {\\n\");\n        content.push_str(\"    const data = [];\\n\");\n        for j in 0..10 {\n            content.push_str(\u0026format!(\"    data.push('item{}');\\n\", j));\n        }\n        content.push_str(\"    return data;\\n\");\n        content.push_str(\"  }\\n\");\n        content.push_str(\"}\\n\\n\");\n    }\n\n    content\n}\n\n/// Setup function for benchmarks\nfn setup_linter_context() -\u003e LinterContext {\n    LinterContext {\n        max_lines: 50,\n        framework: Framework::Unknown,\n        pattern: ArchPattern::Clean,\n        forbidden_imports: vec![ForbiddenRule {\n            from: \"*\".to_string(),\n            to: \"app/components\".to_string(),\n        }],\n        ignored_paths: vec![],\n        ai_configs: vec![],\n    }\n}\n\n/// Benchmark parallel vs sequential file analysis\nfn bench_sequential_vs_parallel(c: \u0026mut Criterion) {\n    let file_counts = vec![10, 50, 100];\n    let ctx = setup_linter_context();\n\n    for file_count in file_counts {\n        let temp_dir = create_test_files(file_count, 20);\n        let files: Vec\u003cPathBuf\u003e = (0..file_count)\n            .map(|i| temp_dir.path().join(format!(\"file_{}.ts\", i)))\n            .collect();\n\n        // Parallel analysis (current implementation)\n        let mut par_group = c.benchmark_group(\"parallel_analysis\");\n\n        par_group.bench_with_input(\n            BenchmarkId::new(\"parallel\", file_count),\n            \u0026(\u0026files, \u0026temp_dir.path(), \u0026ctx),\n            |b, \u0026(ref files, ref project_root, ref ctx)| {\n                let cm = Lrc::new(SourceMap::default());\n                b.iter(|| {\n                    black_box(analyze_all_files(\n                        files,\n                        project_root,\n                        ctx.pattern.clone(),\n                        ctx,\n                        \u0026cm,\n                        Some(\u0026mut AnalysisCache::new(\"test_config_hash\".to_string())),\n                    ))\n                    .unwrap();\n                });\n            },\n        );\n        par_group.finish();\n\n        // Drop temp directory after benchmark\n        drop(temp_dir);\n    }\n}\n\n/// Benchmark cache performance - hit vs miss\nfn bench_cache_performance(c: \u0026mut Criterion) {\n    let temp_dir = create_test_files(50, 20);\n    let files: Vec\u003cPathBuf\u003e = (0..50)\n        .map(|i| temp_dir.path().join(format!(\"file_{}.ts\", i)))\n        .collect();\n\n    let ctx = setup_linter_context();\n    let project_root = temp_dir.path();\n\n    // Create and populate cache\n    let cache_key = \"test\".to_string();\n    let mut cache = AnalysisCache::new(\"test_config_hash\".to_string());\n\n    // Pre-populate cache with some entries\n    for i in 0..25 {\n        let file_path = project_root.join(format!(\"file_{}.ts\", i));\n        let content = fs::read(\u0026file_path).unwrap();\n        let content_hash = architect_linter_pro::cache::hash_content(\u0026content);\n\n        cache.insert(\n            architect_linter_pro::cache::AnalysisCache::normalize_path(\u0026file_path, project_root),\n            FileCacheEntry {\n                content_hash,\n                violations: vec![],\n                long_functions: vec![],\n                import_count: 5,\n                function_count: 10,\n            },\n        );\n    }\n\n    // Benchmark cache hits\n    let mut cache_hit_group = c.benchmark_group(\"cache_hits\");\n\n    cache_hit_group.bench_function(\"cache_hit\", |b| {\n        b.iter(|| {\n            // Hit the cache for existing files\n            for i in 0..25 {\n                let file_path = project_root.join(format!(\"file_{}.ts\", i));\n                let normalized_key = architect_linter_pro::cache::AnalysisCache::normalize_path(\n                    \u0026file_path,\n                    project_root,\n                );\n                let content_hash = format!(\"{:016x}\", i as u64); // Simulated content hash\n\n                black_box(cache.get(\u0026normalized_key, \u0026content_hash));\n            }\n        });\n    });\n    cache_hit_group.finish();\n\n    // Benchmark cache misses\n    let mut cache_miss_group = c.benchmark_group(\"cache_misses\");\n\n    cache_miss_group.bench_function(\"cache_miss\", |b| {\n        b.iter(|| {\n            // Try to get non-existent files\n            for i in 25..50 {\n                let file_path = project_root.join(format!(\"file_{}.ts\", i));\n                let normalized_key = architect_linter_pro::cache::AnalysisCache::normalize_path(\n                    \u0026file_path,\n                    project_root,\n                );\n                let content_hash = format!(\"{:016x}\", i as u64);\n\n                black_box(cache.get(\u0026normalized_key, \u0026content_hash));\n            }\n        });\n    });\n    cache_miss_group.finish();\n\n    // Benchmark memory cache performance\n    let mut mem_cache_group = c.benchmark_group(\"memory_cache\");\n\n    let memory_cache = Arc::new(MemoryCache::new(100));\n\n    // Populate memory cache\n    for i in 0..50 {\n        let file_path = project_root.join(format!(\"file_{}.ts\", i));\n        memory_cache.put(file_path, format!(\"hash_{}\", i));\n    }\n\n    mem_cache_group.bench_function(\"memory_cache_get\", |b| {\n        b.iter(|| {\n            for i in 0..50 {\n                let file_path = project_root.join(format!(\"file_{}.ts\", i));\n                black_box(memory_cache.get(\u0026file_path));\n            }\n        });\n    });\n    mem_cache_group.finish();\n\n    // Drop temp directory\n    drop(temp_dir);\n}\n\n/// Benchmark memory usage with different file counts\nfn bench_memory_usage(c: \u0026mut Criterion) {\n    let mut memory_group = c.benchmark_group(\"memory_usage\");\n\n    let file_counts = vec![10, 25, 50];\n\n    for file_count in file_counts {\n        memory_group.bench_with_input(\n            BenchmarkId::new(\"analyze_files\", file_count),\n            \u0026file_count,\n            |b, \u0026file_count| {\n                let temp_dir = create_test_files(file_count, 20);\n                let files: Vec\u003cPathBuf\u003e = (0..file_count)\n                    .map(|i| temp_dir.path().join(format!(\"file_{}.ts\", i)))\n                    .collect();\n\n                let ctx = setup_linter_context();\n                let project_root = temp_dir.path();\n\n                b.iter(|| {\n                    let start = Instant::now();\n                    let result = analyze_all_files(\n                        \u0026files,\n                        project_root,\n                        ctx.pattern.clone(),\n                        \u0026ctx,\n                        \u0026Lrc::new(SourceMap::default()),\n                        Some(\u0026mut AnalysisCache::new(\"test_config_hash\".to_string())),\n                    )\n                    .unwrap();\n                    let duration = start.elapsed();\n\n                    // Include result size in benchmark to prevent optimization\n                    black_box(result);\n                    black_box(duration);\n                });\n\n                drop(temp_dir);\n            },\n        );\n    }\n\n    memory_group.finish();\n}\n\ncriterion_group!(\n    benches,\n    bench_sequential_vs_parallel,\n    bench_cache_performance,\n    bench_memory_usage\n);\ncriterion_main!(benches);\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","ai.rs"],"content":"use crate::config::{AIConfig, AIProvider};\nuse serde::{Deserialize, Serialize};\n\n// Estructuras para el mapeo de la respuesta de la IA\n#[derive(Deserialize, Serialize, Debug)]\npub struct AISuggestionResponse {\n    pub pattern: String,\n    pub suggested_max_lines: usize,\n    pub rules: Vec\u003cSuggestedRule\u003e,\n}\n\n#[derive(Deserialize, Serialize, Debug, Clone)]\npub struct SuggestedRule {\n    pub from: String,\n    pub to: String,\n    pub reason: String,\n}\n\n/// Obtiene la lista de modelos disponibles para el proveedor configurado\npub fn obtener_modelos_disponibles(\n    provider: \u0026AIProvider,\n    api_url: \u0026str,\n    api_key: \u0026str,\n) -\u003e anyhow::Result\u003cVec\u003cString\u003e\u003e {\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let url = api_url.trim_end_matches('/');\n\n        match provider {\n            AIProvider::Claude =\u003e {\n                let response = client\n                    .get(format!(\"{}/v1/models\", url))\n                    .header(\"x-api-key\", api_key)\n                    .header(\"anthropic-version\", \"2023-06-01\")\n                    .send()\n                    .await?;\n\n                let json: serde_json::Value = response.json().await?;\n                let models = json[\"data\"]\n                    .as_array()\n                    .ok_or_else(|| anyhow::anyhow!(\"Respuesta de Claude inválida\"))?\n                    .iter()\n                    .filter_map(|m| m[\"id\"].as_str().map(|s| s.to_string()))\n                    .collect();\n                Ok(models)\n            }\n            AIProvider::Gemini =\u003e {\n                let response = client\n                    .get(format!(\"{}/v1beta/models?key={}\", url, api_key))\n                    .send()\n                    .await?;\n\n                let json: serde_json::Value = response.json().await?;\n                let models = json[\"models\"]\n                    .as_array()\n                    .ok_or_else(|| anyhow::anyhow!(\"Respuesta de Gemini inválida\"))?\n                    .iter()\n                    .filter_map(|m| {\n                        m[\"name\"]\n                            .as_str()\n                            .map(|s| s.trim_start_matches(\"models/\").to_string())\n                    })\n                    .collect();\n                Ok(models)\n            }\n            AIProvider::OpenAI\n            | AIProvider::Groq\n            | AIProvider::Ollama\n            | AIProvider::Kimi\n            | AIProvider::DeepSeek =\u003e {\n                let mut request = client.get(format!(\"{}/models\", url));\n                if !api_key.is_empty() {\n                    request = request.header(\"authorization\", format!(\"Bearer {}\", api_key));\n                }\n\n                let response = request.send().await?;\n                let json: serde_json::Value = response.json().await?;\n                let models = json[\"data\"]\n                    .as_array()\n                    .ok_or_else(|| anyhow::anyhow!(\"Respuesta de API compatible inválida\"))?\n                    .iter()\n                    .filter_map(|m| m[\"id\"].as_str().map(|s| s.to_string()))\n                    .collect();\n                Ok(models)\n            }\n        }\n    })\n}\n\n/// Función para consultar la IA seleccionada de forma genérica\npub fn consultar_ia(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    match ai_config.provider {\n        AIProvider::Claude =\u003e consultar_claude(prompt, ai_config),\n        AIProvider::Gemini =\u003e consultar_gemini(prompt, ai_config),\n        AIProvider::OpenAI | AIProvider::Groq | AIProvider::Ollama | AIProvider::Kimi =\u003e {\n            consultar_openai_compatible(prompt, ai_config)\n        }\n        AIProvider::DeepSeek =\u003e consultar_openai_compatible(prompt, ai_config),\n    }\n}\n\n/// Orquestador que intenta consultar varias IAs en orden hasta que una funcione\npub fn consultar_ia_con_fallback(prompt: String, configs: \u0026[AIConfig]) -\u003e anyhow::Result\u003cString\u003e {\n    if configs.is_empty() {\n        return Err(anyhow::anyhow!(\"No hay configuraciones de IA disponibles. Ejecuta el linter sin architect.json para configurar una.\"));\n    }\n\n    let mut last_error = anyhow::anyhow!(\"Error desconocido\");\n\n    for (i, config) in configs.iter().enumerate() {\n        if i \u003e 0 {\n            println!(\n                \"\\n⚠️  El modelo '{}' falló. Intentando con el siguiente configurado: '{}'...\",\n                configs[i - 1].name,\n                config.name\n            );\n        }\n\n        match consultar_ia(prompt.clone(), config.clone()) {\n            Ok(res) =\u003e {\n                if i \u003e 0 {\n                    println!(\"✅ El modelo '{}' respondió correctamente.\\n\", config.name);\n                }\n                return Ok(res);\n            }\n            Err(e) =\u003e {\n                println!(\"❌ Error en '{}': {}\", config.name, e);\n                last_error = e;\n            }\n        }\n    }\n\n    Err(anyhow::anyhow!(\n        \"❌ Todos los modelos configurados fallaron. Último error: {}\",\n        last_error\n    ))\n}\n\n/// Función exclusiva para el Linter: Sugiere la arquitectura inicial\npub fn sugerir_arquitectura_inicial(\n    context: crate::discovery::ProjectContext,\n    ai_configs: Vec\u003cAIConfig\u003e,\n) -\u003e anyhow::Result\u003cAISuggestionResponse\u003e {\n    let prompt = format!(\n        \"Eres un Arquitecto de Software Senior. Analiza este proyecto {framework} con las siguientes dependencias: {deps:?}\n        y esta estructura de carpetas: {files:?}.\n        Además, estos son los archivos arquitectónicos clave del proyecto: {key_files:?}.\n\n        TAREA:\n        Identifica el patrón (Hexagonal, Clean o MVC) y sugiere reglas de importaciones prohibidas basándote en las mejores prácticas.\n        Usa los archivos arquitectónicos clave para entender mejor la estructura del proyecto (ej: user.controller.ts, auth_service.py indican convenciones de nomenclatura).\n\n        RESPONDE EXCLUSIVAMENTE EN FORMATO JSON con esta estructura:\n        {{\n          \\\"pattern\\\": \\\"Nombre del patrón\\\",\n          \\\"suggested_max_lines\\\": 60,\n          \\\"rules\\\": [\n            {{ \\\"from\\\": \\\"patrón_origen\\\", \\\"to\\\": \\\"patrón_prohibido\\\", \\\"reason\\\": \\\"explicación corta\\\" }}\n          ]\n        }}\",\n        framework = context.framework,\n        deps = context.dependencies,\n        files = context.folder_structure,\n        key_files = context.key_files\n    );\n\n    // Obtener respuesta con fallback\n    let response_text = consultar_ia_con_fallback(prompt, \u0026ai_configs)?;\n\n    // Limpiar el JSON de posibles textos adicionales de la IA\n    let json_start = response_text\n        .find('{')\n        .ok_or_else(|| anyhow::anyhow!(\"No se encontró JSON en la respuesta\"))?;\n    let json_end = response_text\n        .rfind('}')\n        .ok_or_else(|| anyhow::anyhow!(\"No se encontró JSON en la respuesta\"))?;\n    let clean_json = \u0026response_text[json_start..=json_end];\n\n    let suggestion: AISuggestionResponse = serde_json::from_str(clean_json)?;\n    Ok(suggestion)\n}\n\n/// Consulta la API de Claude (Anthropic)\nfn consultar_claude(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    let url = format!(\"{}/v1/messages\", ai_config.api_url.trim_end_matches('/'));\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let body = serde_json::json!({\n            \"model\": ai_config.model,\n            \"max_tokens\": 1024,\n            \"messages\": [{\n                \"role\": \"user\",\n                \"content\": prompt\n            }]\n        });\n\n        let response = client\n            .post(\u0026url)\n            .header(\"x-api-key\", \u0026ai_config.api_key)\n            .header(\"anthropic-version\", \"2023-06-01\")\n            .header(\"content-type\", \"application/json\")\n            .json(\u0026body)\n            .send()\n            .await?;\n\n        procesar_respuesta(response).await\n    })\n}\n\n/// Consulta la API de Gemini (Google)\nfn consultar_gemini(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    let url = format!(\n        \"{}/v1beta/models/{}:generateContent?key={}\",\n        ai_config.api_url.trim_end_matches('/'),\n        ai_config.model,\n        ai_config.api_key\n    );\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let body = serde_json::json!({\n            \"contents\": [{\n                \"parts\": [{\n                    \"text\": prompt\n                }]\n            }]\n        });\n\n        let response = client\n            .post(\u0026url)\n            .header(\"content-type\", \"application/json\")\n            .json(\u0026body)\n            .send()\n            .await?;\n\n        let status = response.status();\n        let response_text = response.text().await?;\n\n        if !status.is_success() {\n            return Err(anyhow::anyhow!(\n                \"Error Gemini ({}): {}\",\n                status,\n                response_text\n            ));\n        }\n\n        let json: serde_json::Value = serde_json::from_str(\u0026response_text)?;\n        let content = json[\"candidates\"][0][\"content\"][\"parts\"][0][\"text\"]\n            .as_str()\n            .ok_or_else(|| anyhow::anyhow!(\"No se pudo extraer texto de Gemini\"))?;\n\n        Ok(content.to_string())\n    })\n}\n\n/// Consulta APIs compatibles con OpenAI (OpenAI, Groq, Ollama)\nfn consultar_openai_compatible(prompt: String, ai_config: AIConfig) -\u003e anyhow::Result\u003cString\u003e {\n    let url = format!(\n        \"{}/chat/completions\",\n        ai_config.api_url.trim_end_matches('/')\n    );\n    let runtime = tokio::runtime::Runtime::new()?;\n\n    runtime.block_on(async {\n        let client = reqwest::Client::new();\n        let body = serde_json::json!({\n            \"model\": ai_config.model,\n            \"messages\": [\n                {\"role\": \"system\", \"content\": \"Eres un Arquitecto de Software Senior.\"},\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            \"temperature\": 0.1\n        });\n\n        let mut request = client.post(\u0026url).header(\"content-type\", \"application/json\");\n\n        if !ai_config.api_key.is_empty() {\n            request = request.header(\"authorization\", format!(\"Bearer {}\", ai_config.api_key));\n        }\n\n        let response = request.json(\u0026body).send().await?;\n\n        let status = response.status();\n        let response_text = response.text().await?;\n\n        if !status.is_success() {\n            return Err(anyhow::anyhow!(\"Error API ({}): {}\", status, response_text));\n        }\n\n        let json: serde_json::Value = serde_json::from_str(\u0026response_text)?;\n        let content = json[\"choices\"][0][\"message\"][\"content\"]\n            .as_str()\n            .ok_or_else(|| anyhow::anyhow!(\"No se pudo extraer texto de la respuesta\"))?;\n\n        Ok(content.to_string())\n    })\n}\n\nasync fn procesar_respuesta(response: reqwest::Response) -\u003e anyhow::Result\u003cString\u003e {\n    let status = response.status();\n    let response_text = response.text().await?;\n\n    if !status.is_success() {\n        return Err(anyhow::anyhow!(\"Error API ({}): {}\", status, response_text));\n    }\n\n    let json: serde_json::Value = serde_json::from_str(\u0026response_text)?;\n\n    // Claude format\n    if let Some(content) = json[\"content\"][0][\"text\"].as_str() {\n        return Ok(content.to_string());\n    }\n\n    Ok(response_text)\n}\n","traces":[{"line":20,"address":[24898304,24898771,24898777],"length":1,"stats":{"Line":0}},{"line":25,"address":[24898362],"length":1,"stats":{"Line":0}},{"line":27,"address":[24898628],"length":1,"stats":{"Line":0}},{"line":28,"address":[25054791,25054514],"length":1,"stats":{"Line":0}},{"line":29,"address":[25054906,25054794],"length":1,"stats":{"Line":0}},{"line":31,"address":[25054913],"length":1,"stats":{"Line":0}},{"line":33,"address":[25057064,25057137,25054964,25057003,25057488,25055497],"length":1,"stats":{"Line":0}},{"line":34,"address":[25055174,25054979],"length":1,"stats":{"Line":0}},{"line":35,"address":[25055333],"length":1,"stats":{"Line":0}},{"line":36,"address":[25055383],"length":1,"stats":{"Line":0}},{"line":37,"address":[25055435],"length":1,"stats":{"Line":0}},{"line":38,"address":[24174959],"length":1,"stats":{"Line":0}},{"line":40,"address":[25054623,25057400,25057515,25058477,25057306],"length":1,"stats":{"Line":0}},{"line":41,"address":[25058173,25057916,25058084],"length":1,"stats":{"Line":0}},{"line":42,"address":[25058014],"length":1,"stats":{"Line":0}},{"line":43,"address":[25061888,25058041,25058157,25061892],"length":1,"stats":{"Line":0}},{"line":44,"address":[25058261],"length":1,"stats":{"Line":0}},{"line":45,"address":[25062307,25062272,25062486,25062464,25058304],"length":1,"stats":{"Line":0}},{"line":46,"address":[25058347],"length":1,"stats":{"Line":0}},{"line":47,"address":[25058366],"length":1,"stats":{"Line":0}},{"line":50,"address":[25058718,25058852,25055017,25058779,25059203,25055848],"length":1,"stats":{"Line":0}},{"line":51,"address":[25055600,25055032],"length":1,"stats":{"Line":0}},{"line":52,"address":[25055786],"length":1,"stats":{"Line":0}},{"line":53,"address":[24175003],"length":1,"stats":{"Line":0}},{"line":55,"address":[24175025],"length":1,"stats":{"Line":0}},{"line":56,"address":[25059631,25059799,25059888],"length":1,"stats":{"Line":0}},{"line":57,"address":[25059729],"length":1,"stats":{"Line":0}},{"line":58,"address":[25059872,25062112,25059756,25062116],"length":1,"stats":{"Line":0}},{"line":59,"address":[25059976],"length":1,"stats":{"Line":0}},{"line":60,"address":[25062176,25060019],"length":1,"stats":{"Line":0}},{"line":61,"address":[25062211],"length":1,"stats":{"Line":0}},{"line":62,"address":[25062239],"length":1,"stats":{"Line":0}},{"line":63,"address":[25062416,25062253,25062368],"length":1,"stats":{"Line":0}},{"line":65,"address":[25060062],"length":1,"stats":{"Line":0}},{"line":66,"address":[25060081],"length":1,"stats":{"Line":0}},{"line":73,"address":[25055943,25055090],"length":1,"stats":{"Line":0}},{"line":74,"address":[25056616,25056106,25056183],"length":1,"stats":{"Line":0}},{"line":75,"address":[25056621,25056358,25056197],"length":1,"stats":{"Line":0}},{"line":78,"address":[24175047],"length":1,"stats":{"Line":0}},{"line":79,"address":[24175069],"length":1,"stats":{"Line":0}},{"line":80,"address":[25061506,25061429,25061285],"length":1,"stats":{"Line":0}},{"line":81,"address":[25061377],"length":1,"stats":{"Line":0}},{"line":82,"address":[25061952,25061398,25061956,25061490],"length":1,"stats":{"Line":0}},{"line":83,"address":[25061582],"length":1,"stats":{"Line":0}},{"line":84,"address":[25062534,25062016,25061613,25062051,25062512],"length":1,"stats":{"Line":0}},{"line":85,"address":[25061644],"length":1,"stats":{"Line":0}},{"line":86,"address":[25061663],"length":1,"stats":{"Line":0}},{"line":93,"address":[24892688],"length":1,"stats":{"Line":0}},{"line":94,"address":[24892714],"length":1,"stats":{"Line":0}},{"line":95,"address":[24892755],"length":1,"stats":{"Line":0}},{"line":96,"address":[24892830],"length":1,"stats":{"Line":0}},{"line":98,"address":[24892923],"length":1,"stats":{"Line":0}},{"line":100,"address":[24893013],"length":1,"stats":{"Line":0}},{"line":105,"address":[24897341,24896940,24895168],"length":1,"stats":{"Line":0}},{"line":106,"address":[24895253,24895338],"length":1,"stats":{"Line":0}},{"line":107,"address":[24895379,24897269],"length":1,"stats":{"Line":0}},{"line":110,"address":[24895344,24895433],"length":1,"stats":{"Line":0}},{"line":112,"address":[24897204,24895511,24895598],"length":1,"stats":{"Line":0}},{"line":113,"address":[24895832],"length":1,"stats":{"Line":0}},{"line":114,"address":[24896278,24896200],"length":1,"stats":{"Line":0}},{"line":121,"address":[24897231,24896396,24896097],"length":1,"stats":{"Line":0}},{"line":122,"address":[24896628],"length":1,"stats":{"Line":0}},{"line":123,"address":[24896676],"length":1,"stats":{"Line":0}},{"line":124,"address":[24896843,24896772],"length":1,"stats":{"Line":0}},{"line":126,"address":[24896690],"length":1,"stats":{"Line":0}},{"line":128,"address":[24896553],"length":1,"stats":{"Line":0}},{"line":129,"address":[24896987,24896577],"length":1,"stats":{"Line":0}},{"line":130,"address":[24897103],"length":1,"stats":{"Line":0}},{"line":135,"address":[24895855],"length":1,"stats":{"Line":0}},{"line":142,"address":[24898800,24900585,24900631],"length":1,"stats":{"Line":0}},{"line":146,"address":[24898842,24898974],"length":1,"stats":{"Line":0}},{"line":170,"address":[24899227,24900591,24900609],"length":1,"stats":{"Line":0}},{"line":173,"address":[24899575,24899822,24900564,24899737],"length":1,"stats":{"Line":0}},{"line":175,"address":[24899706,24899806],"length":1,"stats":{"Line":0}},{"line":176,"address":[24899966,24900562,24900051,24899872],"length":1,"stats":{"Line":0}},{"line":178,"address":[24900035,24899935],"length":1,"stats":{"Line":0}},{"line":179,"address":[24900093],"length":1,"stats":{"Line":0}},{"line":181,"address":[24900182,24900541],"length":1,"stats":{"Line":0}},{"line":182,"address":[24900382],"length":1,"stats":{"Line":0}},{"line":186,"address":[24893986,24893120,24894037],"length":1,"stats":{"Line":0}},{"line":187,"address":[24893227,24893155],"length":1,"stats":{"Line":0}},{"line":188,"address":[24893407,24893467],"length":1,"stats":{"Line":0}},{"line":190,"address":[25037072,25036962,25039372,25036912,25037109,25037129,25039491],"length":1,"stats":{"Line":0}},{"line":191,"address":[25037007,25037178],"length":1,"stats":{"Line":0}},{"line":192,"address":[25037893,25038110,25037641,25037238,25037347,25037189,25039378,25038041,25038341,25038409,25037575,25037276,25037828,25039350],"length":1,"stats":{"Line":0}},{"line":201,"address":[25038979,25039300,25039687,25039742,25039812],"length":1,"stats":{"Line":0}},{"line":202,"address":[25038986],"length":1,"stats":{"Line":0}},{"line":203,"address":[25039059],"length":1,"stats":{"Line":0}},{"line":204,"address":[25039101],"length":1,"stats":{"Line":0}},{"line":205,"address":[25039153],"length":1,"stats":{"Line":0}},{"line":206,"address":[25039210],"length":1,"stats":{"Line":0}},{"line":207,"address":[25039241],"length":1,"stats":{"Line":0}},{"line":208,"address":[25039796,25037099,25039522,25039268,25039327,25039694],"length":1,"stats":{"Line":0}},{"line":210,"address":[24195842],"length":1,"stats":{"Line":0}},{"line":215,"address":[24895077,24894064,24895026],"length":1,"stats":{"Line":0}},{"line":216,"address":[24894228],"length":1,"stats":{"Line":0}},{"line":218,"address":[24894171,24894099],"length":1,"stats":{"Line":0}},{"line":222,"address":[24894539,24894479],"length":1,"stats":{"Line":0}},{"line":224,"address":[25042927,25040807,25040778,25040735,25040622,25040560,25042867],"length":1,"stats":{"Line":0}},{"line":225,"address":[25040676,25040862],"length":1,"stats":{"Line":0}},{"line":226,"address":[25040963,25041475,25040925,25042845,25041031,25041250,25041401,25042873,25041182,25040873],"length":1,"stats":{"Line":0}},{"line":234,"address":[25042562,25043202,25042789,25043275,25043141,25043679],"length":1,"stats":{"Line":0}},{"line":235,"address":[25042569],"length":1,"stats":{"Line":0}},{"line":236,"address":[25042640],"length":1,"stats":{"Line":0}},{"line":237,"address":[25042700],"length":1,"stats":{"Line":0}},{"line":238,"address":[25042727],"length":1,"stats":{"Line":0}},{"line":239,"address":[24196207],"length":1,"stats":{"Line":0}},{"line":241,"address":[25043520,25043424],"length":1,"stats":{"Line":0}},{"line":242,"address":[24196226],"length":1,"stats":{"Line":0}},{"line":244,"address":[25044147,25044210],"length":1,"stats":{"Line":0}},{"line":245,"address":[25044299,25044224],"length":1,"stats":{"Line":0}},{"line":252,"address":[25044533,25044279,25045404],"length":1,"stats":{"Line":0}},{"line":253,"address":[25045041,25045115,25044807,25044715],"length":1,"stats":{"Line":0}},{"line":254,"address":[25044991],"length":1,"stats":{"Line":0}},{"line":255,"address":[25045022,25045472,25045099,25045476],"length":1,"stats":{"Line":0}},{"line":257,"address":[25045176],"length":1,"stats":{"Line":0}},{"line":262,"address":[24897360,24898277,24898226],"length":1,"stats":{"Line":0}},{"line":263,"address":[24897527],"length":1,"stats":{"Line":0}},{"line":265,"address":[24897467,24897395],"length":1,"stats":{"Line":0}},{"line":267,"address":[24897707,24897647],"length":1,"stats":{"Line":0}},{"line":269,"address":[24897979],"length":1,"stats":{"Line":0}},{"line":270,"address":[25047988,25048218],"length":1,"stats":{"Line":0}},{"line":271,"address":[25049521,25049590,25048837,25048281,25048393,25050471,25050540,25049892,25049137,25049203,25049821,25048906,25051612,25048621,25048686,25048229,25048319],"length":1,"stats":{"Line":0}},{"line":280,"address":[25050834,25050756],"length":1,"stats":{"Line":0}},{"line":282,"address":[25050968,25051412,25050898],"length":1,"stats":{"Line":0}},{"line":283,"address":[25051417,25050982,25051154],"length":1,"stats":{"Line":0}},{"line":286,"address":[24174671],"length":1,"stats":{"Line":0}},{"line":288,"address":[25052302,25052398],"length":1,"stats":{"Line":0}},{"line":289,"address":[25054217,25052401,25052591,25048142],"length":1,"stats":{"Line":0}},{"line":291,"address":[25053023,25053086],"length":1,"stats":{"Line":0}},{"line":292,"address":[25053175,25053100],"length":1,"stats":{"Line":0}},{"line":295,"address":[25053155,25053409,25054212],"length":1,"stats":{"Line":0}},{"line":296,"address":[25053919,25053683,25053845,25053591],"length":1,"stats":{"Line":0}},{"line":297,"address":[25053795],"length":1,"stats":{"Line":0}},{"line":298,"address":[25054304,25054308,25053903,25053826],"length":1,"stats":{"Line":0}},{"line":300,"address":[25053980],"length":1,"stats":{"Line":0}},{"line":304,"address":[24895121,24895104],"length":1,"stats":{"Line":0}},{"line":305,"address":[25045842,25045704],"length":1,"stats":{"Line":0}},{"line":306,"address":[24196865],"length":1,"stats":{"Line":0}},{"line":308,"address":[25046513,25046576],"length":1,"stats":{"Line":0}},{"line":309,"address":[25046668,25046590],"length":1,"stats":{"Line":0}},{"line":312,"address":[25046648,25046902,25047625],"length":1,"stats":{"Line":0}},{"line":315,"address":[25047084,25047176],"length":1,"stats":{"Line":0}},{"line":316,"address":[25047358,25047468],"length":1,"stats":{"Line":0}},{"line":319,"address":[25047377],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":145},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analysis_result.rs"],"content":"//! Aggregated analysis results for v4.0 scoring system\n//!\n//! This module provides the AnalysisResult struct that collects all analysis\n//! data needed for scoring and reporting.\n\nuse crate::autofix::Violation;\nuse crate::circular::CircularDependency;\nuse crate::config::ArchPattern;\nuse crate::metrics::{ComplexityStats, HealthScore, LayerStats};\nuse chrono::{DateTime, Utc};\nuse serde::{Deserialize, Serialize};\nuse std::path::PathBuf;\n\n/// Category of a violation for severity classification\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\npub enum ViolationCategory {\n    /// Critical violation that breaks architecture rules\n    Blocked,\n    /// Warning that should be reviewed\n    Warning,\n    /// Informational notice\n    Info,\n}\n\nimpl ViolationCategory {\n    pub fn as_str(\u0026self) -\u003e \u0026'static str {\n        match self {\n            ViolationCategory::Blocked =\u003e \"blocked\",\n            ViolationCategory::Warning =\u003e \"warning\",\n            ViolationCategory::Info =\u003e \"info\",\n        }\n    }\n}\n\n/// A categorized violation with additional metadata\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct CategorizedViolation {\n    /// The original violation\n    pub violation: Violation,\n    /// Category of this violation\n    pub category: ViolationCategory,\n    /// Optional suggestion for fixing\n    pub suggestion: Option\u003cString\u003e,\n}\n\nimpl CategorizedViolation {\n    pub fn new(violation: Violation, category: ViolationCategory) -\u003e Self {\n        Self {\n            violation,\n            category,\n            suggestion: None,\n        }\n    }\n}\n\n/// Long function detected during complexity analysis\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct LongFunction {\n    /// File containing the function\n    pub file_path: PathBuf,\n    /// Function/method name\n    pub name: String,\n    /// Line number where function starts\n    pub line_start: usize,\n    /// Number of lines\n    pub lines: usize,\n    /// Threshold that was exceeded\n    pub threshold: usize,\n}\n\n/// Complete analysis result with all metrics\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AnalysisResult {\n    /// Project name (derived from directory or package.json)\n    pub project_name: String,\n    /// Architecture pattern detected or configured\n    pub pattern: ArchPattern,\n    /// Total files analyzed\n    pub files_analyzed: usize,\n    /// Timestamp of analysis\n    pub timestamp: DateTime\u003cUtc\u003e,\n    /// All categorized violations found\n    pub violations: Vec\u003cCategorizedViolation\u003e,\n    /// All circular dependencies found\n    pub circular_dependencies: Vec\u003cCircularDependency\u003e,\n    /// All long functions found\n    pub long_functions: Vec\u003cLongFunction\u003e,\n    /// Layer statistics for scoring\n    pub layer_stats: LayerStats,\n    /// Complexity statistics for scoring\n    pub complexity_stats: ComplexityStats,\n    /// Computed health score (set after calculation)\n    pub health_score: Option\u003cHealthScore\u003e,\n}\n\nimpl AnalysisResult {\n    /// Create a new empty analysis result\n    pub fn new(project_name: String, pattern: ArchPattern) -\u003e Self {\n        Self {\n            project_name,\n            pattern,\n            files_analyzed: 0,\n            timestamp: Utc::now(),\n            violations: Vec::new(),\n            circular_dependencies: Vec::new(),\n            long_functions: Vec::new(),\n            layer_stats: LayerStats::default(),\n            complexity_stats: ComplexityStats::default(),\n            health_score: None,\n        }\n    }\n\n    /// Add a violation to the result\n    pub fn add_violation(\u0026mut self, violation: CategorizedViolation) {\n        match violation.category {\n            ViolationCategory::Blocked =\u003e self.layer_stats.blocked_violations += 1,\n            ViolationCategory::Warning | ViolationCategory::Info =\u003e {}\n        }\n        self.violations.push(violation);\n    }\n\n    /// Add a circular dependency to the result\n    pub fn add_circular_dependency(\u0026mut self, cycle: CircularDependency) {\n        self.circular_dependencies.push(cycle);\n    }\n\n    /// Add a long function to the result\n    pub fn add_long_function(\u0026mut self, func: LongFunction) {\n        self.long_functions.push(func);\n        self.complexity_stats.long_functions += 1;\n    }\n\n    /// Get blocked violations count\n    pub fn blocked_count(\u0026self) -\u003e usize {\n        self.violations\n            .iter()\n            .filter(|v| v.category == ViolationCategory::Blocked)\n            .count()\n    }\n\n    /// Get warning violations count\n    pub fn warning_count(\u0026self) -\u003e usize {\n        self.violations\n            .iter()\n            .filter(|v| v.category == ViolationCategory::Warning)\n            .count()\n    }\n\n    /// Check if there are any critical issues\n    pub fn has_critical_issues(\u0026self) -\u003e bool {\n        self.blocked_count() \u003e 0 || !self.circular_dependencies.is_empty()\n    }\n\n    /// Get pattern as display string\n    pub fn pattern_display(\u0026self) -\u003e \u0026str {\n        match self.pattern {\n            ArchPattern::Hexagonal =\u003e \"Hexagonal Architecture\",\n            ArchPattern::Clean =\u003e \"Clean Architecture\",\n            ArchPattern::MVC =\u003e \"MVC Pattern\",\n            ArchPattern::Ninguno =\u003e \"No Pattern\",\n        }\n    }\n}\n","traces":[{"line":26,"address":[24677312],"length":1,"stats":{"Line":0}},{"line":27,"address":[24677317],"length":1,"stats":{"Line":0}},{"line":28,"address":[24677349],"length":1,"stats":{"Line":0}},{"line":29,"address":[24677372],"length":1,"stats":{"Line":0}},{"line":30,"address":[24677395],"length":1,"stats":{"Line":0}},{"line":47,"address":[24677440],"length":1,"stats":{"Line":0}},{"line":98,"address":[24676672,24677285],"length":1,"stats":{"Line":0}},{"line":103,"address":[24676719],"length":1,"stats":{"Line":0}},{"line":104,"address":[24676776],"length":1,"stats":{"Line":0}},{"line":105,"address":[24676792],"length":1,"stats":{"Line":0}},{"line":106,"address":[24676849],"length":1,"stats":{"Line":0}},{"line":107,"address":[24676909],"length":1,"stats":{"Line":0}},{"line":108,"address":[24676995],"length":1,"stats":{"Line":0}},{"line":114,"address":[24676120,24675856,24676091],"length":1,"stats":{"Line":0}},{"line":115,"address":[24675881],"length":1,"stats":{"Line":0}},{"line":116,"address":[24675920,24676023],"length":1,"stats":{"Line":0}},{"line":119,"address":[24675953],"length":1,"stats":{"Line":0}},{"line":123,"address":[24676608],"length":1,"stats":{"Line":0}},{"line":124,"address":[24676617],"length":1,"stats":{"Line":0}},{"line":128,"address":[24676400],"length":1,"stats":{"Line":0}},{"line":129,"address":[24676414],"length":1,"stats":{"Line":0}},{"line":130,"address":[24676503,24676457],"length":1,"stats":{"Line":0}},{"line":134,"address":[24676128],"length":1,"stats":{"Line":0}},{"line":135,"address":[24676133],"length":1,"stats":{"Line":0}},{"line":137,"address":[24704622,24704608],"length":1,"stats":{"Line":0}},{"line":142,"address":[24676192],"length":1,"stats":{"Line":0}},{"line":143,"address":[24676197],"length":1,"stats":{"Line":0}},{"line":145,"address":[24676225],"length":1,"stats":{"Line":0}},{"line":150,"address":[24676528],"length":1,"stats":{"Line":0}},{"line":151,"address":[24676541],"length":1,"stats":{"Line":0}},{"line":155,"address":[24676256],"length":1,"stats":{"Line":0}},{"line":156,"address":[24676261],"length":1,"stats":{"Line":0}},{"line":157,"address":[24676296],"length":1,"stats":{"Line":0}},{"line":158,"address":[24676319],"length":1,"stats":{"Line":0}},{"line":159,"address":[24676342],"length":1,"stats":{"Line":0}},{"line":160,"address":[24676365],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":36},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","collector.rs"],"content":"//! File analysis collector with caching support\n\nuse crate::analysis_result::{AnalysisResult, CategorizedViolation, ViolationCategory};\nuse crate::cache::{self, AnalysisCache, FileCacheEntry};\nuse crate::config::{ArchPattern, LinterContext};\nuse crate::metrics::ComplexityStats;\nuse indicatif::{ProgressBar, ProgressStyle};\nuse miette::Result;\nuse rayon::prelude::*;\nuse std::fs;\nuse std::path::{Path, PathBuf};\nuse std::sync::Mutex;\nuse swc_common::sync::Lrc;\nuse swc_common::SourceMap;\n\nuse super::metrics::{count_functions, count_imports, find_long_functions};\nuse super::swc_parser::collect_violations_from_file;\n\n/// Result of analyzing a single file\nstruct FileAnalysis {\n    violations: Vec\u003cCategorizedViolation\u003e,\n    long_functions: Vec\u003ccrate::analysis_result::LongFunction\u003e,\n    import_count: usize,\n    function_count: usize,\n}\n\n/// Analyzes all files and returns a complete AnalysisResult for scoring.\n/// When a cache is provided, unchanged files are served from cache.\npub fn analyze_all_files(\n    files: \u0026[PathBuf],\n    project_root: \u0026Path,\n    pattern: ArchPattern,\n    ctx: \u0026LinterContext,\n    _cm: \u0026SourceMap,\n    mut analysis_cache: Option\u003c\u0026mut AnalysisCache\u003e,\n) -\u003e Result\u003cAnalysisResult\u003e {\n    // Get project name from directory\n    let project_name = project_root\n        .file_name()\n        .and_then(|n| n.to_str())\n        .unwrap_or(\"project\")\n        .to_string();\n\n    let mut result = AnalysisResult::new(project_name, pattern);\n    result.files_analyzed = files.len();\n\n    // Initialize complexity stats with threshold\n    result.complexity_stats = ComplexityStats {\n        total_functions: 0,\n        long_functions: 0,\n        max_lines_threshold: ctx.max_lines,\n    };\n\n    // Initialize progress bar\n    let pb = if files.len() \u003e 10 {\n        let pb = ProgressBar::new(files.len() as u64);\n        pb.set_style(\n            ProgressStyle::default_bar()\n                .template(\"{spinner:.green} [{elapsed_precise}] [{bar:40.cyan/blue}] {pos}/{len} files ({eta})\")\n                .unwrap()\n                .progress_chars(\"#\u003e-\"),\n        );\n        Some(pb)\n    } else {\n        None\n    };\n\n    // Prepare cache for thread-safe access\n    // We clone the cache if it exists to use in parallel, then update it back\n    let cache_mutex: Option\u003cMutex\u003cAnalysisCache\u003e\u003e = analysis_cache\n        .as_mut()\n        .map(|cache| Mutex::new((**cache).clone()));\n\n    // Process files in parallel\n    let file_results: Vec\u003c(PathBuf, Option\u003cString\u003e, FileAnalysis)\u003e = files\n        .par_iter()\n        .filter_map(|file_path| {\n            // Update progress bar\n            if let Some(ref p) = pb {\n                p.inc(1);\n            }\n\n            // Read file content for hashing\n            let file_bytes = match fs::read(file_path) {\n                Ok(b) =\u003e b,\n                Err(_) =\u003e return None,\n            };\n            let content_hash = cache::hash_content(\u0026file_bytes);\n            let cache_key = AnalysisCache::normalize_path(file_path, project_root);\n\n            // Try to get from cache (thread-safe)\n            if let Some(ref mutex) = cache_mutex {\n                if let Ok(guard) = mutex.lock() {\n                    if let Some(entry) = guard.get(\u0026cache_key, \u0026content_hash) {\n                        // Cache hit — use stored data\n                        return Some((\n                            file_path.clone(),\n                            Some(cache_key),\n                            FileAnalysis {\n                                violations: entry.violations.clone(),\n                                long_functions: entry.long_functions.clone(),\n                                import_count: entry.import_count,\n                                function_count: entry.function_count,\n                            },\n                        ));\n                    }\n                }\n            }\n\n            // Cache miss — run full analysis with thread-local SourceMap\n            let cm = Lrc::new(SourceMap::default());\n\n            let mut file_violations = Vec::new();\n            if let Ok(violations) = collect_violations_from_file(\u0026cm, file_path, ctx) {\n                for violation in violations {\n                    let categorized =\n                        CategorizedViolation::new(violation, ViolationCategory::Blocked);\n                    file_violations.push(categorized);\n                }\n            }\n\n            let mut file_long_functions = Vec::new();\n            if let Ok(long_funcs) = find_long_functions(\u0026cm, file_path, ctx.max_lines) {\n                file_long_functions = long_funcs;\n            }\n\n            let import_count = count_imports(file_path).unwrap_or(0);\n            let function_count = count_functions(\u0026cm, file_path).unwrap_or(0);\n\n            let analysis = FileAnalysis {\n                violations: file_violations.clone(),\n                long_functions: file_long_functions.clone(),\n                import_count,\n                function_count,\n            };\n\n            // Store in cache (thread-safe)\n            if let Some(ref mutex) = cache_mutex {\n                if let Ok(mut guard) = mutex.lock() {\n                    guard.insert(\n                        cache_key.clone(),\n                        FileCacheEntry {\n                            content_hash,\n                            violations: file_violations,\n                            long_functions: file_long_functions,\n                            import_count,\n                            function_count,\n                        },\n                    );\n                }\n            }\n\n            Some((file_path.clone(), None, analysis))\n        })\n        .collect();\n\n    // Finish progress bar\n    if let Some(ref p) = pb {\n        p.finish_with_message(\"Analysis complete\");\n    }\n\n    // Update the original cache from the mutex\n    if let Some(mutex) = cache_mutex {\n        if let Ok(guard) = mutex.lock() {\n            if let Some(ref mut analysis_cache) = analysis_cache {\n                **analysis_cache = (*guard).clone();\n            }\n        }\n    }\n\n    // Merge all file results into the main result\n    for (_file_path, _cache_key, file_analysis) in file_results {\n        for cv in file_analysis.violations {\n            result.add_violation(cv);\n        }\n        for func in file_analysis.long_functions {\n            result.add_long_function(func);\n        }\n        result.layer_stats.total_imports += file_analysis.import_count;\n        result.complexity_stats.total_functions += file_analysis.function_count;\n    }\n\n    // Update blocked_violations count\n    result.layer_stats.blocked_violations = result.blocked_count();\n\n    Ok(result)\n}\n","traces":[{"line":40,"address":[24628208,24628222],"length":1,"stats":{"Line":0}},{"line":72,"address":[24628259,24628240],"length":1,"stats":{"Line":0}},{"line":77,"address":[24633432,24628304,24630205],"length":1,"stats":{"Line":0}},{"line":79,"address":[24628359],"length":1,"stats":{"Line":0}},{"line":80,"address":[24628439],"length":1,"stats":{"Line":0}},{"line":84,"address":[24628458],"length":1,"stats":{"Line":0}},{"line":85,"address":[24628576],"length":1,"stats":{"Line":0}},{"line":86,"address":[24628517],"length":1,"stats":{"Line":0}},{"line":88,"address":[24628728,24628823],"length":1,"stats":{"Line":0}},{"line":89,"address":[24628946,24628858],"length":1,"stats":{"Line":0}},{"line":92,"address":[24628989],"length":1,"stats":{"Line":0}},{"line":93,"address":[24629026,24629108,24629142],"length":1,"stats":{"Line":0}},{"line":94,"address":[24629172,24629251],"length":1,"stats":{"Line":0}},{"line":96,"address":[24629835],"length":1,"stats":{"Line":0}},{"line":97,"address":[24629483],"length":1,"stats":{"Line":0}},{"line":98,"address":[24629520],"length":1,"stats":{"Line":0}},{"line":99,"address":[24629755],"length":1,"stats":{"Line":0}},{"line":100,"address":[24629592],"length":1,"stats":{"Line":0}},{"line":101,"address":[24629667],"length":1,"stats":{"Line":0}},{"line":102,"address":[24629747],"length":1,"stats":{"Line":0}},{"line":103,"address":[24629751],"length":1,"stats":{"Line":0}},{"line":111,"address":[24630277,24629045],"length":1,"stats":{"Line":0}},{"line":113,"address":[24630320],"length":1,"stats":{"Line":0}},{"line":114,"address":[24630383,24630586,24630480],"length":1,"stats":{"Line":0}},{"line":115,"address":[24630618,24630878,24630743],"length":1,"stats":{"Line":0}},{"line":117,"address":[24631047],"length":1,"stats":{"Line":0}},{"line":118,"address":[24631259],"length":1,"stats":{"Line":0}},{"line":122,"address":[24631331],"length":1,"stats":{"Line":0}},{"line":123,"address":[24631581,24631350,24631807,24631431],"length":1,"stats":{"Line":0}},{"line":124,"address":[24631632,24631751,24631613],"length":1,"stats":{"Line":0}},{"line":127,"address":[24631861],"length":1,"stats":{"Line":0}},{"line":128,"address":[24631952],"length":1,"stats":{"Line":0}},{"line":130,"address":[24632196],"length":1,"stats":{"Line":0}},{"line":131,"address":[24632080],"length":1,"stats":{"Line":0}},{"line":132,"address":[24632107],"length":1,"stats":{"Line":0}},{"line":138,"address":[24632308],"length":1,"stats":{"Line":0}},{"line":139,"address":[24632434,24632468,24632345],"length":1,"stats":{"Line":0}},{"line":140,"address":[24632498,24632838],"length":1,"stats":{"Line":0}},{"line":141,"address":[24632565],"length":1,"stats":{"Line":0}},{"line":142,"address":[24632726],"length":1,"stats":{"Line":0}},{"line":143,"address":[24632606],"length":1,"stats":{"Line":0}},{"line":144,"address":[24632646],"length":1,"stats":{"Line":0}},{"line":145,"address":[24632686],"length":1,"stats":{"Line":0}},{"line":153,"address":[24632380,24632970],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":44},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","metrics.rs"],"content":"//! Metrics utilities for counting imports and functions\n\nuse crate::analysis_result::LongFunction;\nuse miette::{IntoDiagnostic, Result};\nuse std::fs;\nuse std::path::Path;\nuse swc_common::SourceMap;\nuse swc_ecma_parser::{lexer::Lexer, EsConfig, Parser, StringInput, Syntax, TsConfig};\n\n/// Represents a function or method call extracted from the AST\n#[derive(Debug, Clone)]\npub struct FunctionCall {\n    pub name: String,\n    pub line: usize,\n}\n\n/// Extract function calls from a file\n/// This function parses the AST and extracts all function/method calls\npub fn extract_function_calls(cm: \u0026SourceMap, path: \u0026Path) -\u003e Result\u003cVec\u003cFunctionCall\u003e\u003e {\n    let mut calls = Vec::new();\n\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only analyze TypeScript/JavaScript for now\n    if !matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n        return Ok(calls);\n    }\n\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(calls),\n    };\n\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(calls),\n    };\n\n    // Recursively visit all nodes in the AST to extract function calls\n    for item in \u0026module.body {\n        extract_calls_from_module_item(item, \u0026mut calls, cm);\n    }\n\n    Ok(calls)\n}\n\n/// Recursively extract function calls from a module item\nfn extract_calls_from_module_item(\n    item: \u0026swc_ecma_ast::ModuleItem,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match item {\n        swc_ecma_ast::ModuleItem::Stmt(stmt) =\u003e extract_calls_from_stmt(stmt, calls, cm),\n        swc_ecma_ast::ModuleItem::ModuleDecl(_) =\u003e {}\n    }\n}\n\n/// Extract calls from a statement\nfn extract_calls_from_stmt(\n    stmt: \u0026swc_ecma_ast::Stmt,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match stmt {\n        swc_ecma_ast::Stmt::Decl(decl) =\u003e extract_calls_from_decl(decl, calls, cm),\n        swc_ecma_ast::Stmt::Expr(expr_stmt) =\u003e {\n            extract_calls_from_expr(\u0026expr_stmt.expr, calls, cm);\n        }\n        swc_ecma_ast::Stmt::Block(block) =\u003e {\n            for stmt in \u0026block.stmts {\n                extract_calls_from_stmt(stmt, calls, cm);\n            }\n        }\n        swc_ecma_ast::Stmt::If(if_stmt) =\u003e {\n            extract_calls_from_expr(\u0026if_stmt.test, calls, cm);\n            extract_calls_from_stmt(\u0026*if_stmt.cons, calls, cm);\n            if let Some(alt) = \u0026if_stmt.alt {\n                extract_calls_from_stmt(alt, calls, cm);\n            }\n        }\n        swc_ecma_ast::Stmt::While(while_stmt) =\u003e {\n            extract_calls_from_expr(\u0026while_stmt.test, calls, cm);\n            extract_calls_from_stmt(\u0026*while_stmt.body, calls, cm);\n        }\n        swc_ecma_ast::Stmt::For(for_stmt) =\u003e {\n            if let Some(init) = \u0026for_stmt.init {\n                extract_calls_from_for_init(init, calls, cm);\n            }\n            if let Some(test) = \u0026for_stmt.test {\n                extract_calls_from_expr(test, calls, cm);\n            }\n            if let Some(update) = \u0026for_stmt.update {\n                extract_calls_from_expr(update, calls, cm);\n            }\n            extract_calls_from_stmt(\u0026*for_stmt.body, calls, cm);\n        }\n        swc_ecma_ast::Stmt::Return(ret_stmt) =\u003e {\n            if let Some(arg) = \u0026ret_stmt.arg {\n                extract_calls_from_expr(arg, calls, cm);\n            }\n        }\n        _ =\u003e {}\n    }\n}\n\n/// Extract calls from a declaration\nfn extract_calls_from_decl(\n    decl: \u0026swc_ecma_ast::Decl,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match decl {\n        swc_ecma_ast::Decl::Class(class) =\u003e {\n            for member in \u0026class.class.body {\n                if let swc_ecma_ast::ClassMember::Method(method) = member {\n                    extract_calls_from_function_body(\u0026method.function, calls, cm);\n                }\n            }\n        }\n        swc_ecma_ast::Decl::Fn(fn_decl) =\u003e {\n            extract_calls_from_function_body(\u0026fn_decl.function, calls, cm);\n        }\n        swc_ecma_ast::Decl::Var(var_decl) =\u003e {\n            for decl in \u0026var_decl.decls {\n                if let Some(init) = \u0026decl.init {\n                    extract_calls_from_expr(init, calls, cm);\n                }\n            }\n        }\n        _ =\u003e {}\n    }\n}\n\n/// Extract calls from a function body\nfn extract_calls_from_function_body(\n    function: \u0026swc_ecma_ast::Function,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    if let Some(body) = \u0026function.body {\n        for stmt in \u0026body.stmts {\n            extract_calls_from_stmt(stmt, calls, cm);\n        }\n    }\n}\n\n/// Extract calls from a for loop init expression\nfn extract_calls_from_for_init(\n    init: \u0026swc_ecma_ast::VarDeclOrExpr,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match init {\n        swc_ecma_ast::VarDeclOrExpr::VarDecl(var_decl) =\u003e {\n            for decl in \u0026var_decl.decls {\n                if let Some(init) = \u0026decl.init {\n                    extract_calls_from_expr(init, calls, cm);\n                }\n            }\n        }\n        swc_ecma_ast::VarDeclOrExpr::Expr(expr) =\u003e {\n            extract_calls_from_expr(expr, calls, cm);\n        }\n    }\n}\n\n/// Extract calls from an expression\nfn extract_calls_from_expr(\n    expr: \u0026swc_ecma_ast::Expr,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    match expr {\n        swc_ecma_ast::Expr::Call(call_expr) =\u003e {\n            let line = cm.lookup_char_pos(call_expr.span.lo).line;\n\n            // Extract the function name\n            let name = extract_call_name(\u0026call_expr.callee);\n\n            calls.push(FunctionCall { name, line });\n\n            // Also extract calls from arguments\n            for arg in \u0026call_expr.args {\n                extract_calls_from_expr_or_spread(arg, calls, cm);\n            }\n        }\n        swc_ecma_ast::Expr::Member(member_expr) =\u003e {\n            extract_calls_from_expr(\u0026*member_expr.obj, calls, cm);\n            if let swc_ecma_ast::MemberProp::Computed(prop) = \u0026member_expr.prop {\n                extract_calls_from_expr(\u0026*prop.expr, calls, cm);\n            }\n        }\n        swc_ecma_ast::Expr::Ident(_) =\u003e {}\n        swc_ecma_ast::Expr::Lit(_) =\u003e {}\n        swc_ecma_ast::Expr::This(_) =\u003e {}\n        swc_ecma_ast::Expr::Array(array_lit) =\u003e {\n            for elem in \u0026array_lit.elems {\n                if let Some(elem_expr) = elem {\n                    extract_calls_from_expr_or_spread(elem_expr, calls, cm);\n                }\n            }\n        }\n        swc_ecma_ast::Expr::Unary(unary_expr) =\u003e {\n            extract_calls_from_expr(\u0026*unary_expr.arg, calls, cm);\n        }\n        swc_ecma_ast::Expr::Bin(bin_expr) =\u003e {\n            extract_calls_from_expr(\u0026*bin_expr.left, calls, cm);\n            extract_calls_from_expr(\u0026*bin_expr.right, calls, cm);\n        }\n        swc_ecma_ast::Expr::Assign(assign_expr) =\u003e {\n            // Handle PatOrExpr\n            match \u0026assign_expr.left {\n                swc_ecma_ast::PatOrExpr::Pat(pat) =\u003e {\n                    // For patterns, we don't extract calls\n                    let _ = pat;\n                }\n                swc_ecma_ast::PatOrExpr::Expr(expr) =\u003e {\n                    extract_calls_from_expr(expr, calls, cm);\n                }\n            }\n            extract_calls_from_expr(\u0026*assign_expr.right, calls, cm);\n        }\n        swc_ecma_ast::Expr::Update(update_expr) =\u003e {\n            extract_calls_from_expr(\u0026*update_expr.arg, calls, cm);\n        }\n        swc_ecma_ast::Expr::Cond(cond_expr) =\u003e {\n            extract_calls_from_expr(\u0026*cond_expr.test, calls, cm);\n            extract_calls_from_expr(\u0026*cond_expr.cons, calls, cm);\n            extract_calls_from_expr(\u0026*cond_expr.alt, calls, cm);\n        }\n        swc_ecma_ast::Expr::New(new_expr) =\u003e {\n            extract_calls_from_expr(\u0026*new_expr.callee, calls, cm);\n        }\n        swc_ecma_ast::Expr::Seq(seq_expr) =\u003e {\n            for expr in \u0026seq_expr.exprs {\n                extract_calls_from_expr(expr, calls, cm);\n            }\n        }\n        _ =\u003e {}\n    }\n}\n\n/// Extract calls from ExprOrSpread (used in function arguments and array elements)\nfn extract_calls_from_expr_or_spread(\n    expr_or_spread: \u0026swc_ecma_ast::ExprOrSpread,\n    calls: \u0026mut Vec\u003cFunctionCall\u003e,\n    cm: \u0026SourceMap,\n) {\n    extract_calls_from_expr(\u0026expr_or_spread.expr, calls, cm);\n}\n\n/// Extract the name from a call expression callee\nfn extract_call_name(callee: \u0026swc_ecma_ast::Callee) -\u003e String {\n    match callee {\n        swc_ecma_ast::Callee::Expr(callee_expr) =\u003e {\n            match \u0026**callee_expr {\n                swc_ecma_ast::Expr::Ident(ident) =\u003e ident.sym.to_string(),\n                swc_ecma_ast::Expr::Member(member_expr) =\u003e {\n                    // Handle methods like this.helper() or console.log()\n                    match \u0026*member_expr.obj {\n                        swc_ecma_ast::Expr::Ident(obj_ident) =\u003e match \u0026member_expr.prop {\n                            swc_ecma_ast::MemberProp::Ident(prop_ident) =\u003e {\n                                format!(\"{}.{}\", obj_ident.sym, prop_ident.sym)\n                            }\n                            _ =\u003e \"member_call\".to_string(),\n                        },\n                        swc_ecma_ast::Expr::This(_) =\u003e match \u0026member_expr.prop {\n                            swc_ecma_ast::MemberProp::Ident(prop_ident) =\u003e {\n                                format!(\"this.{}\", prop_ident.sym)\n                            }\n                            _ =\u003e \"this.method\".to_string(),\n                        },\n                        _ =\u003e \"unknown_call\".to_string(),\n                    }\n                }\n                _ =\u003e \"anonymous_call\".to_string(),\n            }\n        }\n        swc_ecma_ast::Callee::Super(_) =\u003e \"super_call\".to_string(),\n        swc_ecma_ast::Callee::Import(_) =\u003e \"import_call\".to_string(),\n    }\n}\n\n/// Count imports in a file\npub fn count_imports(path: \u0026Path) -\u003e Result\u003cusize\u003e {\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only count for supported file types\n    if !matches!(\n        extension,\n        \"ts\" | \"tsx\" | \"js\" | \"jsx\" | \"py\" | \"go\" | \"php\" | \"java\"\n    ) {\n        return Ok(0);\n    }\n\n    let content = fs::read_to_string(path).into_diagnostic()?;\n    let mut count = 0usize;\n\n    for line in content.lines() {\n        let trimmed = line.trim();\n        // TypeScript/JavaScript\n        if trimmed.starts_with(\"import \") || trimmed.starts_with(\"import{\") {\n            count += 1;\n        }\n        // Python\n        else if trimmed.starts_with(\"import \") || trimmed.starts_with(\"from \") {\n            count += 1;\n        }\n        // Go\n        else if trimmed.starts_with(\"import \") || trimmed == \"import (\" {\n            count += 1;\n        }\n        // PHP\n        else if trimmed.starts_with(\"use \")\n            || trimmed.starts_with(\"require \")\n            || trimmed.starts_with(\"include \")\n        {\n            count += 1;\n        }\n        // Java\n        else if trimmed.starts_with(\"import \") {\n            count += 1;\n        }\n    }\n\n    Ok(count)\n}\n\n/// Count functions in a file\npub fn count_functions(cm: \u0026SourceMap, path: \u0026Path) -\u003e Result\u003cusize\u003e {\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only analyze TypeScript/JavaScript for now\n    if !matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n        return Ok(0);\n    }\n\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(0),\n    };\n\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(0),\n    };\n\n    let mut count = 0usize;\n\n    for item in \u0026module.body {\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(_) = member {\n                    count += 1;\n                }\n            }\n        }\n        // Count standalone functions\n        else if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Fn(_),\n        )) = item\n        {\n            count += 1;\n        }\n    }\n\n    Ok(count)\n}\n\n/// Find functions that exceed the max lines threshold\npub fn find_long_functions(\n    cm: \u0026SourceMap,\n    path: \u0026Path,\n    max_lines: usize,\n) -\u003e Result\u003cVec\u003cLongFunction\u003e\u003e {\n    let mut long_functions = Vec::new();\n\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n    // Only analyze TypeScript/JavaScript for now\n    if !matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n        return Ok(long_functions);\n    }\n\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(long_functions),\n    };\n\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(long_functions),\n    };\n\n    for item in \u0026module.body {\n        // Check class methods\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(m) = member {\n                    let lo = cm.lookup_char_pos(m.span.lo).line;\n                    let hi = cm.lookup_char_pos(m.span.hi).line;\n                    let lines = hi - lo;\n\n                    if lines \u003e max_lines {\n                        // Get method name\n                        let name = match \u0026m.key {\n                            swc_ecma_ast::PropName::Ident(id) =\u003e id.sym.to_string(),\n                            swc_ecma_ast::PropName::Str(s) =\u003e s.value.to_string(),\n                            swc_ecma_ast::PropName::Num(n) =\u003e n.value.to_string(),\n                            swc_ecma_ast::PropName::BigInt(b) =\u003e b.value.to_string(),\n                            _ =\u003e \"anonymous\".to_string(),\n                        };\n\n                        long_functions.push(LongFunction {\n                            file_path: path.to_path_buf(),\n                            name,\n                            line_start: lo,\n                            lines,\n                            threshold: max_lines,\n                        });\n                    }\n                }\n            }\n        }\n        // Check standalone function declarations\n        else if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Fn(f),\n        )) = item\n        {\n            let lo = cm.lookup_char_pos(f.function.span.lo).line;\n            let hi = cm.lookup_char_pos(f.function.span.hi).line;\n            let lines = hi - lo;\n\n            if lines \u003e max_lines {\n                let name = f.ident.sym.to_string();\n\n                long_functions.push(LongFunction {\n                    file_path: path.to_path_buf(),\n                    name,\n                    line_start: lo,\n                    lines,\n                    threshold: max_lines,\n                });\n            }\n        }\n        // Check exported functions\n        else if let swc_ecma_ast::ModuleItem::ModuleDecl(swc_ecma_ast::ModuleDecl::ExportDecl(\n            e,\n        )) = item\n        {\n            if let swc_ecma_ast::Decl::Fn(f) = \u0026e.decl {\n                let lo = cm.lookup_char_pos(f.function.span.lo).line;\n                let hi = cm.lookup_char_pos(f.function.span.hi).line;\n                let lines = hi - lo;\n\n                if lines \u003e max_lines {\n                    let name = f.ident.sym.to_string();\n\n                    long_functions.push(LongFunction {\n                        file_path: path.to_path_buf(),\n                        name,\n                        line_start: lo,\n                        lines,\n                        threshold: max_lines,\n                    });\n                }\n            }\n            // Also check exported classes\n            else if let swc_ecma_ast::Decl::Class(c) = \u0026e.decl {\n                for member in \u0026c.class.body {\n                    if let swc_ecma_ast::ClassMember::Method(m) = member {\n                        let lo = cm.lookup_char_pos(m.span.lo).line;\n                        let hi = cm.lookup_char_pos(m.span.hi).line;\n                        let lines = hi - lo;\n\n                        if lines \u003e max_lines {\n                            let name = match \u0026m.key {\n                                swc_ecma_ast::PropName::Ident(id) =\u003e id.sym.to_string(),\n                                swc_ecma_ast::PropName::Str(s) =\u003e s.value.to_string(),\n                                swc_ecma_ast::PropName::Num(n) =\u003e n.value.to_string(),\n                                swc_ecma_ast::PropName::BigInt(b) =\u003e b.value.to_string(),\n                                _ =\u003e \"anonymous\".to_string(),\n                            };\n\n                            long_functions.push(LongFunction {\n                                file_path: path.to_path_buf(),\n                                name,\n                                line_start: lo,\n                                lines,\n                                threshold: max_lines,\n                            });\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    Ok(long_functions)\n}\n","traces":[{"line":19,"address":[24660688,24663361,24663283],"length":1,"stats":{"Line":0}},{"line":20,"address":[24660759],"length":1,"stats":{"Line":0}},{"line":22,"address":[24660808,24660892],"length":1,"stats":{"Line":0}},{"line":25,"address":[24660995],"length":1,"stats":{"Line":0}},{"line":26,"address":[24661222],"length":1,"stats":{"Line":0}},{"line":29,"address":[24661339,24663330,24661389],"length":1,"stats":{"Line":0}},{"line":32,"address":[24661719,24661550,24662292,24661637],"length":1,"stats":{"Line":0}},{"line":34,"address":[24661682],"length":1,"stats":{"Line":0}},{"line":35,"address":[24662223],"length":1,"stats":{"Line":0}},{"line":37,"address":[24661725,24661850,24661996],"length":1,"stats":{"Line":0}},{"line":39,"address":[24661813],"length":1,"stats":{"Line":0}},{"line":40,"address":[24661985],"length":1,"stats":{"Line":0}},{"line":42,"address":[24661864],"length":1,"stats":{"Line":0}},{"line":45,"address":[24662398,24662173],"length":1,"stats":{"Line":0}},{"line":46,"address":[24662526],"length":1,"stats":{"Line":0}},{"line":48,"address":[24662623,24662552],"length":1,"stats":{"Line":0}},{"line":49,"address":[24662809],"length":1,"stats":{"Line":0}},{"line":50,"address":[24662672],"length":1,"stats":{"Line":0}},{"line":54,"address":[24663000,24662917],"length":1,"stats":{"Line":0}},{"line":55,"address":[24663278,24663116],"length":1,"stats":{"Line":0}},{"line":58,"address":[24663134],"length":1,"stats":{"Line":0}},{"line":62,"address":[24669232],"length":1,"stats":{"Line":0}},{"line":67,"address":[24669265],"length":1,"stats":{"Line":0}},{"line":68,"address":[24669302],"length":1,"stats":{"Line":0}},{"line":74,"address":[24666864],"length":1,"stats":{"Line":0}},{"line":79,"address":[24666919],"length":1,"stats":{"Line":0}},{"line":80,"address":[24667280],"length":1,"stats":{"Line":0}},{"line":81,"address":[24667310],"length":1,"stats":{"Line":0}},{"line":82,"address":[24667325,24668621],"length":1,"stats":{"Line":0}},{"line":84,"address":[24666996],"length":1,"stats":{"Line":0}},{"line":85,"address":[24667353,24667008],"length":1,"stats":{"Line":0}},{"line":86,"address":[24667442],"length":1,"stats":{"Line":0}},{"line":89,"address":[24667104],"length":1,"stats":{"Line":0}},{"line":90,"address":[24667666,24667124,24667574],"length":1,"stats":{"Line":0}},{"line":91,"address":[24667799,24667684,24667645],"length":1,"stats":{"Line":0}},{"line":92,"address":[24667755,24667817],"length":1,"stats":{"Line":0}},{"line":93,"address":[24667825],"length":1,"stats":{"Line":0}},{"line":96,"address":[24667160],"length":1,"stats":{"Line":0}},{"line":97,"address":[24668029,24667937,24667180],"length":1,"stats":{"Line":0}},{"line":98,"address":[24668008,24668047],"length":1,"stats":{"Line":0}},{"line":100,"address":[24667216],"length":1,"stats":{"Line":0}},{"line":101,"address":[24667224,24668155],"length":1,"stats":{"Line":0}},{"line":102,"address":[24668163],"length":1,"stats":{"Line":0}},{"line":104,"address":[24668176],"length":1,"stats":{"Line":0}},{"line":105,"address":[24668228,24668302],"length":1,"stats":{"Line":0}},{"line":107,"address":[24668388,24668256],"length":1,"stats":{"Line":0}},{"line":108,"address":[24668449,24668396],"length":1,"stats":{"Line":0}},{"line":110,"address":[24668534,24668424],"length":1,"stats":{"Line":0}},{"line":112,"address":[24667043],"length":1,"stats":{"Line":0}},{"line":113,"address":[24667454,24667063],"length":1,"stats":{"Line":0}},{"line":114,"address":[24667462],"length":1,"stats":{"Line":0}},{"line":122,"address":[24663408],"length":1,"stats":{"Line":0}},{"line":127,"address":[24663454],"length":1,"stats":{"Line":0}},{"line":128,"address":[24663508],"length":1,"stats":{"Line":0}},{"line":129,"address":[24663523,24663725,24663645],"length":1,"stats":{"Line":0}},{"line":130,"address":[24663791],"length":1,"stats":{"Line":0}},{"line":131,"address":[24663841],"length":1,"stats":{"Line":0}},{"line":135,"address":[24663549],"length":1,"stats":{"Line":0}},{"line":136,"address":[24663564,24663948],"length":1,"stats":{"Line":0}},{"line":138,"address":[24663597],"length":1,"stats":{"Line":0}},{"line":139,"address":[24664107,24663612,24664031],"length":1,"stats":{"Line":0}},{"line":140,"address":[24664177],"length":1,"stats":{"Line":0}},{"line":141,"address":[24664229],"length":1,"stats":{"Line":0}},{"line":150,"address":[24669328],"length":1,"stats":{"Line":0}},{"line":155,"address":[24669356],"length":1,"stats":{"Line":0}},{"line":156,"address":[24669411,24669434],"length":1,"stats":{"Line":0}},{"line":157,"address":[24669497],"length":1,"stats":{"Line":0}},{"line":163,"address":[24668720],"length":1,"stats":{"Line":0}},{"line":168,"address":[24668757],"length":1,"stats":{"Line":0}},{"line":169,"address":[24668819],"length":1,"stats":{"Line":0}},{"line":170,"address":[24668931,24668831],"length":1,"stats":{"Line":0}},{"line":171,"address":[24668985,24669039],"length":1,"stats":{"Line":0}},{"line":172,"address":[24669044],"length":1,"stats":{"Line":0}},{"line":176,"address":[24668771],"length":1,"stats":{"Line":0}},{"line":177,"address":[24669146,24668786],"length":1,"stats":{"Line":0}},{"line":183,"address":[24664336],"length":1,"stats":{"Line":0}},{"line":188,"address":[24664391],"length":1,"stats":{"Line":0}},{"line":189,"address":[24664843],"length":1,"stats":{"Line":0}},{"line":190,"address":[24664863],"length":1,"stats":{"Line":0}},{"line":193,"address":[24664920],"length":1,"stats":{"Line":0}},{"line":195,"address":[24664950],"length":1,"stats":{"Line":0}},{"line":198,"address":[24665025,24666496],"length":1,"stats":{"Line":0}},{"line":199,"address":[24666585],"length":1,"stats":{"Line":0}},{"line":202,"address":[24664735],"length":1,"stats":{"Line":0}},{"line":203,"address":[24665958,24666043,24664743],"length":1,"stats":{"Line":0}},{"line":204,"address":[24666064,24666032],"length":1,"stats":{"Line":0}},{"line":205,"address":[24666079],"length":1,"stats":{"Line":0}},{"line":211,"address":[24664471],"length":1,"stats":{"Line":0}},{"line":212,"address":[24665150,24664483],"length":1,"stats":{"Line":0}},{"line":213,"address":[24665228],"length":1,"stats":{"Line":0}},{"line":214,"address":[24665279],"length":1,"stats":{"Line":0}},{"line":218,"address":[24664518],"length":1,"stats":{"Line":0}},{"line":219,"address":[24665297,24664533],"length":1,"stats":{"Line":0}},{"line":221,"address":[24664626],"length":1,"stats":{"Line":0}},{"line":222,"address":[24664649,24665594,24665493],"length":1,"stats":{"Line":0}},{"line":223,"address":[24665573,24665612],"length":1,"stats":{"Line":0}},{"line":225,"address":[24664688],"length":1,"stats":{"Line":0}},{"line":227,"address":[24664708],"length":1,"stats":{"Line":0}},{"line":228,"address":[24665701],"length":1,"stats":{"Line":0}},{"line":232,"address":[24665720],"length":1,"stats":{"Line":0}},{"line":233,"address":[24665735],"length":1,"stats":{"Line":0}},{"line":236,"address":[24665845],"length":1,"stats":{"Line":0}},{"line":238,"address":[24664572],"length":1,"stats":{"Line":0}},{"line":239,"address":[24665395,24664587],"length":1,"stats":{"Line":0}},{"line":241,"address":[24664779],"length":1,"stats":{"Line":0}},{"line":242,"address":[24664799,24666192,24666284],"length":1,"stats":{"Line":0}},{"line":243,"address":[24666302,24666263,24666394],"length":1,"stats":{"Line":0}},{"line":244,"address":[24666412,24666373],"length":1,"stats":{"Line":0}},{"line":246,"address":[24665060],"length":1,"stats":{"Line":0}},{"line":247,"address":[24665075,24666597],"length":1,"stats":{"Line":0}},{"line":249,"address":[24665111],"length":1,"stats":{"Line":0}},{"line":250,"address":[24665123,24666681],"length":1,"stats":{"Line":0}},{"line":251,"address":[24666754],"length":1,"stats":{"Line":0}},{"line":259,"address":[24669504],"length":1,"stats":{"Line":0}},{"line":264,"address":[24669622,24669533],"length":1,"stats":{"Line":0}},{"line":268,"address":[24652768],"length":1,"stats":{"Line":0}},{"line":269,"address":[24652798],"length":1,"stats":{"Line":0}},{"line":270,"address":[24652884],"length":1,"stats":{"Line":0}},{"line":271,"address":[24652938,24652899],"length":1,"stats":{"Line":0}},{"line":272,"address":[24653117],"length":1,"stats":{"Line":0}},{"line":273,"address":[24653078],"length":1,"stats":{"Line":0}},{"line":275,"address":[24653086,24653145],"length":1,"stats":{"Line":0}},{"line":276,"address":[24653305],"length":1,"stats":{"Line":0}},{"line":277,"address":[24653507],"length":1,"stats":{"Line":0}},{"line":278,"address":[24653524],"length":1,"stats":{"Line":0}},{"line":280,"address":[24653688],"length":1,"stats":{"Line":0}},{"line":282,"address":[24653284],"length":1,"stats":{"Line":0}},{"line":283,"address":[24653342],"length":1,"stats":{"Line":0}},{"line":284,"address":[24653354],"length":1,"stats":{"Line":0}},{"line":286,"address":[24653474],"length":1,"stats":{"Line":0}},{"line":288,"address":[24653256],"length":1,"stats":{"Line":0}},{"line":291,"address":[24653050],"length":1,"stats":{"Line":0}},{"line":294,"address":[24652834],"length":1,"stats":{"Line":0}},{"line":295,"address":[24652859],"length":1,"stats":{"Line":0}},{"line":300,"address":[24648160,24650103,24650109],"length":1,"stats":{"Line":0}},{"line":301,"address":[24648199],"length":1,"stats":{"Line":0}},{"line":304,"address":[24648336,24648584],"length":1,"stats":{"Line":0}},{"line":306,"address":[24648365,24648276],"length":1,"stats":{"Line":0}},{"line":308,"address":[24648594],"length":1,"stats":{"Line":0}},{"line":311,"address":[24648757,24648636],"length":1,"stats":{"Line":0}},{"line":312,"address":[24648868],"length":1,"stats":{"Line":0}},{"line":314,"address":[24648973,24648888],"length":1,"stats":{"Line":0}},{"line":315,"address":[24649221,24649147],"length":1,"stats":{"Line":0}},{"line":317,"address":[24650077,24649237,24649371],"length":1,"stats":{"Line":0}},{"line":318,"address":[24649333,24650069,24650082],"length":1,"stats":{"Line":0}},{"line":321,"address":[24649511,24649377,24650041],"length":1,"stats":{"Line":0}},{"line":322,"address":[24650033,24650046,24649473],"length":1,"stats":{"Line":0}},{"line":325,"address":[24649638,24649517,24650005],"length":1,"stats":{"Line":0}},{"line":326,"address":[24649600,24650010,24649997],"length":1,"stats":{"Line":0}},{"line":329,"address":[24649969,24649644],"length":1,"stats":{"Line":0}},{"line":330,"address":[24649697,24649778],"length":1,"stats":{"Line":0}},{"line":331,"address":[24649784],"length":1,"stats":{"Line":0}},{"line":333,"address":[24649961,24649974,24649740],"length":1,"stats":{"Line":0}},{"line":336,"address":[24649931,24649837],"length":1,"stats":{"Line":0}},{"line":337,"address":[24649893,24649936],"length":1,"stats":{"Line":0}},{"line":341,"address":[24649164],"length":1,"stats":{"Line":0}},{"line":345,"address":[24652750,24652703,24650128],"length":1,"stats":{"Line":0}},{"line":346,"address":[24650209],"length":1,"stats":{"Line":0}},{"line":349,"address":[24650264],"length":1,"stats":{"Line":0}},{"line":350,"address":[24650439],"length":1,"stats":{"Line":0}},{"line":353,"address":[24650489,24650575],"length":1,"stats":{"Line":0}},{"line":356,"address":[24650815,24651307,24650646,24650733],"length":1,"stats":{"Line":0}},{"line":358,"address":[24650778],"length":1,"stats":{"Line":0}},{"line":359,"address":[24651238],"length":1,"stats":{"Line":0}},{"line":361,"address":[24650943,24651011,24650821],"length":1,"stats":{"Line":0}},{"line":363,"address":[24650909],"length":1,"stats":{"Line":0}},{"line":364,"address":[24651000],"length":1,"stats":{"Line":0}},{"line":366,"address":[24650949],"length":1,"stats":{"Line":0}},{"line":369,"address":[24651413,24651188],"length":1,"stats":{"Line":0}},{"line":370,"address":[24651541],"length":1,"stats":{"Line":0}},{"line":372,"address":[24651567,24651638],"length":1,"stats":{"Line":0}},{"line":373,"address":[24651745],"length":1,"stats":{"Line":0}},{"line":374,"address":[24651675],"length":1,"stats":{"Line":0}},{"line":377,"address":[24651853],"length":1,"stats":{"Line":0}},{"line":379,"address":[24651865,24651948],"length":1,"stats":{"Line":0}},{"line":380,"address":[24652068,24652192,24652240],"length":1,"stats":{"Line":0}},{"line":381,"address":[24652252],"length":1,"stats":{"Line":0}},{"line":384,"address":[24652275],"length":1,"stats":{"Line":0}},{"line":385,"address":[24652496,24652564],"length":1,"stats":{"Line":0}},{"line":386,"address":[24652526,24652569],"length":1,"stats":{"Line":0}},{"line":391,"address":[24652218,24652618,24652680],"length":1,"stats":{"Line":0}},{"line":395,"address":[24652644,24652685],"length":1,"stats":{"Line":0}},{"line":399,"address":[24652078],"length":1,"stats":{"Line":0}},{"line":403,"address":[24653712,24657775,24660656],"length":1,"stats":{"Line":0}},{"line":408,"address":[24653799],"length":1,"stats":{"Line":0}},{"line":410,"address":[24653880,24653964],"length":1,"stats":{"Line":0}},{"line":413,"address":[24654073],"length":1,"stats":{"Line":0}},{"line":414,"address":[24654324],"length":1,"stats":{"Line":0}},{"line":417,"address":[24654503,24660622,24654441],"length":1,"stats":{"Line":0}},{"line":420,"address":[24654781,24654688,24655475,24654872],"length":1,"stats":{"Line":0}},{"line":422,"address":[24654829],"length":1,"stats":{"Line":0}},{"line":423,"address":[24655397],"length":1,"stats":{"Line":0}},{"line":425,"address":[24655018,24655167,24654878],"length":1,"stats":{"Line":0}},{"line":427,"address":[24654975],"length":1,"stats":{"Line":0}},{"line":428,"address":[24655153],"length":1,"stats":{"Line":0}},{"line":430,"address":[24655032],"length":1,"stats":{"Line":0}},{"line":433,"address":[24655344,24655581],"length":1,"stats":{"Line":0}},{"line":434,"address":[24655721],"length":1,"stats":{"Line":0}},{"line":436,"address":[24655750,24655821],"length":1,"stats":{"Line":0}},{"line":437,"address":[24656007],"length":1,"stats":{"Line":0}},{"line":438,"address":[24655870],"length":1,"stats":{"Line":0}},{"line":441,"address":[24656210,24656115],"length":1,"stats":{"Line":0}},{"line":443,"address":[24656516,24656324],"length":1,"stats":{"Line":0}},{"line":444,"address":[24656609],"length":1,"stats":{"Line":0}},{"line":447,"address":[24656632],"length":1,"stats":{"Line":0}},{"line":448,"address":[24656891],"length":1,"stats":{"Line":0}},{"line":449,"address":[24656964],"length":1,"stats":{"Line":0}},{"line":450,"address":[24657045],"length":1,"stats":{"Line":0}},{"line":451,"address":[24657179,24657126],"length":1,"stats":{"Line":0}},{"line":453,"address":[24657748,24657169],"length":1,"stats":{"Line":0}},{"line":455,"address":[24657207],"length":1,"stats":{"Line":0}},{"line":456,"address":[24657437,24657252],"length":1,"stats":{"Line":0}},{"line":457,"address":[24657480,24657294],"length":1,"stats":{"Line":0}},{"line":458,"address":[24657336,24657490],"length":1,"stats":{"Line":0}},{"line":459,"address":[24657375,24657500],"length":1,"stats":{"Line":0}},{"line":460,"address":[24657406,24657510],"length":1,"stats":{"Line":0}},{"line":463,"address":[24657625],"length":1,"stats":{"Line":0}},{"line":464,"address":[24657461],"length":1,"stats":{"Line":0}},{"line":465,"address":[24657585],"length":1,"stats":{"Line":0}},{"line":475,"address":[24656569,24657867,24657813],"length":1,"stats":{"Line":0}},{"line":476,"address":[24657882],"length":1,"stats":{"Line":0}},{"line":479,"address":[24657913],"length":1,"stats":{"Line":0}},{"line":480,"address":[24658088],"length":1,"stats":{"Line":0}},{"line":481,"address":[24658323,24658270],"length":1,"stats":{"Line":0}},{"line":483,"address":[24658313,24658646],"length":1,"stats":{"Line":0}},{"line":484,"address":[24658352],"length":1,"stats":{"Line":0}},{"line":486,"address":[24658523],"length":1,"stats":{"Line":0}},{"line":487,"address":[24658399],"length":1,"stats":{"Line":0}},{"line":488,"address":[24658483],"length":1,"stats":{"Line":0}},{"line":496,"address":[24657842,24658704],"length":1,"stats":{"Line":0}},{"line":497,"address":[24658722],"length":1,"stats":{"Line":0}},{"line":500,"address":[24658730],"length":1,"stats":{"Line":0}},{"line":501,"address":[24658819,24658764],"length":1,"stats":{"Line":0}},{"line":502,"address":[24658958],"length":1,"stats":{"Line":0}},{"line":503,"address":[24659166,24659119],"length":1,"stats":{"Line":0}},{"line":505,"address":[24659156,24659480],"length":1,"stats":{"Line":0}},{"line":506,"address":[24659192],"length":1,"stats":{"Line":0}},{"line":508,"address":[24659357],"length":1,"stats":{"Line":0}},{"line":509,"address":[24659239],"length":1,"stats":{"Line":0}},{"line":510,"address":[24659317],"length":1,"stats":{"Line":0}},{"line":518,"address":[24658796,24659515],"length":1,"stats":{"Line":0}},{"line":519,"address":[24659530],"length":1,"stats":{"Line":0}},{"line":520,"address":[24659756],"length":1,"stats":{"Line":0}},{"line":521,"address":[24659819],"length":1,"stats":{"Line":0}},{"line":522,"address":[24659894],"length":1,"stats":{"Line":0}},{"line":523,"address":[24660013,24659966],"length":1,"stats":{"Line":0}},{"line":525,"address":[24660554,24660003],"length":1,"stats":{"Line":0}},{"line":526,"address":[24660039],"length":1,"stats":{"Line":0}},{"line":527,"address":[24660249,24660073],"length":1,"stats":{"Line":0}},{"line":528,"address":[24660112,24660292],"length":1,"stats":{"Line":0}},{"line":529,"address":[24660302,24660151],"length":1,"stats":{"Line":0}},{"line":530,"address":[24660187,24660312],"length":1,"stats":{"Line":0}},{"line":531,"address":[24660218,24660322],"length":1,"stats":{"Line":0}},{"line":534,"address":[24660431],"length":1,"stats":{"Line":0}},{"line":535,"address":[24660273],"length":1,"stats":{"Line":0}},{"line":536,"address":[24660391],"length":1,"stats":{"Line":0}},{"line":548,"address":[24656364],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":257},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","mod.rs"],"content":"//! Analyzer module for Architect Linter Pro\n//!\n//! This module contains all file analysis logic:\n//! - SWC-based parser for TypeScript/JavaScript\n//! - Pattern matching utilities\n//! - Metrics collection (imports, functions)\n//! - File collection with caching\n\npub mod collector;\npub mod metrics;\nmod pattern_matcher;\npub mod swc_parser;\n\n// Re-export public functions\npub use collector::analyze_all_files;\npub use metrics::{count_functions, count_imports, extract_function_calls, find_long_functions};\npub use swc_parser::{analyze_file, collect_violations_from_file};\n\n// Note: analyze_changed_files is defined in main.rs to avoid circular imports\n// For tests, import directly from main\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","pattern_matcher.rs"],"content":"//! Pattern matching utilities for import validation\n\n/// Normaliza un patrón glob para hacer matching simple\n/// Ejemplos:\n/// - \"src/components/**\" → \"src/components/\"\n/// - \"**/*.tsx\" → \".tsx\"\n/// - \"src/services/**\" → \"src/services/\"\npub fn normalize_pattern(pattern: \u0026str) -\u003e String {\n    let normalized = pattern\n        .to_lowercase()\n        .replace(\"\\\\\", \"/\")  // Normalizar separadores de Windows\n        .replace(\"**\", \"\")   // Quitar comodines globales\n        .replace(\"*\", \"\"); // Quitar comodines simples\n\n    // Si el patrón termina en /, dejarlo; si no, mantenerlo como está\n    normalized\n}\n\n/// Verifica si un path coincide con un patrón normalizado\n/// Usa matching flexible para soportar diferentes formatos de import\npub fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n    let normalized_path = path.to_lowercase().replace(\"\\\\\", \"/\");\n    let normalized_pattern = pattern.to_lowercase();\n\n    // Si el patrón está vacío después de normalización, no matchear nada\n    if normalized_pattern.is_empty() {\n        return false;\n    }\n\n    // Matching flexible para rutas absolutas y relativas\n    // Ejemplos:\n    // - Path: \"c:/proyecto/src/components/button.jsx\" con Pattern: \"src/components/\"\n    // - Import: \"../services/userservice\" con Pattern: \"src/services/\"\n    //   → Extraer \"services/\" del pattern y buscar \"/services/\" o \"../services/\" en el import\n    // - Import: \"@/api/posts\" con Pattern: \"src/api/\"\n    //   → Buscar \"/api/\" en el import\n\n    if normalized_path.contains(\u0026normalized_pattern) {\n        return true;\n    }\n\n    // Para imports: si el patrón contiene \"src/\", extraer solo la carpeta después de src/\n    // Ejemplo: \"src/services/\" → buscar también \"/services/\" o \"services/\"\n    if normalized_pattern.contains(\"src/\") {\n        // Extraer la parte después de \"src/\"\n        if let Some(folder_part) = normalized_pattern.strip_prefix(\"src/\") {\n            // Buscar \"/folder/\" o \"../folder/\" en el path (para imports relativos)\n            let with_slash = format!(\"/{}\", folder_part);\n            let with_relative = format!(\"../{}\", folder_part);\n            let with_at = format!(\"@/{}\", folder_part); // Para alias como @/services\n\n            if normalized_path.contains(\u0026with_slash)\n                || normalized_path.contains(\u0026with_relative)\n                || normalized_path.contains(\u0026with_at)\n                || normalized_path.contains(folder_part)\n            {\n                return true;\n            }\n        }\n    }\n\n    false\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_normalize_pattern() {\n        assert_eq!(normalize_pattern(\"src/components/**\"), \"src/components/\");\n        assert_eq!(normalize_pattern(\"**/*.tsx\"), \"/.tsx\"); // Note: keeps leading /\n        assert_eq!(normalize_pattern(\"src/services/**\"), \"src/services/\");\n    }\n\n    #[test]\n    fn test_matches_pattern_basic() {\n        assert!(matches_pattern(\n            \"src/components/button.tsx\",\n            \"src/components/\"\n        ));\n        assert!(!matches_pattern(\"src/services/api.ts\", \"src/components/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_with_relative_imports() {\n        assert!(matches_pattern(\"../services/userservice\", \"src/services/\"));\n        assert!(matches_pattern(\"@/services/api\", \"src/services/\"));\n    }\n}\n","traces":[{"line":8,"address":[25251424,25252067,25252061],"length":1,"stats":{"Line":0}},{"line":9,"address":[25251484,25251733,25251612],"length":1,"stats":{"Line":0}},{"line":16,"address":[25252027],"length":1,"stats":{"Line":0}},{"line":21,"address":[25251401,25249520,25251348],"length":1,"stats":{"Line":0}},{"line":22,"address":[25249584],"length":1,"stats":{"Line":0}},{"line":23,"address":[25249828],"length":1,"stats":{"Line":0}},{"line":26,"address":[25249855,25249917],"length":1,"stats":{"Line":0}},{"line":27,"address":[25249954],"length":1,"stats":{"Line":0}},{"line":38,"address":[25249931,25249983],"length":1,"stats":{"Line":0}},{"line":39,"address":[25250053],"length":1,"stats":{"Line":0}},{"line":44,"address":[25250082,25250030],"length":1,"stats":{"Line":0}},{"line":46,"address":[25250163],"length":1,"stats":{"Line":0}},{"line":48,"address":[25250348],"length":1,"stats":{"Line":0}},{"line":49,"address":[25250499,25250570],"length":1,"stats":{"Line":0}},{"line":50,"address":[25250694,25250765],"length":1,"stats":{"Line":0}},{"line":52,"address":[25250877,25250948],"length":1,"stats":{"Line":0}},{"line":53,"address":[25250989,25251046],"length":1,"stats":{"Line":0}},{"line":54,"address":[25251087],"length":1,"stats":{"Line":0}},{"line":55,"address":[25251159],"length":1,"stats":{"Line":0}},{"line":57,"address":[25251006],"length":1,"stats":{"Line":0}},{"line":62,"address":[25250125],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":21},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","analyzer","swc_parser.rs"],"content":"//! SWC-based parser for TypeScript/JavaScript files\n\nuse crate::autofix::Violation;\nuse crate::config::{ArchError, LinterContext};\nuse crate::parsers;\nuse miette::{IntoDiagnostic, Result, SourceSpan};\nuse std::fs;\nuse std::path::PathBuf;\nuse swc_common::SourceMap;\nuse swc_ecma_parser::{lexer::Lexer, EsConfig, Parser, StringInput, Syntax, TsConfig};\n\nuse super::pattern_matcher::{matches_pattern, normalize_pattern};\n\n/// Analyze a single file for architecture violations\npub fn analyze_file(cm: \u0026SourceMap, path: \u0026PathBuf, ctx: \u0026LinterContext) -\u003e Result\u003c()\u003e {\n    // Try to use multi-language parser first\n    if let Some(parser) = parsers::get_parser_for_file(path) {\n        let source_code = fs::read_to_string(path).into_diagnostic()?;\n        let violations = parser.find_violations(\u0026source_code, path, ctx)?;\n\n        if let Some(first_violation) = violations.first() {\n            // Return error for the first violation\n            let fm = cm.load_file(path).into_diagnostic()?;\n            return Err(create_error_from_violation(\u0026fm, first_violation));\n        }\n\n        // Validate method length for TypeScript/JavaScript files\n        let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n        if matches!(extension, \"ts\" | \"tsx\" | \"js\" | \"jsx\") {\n            validate_method_length(cm, path, ctx)?;\n        }\n\n        return Ok(());\n    }\n\n    // Fallback to old swc parser for unsupported files\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    // Detectar si es TypeScript o JavaScript según la extensión\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e Syntax::Typescript(TsConfig::default()),\n    };\n\n    // Create lexer and parser - these will be dropped when they go out of scope\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    // Parse module immediately and process to avoid keeping AST in memory\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(e) =\u003e {\n            // Clean up parser and lexer before returning error\n            drop(parser);\n            return Err(miette::miette!(\"Syntax Error: {:?}\", e));\n        }\n    };\n\n    let file_path_str = path.to_string_lossy().to_lowercase();\n\n    // Process all imports and class definitions, then drop AST\n    let result = process_module_items(cm, \u0026fm, \u0026module, \u0026file_path_str, ctx);\n\n    // Explicitly drop AST objects to free memory\n    drop(module);\n    drop(parser);\n\n    result\n}\n\n/// Helper function to process module items and extract analysis data\nfn process_module_items(\n    _cm: \u0026SourceMap,\n    fm: \u0026swc_common::SourceFile,\n    module: \u0026swc_ecma_ast::Module,\n    file_path_str: \u0026str,\n    ctx: \u0026LinterContext,\n) -\u003e Result\u003c()\u003e {\n    for item in \u0026module.body {\n        // --- VALIDACIÓN DE IMPORTACIONES DINÁMICAS ---\n        if let swc_ecma_ast::ModuleItem::ModuleDecl(swc_ecma_ast::ModuleDecl::Import(import)) = item\n        {\n            let source = import.src.value.to_string().to_lowercase();\n\n            // 1. Validamos las reglas dinámicas del JSON\n            for rule in \u0026ctx.forbidden_imports {\n                // Normalizar patrones: quitar '**', '*', y '/' al final para matching flexible\n                let from_pattern = normalize_pattern(\u0026rule.from);\n                let to_pattern = normalize_pattern(\u0026rule.to);\n\n                // Verificar si el archivo coincide con el patrón 'from'\n                let file_matches = matches_pattern(\u0026file_path_str, \u0026from_pattern);\n\n                // Verificar si el import coincide con el patrón 'to'\n                let import_matches = matches_pattern(\u0026source, \u0026to_pattern);\n\n                if file_matches \u0026\u0026 import_matches {\n                    return Err(create_error(\n                        \u0026fm,\n                        import.span,\n                        \u0026format!(\n                            \"Restricción: Archivos en '{}' no pueden importar de '{}'.\",\n                            rule.from, rule.to\n                        ),\n                    ));\n                }\n            }\n\n            // 2. Regla extra: Siempre prohibir Repository en Controller (Standard NestJS)\n            if file_path_str.contains(\"controller\") \u0026\u0026 source.contains(\".repository\") {\n                return Err(create_error(\n                    \u0026fm,\n                    import.span,\n                    \"MVC: Prohibido importar Repositorios en Controladores.\",\n                ));\n            }\n        }\n\n        // --- VALIDACIÓN DE LÍNEAS POR MÉTODO ---\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(m) = member {\n                    let lo = fm.start_pos.0 as usize + m.span.lo.0 as usize;\n                    let hi = fm.start_pos.0 as usize + m.span.hi.0 as usize;\n                    let lines = (hi / 80) - (lo / 80); // Approximate line count\n\n                    if lines \u003e ctx.max_lines {\n                        return Err(create_error(\n                            \u0026fm,\n                            m.span,\n                            \u0026format!(\n                                \"Método demasiado largo ({} líneas). Máximo: {}.\",\n                                lines, ctx.max_lines\n                            ),\n                        ));\n                    }\n                }\n            }\n        }\n    }\n    Ok(())\n}\n\n/// Validate method length for TypeScript/JavaScript files using swc\n/// Ensures AST is properly scoped and dropped after analysis\npub fn validate_method_length(cm: \u0026SourceMap, path: \u0026PathBuf, ctx: \u0026LinterContext) -\u003e Result\u003c()\u003e {\n    let fm = cm.load_file(path).into_diagnostic()?;\n\n    let extension = path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n    let syntax = match extension {\n        \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n            decorators: true,\n            tsx: extension == \"tsx\",\n            ..Default::default()\n        }),\n        \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n            decorators: true,\n            jsx: extension == \"jsx\",\n            ..Default::default()\n        }),\n        _ =\u003e return Ok(()),\n    };\n\n    // Create lexer and parser - these will be dropped when they go out of scope\n    let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n    let mut parser = Parser::new_from(lexer);\n\n    // Parse module and immediately extract required information\n    let module = match parser.parse_module() {\n        Ok(m) =\u003e m,\n        Err(_) =\u003e return Ok(()), // Skip on syntax error\n    };\n\n    // Process the AST and immediately drop references to large structures\n    let _functions_extracted = count_methods_in_module(\u0026fm, \u0026module, ctx);\n\n    // Explicitly drop the module to free memory\n    drop(module);\n\n    // Additional cleanup - ensure no references remain to AST structures\n    drop(parser);\n\n    // Return result based on extracted functions\n    Ok(())\n}\n\n/// Helper function to count methods in a module and extract analysis data\nfn count_methods_in_module(\n    fm: \u0026swc_common::SourceFile,\n    module: \u0026swc_ecma_ast::Module,\n    ctx: \u0026LinterContext,\n) -\u003e usize {\n    let mut method_count = 0;\n\n    for item in \u0026module.body {\n        if let swc_ecma_ast::ModuleItem::Stmt(swc_ecma_ast::Stmt::Decl(\n            swc_ecma_ast::Decl::Class(c),\n        )) = item\n        {\n            for member in \u0026c.class.body {\n                if let swc_ecma_ast::ClassMember::Method(m) = member {\n                    let lo = fm.start_pos.0 as usize + m.span.lo.0 as usize;\n                    let hi = fm.start_pos.0 as usize + m.span.hi.0 as usize;\n                    let lines = (hi / 80) - (lo / 80); // Approximate line count\n\n                    if lines \u003e ctx.max_lines {\n                        // Just count the method, don't return error\n                        println!(\"Method too long: {} lines\", lines);\n                    }\n                    method_count += 1;\n                }\n            }\n        }\n    }\n\n    method_count\n}\n\n/// Create a miette error from SWC span\npub fn create_error(\n    fm: \u0026swc_common::SourceFile,\n    span: swc_common::Span,\n    msg: \u0026str,\n) -\u003e miette::Report {\n    let start = (span.lo.0 - fm.start_pos.0) as usize;\n    let end = (span.hi.0 - fm.start_pos.0) as usize;\n\n    ArchError {\n        src: fm.src.to_string(),\n        span: SourceSpan::new(start.into(), (end - start).into()),\n        message: msg.to_string(),\n    }\n    .into()\n}\n\n/// Create a miette error from a Violation\npub fn create_error_from_violation(\n    fm: \u0026swc_common::SourceFile,\n    violation: \u0026Violation,\n) -\u003e miette::Report {\n    // Try to find the import line in the source\n    let lines: Vec\u003c\u0026str\u003e = fm.src.lines().collect();\n    let line_idx = violation.line_number.saturating_sub(1);\n\n    if line_idx \u003c lines.len() {\n        let line_content = lines[line_idx];\n        // Find the position of the import statement in the file\n        let mut char_offset = 0;\n        for (idx, line) in lines.iter().enumerate() {\n            if idx == line_idx {\n                break;\n            }\n            char_offset += line.len() + 1; // +1 for newline\n        }\n\n        ArchError {\n            src: fm.src.to_string(),\n            span: SourceSpan::new(char_offset.into(), line_content.len().into()),\n            message: format!(\n                \"Restricción: Archivos en '{}' no pueden importar de '{}'.\",\n                violation.rule.from, violation.rule.to\n            ),\n        }\n        .into()\n    } else {\n        // Fallback if line number is out of bounds\n        miette::miette!(\n            \"Restricción: Archivos en '{}' no pueden importar de '{}' (línea {}).\",\n            violation.rule.from,\n            violation.rule.to,\n            violation.line_number\n        )\n    }\n}\n\n/// Collect violations from a file without failing\n/// Useful for --fix mode where we want to process all violations\npub fn collect_violations_from_file(\n    _cm: \u0026SourceMap,\n    path: \u0026PathBuf,\n    ctx: \u0026LinterContext,\n) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n    // Try to use multi-language parser first\n    if let Some(parser) = parsers::get_parser_for_file(path) {\n        let source_code = fs::read_to_string(path).into_diagnostic()?;\n        return parser.find_violations(\u0026source_code, path, ctx);\n    }\n\n    // Fallback: return empty violations for unsupported files\n    Ok(Vec::new())\n}\n","traces":[{"line":15,"address":[24635840,24633472,24635111],"length":1,"stats":{"Line":0}},{"line":17,"address":[24633546],"length":1,"stats":{"Line":0}},{"line":18,"address":[24633825,24633666,24635814],"length":1,"stats":{"Line":0}},{"line":19,"address":[24634172,24634025,24635780],"length":1,"stats":{"Line":0}},{"line":21,"address":[24634541,24634446],"length":1,"stats":{"Line":0}},{"line":23,"address":[24635125,24634720,24634639],"length":1,"stats":{"Line":0}},{"line":24,"address":[24635035,24634948],"length":1,"stats":{"Line":0}},{"line":28,"address":[24634670,24635151],"length":1,"stats":{"Line":0}},{"line":29,"address":[24635325],"length":1,"stats":{"Line":0}},{"line":30,"address":[24635593],"length":1,"stats":{"Line":0}},{"line":33,"address":[24635552],"length":1,"stats":{"Line":0}},{"line":37,"address":[24635853,24633696],"length":1,"stats":{"Line":0}},{"line":40,"address":[24373040,24373054],"length":1,"stats":{"Line":0}},{"line":42,"address":[24636156,24636890,24636296],"length":1,"stats":{"Line":0}},{"line":44,"address":[24636253],"length":1,"stats":{"Line":0}},{"line":45,"address":[24636812],"length":1,"stats":{"Line":0}},{"line":47,"address":[24636442,24636630,24636302],"length":1,"stats":{"Line":0}},{"line":49,"address":[24636399],"length":1,"stats":{"Line":0}},{"line":50,"address":[24636616],"length":1,"stats":{"Line":0}},{"line":52,"address":[24636448],"length":1,"stats":{"Line":0}},{"line":56,"address":[24636555,24636996],"length":1,"stats":{"Line":0}},{"line":57,"address":[24637133],"length":1,"stats":{"Line":0}},{"line":60,"address":[24637235,24637167],"length":1,"stats":{"Line":0}},{"line":61,"address":[24637358],"length":1,"stats":{"Line":0}},{"line":62,"address":[24637272],"length":1,"stats":{"Line":0}},{"line":64,"address":[24637288],"length":1,"stats":{"Line":0}},{"line":65,"address":[24638142],"length":1,"stats":{"Line":0}},{"line":69,"address":[24637462,24637538],"length":1,"stats":{"Line":0}},{"line":72,"address":[24637707],"length":1,"stats":{"Line":0}},{"line":75,"address":[24637820],"length":1,"stats":{"Line":0}},{"line":76,"address":[24637939],"length":1,"stats":{"Line":0}},{"line":78,"address":[24637998],"length":1,"stats":{"Line":0}},{"line":82,"address":[24641126,24641132,24639024],"length":1,"stats":{"Line":0}},{"line":89,"address":[24639128,24639106],"length":1,"stats":{"Line":0}},{"line":91,"address":[24639306,24639205],"length":1,"stats":{"Line":0}},{"line":93,"address":[24639366],"length":1,"stats":{"Line":0}},{"line":96,"address":[24639666],"length":1,"stats":{"Line":0}},{"line":98,"address":[24639823,24640153],"length":1,"stats":{"Line":0}},{"line":99,"address":[24640263,24640168],"length":1,"stats":{"Line":0}},{"line":102,"address":[24640409,24640270],"length":1,"stats":{"Line":0}},{"line":105,"address":[24640447],"length":1,"stats":{"Line":0}},{"line":107,"address":[24640603,24640633],"length":1,"stats":{"Line":0}},{"line":108,"address":[24641023],"length":1,"stats":{"Line":0}},{"line":109,"address":[24640655],"length":1,"stats":{"Line":0}},{"line":110,"address":[24640671],"length":1,"stats":{"Line":0}},{"line":111,"address":[24640773,24640693],"length":1,"stats":{"Line":0}},{"line":120,"address":[24639935,24639849],"length":1,"stats":{"Line":0}},{"line":121,"address":[24640055],"length":1,"stats":{"Line":0}},{"line":122,"address":[24640025],"length":1,"stats":{"Line":0}},{"line":123,"address":[24640033],"length":1,"stats":{"Line":0}},{"line":130,"address":[24641177,24639281],"length":1,"stats":{"Line":0}},{"line":131,"address":[24641214],"length":1,"stats":{"Line":0}},{"line":134,"address":[24641347,24641237],"length":1,"stats":{"Line":0}},{"line":135,"address":[24641425],"length":1,"stats":{"Line":0}},{"line":136,"address":[24641480,24641570],"length":1,"stats":{"Line":0}},{"line":137,"address":[24641588,24641655,24641533],"length":1,"stats":{"Line":0}},{"line":138,"address":[24641708,24641681,24641596],"length":1,"stats":{"Line":0}},{"line":140,"address":[24641689],"length":1,"stats":{"Line":0}},{"line":141,"address":[24642029],"length":1,"stats":{"Line":0}},{"line":142,"address":[24641734],"length":1,"stats":{"Line":0}},{"line":143,"address":[24641747],"length":1,"stats":{"Line":0}},{"line":144,"address":[24641769],"length":1,"stats":{"Line":0}},{"line":154,"address":[24639230],"length":1,"stats":{"Line":0}},{"line":159,"address":[24643992,24642096,24644079],"length":1,"stats":{"Line":0}},{"line":160,"address":[24642164],"length":1,"stats":{"Line":0}},{"line":162,"address":[24373086,24373072],"length":1,"stats":{"Line":0}},{"line":164,"address":[24643122,24642642,24642517],"length":1,"stats":{"Line":0}},{"line":166,"address":[24642605],"length":1,"stats":{"Line":0}},{"line":167,"address":[24643053],"length":1,"stats":{"Line":0}},{"line":169,"address":[24642770,24642826,24642648],"length":1,"stats":{"Line":0}},{"line":171,"address":[24642736],"length":1,"stats":{"Line":0}},{"line":172,"address":[24642815],"length":1,"stats":{"Line":0}},{"line":174,"address":[24642776],"length":1,"stats":{"Line":0}},{"line":178,"address":[24643228,24643003],"length":1,"stats":{"Line":0}},{"line":179,"address":[24643356],"length":1,"stats":{"Line":0}},{"line":182,"address":[24643390,24643458],"length":1,"stats":{"Line":0}},{"line":183,"address":[24643553],"length":1,"stats":{"Line":0}},{"line":184,"address":[24643495],"length":1,"stats":{"Line":0}},{"line":188,"address":[24643669,24643755],"length":1,"stats":{"Line":0}},{"line":191,"address":[24643780],"length":1,"stats":{"Line":0}},{"line":194,"address":[24643855],"length":1,"stats":{"Line":0}},{"line":197,"address":[24643912],"length":1,"stats":{"Line":0}},{"line":201,"address":[24644096],"length":1,"stats":{"Line":0}},{"line":206,"address":[24644150],"length":1,"stats":{"Line":0}},{"line":208,"address":[24644159,24644175],"length":1,"stats":{"Line":0}},{"line":209,"address":[24644289,24644246],"length":1,"stats":{"Line":0}},{"line":210,"address":[24644344],"length":1,"stats":{"Line":0}},{"line":213,"address":[24644477,24644367],"length":1,"stats":{"Line":0}},{"line":214,"address":[24644981,24644555],"length":1,"stats":{"Line":0}},{"line":215,"address":[24644694,24644615],"length":1,"stats":{"Line":0}},{"line":216,"address":[24644779,24644665,24644712],"length":1,"stats":{"Line":0}},{"line":217,"address":[24644802,24644826,24644720],"length":1,"stats":{"Line":0}},{"line":219,"address":[24644810],"length":1,"stats":{"Line":0}},{"line":221,"address":[24644863],"length":1,"stats":{"Line":0}},{"line":223,"address":[24644839,24644976,24644986],"length":1,"stats":{"Line":0}},{"line":229,"address":[24644271],"length":1,"stats":{"Line":0}},{"line":233,"address":[24638416,24638990],"length":1,"stats":{"Line":0}},{"line":238,"address":[24638539,24638467],"length":1,"stats":{"Line":0}},{"line":239,"address":[24638516,24638561,24638628],"length":1,"stats":{"Line":0}},{"line":242,"address":[24638576],"length":1,"stats":{"Line":0}},{"line":243,"address":[24638695,24638605],"length":1,"stats":{"Line":0}},{"line":244,"address":[24638820],"length":1,"stats":{"Line":0}},{"line":250,"address":[24646779,24646773,24645008],"length":1,"stats":{"Line":0}},{"line":255,"address":[24645047],"length":1,"stats":{"Line":0}},{"line":256,"address":[24645204,24645128],"length":1,"stats":{"Line":0}},{"line":258,"address":[24645212],"length":1,"stats":{"Line":0}},{"line":259,"address":[24645692,24645345],"length":1,"stats":{"Line":0}},{"line":261,"address":[24645731],"length":1,"stats":{"Line":0}},{"line":262,"address":[24646226,24645743],"length":1,"stats":{"Line":0}},{"line":263,"address":[24646074],"length":1,"stats":{"Line":0}},{"line":266,"address":[24646121,24646231],"length":1,"stats":{"Line":0}},{"line":270,"address":[24646087],"length":1,"stats":{"Line":0}},{"line":271,"address":[24646249,24646340],"length":1,"stats":{"Line":0}},{"line":272,"address":[24646439],"length":1,"stats":{"Line":0}},{"line":280,"address":[24645268,24645382],"length":1,"stats":{"Line":0}},{"line":291,"address":[24647490,24646800,24647511],"length":1,"stats":{"Line":0}},{"line":297,"address":[24646859],"length":1,"stats":{"Line":0}},{"line":298,"address":[24647067,24646945,24647496],"length":1,"stats":{"Line":0}},{"line":299,"address":[24647384,24647264],"length":1,"stats":{"Line":0}},{"line":303,"address":[24646964],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":120},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","autofix.rs"],"content":"use crate::config::{AIConfig, ForbiddenRule};\nuse miette::{IntoDiagnostic, Result};\nuse serde::{Deserialize, Serialize};\nuse std::fs;\nuse std::path::{Path, PathBuf};\n\n/// Representa una violación arquitectónica detectada\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Violation {\n    /// Ruta del archivo con la violación\n    pub file_path: PathBuf,\n    /// Contenido completo del archivo\n    pub file_content: String,\n    /// Import ofensivo que causa la violación\n    pub offensive_import: String,\n    /// Regla que fue violada\n    pub rule: ForbiddenRule,\n    /// Línea donde ocurre la violación\n    pub line_number: usize,\n}\n\n/// Tipo de fix sugerido por la IA\n#[derive(Debug, Deserialize, Serialize)]\n#[serde(tag = \"fix_type\", rename_all = \"snake_case\")]\npub enum FixType {\n    /// Refactorizar código (cambiar imports, crear interfaces)\n    Refactor { old_code: String, new_code: String },\n    /// Mover archivo a otra capa\n    MoveFile { from: String, to: String },\n    /// Crear nueva interfaz/abstracción\n    CreateInterface {\n        interface_path: String,\n        interface_code: String,\n        updated_import: String,\n    },\n}\n\n/// Respuesta estructurada de la IA\n#[derive(Debug, Deserialize, Serialize)]\npub struct FixSuggestion {\n    pub fix_type: FixType,\n    pub explanation: String,\n    pub confidence: String, // \"high\", \"medium\", \"low\"\n}\n\n/// Consulta a la IA para obtener una sugerencia de fix\npub async fn suggest_fix(\n    violation: \u0026Violation,\n    project_root: \u0026Path,\n    ai_configs: \u0026[AIConfig],\n) -\u003e Result\u003cFixSuggestion\u003e {\n    // Obtener estructura de carpetas del proyecto\n    let folder_structure = get_project_structure(project_root);\n\n    // Construir prompt estructurado\n    let prompt = format!(\n        r#\"Eres un arquitecto de software experto. Analiza esta violación arquitectónica y sugiere una refactorización.\n\n**CONTEXTO DEL PROYECTO:**\nEstructura de carpetas:\n{}\n\n**VIOLACIÓN DETECTADA:**\nArchivo: {}\nRegla violada: Archivos en '{}' no pueden importar de '{}'\nImport ofensivo (línea {}): {}\n\n**CÓDIGO DEL ARCHIVO:**\n```typescript\n{}\n```\n\n**TAREA:**\nSugiere la mejor refactorización para resolver esta violación. Responde ÚNICAMENTE con un objeto JSON válido usando uno de estos formatos:\n\n1. Para refactorizar código:\n{{\n  \"fix_type\": \"refactor\",\n  \"old_code\": \"import {{ X }} from '../infrastructure/...'\",\n  \"new_code\": \"import {{ X }} from '../domain/interfaces/...'\",\n  \"explanation\": \"Crear una interfaz en la capa de dominio...\",\n  \"confidence\": \"high\"\n}}\n\n2. Para mover archivo:\n{{\n  \"fix_type\": \"move_file\",\n  \"from\": \"src/domain/user.entity.ts\",\n  \"to\": \"src/infrastructure/models/user.entity.ts\",\n  \"explanation\": \"Este archivo pertenece a la capa de infraestructura...\",\n  \"confidence\": \"medium\"\n}}\n\n3. Para crear interfaz:\n{{\n  \"fix_type\": \"create_interface\",\n  \"interface_path\": \"src/domain/interfaces/IUserRepository.ts\",\n  \"interface_code\": \"export interface IUserRepository {{ ... }}\",\n  \"updated_import\": \"import {{ IUserRepository }} from './interfaces/IUserRepository'\",\n  \"explanation\": \"Crear una abstracción para desacoplar...\",\n  \"confidence\": \"high\"\n}}\n\nResponde SOLO con el JSON, sin texto adicional.\"#,\n        folder_structure,\n        violation.file_path.display(),\n        violation.rule.from,\n        violation.rule.to,\n        violation.line_number,\n        violation.offensive_import,\n        violation.file_content\n    );\n\n    // Hacer la petición a la IA usando el sistema de fallback\n    let content = crate::ai::consultar_ia_con_fallback(prompt, ai_configs)\n        .map_err(|e| miette::miette!(\"No se pudo obtener sugerencia de ningún modelo: {}\", e))?;\n\n    // Limpiar markdown code blocks si existen\n    let json_content = content\n        .trim()\n        .trim_start_matches(\"```json\")\n        .trim_start_matches(\"```\")\n        .trim_end_matches(\"```\")\n        .trim();\n\n    // Buscar el primer '{' y el último '}' para casos donde la IA añade texto\n    let json_start = json_content.find('{').ok_or_else(|| {\n        miette::miette!(\"No se encontró JSON en la respuesta de la IA: {}\", content)\n    })?;\n    let json_end = json_content.rfind('}').unwrap_or(json_content.len() - 1) + 1;\n    let clean_json = \u0026json_content[json_start..json_end];\n\n    // Parsear la respuesta JSON\n    let suggestion: FixSuggestion =\n        serde_json::from_str(clean_json)\n            .into_diagnostic()\n            .map_err(|e| {\n                miette::miette!(\n                    \"Error parseando respuesta de IA: {}. Contenido: {}\",\n                    e,\n                    clean_json\n                )\n            })?;\n\n    Ok(suggestion)\n}\n\n/// Aplica un fix sugerido\npub fn apply_fix(\n    suggestion: \u0026FixSuggestion,\n    violation: \u0026Violation,\n    project_root: \u0026Path,\n) -\u003e Result\u003cString\u003e {\n    match \u0026suggestion.fix_type {\n        FixType::Refactor { old_code, new_code } =\u003e apply_refactor(violation, old_code, new_code),\n        FixType::MoveFile { from, to } =\u003e apply_move_file(project_root, from, to),\n        FixType::CreateInterface {\n            interface_path,\n            interface_code,\n            updated_import,\n        } =\u003e apply_create_interface(\n            project_root,\n            violation,\n            interface_path,\n            interface_code,\n            updated_import,\n        ),\n    }\n}\n\n/// Aplica una refactorización de código\nfn apply_refactor(violation: \u0026Violation, old_code: \u0026str, new_code: \u0026str) -\u003e Result\u003cString\u003e {\n    let content = fs::read_to_string(\u0026violation.file_path).into_diagnostic()?;\n\n    // Reemplazar el código antiguo por el nuevo\n    let updated_content = content.replace(old_code.trim(), new_code.trim());\n\n    if content == updated_content {\n        return Err(miette::miette!(\n            \"No se pudo aplicar el fix: el código antiguo no se encontró exactamente\"\n        ));\n    }\n\n    // Escribir el archivo actualizado\n    fs::write(\u0026violation.file_path, \u0026updated_content).into_diagnostic()?;\n\n    Ok(format!(\n        \"✅ Refactorizado: {}\",\n        violation.file_path.display()\n    ))\n}\n\n/// Aplica el movimiento de un archivo\nfn apply_move_file(project_root: \u0026Path, from: \u0026str, to: \u0026str) -\u003e Result\u003cString\u003e {\n    let from_path = project_root.join(from);\n    let to_path = project_root.join(to);\n\n    // Crear el directorio destino si no existe\n    if let Some(parent) = to_path.parent() {\n        fs::create_dir_all(parent).into_diagnostic()?;\n    }\n\n    // Mover el archivo\n    fs::rename(\u0026from_path, \u0026to_path).into_diagnostic()?;\n\n    Ok(format!(\"✅ Archivo movido: {} → {}\", from, to))\n}\n\n/// Crea una nueva interfaz y actualiza el import\nfn apply_create_interface(\n    project_root: \u0026Path,\n    violation: \u0026Violation,\n    interface_path: \u0026str,\n    interface_code: \u0026str,\n    updated_import: \u0026str,\n) -\u003e Result\u003cString\u003e {\n    let interface_full_path = project_root.join(interface_path);\n\n    // Crear el directorio si no existe\n    if let Some(parent) = interface_full_path.parent() {\n        fs::create_dir_all(parent).into_diagnostic()?;\n    }\n\n    // Crear el archivo de interfaz\n    fs::write(\u0026interface_full_path, interface_code).into_diagnostic()?;\n\n    // Actualizar el import en el archivo original\n    let content = fs::read_to_string(\u0026violation.file_path).into_diagnostic()?;\n    let updated_content = content.replace(\u0026violation.offensive_import, updated_import);\n    fs::write(\u0026violation.file_path, updated_content).into_diagnostic()?;\n\n    Ok(format!(\n        \"✅ Interfaz creada: {} y import actualizado en {}\",\n        interface_path,\n        violation.file_path.display()\n    ))\n}\n\n/// Obtiene la estructura de carpetas del proyecto\nfn get_project_structure(root: \u0026Path) -\u003e String {\n    let mut structure = String::new();\n\n    if let Ok(entries) = fs::read_dir(root) {\n        for entry in entries.flatten() {\n            if let Ok(metadata) = entry.metadata() {\n                let name = entry.file_name().to_string_lossy().to_string();\n\n                // Ignorar node_modules, .git, etc.\n                if name.starts_with('.') || name == \"node_modules\" {\n                    continue;\n                }\n\n                if metadata.is_dir() {\n                    structure.push_str(\u0026format!(\"  📁 {}/\\n\", name));\n\n                    // Listar subdirectorios (máximo 2 niveles)\n                    if let Ok(sub_entries) = fs::read_dir(entry.path()) {\n                        for sub_entry in sub_entries.flatten().take(5) {\n                            let sub_name = sub_entry.file_name().to_string_lossy().to_string();\n                            if !sub_name.starts_with('.') {\n                                structure.push_str(\u0026format!(\"    - {}\\n\", sub_name));\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    structure\n}\n","traces":[{"line":47,"address":[24419104],"length":1,"stats":{"Line":0}},{"line":53,"address":[24402869],"length":1,"stats":{"Line":0}},{"line":56,"address":[24403108],"length":1,"stats":{"Line":0}},{"line":106,"address":[24402965,24403045],"length":1,"stats":{"Line":0}},{"line":115,"address":[24405354,24403795,24403629,24403715],"length":1,"stats":{"Line":0}},{"line":116,"address":[24405585,24405568,24403779,24403688],"length":1,"stats":{"Line":0}},{"line":119,"address":[24404222,24403896],"length":1,"stats":{"Line":0}},{"line":127,"address":[24405327,24404257,24404421,24405392],"length":1,"stats":{"Line":0}},{"line":128,"address":[24405410],"length":1,"stats":{"Line":0}},{"line":130,"address":[24404709,24404484],"length":1,"stats":{"Line":0}},{"line":131,"address":[24404682,24404736],"length":1,"stats":{"Line":0}},{"line":134,"address":[24404849,24404929,24405306,24404752],"length":1,"stats":{"Line":0}},{"line":137,"address":[24404814,24406181,24405856,24406175],"length":1,"stats":{"Line":0}},{"line":138,"address":[24405967,24405886],"length":1,"stats":{"Line":0}},{"line":145,"address":[24405086],"length":1,"stats":{"Line":0}},{"line":149,"address":[24426288],"length":1,"stats":{"Line":0}},{"line":154,"address":[24426368],"length":1,"stats":{"Line":0}},{"line":155,"address":[24426461],"length":1,"stats":{"Line":0}},{"line":156,"address":[24426568],"length":1,"stats":{"Line":0}},{"line":157,"address":[24426687],"length":1,"stats":{"Line":0}},{"line":164,"address":[24426735],"length":1,"stats":{"Line":0}},{"line":165,"address":[24426755],"length":1,"stats":{"Line":0}},{"line":166,"address":[24426773],"length":1,"stats":{"Line":0}},{"line":172,"address":[24420516,24419168,24420510],"length":1,"stats":{"Line":0}},{"line":173,"address":[24419271],"length":1,"stats":{"Line":0}},{"line":176,"address":[24419595,24419480],"length":1,"stats":{"Line":0}},{"line":178,"address":[24419772,24419831],"length":1,"stats":{"Line":0}},{"line":179,"address":[24419869,24420371],"length":1,"stats":{"Line":0}},{"line":185,"address":[24419906,24420329,24419845],"length":1,"stats":{"Line":0}},{"line":187,"address":[24420118],"length":1,"stats":{"Line":0}},{"line":189,"address":[24420040],"length":1,"stats":{"Line":0}},{"line":194,"address":[24421571,24421577,24420544],"length":1,"stats":{"Line":0}},{"line":195,"address":[24420630],"length":1,"stats":{"Line":0}},{"line":196,"address":[24420692],"length":1,"stats":{"Line":0}},{"line":199,"address":[24420772,24420840],"length":1,"stats":{"Line":0}},{"line":200,"address":[24421006,24420950],"length":1,"stats":{"Line":0}},{"line":204,"address":[24421155,24421550,24420966],"length":1,"stats":{"Line":0}},{"line":206,"address":[24421286],"length":1,"stats":{"Line":0}},{"line":210,"address":[24426247,24424544,24426263],"length":1,"stats":{"Line":0}},{"line":217,"address":[24424720],"length":1,"stats":{"Line":0}},{"line":220,"address":[24424769,24424852],"length":1,"stats":{"Line":0}},{"line":221,"address":[24424974,24425044],"length":1,"stats":{"Line":0}},{"line":225,"address":[24425197,24426258,24425009],"length":1,"stats":{"Line":0}},{"line":228,"address":[24425331,24426253],"length":1,"stats":{"Line":0}},{"line":229,"address":[24425653,24425558],"length":1,"stats":{"Line":0}},{"line":230,"address":[24425684],"length":1,"stats":{"Line":0}},{"line":232,"address":[24425957],"length":1,"stats":{"Line":0}},{"line":235,"address":[24425879],"length":1,"stats":{"Line":0}},{"line":240,"address":[24424275,24424529,24421600],"length":1,"stats":{"Line":0}},{"line":241,"address":[24421663],"length":1,"stats":{"Line":0}},{"line":243,"address":[24421747,24421684,24421810],"length":1,"stats":{"Line":0}},{"line":244,"address":[24421918,24422042,24421843],"length":1,"stats":{"Line":0}},{"line":245,"address":[24422214,24422307,24422121],"length":1,"stats":{"Line":0}},{"line":246,"address":[24422309,24422388],"length":1,"stats":{"Line":0}},{"line":249,"address":[24422791,24422682],"length":1,"stats":{"Line":0}},{"line":253,"address":[24422805],"length":1,"stats":{"Line":0}},{"line":254,"address":[24422856],"length":1,"stats":{"Line":0}},{"line":257,"address":[24423217,24423100],"length":1,"stats":{"Line":0}},{"line":258,"address":[24423481,24423250,24423325],"length":1,"stats":{"Line":0}},{"line":259,"address":[24423560,24423661],"length":1,"stats":{"Line":0}},{"line":260,"address":[24423943],"length":1,"stats":{"Line":0}},{"line":261,"address":[24424057,24424008],"length":1,"stats":{"Line":0}},{"line":270,"address":[24424486],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":63},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","cache.rs"],"content":"use crate::analysis_result::{CategorizedViolation, LongFunction};\nuse crate::config::LinterContext;\nuse crate::memory_cache::MemoryCache;\nuse serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse std::fs;\nuse std::io;\nuse std::path::{Path, PathBuf};\n\nconst CACHE_VERSION: u32 = 1;\nconst CACHE_DIR: \u0026str = \".architect-cache\";\nconst CACHE_FILE: \u0026str = \"cache.json\";\n\n/// Per-file cached analysis data\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct FileCacheEntry {\n    pub content_hash: String,\n    pub violations: Vec\u003cCategorizedViolation\u003e,\n    pub long_functions: Vec\u003cLongFunction\u003e,\n    pub import_count: usize,\n    pub function_count: usize,\n}\n\n/// Disk-persisted analysis cache\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AnalysisCache {\n    pub version: u32,\n    pub config_hash: String,\n    pub files: HashMap\u003cString, FileCacheEntry\u003e,\n}\n\n/// Compute xxh3-64 hash of raw bytes, returned as hex string\npub fn hash_content(bytes: \u0026[u8]) -\u003e String {\n    format!(\"{:016x}\", xxhash_rust::xxh3::xxh3_64(bytes))\n}\n\n/// Compute a config hash from the fields that affect analysis results.\n/// If this changes, the entire cache is invalidated.\npub fn hash_config(ctx: \u0026LinterContext) -\u003e String {\n    let mut data = format!(\"max_lines={};imports=\", ctx.max_lines);\n    for rule in \u0026ctx.forbidden_imports {\n        data.push_str(\u0026rule.from);\n        data.push(':');\n        data.push_str(\u0026rule.to);\n        data.push(';');\n    }\n    hash_content(data.as_bytes())\n}\n\nimpl AnalysisCache {\n    /// Create a new empty cache with the given config hash\n    pub fn new(config_hash: String) -\u003e Self {\n        Self {\n            version: CACHE_VERSION,\n            config_hash,\n            files: HashMap::new(),\n        }\n    }\n\n    /// Load cache from disk. Returns None if the file doesn't exist,\n    /// can't be parsed, or has a version/config mismatch.\n    pub fn load(project_root: \u0026Path, config_hash: \u0026str) -\u003e Option\u003cSelf\u003e {\n        let cache_path = project_root.join(CACHE_DIR).join(CACHE_FILE);\n        let data = fs::read_to_string(\u0026cache_path).ok()?;\n        let cache: Self = serde_json::from_str(\u0026data).ok()?;\n\n        if cache.version != CACHE_VERSION || cache.config_hash != config_hash {\n            return None;\n        }\n\n        Some(cache)\n    }\n\n    /// Persist cache to disk\n    pub fn save(\u0026self, project_root: \u0026Path) -\u003e io::Result\u003c()\u003e {\n        let cache_dir = project_root.join(CACHE_DIR);\n        fs::create_dir_all(\u0026cache_dir)?;\n        let cache_path = cache_dir.join(CACHE_FILE);\n        let json =\n            serde_json::to_string(self).map_err(|e| io::Error::new(io::ErrorKind::Other, e))?;\n        fs::write(\u0026cache_path, json)\n    }\n\n    /// Convert an absolute path to a normalized relative key (forward slashes)\n    pub fn normalize_path(path: \u0026Path, project_root: \u0026Path) -\u003e String {\n        path.strip_prefix(project_root)\n            .unwrap_or(path)\n            .to_string_lossy()\n            .replace('\\\\', \"/\")\n    }\n\n    /// Look up a cached entry. Returns Some only if the content hash matches.\n    pub fn get(\u0026self, key: \u0026str, content_hash: \u0026str) -\u003e Option\u003c\u0026FileCacheEntry\u003e {\n        self.files\n            .get(key)\n            .filter(|e| e.content_hash == content_hash)\n    }\n\n    /// Insert or update a cache entry\n    pub fn insert(\u0026mut self, key: String, entry: FileCacheEntry) {\n        self.files.insert(key, entry);\n    }\n\n    /// Remove a file from the cache (e.g. when a watched file changes)\n    pub fn remove(\u0026mut self, key: \u0026str) {\n        self.files.remove(key);\n    }\n}\n\n/// Hybrid cache combining memory (LRU) and disk cache layers\npub struct HybridCache {\n    memory: MemoryCache,\n    disk: AnalysisCache,\n}\n\nimpl HybridCache {\n    pub fn new(\n        memory_capacity: usize,\n        project_root: \u0026Path,\n        config_hash: String,\n    ) -\u003e Result\u003cSelf, Box\u003cdyn std::error::Error\u003e\u003e {\n        // Load disk cache from disk if it exists, otherwise create new\n        let disk = AnalysisCache::load(project_root, \u0026config_hash)\n            .unwrap_or_else(|| AnalysisCache::new(config_hash));\n\n        Ok(Self {\n            memory: MemoryCache::new(memory_capacity),\n            disk,\n        })\n    }\n\n    pub fn get(\u0026self, path: \u0026PathBuf) -\u003e Option\u003cString\u003e {\n        // Layer 1: Memory cache\n        if let Some(content) = self.memory.get(path) {\n            return Some(content);\n        }\n\n        // Layer 2: Disk cache\n        let key = path.to_string_lossy().replace('\\\\', \"/\");\n        if let Some(entry) = self.disk.files.get(\u0026key) {\n            // Promote to memory cache\n            self.memory.put(path.clone(), entry.content_hash.clone());\n            return Some(entry.content_hash.clone());\n        }\n\n        None\n    }\n\n    pub fn put(\u0026mut self, path: PathBuf, entry: FileCacheEntry) {\n        let key = path.to_string_lossy().replace('\\\\', \"/\");\n        // Update both layers\n        self.memory.put(path, entry.content_hash.clone());\n        self.disk.files.insert(key, entry);\n    }\n\n    pub fn clear_memory(\u0026self) {\n        self.memory.clear();\n    }\n\n    pub fn save(\u0026self, project_root: \u0026Path) -\u003e io::Result\u003c()\u003e {\n        self.disk.save(project_root)\n    }\n}\n","traces":[{"line":33,"address":[25243072],"length":1,"stats":{"Line":0}},{"line":34,"address":[25243120],"length":1,"stats":{"Line":0}},{"line":39,"address":[25243051,25242528,25243045],"length":1,"stats":{"Line":0}},{"line":40,"address":[25242558],"length":1,"stats":{"Line":0}},{"line":41,"address":[25242672,25242744],"length":1,"stats":{"Line":0}},{"line":42,"address":[25242849,25242953],"length":1,"stats":{"Line":0}},{"line":43,"address":[25242970],"length":1,"stats":{"Line":0}},{"line":44,"address":[25242982],"length":1,"stats":{"Line":0}},{"line":45,"address":[25243033],"length":1,"stats":{"Line":0}},{"line":47,"address":[25242871],"length":1,"stats":{"Line":0}},{"line":52,"address":[25243616,25243760],"length":1,"stats":{"Line":0}},{"line":56,"address":[25243646],"length":1,"stats":{"Line":0}},{"line":62,"address":[25244825,25244783,25243776],"length":1,"stats":{"Line":0}},{"line":63,"address":[25243819],"length":1,"stats":{"Line":0}},{"line":64,"address":[25244010,25244823],"length":1,"stats":{"Line":0}},{"line":65,"address":[25244287,25244216,25244808],"length":1,"stats":{"Line":0}},{"line":67,"address":[25244590,25244468],"length":1,"stats":{"Line":0}},{"line":68,"address":[25244517],"length":1,"stats":{"Line":0}},{"line":71,"address":[25244601],"length":1,"stats":{"Line":0}},{"line":75,"address":[25245601,25244848,25245666],"length":1,"stats":{"Line":0}},{"line":76,"address":[25244884],"length":1,"stats":{"Line":0}},{"line":77,"address":[25244929,25245659,25244991],"length":1,"stats":{"Line":0}},{"line":78,"address":[25245089],"length":1,"stats":{"Line":0}},{"line":79,"address":[24281612,24281600],"length":1,"stats":{"Line":0}},{"line":81,"address":[25245526,25245415],"length":1,"stats":{"Line":0}},{"line":85,"address":[25243248,25243530,25243524],"length":1,"stats":{"Line":0}},{"line":86,"address":[25243340,25243397],"length":1,"stats":{"Line":0}},{"line":87,"address":[25243365],"length":1,"stats":{"Line":0}},{"line":93,"address":[25243552],"length":1,"stats":{"Line":0}},{"line":94,"address":[25243580],"length":1,"stats":{"Line":0}},{"line":95,"address":[25243584],"length":1,"stats":{"Line":0}},{"line":96,"address":[24281552,24281572],"length":1,"stats":{"Line":0}},{"line":100,"address":[25245680],"length":1,"stats":{"Line":0}},{"line":101,"address":[25245705],"length":1,"stats":{"Line":0}},{"line":105,"address":[25245824],"length":1,"stats":{"Line":0}},{"line":106,"address":[25245852],"length":1,"stats":{"Line":0}},{"line":117,"address":[25241633,25241216],"length":1,"stats":{"Line":0}},{"line":123,"address":[25241379,25241285],"length":1,"stats":{"Line":0}},{"line":124,"address":[24281500,24281488],"length":1,"stats":{"Line":0}},{"line":126,"address":[25241563],"length":1,"stats":{"Line":0}},{"line":127,"address":[25241478],"length":1,"stats":{"Line":0}},{"line":128,"address":[25241535],"length":1,"stats":{"Line":0}},{"line":132,"address":[25241188,25240400,25241194],"length":1,"stats":{"Line":0}},{"line":134,"address":[25240443],"length":1,"stats":{"Line":0}},{"line":135,"address":[25240538],"length":1,"stats":{"Line":0}},{"line":139,"address":[25240639,25240574],"length":1,"stats":{"Line":0}},{"line":140,"address":[25240798],"length":1,"stats":{"Line":0}},{"line":142,"address":[25240901,25241166,25240994,25240967],"length":1,"stats":{"Line":0}},{"line":143,"address":[25241088],"length":1,"stats":{"Line":0}},{"line":146,"address":[25240930],"length":1,"stats":{"Line":0}},{"line":149,"address":[25242414,25242467,25241680],"length":1,"stats":{"Line":0}},{"line":150,"address":[25241723,25241844],"length":1,"stats":{"Line":0}},{"line":152,"address":[25242039,25242392],"length":1,"stats":{"Line":0}},{"line":153,"address":[25242205],"length":1,"stats":{"Line":0}},{"line":156,"address":[25240368],"length":1,"stats":{"Line":0}},{"line":157,"address":[25240373],"length":1,"stats":{"Line":0}},{"line":160,"address":[25242496],"length":1,"stats":{"Line":0}},{"line":161,"address":[25242514],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":58},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","circular.rs"],"content":"use miette::{IntoDiagnostic, Result};\nuse serde::{Deserialize, Serialize};\nuse std::collections::{HashMap, HashSet};\nuse std::path::{Path, PathBuf};\nuse swc_common::SourceMap;\nuse swc_ecma_parser::{lexer::Lexer, EsConfig, Parser, StringInput, Syntax, TsConfig};\n\n/// Representa una dependencia cíclica detectada\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct CircularDependency {\n    /// El ciclo completo de dependencias\n    pub cycle: Vec\u003cString\u003e,\n    /// Descripción legible del problema\n    pub description: String,\n}\n\n/// Analizador de dependencias cíclicas\npub struct CircularDependencyAnalyzer {\n    /// Grafo de dependencias: node -\u003e [nodes que importa]\n    graph: HashMap\u003cString, Vec\u003cString\u003e\u003e,\n    /// Directorio raíz del proyecto\n    project_root: PathBuf,\n    /// Grafo inverso: node -\u003e [nodes que lo importan]\n    reverse_graph: HashMap\u003cString, Vec\u003cString\u003e\u003e,\n}\n\nimpl CircularDependencyAnalyzer {\n    /// Crea un nuevo analizador de dependencias cíclicas\n    pub fn new(project_root: \u0026Path) -\u003e Self {\n        Self {\n            graph: HashMap::new(),\n            project_root: project_root.to_path_buf(),\n            reverse_graph: HashMap::new(),\n        }\n    }\n\n    /// Analiza todos los archivos y construye el grafo de dependencias\n    pub fn build_graph(\u0026mut self, files: \u0026[PathBuf], cm: \u0026SourceMap) -\u003e Result\u003c()\u003e {\n        for file_path in files {\n            // Extraer imports del archivo\n            let imports = self.extract_imports(file_path, cm)?;\n\n            // Normalizar la ruta del archivo actual\n            let normalized_current = self.normalize_file_path(file_path);\n            let current_key = normalized_current.clone();\n\n            // Insertar en el grafo\n            self.graph\n                .entry(current_key.clone())\n                .or_insert_with(Vec::new);\n\n            // Procesar cada import\n            for import_path in imports {\n                if let Some(resolved) = self.resolve_import_path(file_path, \u0026import_path) {\n                    let normalized_import = self.normalize_file_path(\u0026resolved);\n\n                    // Solo agregar dependencias internas del proyecto\n                    if self.is_internal_dependency(\u0026normalized_import) {\n                        self.graph\n                            .entry(current_key.clone())\n                            .or_insert_with(Vec::new)\n                            .push(normalized_import.clone());\n\n                        // Actualizar grafo inverso\n                        self.reverse_graph\n                            .entry(normalized_import)\n                            .or_insert_with(Vec::new)\n                            .push(current_key.clone());\n                    }\n                }\n            }\n        }\n\n        Ok(())\n    }\n\n    /// Detecta todos los ciclos en el grafo de dependencias\n    pub fn detect_cycles(\u0026self) -\u003e Vec\u003cCircularDependency\u003e {\n        let mut cycles = Vec::new();\n        let mut visited = HashSet::new();\n        let mut rec_stack = HashSet::new();\n        let mut path = Vec::new();\n\n        for node in self.graph.keys() {\n            if !visited.contains(node) {\n                self.dfs_detect_cycles(node, \u0026mut visited, \u0026mut rec_stack, \u0026mut path, \u0026mut cycles);\n            }\n        }\n\n        cycles\n    }\n\n    /// DFS para detectar ciclos en el grafo\n    fn dfs_detect_cycles(\n        \u0026self,\n        node: \u0026str,\n        visited: \u0026mut HashSet\u003cString\u003e,\n        rec_stack: \u0026mut HashSet\u003cString\u003e,\n        path: \u0026mut Vec\u003cString\u003e,\n        cycles: \u0026mut Vec\u003cCircularDependency\u003e,\n    ) {\n        visited.insert(node.to_string());\n        rec_stack.insert(node.to_string());\n        path.push(node.to_string());\n\n        if let Some(neighbors) = self.graph.get(node) {\n            for neighbor in neighbors {\n                if !visited.contains(neighbor) {\n                    self.dfs_detect_cycles(neighbor, visited, rec_stack, path, cycles);\n                } else if rec_stack.contains(neighbor) {\n                    // Encontramos un ciclo\n                    let cycle_start = path.iter().position(|x| x == neighbor).unwrap_or(0);\n                    let mut cycle = path[cycle_start..].to_vec();\n                    cycle.push(neighbor.clone());\n\n                    cycles.push(CircularDependency {\n                        cycle: cycle.clone(),\n                        description: self.format_cycle_description(\u0026cycle),\n                    });\n                }\n            }\n        }\n\n        path.pop();\n        rec_stack.remove(node);\n    }\n\n    /// Extrae todos los imports de un archivo\n    fn extract_imports(\u0026self, file_path: \u0026Path, cm: \u0026SourceMap) -\u003e Result\u003cVec\u003cString\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parsear según la extensión\n        let extension = file_path.extension().and_then(|e| e.to_str()).unwrap_or(\"\");\n\n        let syntax = match extension {\n            \"ts\" | \"tsx\" =\u003e Syntax::Typescript(TsConfig {\n                decorators: true,\n                tsx: extension == \"tsx\",\n                ..Default::default()\n            }),\n            \"js\" | \"jsx\" =\u003e Syntax::Es(EsConfig {\n                decorators: true,\n                jsx: extension == \"jsx\",\n                ..Default::default()\n            }),\n            _ =\u003e Syntax::Typescript(TsConfig::default()),\n        };\n\n        let fm = cm.load_file(file_path).into_diagnostic()?;\n        let lexer = Lexer::new(syntax, Default::default(), StringInput::from(\u0026*fm), None);\n        let mut parser = Parser::new_from(lexer);\n\n        let module = parser\n            .parse_module()\n            .map_err(|e| miette::miette!(\"Error parsing {}: {:?}\", file_path.display(), e))?;\n\n        // Extraer imports estáticos\n        for item in \u0026module.body {\n            if let swc_ecma_ast::ModuleItem::ModuleDecl(swc_ecma_ast::ModuleDecl::Import(import)) =\n                item\n            {\n                imports.push(import.src.value.to_string());\n            }\n        }\n\n        Ok(imports)\n    }\n\n    /// Resuelve un path de import a una ruta de archivo real\n    fn resolve_import_path(\u0026self, current_file: \u0026Path, import_path: \u0026str) -\u003e Option\u003cPathBuf\u003e {\n        // Ignorar imports externos (node_modules, @/aliases si no se resuelven, etc.)\n        if import_path.starts_with('@')\n            || import_path.starts_with(\"node_modules\")\n            || (!import_path.starts_with('.') \u0026\u0026 !import_path.starts_with('/'))\n        {\n            // Podríamos agregar lógica para resolver alias de TypeScript aquí\n            // Por ahora, solo procesamos imports relativos\n            return None;\n        }\n\n        // Resolver path relativo\n        let current_dir = current_file.parent()?;\n        let resolved = current_dir.join(import_path);\n\n        // Intentar diferentes extensiones\n        let extensions = [\"ts\", \"tsx\", \"js\", \"jsx\"];\n        for ext in \u0026extensions {\n            let with_ext = resolved.with_extension(ext);\n            if with_ext.exists() {\n                return Some(with_ext);\n            }\n        }\n\n        // Intentar index.ts/js en directorios\n        let index_ts = resolved.join(\"index.ts\");\n        let index_js = resolved.join(\"index.js\");\n\n        if index_ts.exists() {\n            return Some(index_ts);\n        }\n        if index_js.exists() {\n            return Some(index_js);\n        }\n\n        // Si el archivo existe tal cual (sin cambiar extensión)\n        if resolved.exists() {\n            Some(resolved)\n        } else {\n            None\n        }\n    }\n\n    /// Normaliza una ruta de archivo a una representación canónica\n    fn normalize_file_path(\u0026self, path: \u0026Path) -\u003e String {\n        // Canonicalizar el path para limpiar ./ y ../\n        let canonical = if let Ok(canon) = path.canonicalize() {\n            canon\n        } else {\n            // Si falla la canonicalización, limpiar manualmente\n            let cleaned = path\n                .components()\n                .filter(|c| !matches!(c, std::path::Component::CurDir))\n                .collect::\u003cPathBuf\u003e();\n            cleaned\n        };\n\n        // Obtener ruta relativa al directorio raíz del proyecto\n        if let Ok(relative) = canonical.strip_prefix(\u0026self.project_root) {\n            relative.to_string_lossy().replace('\\\\', \"/\").to_lowercase()\n        } else {\n            canonical\n                .to_string_lossy()\n                .replace('\\\\', \"/\")\n                .to_lowercase()\n        }\n    }\n\n    /// Verifica si una dependencia es interna del proyecto\n    fn is_internal_dependency(\u0026self, path: \u0026str) -\u003e bool {\n        // Es interna si no contiene node_modules\n        !path.contains(\"node_modules\")\n    }\n\n    /// Formatea una descripción legible del ciclo\n    fn format_cycle_description(\u0026self, cycle: \u0026[String]) -\u003e String {\n        if cycle.is_empty() {\n            return \"Ciclo vacío\".to_string();\n        }\n\n        let mut desc = String::from(\"Dependencia cíclica detectada:\\n\");\n        for (i, node) in cycle.iter().enumerate() {\n            if i \u003c cycle.len() - 1 {\n                desc.push_str(\u0026format!(\"  {} → {}\\n\", node, cycle[i + 1]));\n            }\n        }\n        desc.push_str(\u0026format!(\n            \"\\n  ⚠️  Esto rompe la jerarquía de capas y crea acoplamiento circular.\"\n        ));\n\n        desc\n    }\n\n    /// Actualiza un archivo específico en el grafo (para watch mode)\n    pub fn update_file(\u0026mut self, file_path: \u0026Path, cm: \u0026SourceMap) -\u003e Result\u003c()\u003e {\n        let normalized_current = self.normalize_file_path(file_path);\n\n        // Eliminar aristas antiguas del nodo\n        self.invalidate_node(\u0026normalized_current);\n\n        // Re-extraer imports\n        let imports = self.extract_imports(file_path, cm)?;\n\n        // Reconstruir aristas\n        self.graph\n            .entry(normalized_current.clone())\n            .or_insert_with(Vec::new);\n\n        for import_path in imports {\n            if let Some(resolved) = self.resolve_import_path(file_path, \u0026import_path) {\n                let normalized_import = self.normalize_file_path(\u0026resolved);\n\n                if self.is_internal_dependency(\u0026normalized_import) {\n                    self.graph\n                        .entry(normalized_current.clone())\n                        .or_insert_with(Vec::new)\n                        .push(normalized_import.clone());\n\n                    // Actualizar grafo inverso\n                    self.reverse_graph\n                        .entry(normalized_import)\n                        .or_insert_with(Vec::new)\n                        .push(normalized_current.clone());\n                }\n            }\n        }\n\n        Ok(())\n    }\n\n    /// Invalida un nodo en el grafo (elimina sus aristas)\n    pub fn invalidate_node(\u0026mut self, node: \u0026str) {\n        // Eliminar aristas salientes del grafo directo\n        if let Some(deps) = self.graph.get(node) {\n            // Eliminar referencias en el grafo inverso\n            for dep in deps {\n                if let Some(reverse_deps) = self.reverse_graph.get_mut(dep) {\n                    reverse_deps.retain(|n| n != node);\n                }\n            }\n        }\n        self.graph.remove(node);\n\n        // Eliminar aristas entrantes del grafo inverso\n        if let Some(reverse_deps) = self.reverse_graph.get(node) {\n            // Eliminar referencias en el grafo directo\n            for dep in reverse_deps.clone() {\n                if let Some(forward_deps) = self.graph.get_mut(\u0026dep) {\n                    forward_deps.retain(|n| n != node);\n                }\n            }\n        }\n        self.reverse_graph.remove(node);\n    }\n\n    /// Obtiene todos los nodos conectados a un nodo dado (componente fuertemente conexo aproximado)\n    /// Útil para re-analizar solo la parte del grafo afectada por un cambio\n    pub fn get_affected_nodes(\u0026self, start_node: \u0026str) -\u003e HashSet\u003cString\u003e {\n        let mut affected = HashSet::new();\n        let mut to_visit = vec![start_node.to_string()];\n\n        while let Some(node) = to_visit.pop() {\n            if affected.contains(\u0026node) {\n                continue;\n            }\n            affected.insert(node.clone());\n\n            // Agregar dependencias directas (hacia adelante)\n            if let Some(deps) = self.graph.get(\u0026node) {\n                for dep in deps {\n                    if !affected.contains(dep) {\n                        to_visit.push(dep.clone());\n                    }\n                }\n            }\n\n            // Agregar dependencias inversas (hacia atrás)\n            if let Some(reverse_deps) = self.reverse_graph.get(\u0026node) {\n                for dep in reverse_deps {\n                    if !affected.contains(dep) {\n                        to_visit.push(dep.clone());\n                    }\n                }\n            }\n        }\n\n        affected\n    }\n\n    /// Detecta ciclos solo en un subconjunto del grafo (para análisis incremental)\n    pub fn detect_cycles_in_subgraph(\u0026self, nodes: \u0026HashSet\u003cString\u003e) -\u003e Vec\u003cCircularDependency\u003e {\n        let mut cycles = Vec::new();\n        let mut visited = HashSet::new();\n        let mut rec_stack = HashSet::new();\n        let mut path = Vec::new();\n\n        for node in nodes {\n            if !visited.contains(node) {\n                self.dfs_detect_cycles_filtered(\n                    node,\n                    nodes,\n                    \u0026mut visited,\n                    \u0026mut rec_stack,\n                    \u0026mut path,\n                    \u0026mut cycles,\n                );\n            }\n        }\n\n        cycles\n    }\n\n    /// DFS para detectar ciclos solo en un subgrafo específico\n    fn dfs_detect_cycles_filtered(\n        \u0026self,\n        node: \u0026str,\n        allowed_nodes: \u0026HashSet\u003cString\u003e,\n        visited: \u0026mut HashSet\u003cString\u003e,\n        rec_stack: \u0026mut HashSet\u003cString\u003e,\n        path: \u0026mut Vec\u003cString\u003e,\n        cycles: \u0026mut Vec\u003cCircularDependency\u003e,\n    ) {\n        visited.insert(node.to_string());\n        rec_stack.insert(node.to_string());\n        path.push(node.to_string());\n\n        if let Some(neighbors) = self.graph.get(node) {\n            for neighbor in neighbors {\n                // Solo seguir nodos que están en el subgrafo permitido\n                if !allowed_nodes.contains(neighbor) {\n                    continue;\n                }\n\n                if !visited.contains(neighbor) {\n                    self.dfs_detect_cycles_filtered(\n                        neighbor,\n                        allowed_nodes,\n                        visited,\n                        rec_stack,\n                        path,\n                        cycles,\n                    );\n                } else if rec_stack.contains(neighbor) {\n                    // Encontramos un ciclo\n                    let cycle_start = path.iter().position(|x| x == neighbor).unwrap_or(0);\n                    let mut cycle = path[cycle_start..].to_vec();\n                    cycle.push(neighbor.clone());\n\n                    cycles.push(CircularDependency {\n                        cycle: cycle.clone(),\n                        description: self.format_cycle_description(\u0026cycle),\n                    });\n                }\n            }\n        }\n\n        path.pop();\n        rec_stack.remove(node);\n    }\n}\n\n/// Función pública para analizar dependencias cíclicas en un proyecto\npub fn analyze_circular_dependencies(\n    files: \u0026[PathBuf],\n    project_root: \u0026Path,\n    cm: \u0026SourceMap,\n) -\u003e Result\u003cVec\u003cCircularDependency\u003e\u003e {\n    let mut analyzer = CircularDependencyAnalyzer::new(project_root);\n    analyzer.build_graph(files, cm)?;\n    Ok(analyzer.detect_cycles())\n}\n\n/// Imprime un reporte de dependencias cíclicas\npub fn print_circular_dependency_report(cycles: \u0026[CircularDependency]) {\n    if cycles.is_empty() {\n        println!(\"✅ No se detectaron dependencias cíclicas.\");\n        return;\n    }\n\n    println!(\"\\n🔴 DEPENDENCIAS CÍCLICAS DETECTADAS\\n\");\n    println!(\n        \"Se encontraron {} ciclo(s) de dependencias:\\n\",\n        cycles.len()\n    );\n\n    for (i, cycle) in cycles.iter().enumerate() {\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n        println!(\"Ciclo #{}\", i + 1);\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n\n        // Mostrar el ciclo completo usando el campo cycle\n        println!(\"📂 Rutas del ciclo:\");\n        for (j, path) in cycle.cycle.iter().enumerate() {\n            if j \u003c cycle.cycle.len() - 1 {\n                println!(\"  {} →\", path);\n            } else {\n                println!(\"  {} ↑ (cierra el ciclo)\", path);\n            }\n        }\n        println!();\n\n        println!(\"{}\", cycle.description);\n        println!();\n    }\n\n    println!(\"💡 Soluciones sugeridas:\");\n    println!(\"  1. Aplicar Inyección de Dependencias para romper el ciclo\");\n    println!(\"  2. Extraer la lógica compartida a un tercer módulo\");\n    println!(\"  3. Usar eventos/observadores en lugar de llamadas directas\");\n    println!(\"  4. Aplicar el principio de inversión de dependencias (DIP)\");\n}\n","traces":[{"line":29,"address":[25398854,25398592,25398860],"length":1,"stats":{"Line":0}},{"line":31,"address":[25398634],"length":1,"stats":{"Line":0}},{"line":32,"address":[25398658],"length":1,"stats":{"Line":0}},{"line":33,"address":[25398715],"length":1,"stats":{"Line":0}},{"line":38,"address":[25381488,25383477,25383483],"length":1,"stats":{"Line":0}},{"line":39,"address":[25382637,25381581],"length":1,"stats":{"Line":0}},{"line":41,"address":[25381897,25381700,25381842],"length":1,"stats":{"Line":0}},{"line":44,"address":[25382065,25381969],"length":1,"stats":{"Line":0}},{"line":45,"address":[25382072],"length":1,"stats":{"Line":0}},{"line":48,"address":[25382148],"length":1,"stats":{"Line":0}},{"line":49,"address":[25382230,25382157],"length":1,"stats":{"Line":0}},{"line":50,"address":[25382257],"length":1,"stats":{"Line":0}},{"line":53,"address":[25382478,25382276],"length":1,"stats":{"Line":0}},{"line":54,"address":[25382555,25382714],"length":1,"stats":{"Line":0}},{"line":55,"address":[25382851,25382960],"length":1,"stats":{"Line":0}},{"line":58,"address":[25383056,25382983],"length":1,"stats":{"Line":0}},{"line":59,"address":[25383104],"length":1,"stats":{"Line":0}},{"line":60,"address":[25383113],"length":1,"stats":{"Line":0}},{"line":61,"address":[25383172],"length":1,"stats":{"Line":0}},{"line":62,"address":[25383196],"length":1,"stats":{"Line":0}},{"line":65,"address":[25383401,25383255],"length":1,"stats":{"Line":0}},{"line":66,"address":[25383259],"length":1,"stats":{"Line":0}},{"line":67,"address":[25383326],"length":1,"stats":{"Line":0}},{"line":68,"address":[25383350],"length":1,"stats":{"Line":0}},{"line":74,"address":[25381814],"length":1,"stats":{"Line":0}},{"line":78,"address":[25385977,25385983,25385312],"length":1,"stats":{"Line":0}},{"line":79,"address":[25385342],"length":1,"stats":{"Line":0}},{"line":80,"address":[25385372],"length":1,"stats":{"Line":0}},{"line":81,"address":[25385429],"length":1,"stats":{"Line":0}},{"line":82,"address":[25385486],"length":1,"stats":{"Line":0}},{"line":84,"address":[25385615,25385551],"length":1,"stats":{"Line":0}},{"line":85,"address":[25385886,25385757],"length":1,"stats":{"Line":0}},{"line":86,"address":[25385901],"length":1,"stats":{"Line":0}},{"line":90,"address":[25385782],"length":1,"stats":{"Line":0}},{"line":94,"address":[25390468,25389440,25390462],"length":1,"stats":{"Line":0}},{"line":102,"address":[25389538],"length":1,"stats":{"Line":0}},{"line":103,"address":[25389575],"length":1,"stats":{"Line":0}},{"line":104,"address":[25389612],"length":1,"stats":{"Line":0}},{"line":106,"address":[25389660],"length":1,"stats":{"Line":0}},{"line":107,"address":[25389811,25389725],"length":1,"stats":{"Line":0}},{"line":108,"address":[25389885],"length":1,"stats":{"Line":0}},{"line":109,"address":[25389903],"length":1,"stats":{"Line":0}},{"line":110,"address":[25389963],"length":1,"stats":{"Line":0}},{"line":112,"address":[25389991],"length":1,"stats":{"Line":0}},{"line":113,"address":[25390091],"length":1,"stats":{"Line":0}},{"line":114,"address":[25390198,25390127],"length":1,"stats":{"Line":0}},{"line":116,"address":[25390360],"length":1,"stats":{"Line":0}},{"line":117,"address":[25390225],"length":1,"stats":{"Line":0}},{"line":118,"address":[25390348,25390252],"length":1,"stats":{"Line":0}},{"line":124,"address":[25389754],"length":1,"stats":{"Line":0}},{"line":125,"address":[25389797],"length":1,"stats":{"Line":0}},{"line":129,"address":[25388450,25386016,25388523],"length":1,"stats":{"Line":0}},{"line":130,"address":[25386095],"length":1,"stats":{"Line":0}},{"line":133,"address":[25386228,25386144],"length":1,"stats":{"Line":0}},{"line":136,"address":[25386477,25387054,25386337],"length":1,"stats":{"Line":0}},{"line":138,"address":[25386434],"length":1,"stats":{"Line":0}},{"line":139,"address":[25386982],"length":1,"stats":{"Line":0}},{"line":141,"address":[25386483,25386800,25386623],"length":1,"stats":{"Line":0}},{"line":143,"address":[25386580],"length":1,"stats":{"Line":0}},{"line":144,"address":[25386786],"length":1,"stats":{"Line":0}},{"line":146,"address":[25386629],"length":1,"stats":{"Line":0}},{"line":149,"address":[25387170,25386754,25388521],"length":1,"stats":{"Line":0}},{"line":150,"address":[25387331,25387422],"length":1,"stats":{"Line":0}},{"line":151,"address":[25387550],"length":1,"stats":{"Line":0}},{"line":153,"address":[25387778,25387690],"length":1,"stats":{"Line":0}},{"line":155,"address":[25379184,25379212],"length":1,"stats":{"Line":0}},{"line":158,"address":[25387895,25387978],"length":1,"stats":{"Line":0}},{"line":159,"address":[25388098,25388291],"length":1,"stats":{"Line":0}},{"line":162,"address":[25388321],"length":1,"stats":{"Line":0}},{"line":166,"address":[25388119],"length":1,"stats":{"Line":0}},{"line":170,"address":[25393376,25395124,25395413],"length":1,"stats":{"Line":0}},{"line":172,"address":[25393493],"length":1,"stats":{"Line":0}},{"line":173,"address":[25393548],"length":1,"stats":{"Line":0}},{"line":174,"address":[25393614],"length":1,"stats":{"Line":0}},{"line":178,"address":[25393580],"length":1,"stats":{"Line":0}},{"line":182,"address":[25393678],"length":1,"stats":{"Line":0}},{"line":183,"address":[25393810],"length":1,"stats":{"Line":0}},{"line":186,"address":[25393835],"length":1,"stats":{"Line":0}},{"line":187,"address":[25394035,25393943],"length":1,"stats":{"Line":0}},{"line":188,"address":[25394157,25395176],"length":1,"stats":{"Line":0}},{"line":189,"address":[25395203,25395274],"length":1,"stats":{"Line":0}},{"line":190,"address":[25395325],"length":1,"stats":{"Line":0}},{"line":195,"address":[25394191],"length":1,"stats":{"Line":0}},{"line":196,"address":[25394334,25394266],"length":1,"stats":{"Line":0}},{"line":198,"address":[25394382,25394453],"length":1,"stats":{"Line":0}},{"line":199,"address":[25394507],"length":1,"stats":{"Line":0}},{"line":201,"address":[25394613,25394482],"length":1,"stats":{"Line":0}},{"line":202,"address":[25394667],"length":1,"stats":{"Line":0}},{"line":206,"address":[25394815,25394642,25394773],"length":1,"stats":{"Line":0}},{"line":207,"address":[25394825],"length":1,"stats":{"Line":0}},{"line":209,"address":[25394802],"length":1,"stats":{"Line":0}},{"line":214,"address":[25393338,25392016,25393048],"length":1,"stats":{"Line":0}},{"line":216,"address":[25392103,25392498,25392188],"length":1,"stats":{"Line":0}},{"line":217,"address":[25392236],"length":1,"stats":{"Line":0}},{"line":222,"address":[25379760,25379770],"length":1,"stats":{"Line":0}},{"line":224,"address":[25392450],"length":1,"stats":{"Line":0}},{"line":228,"address":[25392530,25392715,25392609],"length":1,"stats":{"Line":0}},{"line":229,"address":[25392969,25392755,25392845],"length":1,"stats":{"Line":0}},{"line":231,"address":[25393207,25392695,25393079],"length":1,"stats":{"Line":0}},{"line":239,"address":[25395456],"length":1,"stats":{"Line":0}},{"line":241,"address":[25395499],"length":1,"stats":{"Line":0}},{"line":245,"address":[25395536,25396289,25396758],"length":1,"stats":{"Line":0}},{"line":246,"address":[25395621],"length":1,"stats":{"Line":0}},{"line":247,"address":[25395704],"length":1,"stats":{"Line":0}},{"line":250,"address":[25395631],"length":1,"stats":{"Line":0}},{"line":251,"address":[25395672,25395784],"length":1,"stats":{"Line":0}},{"line":252,"address":[25396305,25396009],"length":1,"stats":{"Line":0}},{"line":253,"address":[25396340],"length":1,"stats":{"Line":0}},{"line":256,"address":[25396036,25396204],"length":1,"stats":{"Line":0}},{"line":260,"address":[25396238],"length":1,"stats":{"Line":0}},{"line":264,"address":[25383520,25385295,25385227],"length":1,"stats":{"Line":0}},{"line":265,"address":[25383594],"length":1,"stats":{"Line":0}},{"line":268,"address":[25383727,25383639],"length":1,"stats":{"Line":0}},{"line":271,"address":[25383769,25385260],"length":1,"stats":{"Line":0}},{"line":274,"address":[25383959],"length":1,"stats":{"Line":0}},{"line":275,"address":[25383968,25384041],"length":1,"stats":{"Line":0}},{"line":276,"address":[25384068],"length":1,"stats":{"Line":0}},{"line":278,"address":[25384289,25384087],"length":1,"stats":{"Line":0}},{"line":279,"address":[25384529,25384366],"length":1,"stats":{"Line":0}},{"line":280,"address":[25384719,25384613],"length":1,"stats":{"Line":0}},{"line":282,"address":[25384742,25384812],"length":1,"stats":{"Line":0}},{"line":283,"address":[25384857],"length":1,"stats":{"Line":0}},{"line":284,"address":[25384866],"length":1,"stats":{"Line":0}},{"line":285,"address":[25384925],"length":1,"stats":{"Line":0}},{"line":286,"address":[25384949],"length":1,"stats":{"Line":0}},{"line":289,"address":[25385151,25385005],"length":1,"stats":{"Line":0}},{"line":290,"address":[25385009],"length":1,"stats":{"Line":0}},{"line":291,"address":[25385076],"length":1,"stats":{"Line":0}},{"line":292,"address":[25385100],"length":1,"stats":{"Line":0}},{"line":297,"address":[25384402],"length":1,"stats":{"Line":0}},{"line":301,"address":[25388560,25389417,25389423],"length":1,"stats":{"Line":0}},{"line":303,"address":[25388590],"length":1,"stats":{"Line":0}},{"line":305,"address":[25388782,25388656],"length":1,"stats":{"Line":0}},{"line":306,"address":[25388848],"length":1,"stats":{"Line":0}},{"line":307,"address":[25379664,25379678],"length":1,"stats":{"Line":0}},{"line":311,"address":[25388679],"length":1,"stats":{"Line":0}},{"line":314,"address":[25388720,25388920],"length":1,"stats":{"Line":0}},{"line":316,"address":[25389152,25388933,25389081],"length":1,"stats":{"Line":0}},{"line":317,"address":[25389226,25389322],"length":1,"stats":{"Line":0}},{"line":318,"address":[25389377,25389415],"length":1,"stats":{"Line":0}},{"line":322,"address":[25389031],"length":1,"stats":{"Line":0}},{"line":327,"address":[25391970,25391935,25390496],"length":1,"stats":{"Line":0}},{"line":328,"address":[25390561],"length":1,"stats":{"Line":0}},{"line":329,"address":[25390604,25391965,25390678],"length":1,"stats":{"Line":0}},{"line":331,"address":[25390963,25390892],"length":1,"stats":{"Line":0}},{"line":332,"address":[25391184,25391032],"length":1,"stats":{"Line":0}},{"line":335,"address":[25391190,25391239],"length":1,"stats":{"Line":0}},{"line":338,"address":[25391274],"length":1,"stats":{"Line":0}},{"line":339,"address":[25391432,25391362],"length":1,"stats":{"Line":0}},{"line":340,"address":[25391541],"length":1,"stats":{"Line":0}},{"line":341,"address":[25391579],"length":1,"stats":{"Line":0}},{"line":347,"address":[25391635,25391391],"length":1,"stats":{"Line":0}},{"line":348,"address":[25391690,25391743],"length":1,"stats":{"Line":0}},{"line":349,"address":[25391847],"length":1,"stats":{"Line":0}},{"line":350,"address":[25391884],"length":1,"stats":{"Line":0}},{"line":356,"address":[25391071],"length":1,"stats":{"Line":0}},{"line":360,"address":[25396784,25397440,25397446],"length":1,"stats":{"Line":0}},{"line":361,"address":[25396827],"length":1,"stats":{"Line":0}},{"line":362,"address":[25396857],"length":1,"stats":{"Line":0}},{"line":363,"address":[25396914],"length":1,"stats":{"Line":0}},{"line":364,"address":[25396971],"length":1,"stats":{"Line":0}},{"line":366,"address":[25397036,25397096],"length":1,"stats":{"Line":0}},{"line":367,"address":[25397340,25397211],"length":1,"stats":{"Line":0}},{"line":368,"address":[25397392],"length":1,"stats":{"Line":0}},{"line":369,"address":[25397355],"length":1,"stats":{"Line":0}},{"line":379,"address":[25397236],"length":1,"stats":{"Line":0}},{"line":383,"address":[25398558,25397488,25398564],"length":1,"stats":{"Line":0}},{"line":392,"address":[25397599],"length":1,"stats":{"Line":0}},{"line":393,"address":[25397636],"length":1,"stats":{"Line":0}},{"line":394,"address":[25397673],"length":1,"stats":{"Line":0}},{"line":396,"address":[25397721],"length":1,"stats":{"Line":0}},{"line":397,"address":[25397786,25397872],"length":1,"stats":{"Line":0}},{"line":399,"address":[25397946],"length":1,"stats":{"Line":0}},{"line":403,"address":[25397971],"length":1,"stats":{"Line":0}},{"line":404,"address":[25398035],"length":1,"stats":{"Line":0}},{"line":405,"address":[25397989],"length":1,"stats":{"Line":0}},{"line":412,"address":[25398059],"length":1,"stats":{"Line":0}},{"line":414,"address":[25379808,25379822],"length":1,"stats":{"Line":0}},{"line":415,"address":[25398187],"length":1,"stats":{"Line":0}},{"line":416,"address":[25398294,25398223],"length":1,"stats":{"Line":0}},{"line":418,"address":[25398456],"length":1,"stats":{"Line":0}},{"line":419,"address":[25398321],"length":1,"stats":{"Line":0}},{"line":420,"address":[25398444,25398348],"length":1,"stats":{"Line":0}},{"line":426,"address":[25397815],"length":1,"stats":{"Line":0}},{"line":427,"address":[25397858],"length":1,"stats":{"Line":0}},{"line":432,"address":[25399285,25399279,25398880],"length":1,"stats":{"Line":0}},{"line":437,"address":[25398978],"length":1,"stats":{"Line":0}},{"line":438,"address":[25399079,25399017],"length":1,"stats":{"Line":0}},{"line":439,"address":[25399178],"length":1,"stats":{"Line":0}},{"line":443,"address":[25399312],"length":1,"stats":{"Line":0}},{"line":444,"address":[25399345],"length":1,"stats":{"Line":0}},{"line":445,"address":[25399570],"length":1,"stats":{"Line":0}},{"line":449,"address":[25399359],"length":1,"stats":{"Line":0}},{"line":450,"address":[25399398],"length":1,"stats":{"Line":0}},{"line":455,"address":[25399487,25399604],"length":1,"stats":{"Line":0}},{"line":456,"address":[25399707],"length":1,"stats":{"Line":0}},{"line":457,"address":[25399741,25399925,25400206],"length":1,"stats":{"Line":0}},{"line":458,"address":[25400036],"length":1,"stats":{"Line":0}},{"line":461,"address":[25400065],"length":1,"stats":{"Line":0}},{"line":462,"address":[25400099,25400219],"length":1,"stats":{"Line":0}},{"line":463,"address":[25400524,25400322],"length":1,"stats":{"Line":0}},{"line":464,"address":[25400652],"length":1,"stats":{"Line":0}},{"line":466,"address":[25400544],"length":1,"stats":{"Line":0}},{"line":469,"address":[25400355],"length":1,"stats":{"Line":0}},{"line":471,"address":[25400389],"length":1,"stats":{"Line":0}},{"line":472,"address":[25400480],"length":1,"stats":{"Line":0}},{"line":475,"address":[25399767],"length":1,"stats":{"Line":0}},{"line":476,"address":[25399796],"length":1,"stats":{"Line":0}},{"line":477,"address":[25399825],"length":1,"stats":{"Line":0}},{"line":478,"address":[25399854],"length":1,"stats":{"Line":0}},{"line":479,"address":[25399883],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":211},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","cli.rs"],"content":"/// Módulo CLI - Funciones relacionadas con la interfaz de línea de comandos\nuse std::env;\n\nconst VERSION: \u0026str = env!(\"CARGO_PKG_VERSION\");\n\n/// Formato de reporte para exportación\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum ReportFormat {\n    Json,\n    Markdown,\n}\n\nimpl ReportFormat {\n    pub fn from_str(s: \u0026str) -\u003e Option\u003cSelf\u003e {\n        match s.to_lowercase().as_str() {\n            \"json\" =\u003e Some(ReportFormat::Json),\n            \"markdown\" | \"md\" =\u003e Some(ReportFormat::Markdown),\n            _ =\u003e None,\n        }\n    }\n}\n\n/// Argumentos procesados de la línea de comandos\n#[derive(Debug, Clone)]\npub struct CliArgs {\n    /// Ruta del proyecto a analizar (None = modo interactivo)\n    pub project_path: Option\u003cString\u003e,\n    /// Activar modo watch\n    pub watch_mode: bool,\n    /// Activar modo fix (auto-reparación con IA)\n    pub fix_mode: bool,\n    /// Solo analizar archivos staged en git\n    pub staged_mode: bool,\n    /// Analizar solo archivos modificados (Git-based)\n    pub incremental_mode: bool,\n    /// Formato de reporte para exportar (json, markdown)\n    pub report_format: Option\u003cReportFormat\u003e,\n    /// Ruta del archivo de salida para el reporte\n    pub output_path: Option\u003cString\u003e,\n    /// Disable analysis cache\n    pub no_cache: bool,\n    /// Ejecutar en segundo plano (modo daemon)\n    pub daemon_mode: bool,\n}\n\n/// Muestra la ayuda del CLI\npub fn print_help() {\n    println!(\"architect-linter-pro {}\", VERSION);\n    println!();\n    println!(\"Linter de arquitectura de software con Architecture Health Score\");\n    println!(\"Soporte multi-lenguaje: TypeScript, JavaScript, Python, Go, PHP, Java\");\n    println!();\n    println!(\"USO:\");\n    println!(\"  architect-linter-pro [OPCIONES] [RUTA]\");\n    println!();\n    println!(\"ARGUMENTOS:\");\n    println!(\"  [RUTA]    Ruta del proyecto a analizar (opcional, modo interactivo si se omite)\");\n    println!();\n    println!(\"OPCIONES:\");\n    println!(\"  -h, --help           Muestra esta ayuda\");\n    println!(\"  -v, --version        Muestra la versión\");\n    println!(\"  -w, --watch          Modo watch: observa cambios y re-analiza automáticamente\");\n    println!(\"  -f, --fix            Modo fix: sugiere y aplica correcciones automáticas con IA\");\n    println!(\"  -s, --staged         Solo analizar archivos staged (git)\");\n    println!(\"  -i, --incremental     Analizar solo archivos modificados (Git-based)\");\n    println!(\"  -r, --report \u003cFMT\u003e   Exportar reporte: json, markdown\");\n    println!(\"  -o, --output \u003cPATH\u003e  Archivo de salida para el reporte\");\n    println!(\"  --no-cache           Disable analysis cache\");\n    println!();\n    println!(\"EJEMPLOS:\");\n    println!(\"  architect-linter-pro                         # Modo interactivo\");\n    println!(\"  architect-linter-pro .                       # Analizar directorio actual\");\n    println!(\"  architect-linter-pro /ruta/a/proyecto        # Analizar proyecto específico\");\n    println!(\"  architect-linter-pro --watch .               # Modo watch en directorio actual\");\n    println!(\"  architect-linter-pro --fix .                 # Analizar y auto-corregir con IA\");\n    println!(\"  architect-linter-pro --staged .              # Solo archivos staged\");\n    println!(\"  architect-linter-pro --incremental .        # Solo archivos modificados\");\n    println!(\"  architect-linter-pro --report json .         # Exportar reporte JSON a stdout\");\n    println!(\n        \"  architect-linter-pro -r md -o report.md .    # Exportar reporte Markdown a archivo\"\n    );\n    println!();\n    println!(\"INTERACTIVE WATCH MODE:\");\n    println!(\"  When running with --watch, type a command + Enter:\");\n    println!(\"    f  Fix: auto-fix violations with AI\");\n    println!(\"    r  Report: generate JSON report\");\n    println!(\"    m  Markdown: generate Markdown report\");\n    println!(\"    a  Analyze: full analysis with dashboard\");\n    println!(\"    v  Violations: list all current violations\");\n    println!(\"    d  Dashboard: show health score\");\n    println!(\"    c  Clear: clear terminal screen\");\n    println!(\"    h  Help: show available commands\");\n    println!(\"    q  Quit: exit watch mode\");\n    println!();\n    println!(\"SCORE GRADES:\");\n    println!(\"  A (90-100)  - Excellent architecture health\");\n    println!(\"  B (80-89)   - Good architecture health\");\n    println!(\"  C (70-79)   - Fair architecture health\");\n    println!(\"  D (60-69)   - Needs improvement\");\n    println!(\"  F (0-59)    - Critical issues\");\n    println!();\n    println!(\"DOCUMENTACIÓN:\");\n    println!(\"  https://github.com/sergiogswv/architect-linter-pro\");\n}\n\n/// Muestra la versión del linter\npub fn print_version() {\n    println!(\"architect-linter-pro {}\", VERSION);\n}\n\n/// Procesa los argumentos de línea de comandos\n/// Retorna None si se procesó un flag especial (--help, --version)\n/// Retorna Some(CliArgs) si hay que continuar con el análisis\npub fn process_args() -\u003e Option\u003cCliArgs\u003e {\n    let args: Vec\u003cString\u003e = env::args().collect();\n\n    let mut watch_mode = false;\n    let mut fix_mode = false;\n    let mut staged_mode = false;\n    let mut incremental_mode = false;\n    let mut no_cache = false;\n    let mut daemon_mode = false;\n    let mut report_format: Option\u003cReportFormat\u003e = None;\n    let mut output_path: Option\u003cString\u003e = None;\n    let mut project_path: Option\u003cString\u003e = None;\n\n    // Procesar argumentos\n    let mut i = 1;\n    while i \u003c args.len() {\n        match args[i].as_str() {\n            \"--version\" | \"-v\" =\u003e {\n                print_version();\n                return None;\n            }\n            \"--help\" | \"-h\" =\u003e {\n                print_help();\n                return None;\n            }\n            \"--watch\" | \"-w\" =\u003e {\n                watch_mode = true;\n            }\n            \"--fix\" | \"-f\" =\u003e {\n                fix_mode = true;\n            }\n            \"--staged\" | \"-s\" =\u003e {\n                staged_mode = true;\n            }\n            \"--incremental\" | \"-i\" =\u003e {\n                incremental_mode = true;\n            }\n            \"--no-cache\" =\u003e {\n                no_cache = true;\n            }\n            \"--daemon\" | \"-d\" =\u003e {\n                daemon_mode = true;\n            }\n            \"--report\" | \"-r\" =\u003e {\n                // Next argument should be the format\n                if i + 1 \u003c args.len() {\n                    i += 1;\n                    if let Some(fmt) = ReportFormat::from_str(\u0026args[i]) {\n                        report_format = Some(fmt);\n                    } else {\n                        eprintln!(\n                            \"Error: Formato de reporte inválido '{}'. Usa 'json' o 'markdown'.\",\n                            args[i]\n                        );\n                        return None;\n                    }\n                } else {\n                    eprintln!(\"Error: --report requiere un formato (json o markdown)\");\n                    return None;\n                }\n            }\n            \"--output\" | \"-o\" =\u003e {\n                // Next argument should be the output path\n                if i + 1 \u003c args.len() {\n                    i += 1;\n                    output_path = Some(args[i].clone());\n                } else {\n                    eprintln!(\"Error: --output requiere una ruta de archivo\");\n                    return None;\n                }\n            }\n            _ =\u003e {\n                // Si no es un flag, asumimos que es la ruta del proyecto\n                if !args[i].starts_with('-') {\n                    project_path = Some(args[i].clone());\n                }\n            }\n        }\n        i += 1;\n    }\n\n    Some(CliArgs {\n        project_path,\n        watch_mode,\n        fix_mode,\n        staged_mode,\n        incremental_mode,\n        no_cache,\n        daemon_mode,\n        report_format,\n        output_path,\n    })\n}\n","traces":[{"line":14,"address":[25120928,25121214,25121208],"length":1,"stats":{"Line":0}},{"line":15,"address":[25121034,25120948],"length":1,"stats":{"Line":0}},{"line":16,"address":[25121116,25121050],"length":1,"stats":{"Line":0}},{"line":17,"address":[25121093,25121127],"length":1,"stats":{"Line":0}},{"line":18,"address":[25121183],"length":1,"stats":{"Line":0}},{"line":47,"address":[25119296],"length":1,"stats":{"Line":0}},{"line":48,"address":[25119300],"length":1,"stats":{"Line":0}},{"line":49,"address":[25119377],"length":1,"stats":{"Line":0}},{"line":50,"address":[25119406],"length":1,"stats":{"Line":0}},{"line":51,"address":[25119435],"length":1,"stats":{"Line":0}},{"line":52,"address":[25119464],"length":1,"stats":{"Line":0}},{"line":53,"address":[25119493],"length":1,"stats":{"Line":0}},{"line":54,"address":[25119522],"length":1,"stats":{"Line":0}},{"line":55,"address":[25119551],"length":1,"stats":{"Line":0}},{"line":56,"address":[25119580],"length":1,"stats":{"Line":0}},{"line":57,"address":[25119609],"length":1,"stats":{"Line":0}},{"line":58,"address":[25119638],"length":1,"stats":{"Line":0}},{"line":59,"address":[25119667],"length":1,"stats":{"Line":0}},{"line":60,"address":[25119696],"length":1,"stats":{"Line":0}},{"line":61,"address":[25119725],"length":1,"stats":{"Line":0}},{"line":62,"address":[25119754],"length":1,"stats":{"Line":0}},{"line":63,"address":[25119783],"length":1,"stats":{"Line":0}},{"line":64,"address":[25119812],"length":1,"stats":{"Line":0}},{"line":65,"address":[25119841],"length":1,"stats":{"Line":0}},{"line":66,"address":[25119870],"length":1,"stats":{"Line":0}},{"line":67,"address":[25119899],"length":1,"stats":{"Line":0}},{"line":68,"address":[25119928],"length":1,"stats":{"Line":0}},{"line":69,"address":[25119957],"length":1,"stats":{"Line":0}},{"line":70,"address":[25119986],"length":1,"stats":{"Line":0}},{"line":71,"address":[25120015],"length":1,"stats":{"Line":0}},{"line":72,"address":[25120044],"length":1,"stats":{"Line":0}},{"line":73,"address":[25120073],"length":1,"stats":{"Line":0}},{"line":74,"address":[25120102],"length":1,"stats":{"Line":0}},{"line":75,"address":[25120131],"length":1,"stats":{"Line":0}},{"line":76,"address":[25120160],"length":1,"stats":{"Line":0}},{"line":77,"address":[25120189],"length":1,"stats":{"Line":0}},{"line":78,"address":[25120218],"length":1,"stats":{"Line":0}},{"line":79,"address":[25120247],"length":1,"stats":{"Line":0}},{"line":82,"address":[25120276],"length":1,"stats":{"Line":0}},{"line":83,"address":[25120305],"length":1,"stats":{"Line":0}},{"line":84,"address":[25120334],"length":1,"stats":{"Line":0}},{"line":85,"address":[25120363],"length":1,"stats":{"Line":0}},{"line":86,"address":[25120392],"length":1,"stats":{"Line":0}},{"line":87,"address":[25120421],"length":1,"stats":{"Line":0}},{"line":88,"address":[25120450],"length":1,"stats":{"Line":0}},{"line":89,"address":[25120479],"length":1,"stats":{"Line":0}},{"line":90,"address":[25120508],"length":1,"stats":{"Line":0}},{"line":91,"address":[25120537],"length":1,"stats":{"Line":0}},{"line":92,"address":[25120566],"length":1,"stats":{"Line":0}},{"line":93,"address":[25120595],"length":1,"stats":{"Line":0}},{"line":94,"address":[25120624],"length":1,"stats":{"Line":0}},{"line":95,"address":[25120653],"length":1,"stats":{"Line":0}},{"line":96,"address":[25120682],"length":1,"stats":{"Line":0}},{"line":97,"address":[25120711],"length":1,"stats":{"Line":0}},{"line":98,"address":[25120740],"length":1,"stats":{"Line":0}},{"line":99,"address":[25120769],"length":1,"stats":{"Line":0}},{"line":100,"address":[25120798],"length":1,"stats":{"Line":0}},{"line":101,"address":[25120827],"length":1,"stats":{"Line":0}},{"line":102,"address":[25120856],"length":1,"stats":{"Line":0}},{"line":103,"address":[25120885],"length":1,"stats":{"Line":0}},{"line":107,"address":[25124848],"length":1,"stats":{"Line":0}},{"line":108,"address":[25124852],"length":1,"stats":{"Line":0}},{"line":114,"address":[25124825,25124819,25121232],"length":1,"stats":{"Line":0}},{"line":115,"address":[25121255],"length":1,"stats":{"Line":0}},{"line":117,"address":[25121291],"length":1,"stats":{"Line":0}},{"line":118,"address":[25121299],"length":1,"stats":{"Line":0}},{"line":119,"address":[25121307],"length":1,"stats":{"Line":0}},{"line":120,"address":[25121315],"length":1,"stats":{"Line":0}},{"line":121,"address":[25121323],"length":1,"stats":{"Line":0}},{"line":122,"address":[25121331],"length":1,"stats":{"Line":0}},{"line":123,"address":[25121339],"length":1,"stats":{"Line":0}},{"line":124,"address":[25121347],"length":1,"stats":{"Line":0}},{"line":125,"address":[25121365],"length":1,"stats":{"Line":0}},{"line":128,"address":[25121383],"length":1,"stats":{"Line":0}},{"line":129,"address":[25121498,25124621,25121395],"length":1,"stats":{"Line":0}},{"line":130,"address":[25121934,25121868],"length":1,"stats":{"Line":0}},{"line":131,"address":[25121995,25122097],"length":1,"stats":{"Line":0}},{"line":132,"address":[25122076],"length":1,"stats":{"Line":0}},{"line":133,"address":[25124681],"length":1,"stats":{"Line":0}},{"line":135,"address":[25122221,25122119],"length":1,"stats":{"Line":0}},{"line":136,"address":[25122200],"length":1,"stats":{"Line":0}},{"line":137,"address":[25124655],"length":1,"stats":{"Line":0}},{"line":139,"address":[25122332,25122243],"length":1,"stats":{"Line":0}},{"line":140,"address":[25122324],"length":1,"stats":{"Line":0}},{"line":142,"address":[25122455,25122366],"length":1,"stats":{"Line":0}},{"line":143,"address":[25122447],"length":1,"stats":{"Line":0}},{"line":145,"address":[25122489,25122578],"length":1,"stats":{"Line":0}},{"line":146,"address":[25122570],"length":1,"stats":{"Line":0}},{"line":148,"address":[25122612,25122701],"length":1,"stats":{"Line":0}},{"line":149,"address":[25122693],"length":1,"stats":{"Line":0}},{"line":151,"address":[25122824,25122735],"length":1,"stats":{"Line":0}},{"line":152,"address":[25122816],"length":1,"stats":{"Line":0}},{"line":154,"address":[25122790,25122892,25122836],"length":1,"stats":{"Line":0}},{"line":155,"address":[25122884],"length":1,"stats":{"Line":0}},{"line":157,"address":[25122926,25123051],"length":1,"stats":{"Line":0}},{"line":159,"address":[25123007,25124078],"length":1,"stats":{"Line":0}},{"line":160,"address":[25124296,25124249,25124170],"length":1,"stats":{"Line":0}},{"line":161,"address":[25124322,25124257],"length":1,"stats":{"Line":0}},{"line":162,"address":[25124421],"length":1,"stats":{"Line":0}},{"line":164,"address":[25124435],"length":1,"stats":{"Line":0}},{"line":168,"address":[25124587],"length":1,"stats":{"Line":0}},{"line":171,"address":[25124207,25124141],"length":1,"stats":{"Line":0}},{"line":172,"address":[25124226],"length":1,"stats":{"Line":0}},{"line":175,"address":[25123073,25123198],"length":1,"stats":{"Line":0}},{"line":177,"address":[25123154,25123614],"length":1,"stats":{"Line":0}},{"line":178,"address":[25123807,25123711,25123854],"length":1,"stats":{"Line":0}},{"line":179,"address":[25123950,25123815,25123880],"length":1,"stats":{"Line":0}},{"line":181,"address":[25123682,25123748],"length":1,"stats":{"Line":0}},{"line":182,"address":[25123767],"length":1,"stats":{"Line":0}},{"line":187,"address":[25123609,25123204],"length":1,"stats":{"Line":0}},{"line":188,"address":[25123329,25123416,25123486],"length":1,"stats":{"Line":0}},{"line":192,"address":[25124613,25123371,25124626],"length":1,"stats":{"Line":0}},{"line":195,"address":[25121664],"length":1,"stats":{"Line":0}},{"line":196,"address":[25121515],"length":1,"stats":{"Line":0}},{"line":197,"address":[25121563],"length":1,"stats":{"Line":0}},{"line":198,"address":[25121571],"length":1,"stats":{"Line":0}},{"line":199,"address":[25121579],"length":1,"stats":{"Line":0}},{"line":200,"address":[25121587],"length":1,"stats":{"Line":0}},{"line":201,"address":[25121595],"length":1,"stats":{"Line":0}},{"line":202,"address":[25121602],"length":1,"stats":{"Line":0}},{"line":203,"address":[25121609],"length":1,"stats":{"Line":0}},{"line":204,"address":[25121616],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":122},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","husky.rs"],"content":"use miette::{IntoDiagnostic, Result};\nuse std::fs;\nuse std::path::Path;\nuse std::process::Command;\n\n/// Configura husky y el hook pre-commit en el proyecto destino\npub fn setup_husky_pre_commit(root: \u0026Path) -\u003e Result\u003c()\u003e {\n    let package_json_path = root.join(\"package.json\");\n\n    // Verificar si el proyecto tiene package.json\n    if !package_json_path.exists() {\n        println!(\"⚠️  No se encontró package.json, omitiendo configuración de husky.\");\n        return Ok(());\n    }\n\n    println!(\"🔧 Configurando husky y pre-commit hook...\");\n\n    // Ejecutar npx husky-init\n    let husky_init_output = Command::new(\"npx\")\n        .args([\"husky-init\"])\n        .current_dir(root)\n        .output();\n\n    match husky_init_output {\n        Ok(output) =\u003e {\n            if output.status.success() {\n                println!(\"✅ husky-init ejecutado correctamente.\");\n\n                // Crear el hook pre-commit\n                let pre_commit_path = root.join(\".husky\").join(\"pre-commit\");\n                let pre_commit_content = r#\"#!/bin/sh\n. \"$(dirname \"$0\")/_/husky.sh\"\n\necho \"🏗️  Ejecutando Architect Linter Pro...\"\n\n# Ejecutar architect-linter-pro en el directorio actual (.)\narchitect-linter-pro .\n\n# Si el linter encuentra errores, el commit se cancelará\nif [ $? -ne 0 ]; then\n  echo \"\"\n  echo \"❌ El commit fue cancelado debido a violaciones de arquitectura\"\n  echo \"💡 Corrige los errores reportados arriba y vuelve a intentar el commit\"\n  exit 1\nfi\n\necho \"✅ Validación de arquitectura exitosa\"\nexit 0\n\"#\n                .to_string();\n\n                // Escribir el hook\n                fs::write(\u0026pre_commit_path, pre_commit_content).into_diagnostic()?;\n\n                // Dar permisos de ejecución al hook (Unix-like systems)\n                #[cfg(unix)]\n                {\n                    let _ = Command::new(\"chmod\")\n                        .args([\"+x\", pre_commit_path.to_str().unwrap()])\n                        .status();\n                }\n\n                // Crear también versión para Windows si es necesario\n                #[cfg(windows)]\n                {\n                    let pre_commit_bat = root.join(\".husky\").join(\"pre-commit.bat\");\n                    let pre_commit_bat_content = r#\"@echo off\necho 🏗️  Ejecutando Architect Linter Pro...\n\nREM Ejecutar architect-linter-pro en el directorio actual (.)\narchitect-linter-pro .\n\nREM Si el linter encuentra errores, el commit se cancelará\nif errorlevel 1 (\n    echo.\n    echo ❌ El commit fue cancelado debido a violaciones de arquitectura\n    echo 💡 Corrige los errores reportados arriba y vuelve a intentar el commit\n    exit /b 1\n)\n\necho ✅ Validación de arquitectura exitosa\nexit /b 0\n\"#\n                    .to_string();\n                    let _ = fs::write(\u0026pre_commit_bat, pre_commit_bat_content);\n                }\n\n                println!(\"✅ Hook pre-commit configurado exitosamente.\");\n                println!(\"💡 Ahora architect-linter se ejecutará automáticamente en cada commit.\");\n            } else {\n                let stderr = String::from_utf8_lossy(\u0026output.stderr);\n                println!(\"⚠️  Error al ejecutar husky-init: {}\", stderr);\n                println!(\"💡 Puedes configurar husky manualmente con: npx husky-init\");\n            }\n        }\n        Err(e) =\u003e {\n            println!(\"⚠️  No se pudo ejecutar npx husky-init: {}\", e);\n            println!(\"💡 Asegúrate de tener Node.js y npm instalados.\");\n            println!(\"💡 Para configurar husky manualmente, ejecuta: npx husky-init\");\n        }\n    }\n\n    Ok(())\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","ignored_paths.rs"],"content":"use crate::config::Framework;\n\n/// Valores por defecto para ignored_paths\npub fn default_ignored_paths() -\u003e Vec\u003cString\u003e {\n    vec![\n        \"node_modules/\".to_string(),\n        \"dist/\".to_string(),\n        \"build/\".to_string(),\n        \".git/\".to_string(),\n        \"coverage/\".to_string(),\n        \".next/\".to_string(),\n        \"out/\".to_string(),\n        \".nuxt/\".to_string(),\n        \".output/\".to_string(),\n        \".vite/\".to_string(),            // Vite cache\n        \".turbo/\".to_string(),           // Turborepo cache\n        \".parcel-cache/\".to_string(),    // Parcel cache\n        \".cache/\".to_string(),           // Generic cache\n        \".architect-cache/\".to_string(), // Architect Linter cache\n        \"target/\".to_string(),           // Rust\n        \"__pycache__/\".to_string(),      // Python\n        \".vscode/\".to_string(),          // VSCode\n        \".idea/\".to_string(),            // IntelliJ\n        \"venv/\".to_string(),             // Python venv\n        \".venv/\".to_string(),            // Python venv\n        \"vendor/\".to_string(),           // PHP/Go vendor\n        \".gradle/\".to_string(),          // Gradle\n    ]\n}\n\n/// Obtiene los patrones de exclusión según el framework detectado\npub fn get_framework_ignored_paths(framework: \u0026Framework) -\u003e Vec\u003cString\u003e {\n    let mut paths = vec![\n        \"node_modules/\".to_string(),\n        \".git/\".to_string(),\n        \"coverage/\".to_string(),\n        \".vscode/\".to_string(),\n        \".idea/\".to_string(),\n    ];\n\n    match framework {\n        Framework::React =\u003e {\n            paths.extend(vec![\n                \"build/\".to_string(),\n                \"dist/\".to_string(),\n                \".next/\".to_string(), // Next.js\n                \"out/\".to_string(),\n                \".vite/\".to_string(),         // Vite\n                \".turbo/\".to_string(),        // Turborepo\n                \".parcel-cache/\".to_string(), // Parcel\n            ]);\n        }\n        Framework::NestJS =\u003e {\n            paths.extend(vec![\"dist/\".to_string(), \"build/\".to_string()]);\n        }\n        Framework::Angular =\u003e {\n            paths.extend(vec![\"dist/\".to_string(), \".angular/\".to_string()]);\n        }\n        Framework::Express =\u003e {\n            paths.extend(vec![\"dist/\".to_string(), \"build/\".to_string()]);\n        }\n        // Python frameworks\n        Framework::Django | Framework::Flask | Framework::FastAPI =\u003e {\n            paths.extend(vec![\n                \"venv/\".to_string(),\n                \".venv/\".to_string(),\n                \"env/\".to_string(),\n                \".env/\".to_string(),\n                \"__pycache__/\".to_string(),\n                \"*.pyc\".to_string(),\n                \".pytest_cache/\".to_string(),\n                \".mypy_cache/\".to_string(),\n                \"htmlcov/\".to_string(),\n                \"*.egg-info/\".to_string(),\n            ]);\n        }\n        // Go frameworks\n        Framework::Gin | Framework::Echo =\u003e {\n            paths.extend(vec![\n                \"vendor/\".to_string(),\n                \"bin/\".to_string(),\n                \"*.exe\".to_string(),\n                \"*.exe~\".to_string(),\n                \"*.dll\".to_string(),\n                \"*.so\".to_string(),\n                \"*.dylib\".to_string(),\n            ]);\n        }\n        // Java frameworks\n        Framework::Spring =\u003e {\n            paths.extend(vec![\n                \"target/\".to_string(),\n                \".gradle/\".to_string(),\n                \"build/\".to_string(),\n                \"out/\".to_string(),\n                \"*.class\".to_string(),\n                \"*.jar\".to_string(),\n                \"*.war\".to_string(),\n            ]);\n        }\n        // PHP frameworks\n        Framework::Laravel | Framework::Symfony =\u003e {\n            paths.extend(vec![\n                \"vendor/\".to_string(),\n                \"storage/\".to_string(),\n                \"bootstrap/cache/\".to_string(),\n                \"*.log\".to_string(),\n            ]);\n        }\n        Framework::Unknown =\u003e {\n            paths.extend(vec![\n                \"dist/\".to_string(),\n                \"build/\".to_string(),\n                \"out/\".to_string(),\n                \".vite/\".to_string(),\n                \".cache/\".to_string(),\n            ]);\n        }\n    }\n\n    paths\n}\n","traces":[{"line":4,"address":[24866855,24864224,24866849],"length":1,"stats":{"Line":0}},{"line":5,"address":[24864844,24864358,24864700,24865708,24865132,24864559,24864988,24864490,24865636,24866836,24865492,24864772,24864289,24865276,24865204,24864628,24864251,24865564,24864916,24865060,24864424,24865348,24865821,24865420,24865780],"length":1,"stats":{"Line":0}},{"line":6,"address":[24864261],"length":1,"stats":{"Line":0}},{"line":7,"address":[24864330],"length":1,"stats":{"Line":0}},{"line":8,"address":[24864396],"length":1,"stats":{"Line":0}},{"line":9,"address":[24864462],"length":1,"stats":{"Line":0}},{"line":10,"address":[24864528],"length":1,"stats":{"Line":0}},{"line":11,"address":[24864597],"length":1,"stats":{"Line":0}},{"line":12,"address":[24864669],"length":1,"stats":{"Line":0}},{"line":13,"address":[24864741],"length":1,"stats":{"Line":0}},{"line":14,"address":[24864813],"length":1,"stats":{"Line":0}},{"line":15,"address":[24864885],"length":1,"stats":{"Line":0}},{"line":16,"address":[24864957],"length":1,"stats":{"Line":0}},{"line":17,"address":[24865029],"length":1,"stats":{"Line":0}},{"line":18,"address":[24865101],"length":1,"stats":{"Line":0}},{"line":19,"address":[24865173],"length":1,"stats":{"Line":0}},{"line":20,"address":[24865245],"length":1,"stats":{"Line":0}},{"line":21,"address":[24865317],"length":1,"stats":{"Line":0}},{"line":22,"address":[24865389],"length":1,"stats":{"Line":0}},{"line":23,"address":[24865461],"length":1,"stats":{"Line":0}},{"line":24,"address":[24865533],"length":1,"stats":{"Line":0}},{"line":25,"address":[24865605],"length":1,"stats":{"Line":0}},{"line":26,"address":[24865677],"length":1,"stats":{"Line":0}},{"line":27,"address":[24865749],"length":1,"stats":{"Line":0}},{"line":32,"address":[24873957,24868291,24866880],"length":1,"stats":{"Line":0}},{"line":33,"address":[24866973,24873970,24867585,24867192,24867048,24867305,24867264,24867120,24866929],"length":1,"stats":{"Line":0}},{"line":34,"address":[24866942],"length":1,"stats":{"Line":0}},{"line":35,"address":[24867017],"length":1,"stats":{"Line":0}},{"line":36,"address":[24867089],"length":1,"stats":{"Line":0}},{"line":37,"address":[24867161],"length":1,"stats":{"Line":0}},{"line":38,"address":[24867233],"length":1,"stats":{"Line":0}},{"line":41,"address":[24867598,24867550],"length":1,"stats":{"Line":0}},{"line":43,"address":[24868640,24868496,24868825,24867638,24868568,24868784,24868349,24868424,24868712,24868310],"length":1,"stats":{"Line":0}},{"line":44,"address":[24868318],"length":1,"stats":{"Line":0}},{"line":45,"address":[24868393],"length":1,"stats":{"Line":0}},{"line":46,"address":[24868465],"length":1,"stats":{"Line":0}},{"line":47,"address":[24868537],"length":1,"stats":{"Line":0}},{"line":48,"address":[24868609],"length":1,"stats":{"Line":0}},{"line":49,"address":[24868681],"length":1,"stats":{"Line":0}},{"line":50,"address":[24868753],"length":1,"stats":{"Line":0}},{"line":54,"address":[24868297,24867883,24867610],"length":1,"stats":{"Line":0}},{"line":57,"address":[24869164,24867666],"length":1,"stats":{"Line":0}},{"line":60,"address":[24867691,24869526],"length":1,"stats":{"Line":0}},{"line":64,"address":[24870506,24870218,24870002,24870362,24867716,24870578,24869927,24870619,24870146,24870290,24869888,24870074,24870434],"length":1,"stats":{"Line":0}},{"line":65,"address":[24869896],"length":1,"stats":{"Line":0}},{"line":66,"address":[24869971],"length":1,"stats":{"Line":0}},{"line":67,"address":[24870043],"length":1,"stats":{"Line":0}},{"line":68,"address":[24870115],"length":1,"stats":{"Line":0}},{"line":69,"address":[24870187],"length":1,"stats":{"Line":0}},{"line":70,"address":[24870259],"length":1,"stats":{"Line":0}},{"line":71,"address":[24870331],"length":1,"stats":{"Line":0}},{"line":72,"address":[24870403],"length":1,"stats":{"Line":0}},{"line":73,"address":[24870475],"length":1,"stats":{"Line":0}},{"line":74,"address":[24870547],"length":1,"stats":{"Line":0}},{"line":79,"address":[24867741,24871162,24871306,24871048,24871087,24871522,24871234,24871563,24871450,24871378],"length":1,"stats":{"Line":0}},{"line":80,"address":[24871056],"length":1,"stats":{"Line":0}},{"line":81,"address":[24871131],"length":1,"stats":{"Line":0}},{"line":82,"address":[24871203],"length":1,"stats":{"Line":0}},{"line":83,"address":[24871275],"length":1,"stats":{"Line":0}},{"line":84,"address":[24871347],"length":1,"stats":{"Line":0}},{"line":85,"address":[24871419],"length":1,"stats":{"Line":0}},{"line":86,"address":[24871491],"length":1,"stats":{"Line":0}},{"line":91,"address":[24871902,24867766,24872160,24872016,24872417,24872304,24872088,24872232,24872376,24871941],"length":1,"stats":{"Line":0}},{"line":92,"address":[24871910],"length":1,"stats":{"Line":0}},{"line":93,"address":[24871985],"length":1,"stats":{"Line":0}},{"line":94,"address":[24872057],"length":1,"stats":{"Line":0}},{"line":95,"address":[24872129],"length":1,"stats":{"Line":0}},{"line":96,"address":[24872201],"length":1,"stats":{"Line":0}},{"line":97,"address":[24872273],"length":1,"stats":{"Line":0}},{"line":98,"address":[24872345],"length":1,"stats":{"Line":0}},{"line":103,"address":[24873014,24872795,24872870,24873055,24867791,24872942,24872756],"length":1,"stats":{"Line":0}},{"line":104,"address":[24872764],"length":1,"stats":{"Line":0}},{"line":105,"address":[24872839],"length":1,"stats":{"Line":0}},{"line":106,"address":[24872911],"length":1,"stats":{"Line":0}},{"line":107,"address":[24872983],"length":1,"stats":{"Line":0}},{"line":111,"address":[24873427,24873643,24873352,24867816,24873499,24873313,24873571,24873684],"length":1,"stats":{"Line":0}},{"line":112,"address":[24873321],"length":1,"stats":{"Line":0}},{"line":113,"address":[24873396],"length":1,"stats":{"Line":0}},{"line":114,"address":[24873468],"length":1,"stats":{"Line":0}},{"line":115,"address":[24873540],"length":1,"stats":{"Line":0}},{"line":116,"address":[24873612],"length":1,"stats":{"Line":0}},{"line":121,"address":[24868248],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":82},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","loader.rs"],"content":"use miette::{Diagnostic, IntoDiagnostic, Result};\nuse serde::{Deserialize, Serialize};\nuse std::fs;\nuse std::path::Path;\nuse thiserror::Error;\n\nuse super::types::{AIConfig, ArchPattern, ForbiddenRule, Framework, LinterContext};\n\n/// Estructura para mapear el architect.json tal cual está en el disco\n#[derive(Debug, Serialize, Deserialize)]\npub struct ConfigFile {\n    pub max_lines_per_function: usize,\n    pub architecture_pattern: ArchPattern,\n    pub forbidden_imports: Vec\u003cForbiddenRule\u003e,\n    #[serde(default = \"super::ignored_paths::default_ignored_paths\")]\n    pub ignored_paths: Vec\u003cString\u003e,\n}\n\n/// Estructura para el archivo de configuración de IA (ahora soporta múltiples)\n#[derive(Debug, Serialize, Deserialize)]\npub struct AIConfigFile {\n    pub configs: Vec\u003cAIConfig\u003e,\n    pub selected_name: String,\n}\n\n#[derive(Error, Debug, Diagnostic)]\n#[error(\"{details}\")]\n#[diagnostic(code(config::invalid), severity(error))]\npub struct ConfigError {\n    #[help]\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub help: String,\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub details: String,\n}\n\nimpl ConfigError {\n    pub fn new(details: String, help: String) -\u003e Self {\n        Self { details, help }\n    }\n}\n\n/// CARGA SILENCIOSA: Lee architect.json y .architect.ai.json y los convierte en contexto\npub fn load_config(root: \u0026Path) -\u003e Result\u003cLinterContext\u003e {\n    let config_path = root.join(\"architect.json\");\n\n    // Leer el archivo de reglas\n    let content = fs::read_to_string(\u0026config_path).map_err(|e| {\n        ConfigError::new(\n            format!(\"No se pudo leer architect.json: {}\", e),\n            format!(\n                \"Asegúrate de que el archivo existe en: {}\",\n                config_path.display()\n            ),\n        )\n    })?;\n\n    // Validar que es JSON válido\n    let json_value: serde_json::Value = serde_json::from_str(\u0026content)\n        .map_err(|e| ConfigError::new(\n            format!(\"JSON inválido: {}\", e),\n            \"Verifica que el archivo architect.json tenga sintaxis JSON válida. Usa un validador JSON online si es necesario.\".to_string()\n        ))?;\n\n    // Validar el esquema antes de deserializar\n    validate_schema(\u0026json_value)?;\n\n    // Ahora sí deserializar con mejor manejo de errores\n    let config: ConfigFile = serde_json::from_value(json_value).map_err(|e| {\n        ConfigError::new(\n            format!(\"Error en la estructura: {}\", e),\n            \"Revisa que todos los campos tengan el tipo correcto.\".to_string(),\n        )\n    })?;\n\n    // Validar los valores\n    validate_config_values(\u0026config)?;\n\n    // Cargar configuración de IA (si existe, es opcional)\n    let ai_config_path = root.join(\".architect.ai.json\");\n    let ai_configs = if ai_config_path.exists() {\n        let ai_content = fs::read_to_string(\u0026ai_config_path).into_diagnostic()?;\n        let ai_file: AIConfigFile = serde_json::from_str(\u0026ai_content).into_diagnostic()?;\n\n        let mut configs = ai_file.configs;\n        // Mover la configuración seleccionada al principio de la lista\n        if let Some(pos) = configs.iter().position(|c| c.name == ai_file.selected_name) {\n            let selected = configs.remove(pos);\n            configs.insert(0, selected);\n        }\n        configs\n    } else {\n        Vec::new()\n    };\n\n    // Re-detectamos el framework para el contexto actual\n    let framework = crate::detector::detect_framework(root);\n\n    Ok(LinterContext {\n        max_lines: config.max_lines_per_function,\n        framework,\n        pattern: config.architecture_pattern,\n        forbidden_imports: config.forbidden_imports,\n        ignored_paths: config.ignored_paths,\n        ai_configs,\n    })\n}\n\n/// Valida que el JSON tenga todos los campos requeridos\nfn validate_schema(json: \u0026serde_json::Value) -\u003e Result\u003c()\u003e {\n    let obj = json.as_object().ok_or_else(|| {\n        ConfigError::new(\n            \"El archivo debe ser un objeto JSON\".to_string(),\n            \"El archivo architect.json debe empezar y terminar con llaves { }\".to_string(),\n        )\n    })?;\n\n    // Validar campo: max_lines_per_function\n    if !obj.contains_key(\"max_lines_per_function\") {\n        return Err(ConfigError::new(\n            \"Falta el campo requerido: max_lines_per_function\".to_string(),\n            \"Agrega este campo con un número, ejemplo: \\\"max_lines_per_function\\\": 40\".to_string(),\n        )\n        .into());\n    }\n\n    if !obj[\"max_lines_per_function\"].is_number() {\n        return Err(ConfigError::new(\n            \"El campo 'max_lines_per_function' debe ser un número\".to_string(),\n            \"Ejemplo correcto: \\\"max_lines_per_function\\\": 40\".to_string(),\n        )\n        .into());\n    }\n\n    // Validar campo: architecture_pattern\n    if !obj.contains_key(\"architecture_pattern\") {\n        return Err(ConfigError::new(\n            \"Falta el campo requerido: architecture_pattern\".to_string(),\n            \"Agrega este campo. Valores válidos: \\\"Hexagonal\\\", \\\"Clean\\\", \\\"MVC\\\", \\\"Ninguno\\\"\"\n                .to_string(),\n        )\n        .into());\n    }\n\n    if !obj[\"architecture_pattern\"].is_string() {\n        return Err(ConfigError::new(\n            \"El campo 'architecture_pattern' debe ser un string\".to_string(),\n            \"Valores válidos: \\\"Hexagonal\\\", \\\"Clean\\\", \\\"MVC\\\", \\\"Ninguno\\\"\".to_string(),\n        )\n        .into());\n    }\n\n    // Validar que el patrón sea uno de los valores aceptados\n    let pattern_str = obj[\"architecture_pattern\"].as_str().unwrap_or(\"Ninguno\");\n    let valid_patterns = [\"Hexagonal\", \"Clean\", \"MVC\", \"Ninguno\"];\n    if !valid_patterns.contains(\u0026pattern_str) {\n        return Err(ConfigError::new(\n            format!(\"Patrón arquitectónico inválido: '{}'\", pattern_str),\n            format!(\"Valores válidos: {}\", valid_patterns.join(\", \")),\n        )\n        .into());\n    }\n\n    // Validar cada regla en forbidden_imports\n    let rules = match obj[\"forbidden_imports\"].as_array() {\n        Some(r) =\u003e r,\n        None =\u003e {\n            return Err(ConfigError::new(\n                \"El campo 'forbidden_imports' debe ser un array\".to_string(),\n                \"Ejemplo: \\\"forbidden_imports\\\": []\".to_string(),\n            )\n            .into())\n        }\n    };\n    for (index, rule) in rules.iter().enumerate() {\n        if !rule.is_object() {\n            return Err(ConfigError::new(\n                format!(\n                    \"La regla #{} en forbidden_imports no es un objeto\",\n                    index + 1\n                ),\n                \"Cada regla debe tener la forma: {\\\"from\\\": \\\"patrón1\\\", \\\"to\\\": \\\"patrón2\\\"}\"\n                    .to_string(),\n            )\n            .into());\n        }\n\n        let rule_obj = rule.as_object().unwrap_or_else(|| unreachable!());\n\n        if !rule_obj.contains_key(\"from\") {\n            return Err(ConfigError::new(\n                format!(\"La regla #{} no tiene el campo 'from'\", index + 1),\n                \"Ejemplo: {\\\"from\\\": \\\"src/components/**\\\", \\\"to\\\": \\\"src/services/**\\\"}\"\n                    .to_string(),\n            )\n            .into());\n        }\n\n        if !rule_obj.contains_key(\"to\") {\n            return Err(ConfigError::new(\n                format!(\"La regla #{} no tiene el campo 'to'\", index + 1),\n                \"Ejemplo: {\\\"from\\\": \\\"src/components/**\\\", \\\"to\\\": \\\"src/services/**\\\"}\"\n                    .to_string(),\n            )\n            .into());\n        }\n\n        if !rule_obj[\"from\"].is_string() {\n            return Err(ConfigError::new(\n                format!(\n                    \"El campo 'from' en la regla #{} debe ser un string\",\n                    index + 1\n                ),\n                \"Ejemplo: \\\"from\\\": \\\"src/components/**\\\"\".to_string(),\n            )\n            .into());\n        }\n\n        if !rule_obj[\"to\"].is_string() {\n            return Err(ConfigError::new(\n                format!(\n                    \"El campo 'to' en la regla #{} debe ser un string\",\n                    index + 1\n                ),\n                \"Ejemplo: \\\"to\\\": \\\"src/services/**\\\"\".to_string(),\n            )\n            .into());\n        }\n    }\n\n    Ok(())\n}\n\n/// Valida los valores de la configuración (rangos, lógica, etc.)\nfn validate_config_values(config: \u0026ConfigFile) -\u003e Result\u003c()\u003e {\n    // Validar que max_lines_per_function esté en un rango razonable\n    if config.max_lines_per_function == 0 {\n        return Err(ConfigError::new(\n            \"max_lines_per_function no puede ser 0\".to_string(),\n            \"Usa un valor entre 10 y 500. Recomendado: 20-60 según tu framework.\".to_string(),\n        )\n        .into());\n    }\n\n    if config.max_lines_per_function \u003e 1000 {\n        return Err(ConfigError::new(\n            format!(\n                \"max_lines_per_function es muy alto: {}\",\n                config.max_lines_per_function\n            ),\n            \"Un valor tan alto desactiva efectivamente esta validación. Máximo recomendado: 500\"\n                .to_string(),\n        )\n        .into());\n    }\n\n    // Validar que forbidden_imports tenga reglas únicas (no duplicadas)\n    for (i, rule1) in config.forbidden_imports.iter().enumerate() {\n        for (j, rule2) in config.forbidden_imports.iter().enumerate() {\n            if i != j \u0026\u0026 rule1.from == rule2.from \u0026\u0026 rule1.to == rule2.to {\n                return Err(ConfigError::new(\n                    format!(\"Regla duplicada: from '{}' to '{}'\", rule1.from, rule1.to),\n                    \"Elimina una de las reglas duplicadas en forbidden_imports.\".to_string(),\n                )\n                .into());\n            }\n        }\n    }\n\n    // Advertencia si no hay reglas (aunque técnicamente válido)\n    if config.forbidden_imports.is_empty() {\n        eprintln!(\"⚠️  Advertencia: No hay reglas en forbidden_imports. El linter solo validará la longitud de funciones.\");\n    }\n\n    Ok(())\n}\n\n/// Detecta el framework del proyecto (wrapper público)\n#[allow(dead_code)]\npub fn detect_project_framework(root: \u0026Path) -\u003e Framework {\n    crate::detector::detect_framework(root)\n}\n","traces":[{"line":40,"address":[25401760],"length":1,"stats":{"Line":0}},{"line":46,"address":[25401824,25405286,25405593],"length":1,"stats":{"Line":0}},{"line":47,"address":[25401879],"length":1,"stats":{"Line":0}},{"line":50,"address":[24860224,24860780,24860786],"length":1,"stats":{"Line":0}},{"line":51,"address":[24860701],"length":1,"stats":{"Line":0}},{"line":52,"address":[24860340,24860259],"length":1,"stats":{"Line":0}},{"line":53,"address":[24860567],"length":1,"stats":{"Line":0}},{"line":55,"address":[24860448,24860516],"length":1,"stats":{"Line":0}},{"line":61,"address":[25402581,25402411,25402457,25402328,25405570],"length":1,"stats":{"Line":0}},{"line":62,"address":[24860202,24860123,24859856,24860208],"length":1,"stats":{"Line":0}},{"line":63,"address":[24859956,24859878],"length":1,"stats":{"Line":0}},{"line":64,"address":[24860050],"length":1,"stats":{"Line":0}},{"line":68,"address":[25405500,25402738,25402796],"length":1,"stats":{"Line":0}},{"line":71,"address":[24861146,24861152,24860800],"length":1,"stats":{"Line":0}},{"line":72,"address":[24861067],"length":1,"stats":{"Line":0}},{"line":73,"address":[24860822,24860900],"length":1,"stats":{"Line":0}},{"line":74,"address":[24860994],"length":1,"stats":{"Line":0}},{"line":79,"address":[25403406,25403348,25405410],"length":1,"stats":{"Line":0}},{"line":82,"address":[25403527],"length":1,"stats":{"Line":0}},{"line":83,"address":[25403638,25403567],"length":1,"stats":{"Line":0}},{"line":84,"address":[25403678,25403741,25405389],"length":1,"stats":{"Line":0}},{"line":85,"address":[25403949,25404020],"length":1,"stats":{"Line":0}},{"line":87,"address":[25404279],"length":1,"stats":{"Line":0}},{"line":89,"address":[24859808,24859833],"length":1,"stats":{"Line":0}},{"line":90,"address":[25404542],"length":1,"stats":{"Line":0}},{"line":91,"address":[25404630],"length":1,"stats":{"Line":0}},{"line":93,"address":[25404576],"length":1,"stats":{"Line":0}},{"line":95,"address":[25403705,25403659],"length":1,"stats":{"Line":0}},{"line":99,"address":[25404871,25403723],"length":1,"stats":{"Line":0}},{"line":101,"address":[25405005],"length":1,"stats":{"Line":0}},{"line":102,"address":[25404878],"length":1,"stats":{"Line":0}},{"line":104,"address":[25404886],"length":1,"stats":{"Line":0}},{"line":105,"address":[25404893],"length":1,"stats":{"Line":0}},{"line":106,"address":[25404933],"length":1,"stats":{"Line":0}},{"line":107,"address":[25404973],"length":1,"stats":{"Line":0}},{"line":112,"address":[25406227,25405616,25406195],"length":1,"stats":{"Line":0}},{"line":113,"address":[25405631,25405827],"length":1,"stats":{"Line":0}},{"line":114,"address":[24861311],"length":1,"stats":{"Line":0}},{"line":115,"address":[24861214],"length":1,"stats":{"Line":0}},{"line":116,"address":[24861260],"length":1,"stats":{"Line":0}},{"line":121,"address":[25405911],"length":1,"stats":{"Line":0}},{"line":122,"address":[25406103,25406171],"length":1,"stats":{"Line":0}},{"line":123,"address":[25405933],"length":1,"stats":{"Line":0}},{"line":124,"address":[25405986],"length":1,"stats":{"Line":0}},{"line":126,"address":[25406150],"length":1,"stats":{"Line":0}},{"line":129,"address":[25406018],"length":1,"stats":{"Line":0}},{"line":130,"address":[25406386,25406454],"length":1,"stats":{"Line":0}},{"line":131,"address":[25406233],"length":1,"stats":{"Line":0}},{"line":132,"address":[25406286],"length":1,"stats":{"Line":0}},{"line":134,"address":[25406433],"length":1,"stats":{"Line":0}},{"line":138,"address":[25406318],"length":1,"stats":{"Line":0}},{"line":139,"address":[25406726,25406658],"length":1,"stats":{"Line":0}},{"line":140,"address":[25406489],"length":1,"stats":{"Line":0}},{"line":142,"address":[25406542],"length":1,"stats":{"Line":0}},{"line":144,"address":[25406705],"length":1,"stats":{"Line":0}},{"line":147,"address":[25406574],"length":1,"stats":{"Line":0}},{"line":148,"address":[25407176,25407108],"length":1,"stats":{"Line":0}},{"line":149,"address":[25406761],"length":1,"stats":{"Line":0}},{"line":150,"address":[25406814],"length":1,"stats":{"Line":0}},{"line":152,"address":[25407155],"length":1,"stats":{"Line":0}},{"line":156,"address":[25406849],"length":1,"stats":{"Line":0}},{"line":157,"address":[25406923],"length":1,"stats":{"Line":0}},{"line":158,"address":[25407031],"length":1,"stats":{"Line":0}},{"line":159,"address":[25407725,25407793],"length":1,"stats":{"Line":0}},{"line":160,"address":[25407219],"length":1,"stats":{"Line":0}},{"line":161,"address":[25407341,25407528],"length":1,"stats":{"Line":0}},{"line":163,"address":[25407772],"length":1,"stats":{"Line":0}},{"line":167,"address":[25407397],"length":1,"stats":{"Line":0}},{"line":168,"address":[25407828],"length":1,"stats":{"Line":0}},{"line":170,"address":[25408062,25408130],"length":1,"stats":{"Line":0}},{"line":171,"address":[25407954],"length":1,"stats":{"Line":0}},{"line":172,"address":[25408001],"length":1,"stats":{"Line":0}},{"line":174,"address":[25408109],"length":1,"stats":{"Line":0}},{"line":177,"address":[25408165,25407844],"length":1,"stats":{"Line":0}},{"line":178,"address":[25408268],"length":1,"stats":{"Line":0}},{"line":179,"address":[25408617,25408685],"length":1,"stats":{"Line":0}},{"line":180,"address":[25408420],"length":1,"stats":{"Line":0}},{"line":182,"address":[25408404,25408302,25408567],"length":1,"stats":{"Line":0}},{"line":185,"address":[25408536],"length":1,"stats":{"Line":0}},{"line":187,"address":[25408664],"length":1,"stats":{"Line":0}},{"line":190,"address":[24861169,24861168],"length":1,"stats":{"Line":0}},{"line":192,"address":[25408368],"length":1,"stats":{"Line":0}},{"line":193,"address":[25409002,25409070],"length":1,"stats":{"Line":0}},{"line":194,"address":[25408952,25408725,25408789],"length":1,"stats":{"Line":0}},{"line":196,"address":[25408921],"length":1,"stats":{"Line":0}},{"line":198,"address":[25409049],"length":1,"stats":{"Line":0}},{"line":201,"address":[25408753],"length":1,"stats":{"Line":0}},{"line":202,"address":[25409403,25409471],"length":1,"stats":{"Line":0}},{"line":203,"address":[25409190,25409110,25409353],"length":1,"stats":{"Line":0}},{"line":205,"address":[25409322],"length":1,"stats":{"Line":0}},{"line":207,"address":[25409450],"length":1,"stats":{"Line":0}},{"line":210,"address":[25409138],"length":1,"stats":{"Line":0}},{"line":211,"address":[25409804,25409872],"length":1,"stats":{"Line":0}},{"line":212,"address":[25409607],"length":1,"stats":{"Line":0}},{"line":214,"address":[25409591,25409511,25409754],"length":1,"stats":{"Line":0}},{"line":216,"address":[25409723],"length":1,"stats":{"Line":0}},{"line":218,"address":[25409851],"length":1,"stats":{"Line":0}},{"line":221,"address":[25409539],"length":1,"stats":{"Line":0}},{"line":222,"address":[25410219,25410151],"length":1,"stats":{"Line":0}},{"line":223,"address":[25409954],"length":1,"stats":{"Line":0}},{"line":225,"address":[25410101,25409912],"length":1,"stats":{"Line":0}},{"line":227,"address":[25410070],"length":1,"stats":{"Line":0}},{"line":229,"address":[25410198],"length":1,"stats":{"Line":0}},{"line":233,"address":[25408280],"length":1,"stats":{"Line":0}},{"line":237,"address":[25411488,25410256,25411456],"length":1,"stats":{"Line":0}},{"line":239,"address":[25410276],"length":1,"stats":{"Line":0}},{"line":240,"address":[25411727,25411665],"length":1,"stats":{"Line":0}},{"line":241,"address":[25410328],"length":1,"stats":{"Line":0}},{"line":242,"address":[25410375],"length":1,"stats":{"Line":0}},{"line":244,"address":[25411709],"length":1,"stats":{"Line":0}},{"line":247,"address":[25410312],"length":1,"stats":{"Line":0}},{"line":248,"address":[25411528,25411596],"length":1,"stats":{"Line":0}},{"line":249,"address":[25410522],"length":1,"stats":{"Line":0}},{"line":254,"address":[25410642],"length":1,"stats":{"Line":0}},{"line":256,"address":[25411575],"length":1,"stats":{"Line":0}},{"line":260,"address":[25410407,25410676],"length":1,"stats":{"Line":0}},{"line":261,"address":[25410788,25410965],"length":1,"stats":{"Line":0}},{"line":262,"address":[25411072],"length":1,"stats":{"Line":0}},{"line":263,"address":[25411378,25411446],"length":1,"stats":{"Line":0}},{"line":264,"address":[25411138],"length":1,"stats":{"Line":0}},{"line":265,"address":[25411313],"length":1,"stats":{"Line":0}},{"line":267,"address":[25411425],"length":1,"stats":{"Line":0}},{"line":273,"address":[25410900],"length":1,"stats":{"Line":0}},{"line":274,"address":[25410921],"length":1,"stats":{"Line":0}},{"line":277,"address":[25410910],"length":1,"stats":{"Line":0}},{"line":282,"address":[25411760],"length":1,"stats":{"Line":0}},{"line":283,"address":[25411774],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":127},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","mod.rs"],"content":"//! Configuración del Architect Linter Pro\n//!\n//! Este módulo contiene toda la lógica relacionada con:\n//! - Tipos de configuración (Framework, ArchPattern, etc.)\n//! - Carga y validación de architect.json\n//! - Wizard de configuración con IA\n//! - Gestión de ignored_paths\n//! - Setup de hooks de git (husky)\n\nmod husky;\nmod ignored_paths;\nmod loader;\nmod types;\nmod wizard;\n\n// Re-export tipos públicos\npub use types::{\n    AIConfig, AIProvider, ArchError, ArchPattern, ForbiddenRule, Framework, LinterContext,\n};\n\n// Re-export funciones de loader\npub use loader::load_config;\n\n// Re-export funciones de wizard\npub use wizard::setup_or_load_config;\n\n// Re-export funciones de ignored_paths\npub use ignored_paths::default_ignored_paths;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","types.rs"],"content":"use miette::{Diagnostic, SourceSpan};\nuse serde::{Deserialize, Serialize};\nuse thiserror::Error;\n\n#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]\npub enum Framework {\n    NestJS,\n    React,\n    Angular,\n    Express,\n    // Python frameworks\n    Django,\n    Flask,\n    FastAPI,\n    // Go frameworks\n    Gin,\n    Echo,\n    // Java frameworks\n    Spring,\n    // PHP frameworks\n    Laravel,\n    Symfony,\n    Unknown,\n}\n\nimpl Framework {\n    pub fn as_str(\u0026self) -\u003e \u0026str {\n        match self {\n            Framework::NestJS =\u003e \"NestJS\",\n            Framework::React =\u003e \"React\",\n            Framework::Angular =\u003e \"Angular\",\n            Framework::Express =\u003e \"Express\",\n            // Python\n            Framework::Django =\u003e \"Django\",\n            Framework::Flask =\u003e \"Flask\",\n            Framework::FastAPI =\u003e \"FastAPI\",\n            // Go\n            Framework::Gin =\u003e \"Gin\",\n            Framework::Echo =\u003e \"Echo\",\n            // Java\n            Framework::Spring =\u003e \"Spring\",\n            // PHP\n            Framework::Laravel =\u003e \"Laravel\",\n            Framework::Symfony =\u003e \"Symfony\",\n            Framework::Unknown =\u003e \"Unknown\",\n        }\n    }\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]\npub enum ArchPattern {\n    Hexagonal,\n    Clean,\n    MVC,\n    Ninguno,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ForbiddenRule {\n    pub from: String,\n    pub to: String,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]\npub enum AIProvider {\n    Claude,\n    Gemini,\n    OpenAI,\n    Groq,\n    Ollama,\n    Kimi,\n    DeepSeek,\n}\n\nimpl AIProvider {\n    pub fn as_str(\u0026self) -\u003e \u0026str {\n        match self {\n            AIProvider::Claude =\u003e \"Claude\",\n            AIProvider::Gemini =\u003e \"Gemini\",\n            AIProvider::OpenAI =\u003e \"OpenAI\",\n            AIProvider::Groq =\u003e \"Groq\",\n            AIProvider::Ollama =\u003e \"Ollama\",\n            AIProvider::Kimi =\u003e \"Kimi\",\n            AIProvider::DeepSeek =\u003e \"DeepSeek\",\n        }\n    }\n}\n\n/// Configuración de IA para análisis arquitectónico\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AIConfig {\n    pub name: String,\n    pub provider: AIProvider,\n    pub api_url: String,\n    pub api_key: String,\n    pub model: String,\n}\n\nimpl Default for AIConfig {\n    fn default() -\u003e Self {\n        Self {\n            name: \"Default Claude\".to_string(),\n            provider: AIProvider::Claude,\n            api_url: \"https://api.anthropic.com\".to_string(),\n            api_key: String::new(),\n            model: \"claude-3-7-sonnet-20250219\".to_string(),\n        }\n    }\n}\n\npub struct LinterContext {\n    pub max_lines: usize,\n    #[allow(dead_code)]\n    pub framework: Framework,\n    #[allow(dead_code)]\n    pub pattern: ArchPattern,\n    pub forbidden_imports: Vec\u003cForbiddenRule\u003e,\n    pub ignored_paths: Vec\u003cString\u003e,\n    #[allow(dead_code)]\n    pub ai_configs: Vec\u003cAIConfig\u003e,\n}\n\n#[derive(Error, Debug, Diagnostic)]\n#[error(\"Violación de Arquitectura\")]\n#[diagnostic(code(arch::violation), severity(error))]\npub struct ArchError {\n    #[source_code]\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub src: String,\n    #[label(\"{message}\")]\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub span: SourceSpan,\n    #[allow(dead_code)]\n    #[allow(unused_assignments)]\n    pub message: String,\n}\n","traces":[{"line":27,"address":[25304016],"length":1,"stats":{"Line":0}},{"line":28,"address":[25304021],"length":1,"stats":{"Line":0}},{"line":29,"address":[25304052],"length":1,"stats":{"Line":0}},{"line":30,"address":[25304078],"length":1,"stats":{"Line":0}},{"line":31,"address":[25304104],"length":1,"stats":{"Line":0}},{"line":32,"address":[25304130],"length":1,"stats":{"Line":0}},{"line":34,"address":[25304156],"length":1,"stats":{"Line":0}},{"line":35,"address":[25304182],"length":1,"stats":{"Line":0}},{"line":36,"address":[25304208],"length":1,"stats":{"Line":0}},{"line":38,"address":[25304234],"length":1,"stats":{"Line":0}},{"line":39,"address":[25304257],"length":1,"stats":{"Line":0}},{"line":41,"address":[25304280],"length":1,"stats":{"Line":0}},{"line":43,"address":[25304303],"length":1,"stats":{"Line":0}},{"line":44,"address":[25304326],"length":1,"stats":{"Line":0}},{"line":45,"address":[25304349],"length":1,"stats":{"Line":0}},{"line":76,"address":[25303792],"length":1,"stats":{"Line":0}},{"line":77,"address":[25303797],"length":1,"stats":{"Line":0}},{"line":78,"address":[25303828],"length":1,"stats":{"Line":0}},{"line":79,"address":[25303854],"length":1,"stats":{"Line":0}},{"line":80,"address":[25303877],"length":1,"stats":{"Line":0}},{"line":81,"address":[25303900],"length":1,"stats":{"Line":0}},{"line":82,"address":[25303923],"length":1,"stats":{"Line":0}},{"line":83,"address":[25303946],"length":1,"stats":{"Line":0}},{"line":84,"address":[25303969],"length":1,"stats":{"Line":0}},{"line":100,"address":[25306816,25307171,25307165],"length":1,"stats":{"Line":0}},{"line":102,"address":[25306832],"length":1,"stats":{"Line":0}},{"line":104,"address":[25306868],"length":1,"stats":{"Line":0}},{"line":105,"address":[25306932],"length":1,"stats":{"Line":0}},{"line":106,"address":[25306974],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":29},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","config","wizard.rs"],"content":"use crate::ai::SuggestedRule;\nuse miette::{IntoDiagnostic, Result};\nuse std::fs;\nuse std::path::Path;\nuse std::sync::Arc;\n\nuse super::husky::setup_husky_pre_commit;\nuse super::ignored_paths::get_framework_ignored_paths;\nuse super::loader::{AIConfigFile, ConfigFile};\nuse super::types::{AIConfig, ArchPattern, ForbiddenRule, LinterContext};\n\n/// Orquestador de configuración: Carga silenciosa o Wizard con IA\npub fn setup_or_load_config(root: \u0026Path) -\u003e Result\u003cArc\u003cLinterContext\u003e\u003e {\n    let config_path = root.join(\"architect.json\");\n\n    if config_path.exists() {\n        // MODO AUTOMÁTICO: carga silenciosa\n        let ctx = super::loader::load_config(root)?;\n        return Ok(Arc::new(ctx));\n    }\n\n    // MODO CONFIGURACIÓN (IA Discovery)\n    println!(\"📝 No encontré 'architect.json'. Iniciando descubrimiento asistido por IA...\\n\");\n\n    // 0. Pedir configuración de IA si no existe\n    let ai_configs = crate::ui::ask_ai_configs()?;\n\n    // Seleccionar cuál usar para el descubrimiento inicial\n    let ai_config = if ai_configs.len() \u003e 1 {\n        let names: Vec\u003cString\u003e = ai_configs.iter().map(|c| c.name.clone()).collect();\n        let selection = dialoguer::Select::with_theme(\u0026dialoguer::theme::ColorfulTheme::default())\n            .with_prompt(\"¿Qué modelo deseas usar para el descubrimiento inicial?\")\n            .items(\u0026names)\n            .default(0)\n            .interact()\n            .into_diagnostic()?;\n        ai_configs[selection].clone()\n    } else {\n        ai_configs[0].clone()\n    };\n\n    // 1. Discovery (Input local)\n    let project_info = crate::discovery::get_architecture_snapshot(root);\n\n    // 2. IA (Procesamiento inteligente)\n    let suggestions = crate::ai::sugerir_arquitectura_inicial(project_info, ai_configs.clone())\n        .map_err(|e| miette::miette!(\"Error consultando la IA: {}\", e))?;\n\n    // 3. UI (Wizard de confirmación)\n    let (selected_rules, max_lines) = crate::ui::ask_user_to_confirm_rules(suggestions)?;\n\n    // 4. Config (Persistencia)\n    let final_ctx = save_config_from_wizard(\n        root,\n        selected_rules,\n        max_lines,\n        ai_configs,\n        ai_config.name.clone(),\n    )?;\n\n    println!(\"✅ Configuración guardada exitosamente.\\n\");\n    Ok(Arc::new(final_ctx))\n}\n\n/// PERSISTENCIA: Guarda las reglas de la IA y devuelve el contexto nuevo\npub fn save_config_from_wizard(\n    root: \u0026Path,\n    rules: Vec\u003cSuggestedRule\u003e,\n    max_lines: usize,\n    ai_configs: Vec\u003cAIConfig\u003e,\n    selected_name: String,\n) -\u003e Result\u003cLinterContext\u003e {\n    // 1. Guardar architect.json (reglas - compartible en el repo)\n    let config_path = root.join(\"architect.json\");\n\n    // Convertimos de SuggestedRule (IA) a ForbiddenRule (Linter)\n    let forbidden_imports: Vec\u003cForbiddenRule\u003e = rules\n        .into_iter()\n        .map(|r| ForbiddenRule {\n            from: r.from,\n            to: r.to,\n        })\n        .collect();\n\n    let framework = crate::detector::detect_framework(root);\n\n    // Obtener ignored_paths según el framework\n    let ignored_paths = get_framework_ignored_paths(\u0026framework);\n\n    // Valores por defecto para el primer architect.json\n    let config = ConfigFile {\n        max_lines_per_function: max_lines,\n        architecture_pattern: ArchPattern::MVC, // O el que detecte la IA\n        forbidden_imports: forbidden_imports.clone(),\n        ignored_paths: ignored_paths.clone(),\n    };\n\n    let json = serde_json::to_string_pretty(\u0026config).into_diagnostic()?;\n    fs::write(\u0026config_path, json).into_diagnostic()?;\n\n    // 2. Guardar .architect.ai.json (config de IA - PRIVADO, en .gitignore)\n    if !ai_configs.is_empty() {\n        let ai_config_path = root.join(\".architect.ai.json\");\n        let ai_config_file = AIConfigFile {\n            configs: ai_configs.clone(),\n            selected_name: selected_name.clone(),\n        };\n        let ai_json = serde_json::to_string_pretty(\u0026ai_config_file).into_diagnostic()?;\n        fs::write(\u0026ai_config_path, ai_json).into_diagnostic()?;\n\n        println!(\"🔐 Configuraciones de IA guardadas en: .architect.ai.json\");\n        println!(\"⚠️  Este archivo contiene API keys y NO debe ser compartido en el repositorio.\");\n\n        // Actualizar .gitignore automáticamente\n        update_gitignore(root)?;\n\n        println!();\n    }\n\n    // Instalar husky y pre-commit hook después de guardar la configuración\n    setup_husky_pre_commit(root)?;\n\n    Ok(LinterContext {\n        max_lines: config.max_lines_per_function,\n        framework,\n        pattern: config.architecture_pattern,\n        forbidden_imports,\n        ignored_paths,\n        ai_configs,\n    })\n}\n\n/// Actualiza el .gitignore del proyecto para incluir .architect.ai.json\nfn update_gitignore(root: \u0026Path) -\u003e Result\u003c()\u003e {\n    let gitignore_path = root.join(\".gitignore\");\n    let entry_to_add =\n        \"# Architect Linter - AI Configuration (contains API keys)\\n.architect.ai.json\";\n\n    // Verificar si el archivo existe\n    if gitignore_path.exists() {\n        // Leer el contenido actual\n        let content = fs::read_to_string(\u0026gitignore_path).into_diagnostic()?;\n\n        // Verificar si ya contiene la entrada\n        if content.contains(\".architect.ai.json\") {\n            println!(\"✅ .architect.ai.json ya está en el .gitignore\");\n            return Ok(());\n        }\n\n        // Agregar la entrada al final\n        let mut updated_content = content;\n        if !updated_content.ends_with('\\n') {\n            updated_content.push('\\n');\n        }\n        updated_content.push_str(entry_to_add);\n        updated_content.push('\\n');\n\n        fs::write(\u0026gitignore_path, updated_content).into_diagnostic()?;\n        println!(\"✅ .architect.ai.json agregado al .gitignore\");\n    } else {\n        // Crear el .gitignore con la entrada\n        let mut gitignore_content =\n            String::from(\"# Architect Linter - AI Configuration (contains API keys)\\n\");\n        gitignore_content.push_str(\".architect.ai.json\\n\");\n\n        fs::write(\u0026gitignore_path, gitignore_content).into_diagnostic()?;\n        println!(\"✅ .gitignore creado con .architect.ai.json\");\n    }\n\n    Ok(())\n}\n","traces":[{"line":30,"address":[24599251,24599216],"length":1,"stats":{"Line":0}},{"line":47,"address":[24598928,24598945],"length":1,"stats":{"Line":0}},{"line":79,"address":[24599361,24599280],"length":1,"stats":{"Line":0}},{"line":80,"address":[24599308],"length":1,"stats":{"Line":0}},{"line":81,"address":[24599334],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","detector.rs"],"content":"use crate::config::Framework;\nuse std::fs;\nuse std::path::Path;\n\n/// Analiza los archivos de dependencias para determinar el framework del proyecto.\n/// Soporta: JavaScript/TypeScript (package.json), Python (requirements.txt/pyproject.toml/Pipfile),\n/// Go (go.mod), PHP (composer.json), Java (pom.xml/build.gradle)\npub fn detect_framework(root: \u0026Path) -\u003e Framework {\n    // 1. Check JavaScript/TypeScript (package.json)\n    let pkg_path = root.join(\"package.json\");\n    if let Ok(content) = fs::read_to_string(\u0026pkg_path) {\n        if content.contains(\"@nestjs/core\") {\n            return Framework::NestJS;\n        }\n        if content.contains(\"\\\"react\\\"\") {\n            return Framework::React;\n        }\n        if content.contains(\"@angular/core\") {\n            return Framework::Angular;\n        }\n        if content.contains(\"\\\"express\\\"\") {\n            return Framework::Express;\n        }\n    }\n\n    // 2. Check Python (requirements.txt)\n    let requirements_path = root.join(\"requirements.txt\");\n    if let Ok(content) = fs::read_to_string(\u0026requirements_path) {\n        let content_lower = content.to_lowercase();\n        if content_lower.contains(\"django\") {\n            return Framework::Django;\n        }\n        if content_lower.contains(\"fastapi\") {\n            return Framework::FastAPI;\n        }\n        if content_lower.contains(\"flask\") {\n            return Framework::Flask;\n        }\n    }\n\n    // 3. Check Python (pyproject.toml)\n    let pyproject_path = root.join(\"pyproject.toml\");\n    if let Ok(content) = fs::read_to_string(\u0026pyproject_path) {\n        let content_lower = content.to_lowercase();\n        if content_lower.contains(\"django\") {\n            return Framework::Django;\n        }\n        if content_lower.contains(\"fastapi\") {\n            return Framework::FastAPI;\n        }\n        if content_lower.contains(\"flask\") {\n            return Framework::Flask;\n        }\n    }\n\n    // 4. Check Python (Pipfile)\n    let pipfile_path = root.join(\"Pipfile\");\n    if let Ok(content) = fs::read_to_string(\u0026pipfile_path) {\n        let content_lower = content.to_lowercase();\n        if content_lower.contains(\"django\") {\n            return Framework::Django;\n        }\n        if content_lower.contains(\"fastapi\") {\n            return Framework::FastAPI;\n        }\n        if content_lower.contains(\"flask\") {\n            return Framework::Flask;\n        }\n    }\n\n    // 5. Check Go (go.mod)\n    let go_mod_path = root.join(\"go.mod\");\n    if let Ok(content) = fs::read_to_string(\u0026go_mod_path) {\n        if content.contains(\"gin-gonic/gin\") || content.contains(\"github.com/gin-gonic/gin\") {\n            return Framework::Gin;\n        }\n        if content.contains(\"labstack/echo\") || content.contains(\"github.com/labstack/echo\") {\n            return Framework::Echo;\n        }\n    }\n\n    // 6. Check PHP (composer.json)\n    let composer_path = root.join(\"composer.json\");\n    if let Ok(content) = fs::read_to_string(\u0026composer_path) {\n        if content.contains(\"laravel/framework\") {\n            return Framework::Laravel;\n        }\n        if content.contains(\"symfony/framework-bundle\")\n            || content.contains(\"symfony/flex\")\n            || content.contains(\"\\\"symfony/\")\n        {\n            return Framework::Symfony;\n        }\n    }\n\n    // 7. Check Java (pom.xml - Maven)\n    let pom_path = root.join(\"pom.xml\");\n    if let Ok(content) = fs::read_to_string(\u0026pom_path) {\n        if content.contains(\"spring-boot\") || content.contains(\"org.springframework\") {\n            return Framework::Spring;\n        }\n    }\n\n    // 8. Check Java (build.gradle - Gradle)\n    let gradle_path = root.join(\"build.gradle\");\n    if !gradle_path.exists() {\n        // Also check build.gradle.kts\n        let _ = root.join(\"build.gradle.kts\");\n    }\n    if let Ok(content) = fs::read_to_string(\u0026gradle_path) {\n        if content.contains(\"spring-boot\") || content.contains(\"org.springframework\") {\n            return Framework::Spring;\n        }\n    }\n    let gradle_kts_path = root.join(\"build.gradle.kts\");\n    if let Ok(content) = fs::read_to_string(\u0026gradle_kts_path) {\n        if content.contains(\"spring-boot\") || content.contains(\"org.springframework\") {\n            return Framework::Spring;\n        }\n    }\n\n    Framework::Unknown\n}\n\n/// Sugiere un límite de líneas de código (LOC) basado en el framework detectado.\n#[allow(dead_code)]\npub fn get_loc_suggestion(framework: \u0026Framework) -\u003e usize {\n    match framework {\n        Framework::NestJS =\u003e 40,  // Métodos de clase\n        Framework::React =\u003e 25,   // Componentes funcionales pequeños\n        Framework::Angular =\u003e 50, // Componentes con lógica más extensa\n        Framework::Express =\u003e 60, // Middlewares y handlers\n        // Python frameworks\n        Framework::Django =\u003e 50,  // Views, models\n        Framework::Flask =\u003e 50,   // Route handlers\n        Framework::FastAPI =\u003e 40, // Endpoint functions\n        // Go frameworks\n        Framework::Gin =\u003e 40,  // Handler functions\n        Framework::Echo =\u003e 40, // Handler functions\n        // Java frameworks\n        Framework::Spring =\u003e 50, // Service methods, controllers\n        // PHP frameworks\n        Framework::Laravel =\u003e 50, // Controller methods\n        Framework::Symfony =\u003e 50, // Controller methods\n        Framework::Unknown =\u003e 50, // Estándar general\n    }\n}\n","traces":[{"line":8,"address":[25364629,25363728,25371643],"length":1,"stats":{"Line":0}},{"line":10,"address":[25363773],"length":1,"stats":{"Line":0}},{"line":11,"address":[25363819,25363882,25363965],"length":1,"stats":{"Line":0}},{"line":12,"address":[25364088,25364005],"length":1,"stats":{"Line":0}},{"line":13,"address":[25364162],"length":1,"stats":{"Line":0}},{"line":15,"address":[25364191,25364139],"length":1,"stats":{"Line":0}},{"line":16,"address":[25364265],"length":1,"stats":{"Line":0}},{"line":18,"address":[25364242,25364294],"length":1,"stats":{"Line":0}},{"line":19,"address":[25364368],"length":1,"stats":{"Line":0}},{"line":21,"address":[25364397,25364345],"length":1,"stats":{"Line":0}},{"line":22,"address":[25364462],"length":1,"stats":{"Line":0}},{"line":27,"address":[25364692],"length":1,"stats":{"Line":0}},{"line":28,"address":[25364724,25364878,25364795],"length":1,"stats":{"Line":0}},{"line":29,"address":[25365001,25364918],"length":1,"stats":{"Line":0}},{"line":30,"address":[25365028,25365111],"length":1,"stats":{"Line":0}},{"line":31,"address":[25365185],"length":1,"stats":{"Line":0}},{"line":33,"address":[25365162,25365214],"length":1,"stats":{"Line":0}},{"line":34,"address":[25365288],"length":1,"stats":{"Line":0}},{"line":36,"address":[25365317,25365265],"length":1,"stats":{"Line":0}},{"line":37,"address":[25365379],"length":1,"stats":{"Line":0}},{"line":42,"address":[25365650],"length":1,"stats":{"Line":0}},{"line":43,"address":[25365753,25365836,25365682],"length":1,"stats":{"Line":0}},{"line":44,"address":[25365876,25365959],"length":1,"stats":{"Line":0}},{"line":45,"address":[25366069,25365986],"length":1,"stats":{"Line":0}},{"line":46,"address":[25366143],"length":1,"stats":{"Line":0}},{"line":48,"address":[25366172,25366120],"length":1,"stats":{"Line":0}},{"line":49,"address":[25366246],"length":1,"stats":{"Line":0}},{"line":51,"address":[25366223,25366275],"length":1,"stats":{"Line":0}},{"line":52,"address":[25366337],"length":1,"stats":{"Line":0}},{"line":57,"address":[25366608],"length":1,"stats":{"Line":0}},{"line":58,"address":[25366711,25366794,25366640],"length":1,"stats":{"Line":0}},{"line":59,"address":[25366917,25366834],"length":1,"stats":{"Line":0}},{"line":60,"address":[25366944,25367027],"length":1,"stats":{"Line":0}},{"line":61,"address":[25367101],"length":1,"stats":{"Line":0}},{"line":63,"address":[25367130,25367078],"length":1,"stats":{"Line":0}},{"line":64,"address":[25367204],"length":1,"stats":{"Line":0}},{"line":66,"address":[25367181,25367233],"length":1,"stats":{"Line":0}},{"line":67,"address":[25367295],"length":1,"stats":{"Line":0}},{"line":72,"address":[25367566],"length":1,"stats":{"Line":0}},{"line":73,"address":[25367598,25367669,25367752],"length":1,"stats":{"Line":0}},{"line":74,"address":[25367978,25367875,25367792],"length":1,"stats":{"Line":0}},{"line":75,"address":[25367949],"length":1,"stats":{"Line":0}},{"line":77,"address":[25368171,25368029],"length":1,"stats":{"Line":0}},{"line":78,"address":[25368142],"length":1,"stats":{"Line":0}},{"line":83,"address":[25368453],"length":1,"stats":{"Line":0}},{"line":84,"address":[25368485,25368556,25368639],"length":1,"stats":{"Line":0}},{"line":85,"address":[25368679,25368762],"length":1,"stats":{"Line":0}},{"line":86,"address":[25368836],"length":1,"stats":{"Line":0}},{"line":88,"address":[25368865,25368813],"length":1,"stats":{"Line":0}},{"line":89,"address":[25368916,25368968],"length":1,"stats":{"Line":0}},{"line":90,"address":[25369019],"length":1,"stats":{"Line":0}},{"line":92,"address":[25368939],"length":1,"stats":{"Line":0}},{"line":97,"address":[25369344],"length":1,"stats":{"Line":0}},{"line":98,"address":[25369530,25369376,25369447],"length":1,"stats":{"Line":0}},{"line":99,"address":[25369570,25369773,25369653],"length":1,"stats":{"Line":0}},{"line":100,"address":[25369727],"length":1,"stats":{"Line":0}},{"line":105,"address":[25370030],"length":1,"stats":{"Line":0}},{"line":106,"address":[25370141,25370070],"length":1,"stats":{"Line":0}},{"line":108,"address":[25370178,25370237],"length":1,"stats":{"Line":0}},{"line":110,"address":[25370256,25370210,25370339],"length":1,"stats":{"Line":0}},{"line":111,"address":[25370450,25370552,25370379],"length":1,"stats":{"Line":0}},{"line":112,"address":[25370512],"length":1,"stats":{"Line":0}},{"line":115,"address":[25370809],"length":1,"stats":{"Line":0}},{"line":116,"address":[25370912,25370841,25370995],"length":1,"stats":{"Line":0}},{"line":117,"address":[25371106,25371208,25371035],"length":1,"stats":{"Line":0}},{"line":118,"address":[25371168],"length":1,"stats":{"Line":0}},{"line":122,"address":[25371464],"length":1,"stats":{"Line":0}},{"line":127,"address":[25371664],"length":1,"stats":{"Line":0}},{"line":128,"address":[25371669],"length":1,"stats":{"Line":0}},{"line":129,"address":[25371700],"length":1,"stats":{"Line":0}},{"line":130,"address":[25371714],"length":1,"stats":{"Line":0}},{"line":131,"address":[25371725],"length":1,"stats":{"Line":0}},{"line":132,"address":[25371736],"length":1,"stats":{"Line":0}},{"line":134,"address":[25371747],"length":1,"stats":{"Line":0}},{"line":135,"address":[25371758],"length":1,"stats":{"Line":0}},{"line":136,"address":[25371769],"length":1,"stats":{"Line":0}},{"line":138,"address":[25371780],"length":1,"stats":{"Line":0}},{"line":139,"address":[25371791],"length":1,"stats":{"Line":0}},{"line":141,"address":[25371802],"length":1,"stats":{"Line":0}},{"line":143,"address":[25371813],"length":1,"stats":{"Line":0}},{"line":144,"address":[25371824],"length":1,"stats":{"Line":0}},{"line":145,"address":[25371835],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":82},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","discovery.rs"],"content":"use crate::config::default_ignored_paths;\nuse crate::detector;\nuse crate::parsers;\nuse serde::Serialize;\nuse std::fs;\nuse std::path::{Path, PathBuf};\nuse walkdir::{DirEntry, WalkDir};\n\n#[derive(Serialize)]\npub struct ProjectContext {\n    pub framework: String,\n    pub dependencies: Vec\u003cString\u003e,\n    pub folder_structure: Vec\u003cString\u003e,\n    pub key_files: Vec\u003cString\u003e,\n}\n\n/// Recolecta todos los archivos soportados que el linter debe analizar.\n/// Incluye: TypeScript (.ts, .tsx), JavaScript (.js, .jsx), Python (.py), Go (.go), PHP (.php), Java (.java)\n/// Respeta los patrones de exclusión definidos en ignored_paths.\npub fn collect_files(root: \u0026Path, ignored_paths: \u0026[String]) -\u003e Vec\u003cPathBuf\u003e {\n    let supported_exts = parsers::supported_extensions();\n\n    WalkDir::new(root)\n        .into_iter()\n        .filter_entry(|e| is_not_ignored_with_patterns(e, root, ignored_paths))\n        .filter_map(|e| e.ok())\n        .filter(|e| {\n            let path_str = e.path().to_string_lossy();\n\n            // Ignorar archivos de definición TypeScript\n            if path_str.ends_with(\".d.ts\") {\n                return false;\n            }\n\n            // Verificar si la extensión está en la lista de soportadas\n            e.path().extension().map_or(false, |ext| {\n                supported_exts.iter().any(|\u0026supported| ext == supported)\n            })\n        })\n        .map(|e| e.path().to_path_buf())\n        .collect()\n}\n\n/// Genera un resumen completo del proyecto para que la IA tome decisiones arquitectónicas.\npub fn get_architecture_snapshot(root: \u0026Path) -\u003e ProjectContext {\n    let mut folders = Vec::new();\n    let mut key_files = Vec::new();\n\n    let framework_enum = detector::detect_framework(root);\n    let framework = framework_enum.as_str().to_string();\n    let dependencies = get_dependency_list(root);\n\n    let src_path = root.join(\"src\");\n    let scan_path = if src_path.exists() {\n        src_path\n    } else {\n        root.to_path_buf()\n    };\n\n    // Use default_ignored_paths instead of hardcoded filter\n    let ignored = default_ignored_paths();\n\n    let walker = WalkDir::new(scan_path)\n        .into_iter()\n        .filter_entry(|e| is_not_ignored_with_patterns(e, root, \u0026ignored));\n\n    for entry in walker.filter_map(|e| e.ok()) {\n        let path = entry.path();\n        let relative_path = path.strip_prefix(root).unwrap_or(path);\n        let path_str = relative_path.to_string_lossy().into_owned();\n\n        if path.is_dir() {\n            if path_str != \".\" \u0026\u0026 !path_str.is_empty() {\n                folders.push(path_str);\n            }\n        } else if is_architectural_file(path) {\n            key_files.push(path_str);\n        }\n    }\n\n    ProjectContext {\n        framework,\n        dependencies,\n        folder_structure: folders,\n        key_files,\n    }\n}\n\nfn get_dependency_list(root: \u0026Path) -\u003e Vec\u003cString\u003e {\n    let mut deps_list = Vec::new();\n\n    // 1. JavaScript/TypeScript: package.json\n    let pkg_path = root.join(\"package.json\");\n    if let Ok(content) = fs::read_to_string(\u0026pkg_path) {\n        if let Ok(json) = serde_json::from_str::\u003cserde_json::Value\u003e(\u0026content) {\n            if let Some(deps) = json.get(\"dependencies\").and_then(|d| d.as_object()) {\n                deps_list.extend(deps.keys().cloned());\n            }\n            if let Some(dev_deps) = json.get(\"devDependencies\").and_then(|d| d.as_object()) {\n                deps_list.extend(dev_deps.keys().cloned());\n            }\n        }\n    }\n\n    // 2. Python: requirements.txt\n    let requirements_path = root.join(\"requirements.txt\");\n    if let Ok(content) = fs::read_to_string(\u0026requirements_path) {\n        for line in content.lines() {\n            let line = line.trim();\n            // Skip comments and empty lines\n            if line.is_empty() || line.starts_with('#') {\n                continue;\n            }\n            // Extract package name (strip version specifiers like ==, \u003e=, \u003c=, ~=, !=, etc.)\n            let pkg_name = line\n                .split(\u0026['=', '\u003c', '\u003e', '~', '!', ';'][..])\n                .next()\n                .unwrap_or(line)\n                .trim()\n                .to_string();\n            if !pkg_name.is_empty() {\n                deps_list.push(pkg_name);\n            }\n        }\n    }\n\n    // 3. Python: pyproject.toml (simple line-by-line parsing)\n    let pyproject_path = root.join(\"pyproject.toml\");\n    if let Ok(content) = fs::read_to_string(\u0026pyproject_path) {\n        let mut in_dependencies = false;\n        let mut bracket_count = 0;\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Detect dependencies section start\n            if trimmed.starts_with(\"dependencies\") \u0026\u0026 trimmed.contains('[') {\n                in_dependencies = true;\n                bracket_count =\n                    trimmed.matches('[').count() as i32 - trimmed.matches(']').count() as i32;\n                continue;\n            }\n\n            if in_dependencies {\n                // Track brackets for multi-line arrays\n                bracket_count += trimmed.matches('[').count() as i32;\n                bracket_count -= trimmed.matches(']').count() as i32;\n\n                if bracket_count \u003c= 0 \u0026\u0026 trimmed.ends_with(']') {\n                    in_dependencies = false;\n                    continue;\n                }\n\n                // Extract quoted package names\n                if trimmed.starts_with('\"') || trimmed.starts_with(\"'\") {\n                    let pkg = trimmed\n                        .trim_start_matches('\"')\n                        .trim_start_matches('\\'')\n                        .split(\u0026['\"', '\\'', ' ', '\u003e', '\u003c', '=', '~', '^'][..])\n                        .next()\n                        .unwrap_or(\"\")\n                        .to_string();\n                    if !pkg.is_empty() {\n                        deps_list.push(pkg);\n                    }\n                }\n            }\n        }\n    }\n\n    // 4. Go: go.mod\n    let go_mod_path = root.join(\"go.mod\");\n    if let Ok(content) = fs::read_to_string(\u0026go_mod_path) {\n        let mut in_require = false;\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Detect require block\n            if trimmed == \"require (\" {\n                in_require = true;\n                continue;\n            }\n            if in_require \u0026\u0026 trimmed == \")\" {\n                in_require = false;\n                continue;\n            }\n\n            // Parse require entries\n            if in_require \u0026\u0026 !trimmed.is_empty() \u0026\u0026 !trimmed.starts_with(\"//\") {\n                // Format: module/path version\n                if let Some(module) = trimmed.split_whitespace().next() {\n                    deps_list.push(module.to_string());\n                }\n            }\n\n            // Single-line require: require module/path version\n            if trimmed.starts_with(\"require \") \u0026\u0026 !trimmed.starts_with(\"require (\") {\n                if let Some(rest) = trimmed.strip_prefix(\"require \") {\n                    if let Some(module) = rest.split_whitespace().next() {\n                        deps_list.push(module.to_string());\n                    }\n                }\n            }\n        }\n    }\n\n    // 5. PHP: composer.json\n    let composer_path = root.join(\"composer.json\");\n    if let Ok(content) = fs::read_to_string(\u0026composer_path) {\n        if let Ok(json) = serde_json::from_str::\u003cserde_json::Value\u003e(\u0026content) {\n            if let Some(deps) = json.get(\"require\").and_then(|d| d.as_object()) {\n                deps_list.extend(deps.keys().cloned());\n            }\n            if let Some(dev_deps) = json.get(\"require-dev\").and_then(|d| d.as_object()) {\n                deps_list.extend(dev_deps.keys().cloned());\n            }\n        }\n    }\n\n    // 6. Java: pom.xml (Maven) - simple line scan for artifactId\n    let pom_path = root.join(\"pom.xml\");\n    if let Ok(content) = fs::read_to_string(\u0026pom_path) {\n        let mut in_dependencies = false;\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            if trimmed == \"\u003cdependencies\u003e\" {\n                in_dependencies = true;\n                continue;\n            }\n            if trimmed == \"\u003c/dependencies\u003e\" {\n                in_dependencies = false;\n                continue;\n            }\n\n            if in_dependencies\n                \u0026\u0026 trimmed.starts_with(\"\u003cartifactId\u003e\")\n                \u0026\u0026 trimmed.ends_with(\"\u003c/artifactId\u003e\")\n            {\n                let artifact = trimmed\n                    .trim_start_matches(\"\u003cartifactId\u003e\")\n                    .trim_end_matches(\"\u003c/artifactId\u003e\");\n                if !artifact.is_empty() {\n                    deps_list.push(artifact.to_string());\n                }\n            }\n        }\n    }\n\n    // 7. Java: build.gradle (Gradle) - simple line scan\n    let gradle_path = root.join(\"build.gradle\");\n    if let Ok(content) = fs::read_to_string(\u0026gradle_path) {\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Match: implementation 'group:artifact:version' or implementation \"group:artifact:version\"\n            if trimmed.starts_with(\"implementation \") || trimmed.starts_with(\"api \") {\n                let quote_char = if trimmed.contains('\\'') { '\\'' } else { '\"' };\n                if let Some(start) = trimmed.find(quote_char) {\n                    if let Some(end) = trimmed.rfind(quote_char) {\n                        if start \u003c end {\n                            let dep = \u0026trimmed[start + 1..end];\n                            // Extract artifact name (last part before version)\n                            if let Some(artifact) = dep.split(':').nth(1) {\n                                deps_list.push(artifact.to_string());\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // Also check build.gradle.kts\n    let gradle_kts_path = root.join(\"build.gradle.kts\");\n    if let Ok(content) = fs::read_to_string(\u0026gradle_kts_path) {\n        for line in content.lines() {\n            let trimmed = line.trim();\n\n            // Match: implementation(\"group:artifact:version\")\n            if trimmed.starts_with(\"implementation(\") || trimmed.starts_with(\"api(\") {\n                if let Some(start) = trimmed.find('\"') {\n                    if let Some(end) = trimmed.rfind('\"') {\n                        if start \u003c end {\n                            let dep = \u0026trimmed[start + 1..end];\n                            if let Some(artifact) = dep.split(':').nth(1) {\n                                deps_list.push(artifact.to_string());\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    deps_list\n}\n\n/// Verifica si una entrada debe ser ignorada según los patrones configurados\npub fn is_not_ignored_with_patterns(\n    entry: \u0026DirEntry,\n    root: \u0026Path,\n    ignored_paths: \u0026[String],\n) -\u003e bool {\n    // Obtener la ruta relativa al root del proyecto\n    let entry_path = entry.path();\n    let relative_path = entry_path\n        .strip_prefix(root)\n        .unwrap_or(entry_path)\n        .to_string_lossy()\n        .replace('\\\\', \"/\"); // Normalizar separadores para Windows\n\n    // Verificar si la ruta coincide con algún patrón de exclusión\n    for pattern in ignored_paths {\n        let normalized_pattern = pattern.replace('\\\\', \"/\");\n\n        // Coincidencia exacta o si la ruta comienza con el patrón\n        if relative_path == normalized_pattern.trim_end_matches('/')\n            || relative_path.starts_with(\u0026normalized_pattern)\n            || relative_path.starts_with(\u0026format!(\"{}/\", normalized_pattern.trim_end_matches('/')))\n        {\n            return false;\n        }\n\n        // También verificar el nombre del directorio/archivo directamente\n        if let Some(file_name) = entry.file_name().to_str() {\n            if file_name == normalized_pattern.trim_end_matches('/')\n                || format!(\"{}/\", file_name) == normalized_pattern\n            {\n                return false;\n            }\n        }\n    }\n\n    true\n}\n\nfn is_architectural_file(path: \u0026Path) -\u003e bool {\n    let s = path.to_string_lossy().to_lowercase();\n\n    // TypeScript/JavaScript patterns\n    let ts_js_patterns = [\n        \".controller.ts\",\n        \".controller.js\",\n        \".service.ts\",\n        \".service.js\",\n        \".entity.ts\",\n        \".entity.js\",\n        \".repository.ts\",\n        \".repository.js\",\n        \".dto.ts\",\n        \".dto.js\",\n        \".module.ts\",\n        \".module.js\",\n        \".handler.ts\",\n        \".handler.js\",\n    ];\n\n    // Python patterns\n    let py_patterns = [\n        \"_controller.py\",\n        \"_service.py\",\n        \"_repository.py\",\n        \"_model.py\",\n        \"_view.py\",\n        \"_handler.py\",\n    ];\n\n    // Go patterns\n    let go_patterns = [\n        \"_controller.go\",\n        \"_service.go\",\n        \"_repository.go\",\n        \"_handler.go\",\n        \"_model.go\",\n    ];\n\n    // PHP patterns\n    let php_patterns = [\n        \"controller.php\",\n        \"service.php\",\n        \"repository.php\",\n        \"model.php\",\n        \"handler.php\",\n        \"entity.php\",\n    ];\n\n    // Java patterns\n    let java_patterns = [\n        \"controller.java\",\n        \"service.java\",\n        \"repository.java\",\n        \"model.java\",\n        \"handler.java\",\n        \"entity.java\",\n        \"dao.java\",\n    ];\n\n    ts_js_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || py_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || go_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || php_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n        || java_patterns.iter().any(|\u0026pattern| s.ends_with(pattern))\n}\n","traces":[{"line":20,"address":[25345072,25345473,25345467],"length":1,"stats":{"Line":0}},{"line":21,"address":[25345141],"length":1,"stats":{"Line":0}},{"line":23,"address":[25345165],"length":1,"stats":{"Line":0}},{"line":25,"address":[25309977,25309952],"length":1,"stats":{"Line":0}},{"line":26,"address":[25310046,25310016],"length":1,"stats":{"Line":0}},{"line":27,"address":[25310256,25310588,25310594],"length":1,"stats":{"Line":0}},{"line":28,"address":[25310302],"length":1,"stats":{"Line":0}},{"line":31,"address":[25310406,25310334],"length":1,"stats":{"Line":0}},{"line":32,"address":[25310469],"length":1,"stats":{"Line":0}},{"line":36,"address":[25310608,25310448,25310497],"length":1,"stats":{"Line":0}},{"line":37,"address":[25310626,25310702,25310688],"length":1,"stats":{"Line":0}},{"line":40,"address":[25310128,25310096],"length":1,"stats":{"Line":0}},{"line":45,"address":[25361493,25361609,25359136],"length":1,"stats":{"Line":0}},{"line":46,"address":[25359191],"length":1,"stats":{"Line":0}},{"line":47,"address":[25359296],"length":1,"stats":{"Line":0}},{"line":49,"address":[25359357,25359428],"length":1,"stats":{"Line":0}},{"line":50,"address":[25359435],"length":1,"stats":{"Line":0}},{"line":51,"address":[25359525,25359589],"length":1,"stats":{"Line":0}},{"line":53,"address":[25359597,25359667],"length":1,"stats":{"Line":0}},{"line":54,"address":[25359748,25359683,25359868],"length":1,"stats":{"Line":0}},{"line":55,"address":[25359804],"length":1,"stats":{"Line":0}},{"line":57,"address":[25359785,25359870],"length":1,"stats":{"Line":0}},{"line":61,"address":[25359878],"length":1,"stats":{"Line":0}},{"line":63,"address":[25359938],"length":1,"stats":{"Line":0}},{"line":65,"address":[25311298,25311280],"length":1,"stats":{"Line":0}},{"line":67,"address":[25311390,25311360],"length":1,"stats":{"Line":0}},{"line":68,"address":[25360920,25360424],"length":1,"stats":{"Line":0}},{"line":69,"address":[25360952],"length":1,"stats":{"Line":0}},{"line":70,"address":[25361048],"length":1,"stats":{"Line":0}},{"line":72,"address":[25361160,25361100],"length":1,"stats":{"Line":0}},{"line":73,"address":[25361187,25361315],"length":1,"stats":{"Line":0}},{"line":74,"address":[25361350],"length":1,"stats":{"Line":0}},{"line":76,"address":[25361176,25361217],"length":1,"stats":{"Line":0}},{"line":77,"address":[25361242],"length":1,"stats":{"Line":0}},{"line":89,"address":[25345488,25346603,25357250],"length":1,"stats":{"Line":0}},{"line":90,"address":[25345558],"length":1,"stats":{"Line":0}},{"line":93,"address":[25345623],"length":1,"stats":{"Line":0}},{"line":94,"address":[25345764,25345696,25345847],"length":1,"stats":{"Line":0}},{"line":95,"address":[25346052,25345887,25345970],"length":1,"stats":{"Line":0}},{"line":96,"address":[25310752,25310761],"length":1,"stats":{"Line":0}},{"line":97,"address":[25346265,25346311],"length":1,"stats":{"Line":0}},{"line":99,"address":[25346375,25346272],"length":1,"stats":{"Line":0}},{"line":100,"address":[25346465,25346494],"length":1,"stats":{"Line":0}},{"line":106,"address":[25346792],"length":1,"stats":{"Line":0}},{"line":107,"address":[25346895,25346978,25346824],"length":1,"stats":{"Line":0}},{"line":108,"address":[25347980,25347018,25347109],"length":1,"stats":{"Line":0}},{"line":109,"address":[25347295,25347422],"length":1,"stats":{"Line":0}},{"line":111,"address":[25347460],"length":1,"stats":{"Line":0}},{"line":116,"address":[25347547],"length":1,"stats":{"Line":0}},{"line":118,"address":[25347706],"length":1,"stats":{"Line":0}},{"line":121,"address":[25347823,25347885],"length":1,"stats":{"Line":0}},{"line":122,"address":[25347891,25347970],"length":1,"stats":{"Line":0}},{"line":128,"address":[25348083],"length":1,"stats":{"Line":0}},{"line":129,"address":[25348269,25348115,25348186],"length":1,"stats":{"Line":0}},{"line":130,"address":[25348301],"length":1,"stats":{"Line":0}},{"line":131,"address":[25348309],"length":1,"stats":{"Line":0}},{"line":132,"address":[25348328,25348419],"length":1,"stats":{"Line":0}},{"line":133,"address":[25348732,25348605],"length":1,"stats":{"Line":0}},{"line":136,"address":[25348844,25348770],"length":1,"stats":{"Line":0}},{"line":137,"address":[25348896],"length":1,"stats":{"Line":0}},{"line":138,"address":[25350084],"length":1,"stats":{"Line":0}},{"line":139,"address":[25348904,25349939,25350096],"length":1,"stats":{"Line":0}},{"line":143,"address":[25348813],"length":1,"stats":{"Line":0}},{"line":145,"address":[25349079,25348947],"length":1,"stats":{"Line":0}},{"line":146,"address":[25349099,25349183,25349055],"length":1,"stats":{"Line":0}},{"line":148,"address":[25349256,25349171],"length":1,"stats":{"Line":0}},{"line":149,"address":[25349292],"length":1,"stats":{"Line":0}},{"line":154,"address":[25349893,25349217,25349419,25349312],"length":1,"stats":{"Line":0}},{"line":158,"address":[25349508],"length":1,"stats":{"Line":0}},{"line":162,"address":[25349736,25349798],"length":1,"stats":{"Line":0}},{"line":163,"address":[25349883,25349804],"length":1,"stats":{"Line":0}},{"line":171,"address":[25350174],"length":1,"stats":{"Line":0}},{"line":172,"address":[25350206,25350277,25350360],"length":1,"stats":{"Line":0}},{"line":173,"address":[25350392],"length":1,"stats":{"Line":0}},{"line":174,"address":[25350499,25350408],"length":1,"stats":{"Line":0}},{"line":175,"address":[25350685,25350812],"length":1,"stats":{"Line":0}},{"line":178,"address":[25350828],"length":1,"stats":{"Line":0}},{"line":179,"address":[25350886],"length":1,"stats":{"Line":0}},{"line":182,"address":[25350911,25350874],"length":1,"stats":{"Line":0}},{"line":183,"address":[25350957],"length":1,"stats":{"Line":0}},{"line":188,"address":[25351019,25350899],"length":1,"stats":{"Line":0}},{"line":190,"address":[25351125],"length":1,"stats":{"Line":0}},{"line":191,"address":[25351286],"length":1,"stats":{"Line":0}},{"line":196,"address":[25351344,25350970],"length":1,"stats":{"Line":0}},{"line":197,"address":[25351416],"length":1,"stats":{"Line":0}},{"line":198,"address":[25351578],"length":1,"stats":{"Line":0}},{"line":199,"address":[25351715],"length":1,"stats":{"Line":0}},{"line":207,"address":[25351823],"length":1,"stats":{"Line":0}},{"line":208,"address":[25351855,25352009,25351926],"length":1,"stats":{"Line":0}},{"line":209,"address":[25352049,25352132,25352214],"length":1,"stats":{"Line":0}},{"line":210,"address":[25352246,25352337],"length":1,"stats":{"Line":0}},{"line":211,"address":[25352473,25352427],"length":1,"stats":{"Line":0}},{"line":213,"address":[25352434,25352537],"length":1,"stats":{"Line":0}},{"line":214,"address":[25352656,25352627],"length":1,"stats":{"Line":0}},{"line":220,"address":[25352948],"length":1,"stats":{"Line":0}},{"line":221,"address":[25353134,25353051,25352980],"length":1,"stats":{"Line":0}},{"line":222,"address":[25353166],"length":1,"stats":{"Line":0}},{"line":223,"address":[25353273,25353182],"length":1,"stats":{"Line":0}},{"line":224,"address":[25353586,25353459],"length":1,"stats":{"Line":0}},{"line":226,"address":[25353602],"length":1,"stats":{"Line":0}},{"line":227,"address":[25353681],"length":1,"stats":{"Line":0}},{"line":230,"address":[25353648,25353701],"length":1,"stats":{"Line":0}},{"line":231,"address":[25353722],"length":1,"stats":{"Line":0}},{"line":235,"address":[25353707],"length":1,"stats":{"Line":0}},{"line":236,"address":[25353735],"length":1,"stats":{"Line":0}},{"line":237,"address":[25353797],"length":1,"stats":{"Line":0}},{"line":239,"address":[25353985,25353859],"length":1,"stats":{"Line":0}},{"line":242,"address":[25354023],"length":1,"stats":{"Line":0}},{"line":243,"address":[25354070],"length":1,"stats":{"Line":0}},{"line":250,"address":[25354178],"length":1,"stats":{"Line":0}},{"line":251,"address":[25354281,25354210,25354364],"length":1,"stats":{"Line":0}},{"line":252,"address":[25354495,25354404],"length":1,"stats":{"Line":0}},{"line":253,"address":[25354681,25354808],"length":1,"stats":{"Line":0}},{"line":256,"address":[25354846,25354981],"length":1,"stats":{"Line":0}},{"line":257,"address":[25354951,25354997],"length":1,"stats":{"Line":0}},{"line":258,"address":[25355043],"length":1,"stats":{"Line":0}},{"line":259,"address":[25355167],"length":1,"stats":{"Line":0}},{"line":260,"address":[25355283],"length":1,"stats":{"Line":0}},{"line":261,"address":[25355300],"length":1,"stats":{"Line":0}},{"line":263,"address":[25355439],"length":1,"stats":{"Line":0}},{"line":264,"address":[25355602],"length":1,"stats":{"Line":0}},{"line":274,"address":[25355710],"length":1,"stats":{"Line":0}},{"line":275,"address":[25355742,25355813,25355896],"length":1,"stats":{"Line":0}},{"line":276,"address":[25356027,25355936],"length":1,"stats":{"Line":0}},{"line":277,"address":[25356213,25356340],"length":1,"stats":{"Line":0}},{"line":280,"address":[25356486,25356372],"length":1,"stats":{"Line":0}},{"line":281,"address":[25356505,25356456],"length":1,"stats":{"Line":0}},{"line":282,"address":[25356570],"length":1,"stats":{"Line":0}},{"line":283,"address":[25356666],"length":1,"stats":{"Line":0}},{"line":284,"address":[25356680],"length":1,"stats":{"Line":0}},{"line":285,"address":[25356792],"length":1,"stats":{"Line":0}},{"line":286,"address":[25356943],"length":1,"stats":{"Line":0}},{"line":295,"address":[25357043],"length":1,"stats":{"Line":0}},{"line":299,"address":[25363687,25363712,25361648],"length":1,"stats":{"Line":0}},{"line":305,"address":[25361735],"length":1,"stats":{"Line":0}},{"line":306,"address":[25361870],"length":1,"stats":{"Line":0}},{"line":307,"address":[25361798],"length":1,"stats":{"Line":0}},{"line":308,"address":[25361829],"length":1,"stats":{"Line":0}},{"line":313,"address":[25362073],"length":1,"stats":{"Line":0}},{"line":314,"address":[25362300,25362222],"length":1,"stats":{"Line":0}},{"line":317,"address":[25362345,25362428],"length":1,"stats":{"Line":0}},{"line":318,"address":[25362612,25362543],"length":1,"stats":{"Line":0}},{"line":319,"address":[25362659],"length":1,"stats":{"Line":0}},{"line":321,"address":[25362566],"length":1,"stats":{"Line":0}},{"line":325,"address":[25363106],"length":1,"stats":{"Line":0}},{"line":326,"address":[25363300,25363251],"length":1,"stats":{"Line":0}},{"line":327,"address":[25363401,25363458],"length":1,"stats":{"Line":0}},{"line":329,"address":[25363428],"length":1,"stats":{"Line":0}},{"line":334,"address":[25362245],"length":1,"stats":{"Line":0}},{"line":337,"address":[25359103,25357296,25359109],"length":1,"stats":{"Line":0}},{"line":338,"address":[25357338],"length":1,"stats":{"Line":0}},{"line":341,"address":[25357517],"length":1,"stats":{"Line":0}},{"line":359,"address":[25357895],"length":1,"stats":{"Line":0}},{"line":369,"address":[25358057],"length":1,"stats":{"Line":0}},{"line":378,"address":[25358192],"length":1,"stats":{"Line":0}},{"line":388,"address":[25358354],"length":1,"stats":{"Line":0}},{"line":398,"address":[25311134,25311120],"length":1,"stats":{"Line":0}},{"line":399,"address":[25310974,25310960],"length":1,"stats":{"Line":0}},{"line":400,"address":[25311200,25311214],"length":1,"stats":{"Line":0}},{"line":401,"address":[25310894,25310880],"length":1,"stats":{"Line":0}},{"line":402,"address":[25311040,25311054],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":161},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","git.rs"],"content":"//! Git operations for --staged flag support\n//!\n//! This module provides functions to interact with git repositories\n//! and get information about staged files.\n\nuse git2::{Repository, Status, StatusOptions, StatusShow};\nuse miette::Result;\nuse std::path::{Path, PathBuf};\n\n/// Check if the given path is inside a git repository\npub fn is_git_repo(path: \u0026Path) -\u003e bool {\n    Repository::discover(path).is_ok()\n}\n\n/// Get all staged files in the repository\n/// Returns a list of absolute paths to staged files\npub fn get_staged_files(repo_path: \u0026Path) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e {\n    let repo = Repository::discover(repo_path)\n        .map_err(|e| miette::miette!(\"No se encontró repositorio git: {}\", e))?;\n\n    let workdir = repo\n        .workdir()\n        .ok_or_else(|| miette::miette!(\"El repositorio no tiene directorio de trabajo\"))?;\n\n    let mut opts = StatusOptions::new();\n    opts.include_untracked(false)\n        .include_ignored(false)\n        .include_unmodified(false)\n        .show(StatusShow::Index); // Only staged files\n\n    let statuses = repo\n        .statuses(Some(\u0026mut opts))\n        .map_err(|e| miette::miette!(\"Error al obtener estados de git: {}\", e))?;\n\n    let staged_files: Vec\u003cPathBuf\u003e = statuses\n        .iter()\n        .filter(|entry| {\n            let status = entry.status();\n            // Include files that are staged (added, modified, renamed, etc.)\n            status.contains(Status::INDEX_NEW)\n                || status.contains(Status::INDEX_MODIFIED)\n                || status.contains(Status::INDEX_RENAMED)\n                || status.contains(Status::INDEX_TYPECHANGE)\n        })\n        .filter_map(|entry| {\n            let path = entry.path()?;\n            let full_path = workdir.join(path);\n            // Only include existing files\n            if full_path.exists() {\n                Some(full_path)\n            } else {\n                None\n            }\n        })\n        .collect();\n\n    Ok(staged_files)\n}\n\n/// Filter files to only include those that are staged\npub fn filter_staged_files(all_files: \u0026[PathBuf], repo_path: \u0026Path) -\u003e Result\u003cVec\u003cPathBuf\u003e\u003e {\n    let staged = get_staged_files(repo_path)?;\n    let staged_set: std::collections::HashSet\u003c_\u003e = staged.iter().collect();\n\n    Ok(all_files\n        .iter()\n        .filter(|f| staged_set.contains(f))\n        .cloned()\n        .collect())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_is_git_repo() {\n        // This test depends on running from within a git repo\n        if let Ok(current_dir) = std::env::current_dir() {\n            // Just verify the function doesn't panic\n            let _ = is_git_repo(\u0026current_dir);\n        }\n    }\n}\n","traces":[{"line":19,"address":[24265327,24265312],"length":1,"stats":{"Line":0}},{"line":23,"address":[24265223,24265216],"length":1,"stats":{"Line":0}},{"line":33,"address":[24265744,24265759],"length":1,"stats":{"Line":0}},{"line":37,"address":[24265600],"length":1,"stats":{"Line":0}},{"line":38,"address":[24265627],"length":1,"stats":{"Line":0}},{"line":40,"address":[24265637,24265677],"length":1,"stats":{"Line":0}},{"line":41,"address":[24265656],"length":1,"stats":{"Line":0}},{"line":42,"address":[24265684],"length":1,"stats":{"Line":0}},{"line":43,"address":[24265703],"length":1,"stats":{"Line":0}},{"line":45,"address":[24266446,24266032,24266452],"length":1,"stats":{"Line":0}},{"line":46,"address":[24266067],"length":1,"stats":{"Line":0}},{"line":47,"address":[24266183],"length":1,"stats":{"Line":0}},{"line":49,"address":[24266222,24266290,24266329],"length":1,"stats":{"Line":0}},{"line":50,"address":[24266336],"length":1,"stats":{"Line":0}},{"line":52,"address":[24266316],"length":1,"stats":{"Line":0}},{"line":67,"address":[24266480,24266494],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":16},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","git_changes.rs"],"content":"use git2::{Error, Repository};\nuse std::path::{Path, PathBuf};\n\n/// Get list of files changed since last commit\npub fn get_changed_files(repo_path: \u0026Path) -\u003e Result\u003cVec\u003cPathBuf\u003e, Error\u003e {\n    let repo = Repository::discover(repo_path)?;\n\n    // Get HEAD commit\n    let head = repo\n        .head()?\n        .target()\n        .ok_or_else(|| Error::from_str(\"No HEAD commit\"))?;\n\n    let head_commit = repo.find_commit(head)?;\n    let head_tree = head_commit.tree()?;\n\n    // Get parent commit (if exists)\n    let changed_files = if head_commit.parent_count() \u003e 0 {\n        let parent = head_commit.parent(0)?;\n        let parent_tree = parent.tree()?;\n\n        // Diff parent vs HEAD\n        let diff = repo.diff_tree_to_tree(Some(\u0026parent_tree), Some(\u0026head_tree), None)?;\n\n        collect_diff_files(\u0026diff, \u0026repo)\n    } else {\n        // First commit, all files are \"changed\"\n        collect_all_files(\u0026head_tree, \u0026repo)\n    };\n\n    Ok(changed_files)\n}\n\nfn collect_diff_files(diff: \u0026git2::Diff, repo: \u0026Repository) -\u003e Vec\u003cPathBuf\u003e {\n    let mut files = Vec::new();\n    let workdir = repo.workdir().unwrap_or(Path::new(\".\"));\n\n    let _ = diff.foreach(\n        \u0026mut |delta, _| {\n            if let Some(path) = delta.new_file().path() {\n                if is_typescript_file(path) {\n                    files.push(workdir.join(path));\n                }\n            }\n            true\n        },\n        None,\n        None,\n        None,\n    );\n\n    files\n}\n\nfn collect_all_files(tree: \u0026git2::Tree, repo: \u0026Repository) -\u003e Vec\u003cPathBuf\u003e {\n    let mut files = Vec::new();\n    let workdir = repo.workdir().unwrap_or(Path::new(\".\"));\n\n    let _ = tree.walk(git2::TreeWalkMode::PreOrder, |root, entry| {\n        if let Some(name) = entry.name() {\n            let path = Path::new(name);\n            if is_typescript_file(path) {\n                files.push(workdir.join(root).join(name));\n            }\n        }\n        git2::TreeWalkResult::Ok\n    });\n\n    files\n}\n\nfn is_typescript_file(path: \u0026Path) -\u003e bool {\n    path.extension()\n        .and_then(|s| s.to_str())\n        .map(|s| s == \"ts\" || s == \"tsx\" || s == \"js\" || s == \"jsx\")\n        .unwrap_or(false)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use std::path::PathBuf;\n\n    #[test]\n    fn test_git_detection_in_crate() {\n        let repo_path = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n        let result = get_changed_files(\u0026repo_path);\n        assert!(result.is_ok());\n    }\n}\n","traces":[{"line":5,"address":[25318848,25321301,25321177],"length":1,"stats":{"Line":0}},{"line":6,"address":[25318881],"length":1,"stats":{"Line":0}},{"line":9,"address":[25319397,25319214,25321299,25319472,25319119],"length":1,"stats":{"Line":0}},{"line":12,"address":[25318060,25318048],"length":1,"stats":{"Line":0}},{"line":14,"address":[25319579,25321278],"length":1,"stats":{"Line":0}},{"line":15,"address":[25321263,25319892,25319821],"length":1,"stats":{"Line":0}},{"line":18,"address":[25320072,25320145],"length":1,"stats":{"Line":0}},{"line":19,"address":[25320302,25320179,25321242],"length":1,"stats":{"Line":0}},{"line":20,"address":[25320553,25320482,25321221],"length":1,"stats":{"Line":0}},{"line":23,"address":[25320733,25320822],"length":1,"stats":{"Line":0}},{"line":25,"address":[25321023],"length":1,"stats":{"Line":0}},{"line":28,"address":[25320210,25320172],"length":1,"stats":{"Line":0}},{"line":31,"address":[25320217],"length":1,"stats":{"Line":0}},{"line":34,"address":[25321744,25321328,25321750],"length":1,"stats":{"Line":0}},{"line":35,"address":[25321371],"length":1,"stats":{"Line":0}},{"line":36,"address":[25321478,25321393],"length":1,"stats":{"Line":0}},{"line":38,"address":[25321615],"length":1,"stats":{"Line":0}},{"line":39,"address":[25318096],"length":1,"stats":{"Line":0}},{"line":40,"address":[25318121],"length":1,"stats":{"Line":0}},{"line":41,"address":[25318216],"length":1,"stats":{"Line":0}},{"line":42,"address":[25318249],"length":1,"stats":{"Line":0}},{"line":52,"address":[25321701],"length":1,"stats":{"Line":0}},{"line":55,"address":[25318832,25318464,25318826],"length":1,"stats":{"Line":0}},{"line":56,"address":[25318507],"length":1,"stats":{"Line":0}},{"line":57,"address":[25318526,25318608],"length":1,"stats":{"Line":0}},{"line":59,"address":[25317632,25318018,25318024],"length":1,"stats":{"Line":0}},{"line":60,"address":[25317699],"length":1,"stats":{"Line":0}},{"line":61,"address":[25317779],"length":1,"stats":{"Line":0}},{"line":62,"address":[25317807],"length":1,"stats":{"Line":0}},{"line":63,"address":[25317841],"length":1,"stats":{"Line":0}},{"line":69,"address":[25318792],"length":1,"stats":{"Line":0}},{"line":72,"address":[25321776],"length":1,"stats":{"Line":0}},{"line":73,"address":[25321790],"length":1,"stats":{"Line":0}},{"line":74,"address":[25318318,25318304],"length":1,"stats":{"Line":0}},{"line":75,"address":[25318336,25318349],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":35},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","lib.rs"],"content":"// Library exports for testing and potential programmatic use\n//\n// This module exposes the internal modules publicly so they can be tested\n// and potentially used as a library.\n\npub mod ai;\n// Note: main module is only available in binary context\n// Functions from main are re-exported individually for testing\npub mod analysis_result;\npub mod analyzer;\npub mod autofix;\npub mod cache;\npub mod circular;\npub mod cli;\npub mod config;\npub mod detector;\npub mod discovery;\npub mod git;\npub mod git_changes;\npub mod memory_cache;\npub mod metrics;\npub mod notification;\npub mod output;\npub mod parsers;\npub mod report;\npub mod scoring;\npub mod ui;\npub mod watch;\n\n// Re-export commonly used types for convenience\npub use analysis_result::AnalysisResult;\npub use circular::CircularDependency;\npub use config::ArchPattern;\npub use metrics::{\n    ComplexityStats, HealthGrade, HealthScore, LayerStats, PerformanceMetrics, ScoreComponents,\n};\npub use scoring::{apply_severity_multiplier, calculate_health_score, Violation, ViolationType};\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","main.rs"],"content":"use indicatif::{ProgressBar, ProgressStyle};\nuse miette::{GraphicalReportHandler, IntoDiagnostic, Result};\nuse std::path::{Path, PathBuf};\nuse std::sync::{Arc, Mutex};\nuse swc_common::SourceMap;\n\nmod ai;\nmod analysis_result;\nmod analyzer;\nmod autofix;\nmod cache;\nmod circular;\nmod cli;\nmod config;\nmod detector;\nmod discovery;\nmod git;\nmod git_changes;\nmod memory_cache;\nmod metrics;\nmod notification;\nmod output;\nmod parsers;\nmod report;\nmod scoring;\nmod ui;\nmod watch;\n\n#[cfg(unix)]\nfn run_as_daemon(project_root: \u0026std::path::Path) -\u003e Result\u003c()\u003e {\n    use daemonize::Daemonize;\n    use std::fs::File;\n\n    let stdout = File::create(\"/tmp/architect-linter.out\").into_diagnostic()?;\n    let stderr = File::create(\"/tmp/architect-linter.err\").into_diagnostic()?;\n\n    let daemonize = Daemonize::new()\n        .pid_file(\"/tmp/architect-linter.pid\")\n        .umask(0o027)\n        .working_directory(project_root)\n        .stdout(stdout)\n        .stderr(stderr)\n        .privileged_action(|| {\n            println!(\"Architect Linter Pro running in background...\");\n        });\n\n    daemonize\n        .start()\n        .map_err(|e| miette::miette!(\"Failed to daemonize: {}\", e))?;\n    Ok(())\n}\n\n/// Analyzes only changed files since last commit (incremental analysis)\n/// This function is defined in main.rs to avoid circular import issues\npub fn analyze_changed_files(\n    project_root: \u0026Path,\n    analysis_cache: Option\u003c\u0026mut cache::AnalysisCache\u003e,\n) -\u003e Result\u003canalysis_result::AnalysisResult\u003e {\n    // Use the collector function but we need to handle the circular dependency\n    // So we'll implement the logic directly here\n    let changed_files = match git_changes::get_changed_files(project_root) {\n        Ok(files) =\u003e files,\n        Err(e) =\u003e {\n            return Err(miette::miette!(\n                \"Failed to get changed files from git: {}\",\n                e\n            ));\n        }\n    };\n\n    if changed_files.is_empty() {\n        println!(\"✅ No changed files detected\");\n        println!(\"   Incremental analysis completed (no changes to analyze)\");\n\n        // Return empty analysis result\n        let project_name = project_root\n            .file_name()\n            .and_then(|n| n.to_str())\n            .unwrap_or(\"project\")\n            .to_string();\n\n        let config = config::load_config(project_root)\n            .map_err(|e| miette::miette!(\"Failed to load config: {}\", e))?;\n\n        let mut result = analysis_result::AnalysisResult::new(project_name, config.pattern);\n        result.files_analyzed = 0;\n        result.complexity_stats = metrics::ComplexityStats {\n            total_functions: 0,\n            long_functions: 0,\n            max_lines_threshold: config.max_lines,\n        };\n\n        return Ok(result);\n    }\n\n    println!(\"🔍 Found {} changed files to analyze\", changed_files.len());\n\n    // Load config\n    let config = config::load_config(project_root)\n        .map_err(|e| miette::miette!(\"Failed to load config: {}\", e))?;\n\n    let linter_context: config::LinterContext = config;\n    let cm = Arc::new(SourceMap::default());\n\n    // Analyze only changed files\n    analyzer::analyze_all_files(\n        \u0026changed_files,\n        project_root,\n        linter_context.pattern.clone(),\n        \u0026linter_context,\n        \u0026cm,\n        analysis_cache,\n    )\n}\n\nfn main() -\u003e Result\u003c()\u003e {\n    // 1. Procesar argumentos de línea de comandos\n    let cli_args = match cli::process_args() {\n        Some(args) =\u003e args,\n        None =\u003e return Ok(()), // Se procesó --help o --version\n    };\n\n    ui::print_banner();\n\n    // 2. Obtener la ruta del proyecto\n    let project_root = if let Some(ref path) = cli_args.project_path {\n        PathBuf::from(path).canonicalize().into_diagnostic()?\n    } else {\n        ui::get_interactive_path()?\n    };\n\n    // 3. Cargar o crear configuración asistida por IA\n    let ctx = Arc::new(config::setup_or_load_config(\u0026project_root)?);\n\n    let no_cache = cli_args.no_cache;\n\n    // 3.5 Check for daemon mode\n    if cli_args.daemon_mode {\n        #[cfg(unix)]\n        {\n            println!(\"🚀 Entrando en modo daemon. Revisa /tmp/architect-linter.err para errores.\");\n            run_as_daemon(\u0026project_root)?;\n        }\n        #[cfg(windows)]\n        {\n            println!(\n                \"⚠️  Modo daemon nativo no soportado aún en Windows. Corriendo en modo normal.\"\n            );\n        }\n    }\n\n    // 4. Decidir entre modo normal, watch o fix\n    if cli_args.fix_mode {\n        run_fix_mode(\u0026project_root, Arc::clone(\u0026ctx))?;\n    } else if cli_args.watch_mode {\n        run_watch_mode(\u0026project_root, Arc::clone(\u0026ctx), no_cache)?;\n    } else if cli_args.incremental_mode {\n        run_incremental_mode(\u0026project_root, Arc::clone(\u0026ctx), \u0026cli_args)?;\n    } else {\n        run_normal_mode(\u0026project_root, Arc::clone(\u0026ctx), \u0026cli_args)?;\n    }\n\n    Ok(())\n}\n\n/// Ejecuta el análisis en modo normal (una sola vez)\nfn run_normal_mode(\n    project_root: \u0026Path,\n    ctx: Arc\u003cconfig::LinterContext\u003e,\n    cli_args: \u0026cli::CliArgs,\n) -\u003e Result\u003c()\u003e {\n    // Recolectar archivos de todos los lenguajes soportados\n    let mut files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n\n    // Filter to staged files if --staged flag is set\n    if cli_args.staged_mode {\n        if !git::is_git_repo(project_root) {\n            return Err(miette::miette!(\n                \"El flag --staged requiere un repositorio git.\"\n            ));\n        }\n        files = git::filter_staged_files(\u0026files, project_root)?;\n        if files.is_empty() {\n            println!(\"✅ No hay archivos staged para analizar.\");\n            return Ok(());\n        }\n        println!(\"🔍 Analizando {} archivos staged...\", files.len());\n    }\n\n    // Mostrar información de directorios ignorados\n    if !ctx.ignored_paths.is_empty() \u0026\u0026 !cli_args.staged_mode {\n        println!(\"📂 Ignorando directorios: {}\", ctx.ignored_paths.join(\", \"));\n    }\n\n    if files.is_empty() {\n        println!(\"✅ No se encontraron archivos para analizar (TypeScript, JavaScript, Python, Go, PHP, Java).\");\n        return Ok(());\n    }\n\n    // Barra de progreso y Análisis Paralelo con Rayon\n    let pb = ProgressBar::new(files.len() as u64);\n    pb.set_style(\n        ProgressStyle::default_bar()\n            .template(\"{spinner:.green} [{bar:40.cyan/blue}] {pos}/{len} {msg}\")\n            .into_diagnostic()?,\n    );\n    pb.set_message(\"Analyzing...\");\n\n    let cm = Arc::new(SourceMap::default());\n\n    // Load or create analysis cache\n    let use_cache = !cli_args.no_cache;\n    let config_hash = cache::hash_config(\u0026ctx);\n    let mut analysis_cache = if use_cache {\n        cache::AnalysisCache::load(project_root, \u0026config_hash)\n            .unwrap_or_else(|| cache::AnalysisCache::new(config_hash.clone()))\n    } else {\n        cache::AnalysisCache::new(config_hash.clone())\n    };\n\n    // v4.0: Use aggregated analysis for scoring\n    let mut analysis_result = analyzer::analyze_all_files(\n        \u0026files,\n        project_root,\n        ctx.pattern.clone(),\n        \u0026ctx,\n        \u0026cm,\n        if use_cache {\n            Some(\u0026mut analysis_cache)\n        } else {\n            None\n        },\n    )?;\n\n    // Save cache to disk\n    if use_cache {\n        if let Err(e) = analysis_cache.save(project_root) {\n            eprintln!(\"⚠️  Could not save analysis cache: {}\", e);\n        }\n    }\n\n    // Análisis de Dependencias Cíclicas\n    pb.set_message(\"Checking circular deps...\");\n    let cycles = circular::analyze_circular_dependencies(\u0026files, project_root, \u0026cm);\n\n    match cycles {\n        Ok(detected_cycles) =\u003e {\n            for cycle in \u0026detected_cycles {\n                analysis_result.add_circular_dependency(cycle.clone());\n            }\n        }\n        Err(e) =\u003e {\n            eprintln!(\"⚠️  No se pudo analizar dependencias cíclicas: {}\", e);\n        }\n    }\n\n    pb.finish_and_clear();\n\n    // Calculate health score\n    let health_score = scoring::calculate(\u0026analysis_result);\n    analysis_result.health_score = Some(health_score.clone());\n\n    // Handle report export if requested\n    if let Some(format) = cli_args.report_format {\n        let report_content = report::generate_report(\u0026analysis_result, format);\n\n        if let Some(output_path) = \u0026cli_args.output_path {\n            let path = std::path::Path::new(output_path);\n            report::write_report(\u0026report_content, path)?;\n            println!(\"📄 Report saved to: {}\", output_path);\n        } else {\n            report::write_stdout(\u0026report_content)?;\n        }\n\n        // Exit with appropriate code\n        if analysis_result.has_critical_issues() {\n            std::process::exit(1);\n        }\n        return Ok(());\n    }\n\n    // Print dashboard\n    output::print_dashboard(\u0026analysis_result);\n\n    // Print summary\n    output::dashboard::print_summary(\u0026analysis_result);\n\n    // Print circular dependency details if any\n    if !analysis_result.circular_dependencies.is_empty() {\n        println!();\n        circular::print_circular_dependency_report(\u0026analysis_result.circular_dependencies);\n    }\n\n    // Exit with appropriate code\n    if analysis_result.has_critical_issues() {\n        std::process::exit(1);\n    } else {\n        std::process::exit(0);\n    }\n}\n\n/// Run a full analysis and return the AnalysisResult (reused by watch commands)\nfn run_full_analysis(\n    project_root: \u0026Path,\n    ctx: \u0026config::LinterContext,\n    analysis_cache: Option\u003c\u0026mut cache::AnalysisCache\u003e,\n) -\u003e Result\u003canalysis_result::AnalysisResult\u003e {\n    let files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n    let cm = Arc::new(SourceMap::default());\n\n    let mut analysis_result = analyzer::analyze_all_files(\n        \u0026files,\n        project_root,\n        ctx.pattern.clone(),\n        ctx,\n        \u0026cm,\n        analysis_cache,\n    )?;\n\n    // Circular dependencies\n    match circular::analyze_circular_dependencies(\u0026files, project_root, \u0026cm) {\n        Ok(detected_cycles) =\u003e {\n            for cycle in \u0026detected_cycles {\n                analysis_result.add_circular_dependency(cycle.clone());\n            }\n        }\n        Err(e) =\u003e {\n            eprintln!(\"⚠️  No se pudo analizar dependencias cíclicas: {}\", e);\n        }\n    }\n\n    // Health score\n    let health_score = scoring::calculate(\u0026analysis_result);\n    analysis_result.health_score = Some(health_score);\n\n    Ok(analysis_result)\n}\n\n/// Run the AI auto-fix flow (reused by watch commands)\nfn run_fix_flow(project_root: \u0026Path, ctx: \u0026config::LinterContext) -\u003e Result\u003c()\u003e {\n    use dialoguer::Confirm;\n\n    if ctx.ai_configs.is_empty() {\n        println!(\"⚠️  No se encontró configuración de IA (.architect.ai.json).\");\n        println!(\"   El modo fix requiere configuración de IA para funcionar.\");\n        return Ok(());\n    }\n\n    let files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n    if files.is_empty() {\n        println!(\"✅ No se encontraron archivos para analizar.\");\n        return Ok(());\n    }\n\n    println!(\"📊 Analizando {} archivos...\\n\", files.len());\n\n    let cm = Arc::new(SourceMap::default());\n    let mut all_violations = Vec::new();\n\n    for file_path in \u0026files {\n        match analyzer::collect_violations_from_file(\u0026cm, file_path, ctx) {\n            Ok(violations) =\u003e all_violations.extend(violations),\n            Err(e) =\u003e eprintln!(\"⚠️  Error analizando {}: {}\", file_path.display(), e),\n        }\n    }\n\n    if all_violations.is_empty() {\n        println!(\"✨ ¡No se encontraron violaciones! Tu código está perfecto.\");\n        return Ok(());\n    }\n\n    println!(\n        \"🔍 Encontradas {} violación(es) arquitectónicas\\n\",\n        all_violations.len()\n    );\n\n    let mut fixed_count = 0;\n    let mut skipped_count = 0;\n\n    for (index, violation) in all_violations.iter().enumerate() {\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n        println!(\"Violación #{}/{}\", index + 1, all_violations.len());\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n        println!(\"📄 Archivo: {}\", violation.file_path.display());\n        println!(\"📍 Línea: {}\", violation.line_number);\n        println!(\n            \"🚫 Regla violada: '{}' no puede importar de '{}'\",\n            violation.rule.from, violation.rule.to\n        );\n        println!(\"💥 Import ofensivo: {}\", violation.offensive_import);\n        println!();\n\n        println!(\"🤖 Consultando sugerencia de fix (usando sistema de fallback multimodelo)...\");\n\n        let runtime = tokio::runtime::Runtime::new().into_diagnostic()?;\n        let suggestion = match runtime.block_on(autofix::suggest_fix(\n            violation,\n            project_root,\n            \u0026ctx.ai_configs,\n        )) {\n            Ok(s) =\u003e s,\n            Err(_e) =\u003e {\n                eprintln!(\"❌ No se pudo obtener ninguna sugerencia de los modelos configurados.\");\n                println!(\"⏭️  Saltando esta violación...\\n\");\n                skipped_count += 1;\n                continue;\n            }\n        };\n\n        println!();\n        println!(\n            \"💡 Sugerencia de la IA (confianza: {}):\",\n            suggestion.confidence\n        );\n        println!(\"{}\", suggestion.explanation);\n        println!();\n\n        match \u0026suggestion.fix_type {\n            autofix::FixType::Refactor { old_code, new_code } =\u003e {\n                println!(\"📝 Tipo: Refactorización de código\");\n                println!(\"Cambiar:\");\n                println!(\"  ❌ {}\", old_code);\n                println!(\"Por:\");\n                println!(\"  ✅ {}\", new_code);\n            }\n            autofix::FixType::MoveFile { from, to } =\u003e {\n                println!(\"📦 Tipo: Mover archivo\");\n                println!(\"  De: {}\", from);\n                println!(\"  A:  {}\", to);\n            }\n            autofix::FixType::CreateInterface {\n                interface_path,\n                interface_code,\n                updated_import,\n            } =\u003e {\n                println!(\"🎯 Tipo: Crear interfaz\");\n                println!(\"  Nueva interfaz: {}\", interface_path);\n                println!(\"  Código: {} líneas\", interface_code.lines().count());\n                println!(\"  Nuevo import: {}\", updated_import);\n            }\n        }\n\n        println!();\n\n        let should_apply = Confirm::new()\n            .with_prompt(\"¿Aplicar este fix?\")\n            .default(false)\n            .interact()\n            .into_diagnostic()?;\n\n        if should_apply {\n            match autofix::apply_fix(\u0026suggestion, violation, project_root) {\n                Ok(message) =\u003e {\n                    println!(\"{}\", message);\n                    fixed_count += 1;\n                }\n                Err(e) =\u003e {\n                    eprintln!(\"❌ Error aplicando fix: {}\", e);\n                    skipped_count += 1;\n                }\n            }\n        } else {\n            println!(\"⏭️  Fix omitido\");\n            skipped_count += 1;\n        }\n\n        println!();\n    }\n\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"📊 RESUMEN\");\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"✅ Fixes aplicados: {}\", fixed_count);\n    println!(\"⏭️  Omitidos: {}\", skipped_count);\n    println!(\"📝 Total violaciones: {}\", all_violations.len());\n    println!();\n\n    if fixed_count \u003e 0 {\n        println!(\"🎉 ¡Se aplicaron {} fix(es) exitosamente!\", fixed_count);\n        println!(\"💡 Tip: Ejecuta el linter nuevamente para verificar que todo esté correcto.\");\n    }\n\n    Ok(())\n}\n\n/// Ejecuta el análisis en modo watch (observación continua e interactiva)\nfn run_watch_mode(\n    project_root: \u0026Path,\n    ctx: Arc\u003cconfig::LinterContext\u003e,\n    no_cache: bool,\n) -\u003e Result\u003c()\u003e {\n    let project_name_notification = Arc::new(\n        project_root\n            .file_name()\n            .map(|n| n.to_string_lossy().into_owned())\n            .unwrap_or_else(|| \"project\".to_string()),\n    );\n\n    println!(\"🚀 Iniciando modo watch...\\n\");\n\n    // Análisis inicial completo\n    let files = discovery::collect_files(project_root, \u0026ctx.ignored_paths);\n\n    if !ctx.ignored_paths.is_empty() {\n        println!(\"📂 Ignorando directorios: {}\", ctx.ignored_paths.join(\", \"));\n    }\n\n    if files.is_empty() {\n        println!(\"✅ No se encontraron archivos para analizar (TypeScript, JavaScript, Python, Go, PHP, Java).\");\n        return Ok(());\n    }\n\n    println!(\"📊 Análisis inicial de {} archivos...\", files.len());\n    let cm = Arc::new(SourceMap::default());\n\n    // Construir grafo de dependencias inicial\n    let mut dep_analyzer = circular::CircularDependencyAnalyzer::new(project_root);\n    dep_analyzer.build_graph(\u0026files, \u0026cm)?;\n\n    // Análisis inicial de violaciones\n    let mut error_count = 0;\n    for file_path in \u0026files {\n        if let Err(e) = analyzer::analyze_file(\u0026cm, file_path, \u0026ctx) {\n            error_count += 1;\n            let mut out = String::new();\n            let _ = GraphicalReportHandler::new().render_report(\u0026mut out, e.as_ref());\n            println!(\"\\n📌 Violación en: {}\", file_path.display());\n            println!(\"{}\", out);\n        }\n    }\n\n    // Análisis de ciclos inicial\n    let cycles = dep_analyzer.detect_cycles();\n    if !cycles.is_empty() {\n        circular::print_circular_dependency_report(\u0026cycles);\n        println!(\n            \"\\n⚠️  Se encontraron {} dependencias cíclicas.\",\n            cycles.len()\n        );\n    }\n\n    if error_count \u003e 0 {\n        println!(\n            \"\\n❌ Se encontraron {} violaciones arquitectónicas.\",\n            error_count\n        );\n    } else {\n        println!(\"\\n✨ ¡Proyecto impecable! La arquitectura se respeta.\");\n    }\n\n    println!();\n\n    // Initialize analysis cache for watch session\n    let config_hash = cache::hash_config(\u0026ctx);\n    let watch_cache: Arc\u003cMutex\u003cOption\u003ccache::AnalysisCache\u003e\u003e\u003e = if no_cache {\n        Arc::new(Mutex::new(None))\n    } else {\n        let c = cache::AnalysisCache::load(project_root, \u0026config_hash)\n            .unwrap_or_else(|| cache::AnalysisCache::new(config_hash));\n        Arc::new(Mutex::new(Some(c)))\n    };\n\n    // Shared state for the watch loop\n    let dep_analyzer = Arc::new(Mutex::new(dep_analyzer));\n    let project_root_arc = Arc::new(project_root.to_path_buf());\n    let ignored_paths = ctx.ignored_paths.clone();\n\n    // Clone Arcs for the on_command closure\n    let cmd_ctx = Arc::clone(\u0026ctx);\n    let cmd_project_root = Arc::clone(\u0026project_root_arc);\n    let cmd_cache = Arc::clone(\u0026watch_cache);\n\n    let change_cache = Arc::clone(\u0026watch_cache);\n\n    watch::start_watch_mode(\n        project_root_arc.as_ref(),\n        ignored_paths,\n        // on_change: incremental analysis for file changes\n        |changed_files| {\n            let dep_analyzer = Arc::clone(\u0026dep_analyzer);\n            let ctx = Arc::clone(\u0026ctx);\n            let cm = Arc::clone(\u0026cm);\n            let project_root = Arc::clone(\u0026project_root_arc);\n            let change_cache = Arc::clone(\u0026change_cache);\n            let project_name_notification = Arc::clone(\u0026project_name_notification);\n\n            // Invalidate changed files in cache\n            {\n                let mut cache_guard = change_cache.lock().expect(\"Failed to lock mutex\");\n                if let Some(ref mut c) = *cache_guard {\n                    for file_path in changed_files {\n                        let key = cache::AnalysisCache::normalize_path(file_path, \u0026project_root);\n                        c.remove(\u0026key);\n                    }\n                }\n            }\n\n            let mut error_count = 0;\n            for file_path in changed_files {\n                if let Err(e) = analyzer::analyze_file(\u0026cm, file_path, \u0026ctx) {\n                    error_count += 1;\n                    let mut out = String::new();\n                    let _ = GraphicalReportHandler::new().render_report(\u0026mut out, e.as_ref());\n                    println!(\"\\n📌 Violación en: {}\", file_path.display());\n                    println!(\"{}\", out);\n                }\n\n                let mut dep_analyzer = dep_analyzer.lock().expect(\"Failed to lock mutex\");\n                if let Err(e) = dep_analyzer.update_file(file_path, \u0026cm) {\n                    eprintln!(\"⚠️  Error actualizando grafo: {}\", e);\n                    continue;\n                }\n\n                let normalized_path =\n                    if let Ok(relative) = file_path.strip_prefix(project_root.as_ref()) {\n                        relative.to_string_lossy().replace('\\\\', \"/\").to_lowercase()\n                    } else {\n                        file_path\n                            .to_string_lossy()\n                            .replace('\\\\', \"/\")\n                            .to_lowercase()\n                    };\n\n                let affected_nodes = dep_analyzer.get_affected_nodes(\u0026normalized_path);\n\n                if !affected_nodes.is_empty() {\n                    let cycles = dep_analyzer.detect_cycles_in_subgraph(\u0026affected_nodes);\n                    if !cycles.is_empty() {\n                        circular::print_circular_dependency_report(\u0026cycles);\n                        println!(\n                            \"\\n⚠️  Se encontraron {} dependencias cíclicas.\",\n                            cycles.len()\n                        );\n                        notification::send_cycle_alert(\u0026project_name_notification, cycles.len());\n                    }\n                }\n            }\n\n            if error_count \u003e 0 {\n                println!(\n                    \"\\n❌ Se encontraron {} violaciones arquitectónicas.\",\n                    error_count\n                );\n                notification::send_violation_alert(\u0026project_name_notification, error_count);\n            } else {\n                println!(\"\\n✨ Todo correcto!\");\n                notification::send_success_notification(\u0026project_name_notification);\n            }\n\n            Ok(())\n        },\n        // on_command: handle interactive commands\n        |cmd| {\n            let ctx = Arc::clone(\u0026cmd_ctx);\n            let project_root = cmd_project_root.as_ref();\n            let cmd_cache = Arc::clone(\u0026cmd_cache);\n\n            // Helper: run full analysis with cache, then save\n            let run_cached_analysis = |cache_arc: \u0026Arc\u003cMutex\u003cOption\u003ccache::AnalysisCache\u003e\u003e\u003e| -\u003e Result\u003canalysis_result::AnalysisResult\u003e {\n                let mut guard = cache_arc.lock().expect(\"Failed to lock mutex\");\n                let result = run_full_analysis(\n                    project_root,\n                    \u0026ctx,\n                    guard.as_mut(),\n                )?;\n                // Save cache after analysis\n                if let Some(ref c) = *guard {\n                    if let Err(e) = c.save(project_root) {\n                        eprintln!(\"⚠️  Could not save analysis cache: {}\", e);\n                    }\n                }\n                Ok(result)\n            };\n\n            match cmd {\n                watch::WatchCommand::Fix =\u003e {\n                    println!(\"\\n🔧 Ejecutando auto-fix con IA...\\n\");\n                    run_fix_flow(project_root, \u0026ctx)?;\n                }\n                watch::WatchCommand::ReportJson =\u003e {\n                    println!(\"\\n📄 Generando reporte JSON...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    let content = report::generate_report(\u0026result, cli::ReportFormat::Json);\n                    let path = project_root.join(\"report.json\");\n                    report::write_report(\u0026content, \u0026path)?;\n                    println!(\"📄 Reporte guardado en: {}\", path.display());\n                }\n                watch::WatchCommand::ReportMarkdown =\u003e {\n                    println!(\"\\n📄 Generando reporte Markdown...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    let content = report::generate_report(\u0026result, cli::ReportFormat::Markdown);\n                    let path = project_root.join(\"report.md\");\n                    report::write_report(\u0026content, \u0026path)?;\n                    println!(\"📄 Reporte guardado en: {}\", path.display());\n                }\n                watch::WatchCommand::FullAnalysis =\u003e {\n                    println!(\"\\n📊 Ejecutando análisis completo...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    output::print_dashboard(\u0026result);\n                    output::dashboard::print_summary(\u0026result);\n                    if !result.circular_dependencies.is_empty() {\n                        println!();\n                        circular::print_circular_dependency_report(\u0026result.circular_dependencies);\n                    }\n                }\n                watch::WatchCommand::Violations =\u003e {\n                    println!(\"\\n🔍 Escaneando todas las violaciones...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n\n                    if result.violations.is_empty() \u0026\u0026 result.circular_dependencies.is_empty() {\n                        println!(\"✨ ¡No se encontraron violaciones! La arquitectura se respeta.\");\n                    } else {\n                        // Violations\n                        if !result.violations.is_empty() {\n                            println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n                            println!(\n                                \"  🚫 {} violación(es) arquitectónicas\",\n                                result.violations.len()\n                            );\n                            println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n                            for (i, cv) in result.violations.iter().enumerate() {\n                                let icon = match cv.category {\n                                    analysis_result::ViolationCategory::Blocked =\u003e \"❌\",\n                                    analysis_result::ViolationCategory::Warning =\u003e \"⚠️\",\n                                    analysis_result::ViolationCategory::Info =\u003e \"ℹ️\",\n                                };\n                                println!(\n                                    \"\\n  {} #{} [{}]\",\n                                    icon,\n                                    i + 1,\n                                    cv.category.as_str().to_uppercase()\n                                );\n                                println!(\n                                    \"     📄 {}:{}\",\n                                    cv.violation.file_path.display(),\n                                    cv.violation.line_number\n                                );\n                                println!(\n                                    \"     🚫 '{}' no puede importar de '{}'\",\n                                    cv.violation.rule.from, cv.violation.rule.to\n                                );\n                                println!(\"     💥 {}\", cv.violation.offensive_import);\n                            }\n                            println!();\n                        }\n\n                        // Circular dependencies\n                        if !result.circular_dependencies.is_empty() {\n                            circular::print_circular_dependency_report(\n                                \u0026result.circular_dependencies,\n                            );\n                        }\n\n                        // Summary line\n                        println!(\n                            \"📊 Total: {} violaciones, {} dependencias cíclicas\",\n                            result.violations.len(),\n                            result.circular_dependencies.len()\n                        );\n                    }\n                }\n                watch::WatchCommand::Dashboard =\u003e {\n                    println!(\"\\n📊 Calculando health score...\\n\");\n                    let result = run_cached_analysis(\u0026cmd_cache)?;\n                    output::print_dashboard(\u0026result);\n                }\n                watch::WatchCommand::Clear =\u003e {\n                    // ANSI escape to clear screen and move cursor to top\n                    print!(\"\\x1B[2J\\x1B[1;1H\");\n                    println!(\"👁️  Modo Watch activo\");\n                }\n                watch::WatchCommand::Help =\u003e {\n                    println!();\n                    watch::print_watch_help();\n                }\n                watch::WatchCommand::Quit =\u003e {\n                    return Ok(false);\n                }\n            }\n\n            Ok(true)\n        },\n    )?;\n\n    Ok(())\n}\n\n/// Ejecuta el análisis en modo fix (auto-reparación con IA)\nfn run_fix_mode(project_root: \u0026Path, ctx: Arc\u003cconfig::LinterContext\u003e) -\u003e Result\u003c()\u003e {\n    println!(\"🔧 Modo Fix: Auto-reparación con IA\\n\");\n\n    if ctx.ai_configs.is_empty() {\n        return Err(miette::miette!(\n            \"No se encontró configuración de IA (.architect.ai.json).\\n\\\n             El modo --fix requiere configuración de IA para funcionar.\"\n        ));\n    }\n\n    run_fix_flow(project_root, \u0026ctx)\n}\n\n/// Ejecuta el análisis en modo incremental (solo archivos modificados)\nfn run_incremental_mode(\n    project_root: \u0026Path,\n    __ctx: Arc\u003cconfig::LinterContext\u003e,\n    cli_args: \u0026cli::CliArgs,\n) -\u003e Result\u003c()\u003e {\n    println!(\"🚀 Modo Incremental: Analizando solo archivos modificados\\n\");\n\n    if !git::is_git_repo(project_root) {\n        return Err(miette::miette!(\n            \"El flag --incremental requiere un repositorio git.\"\n        ));\n    }\n\n    // Get changed files from Git\n    let changed_files = git_changes::get_changed_files(project_root)\n        .map_err(|e| miette::miette!(\"Failed to get changed files from git: {}\", e))?;\n\n    if changed_files.is_empty() {\n        println!(\"No changed files detected\");\n        println!(\"✅ Análisis incremental completado (sin cambios)\");\n        std::process::exit(0);\n    }\n\n    println!(\n        \"🔍 Analizando {} archivos modificados incrementalmente\",\n        changed_files.len()\n    );\n\n    // Load config\n    let config = config::load_config(\u0026project_root.join(\"architect.json\"))?;\n    let linter_context: config::LinterContext = config;\n\n    // Analyze only changed files\n    let cm = Arc::new(SourceMap::default());\n    let mut analysis_result = analyzer::analyze_all_files(\n        \u0026changed_files,\n        project_root,\n        linter_context.pattern.clone(),\n        \u0026linter_context,\n        \u0026cm,\n        None,\n    )?;\n\n    // Handle circular dependencies\n    if !analysis_result.circular_dependencies.is_empty() {\n        circular::print_circular_dependency_report(\u0026analysis_result.circular_dependencies);\n    }\n\n    // Calculate health score\n    let health_score = scoring::calculate(\u0026analysis_result);\n    analysis_result.health_score = Some(health_score.clone());\n\n    // Handle report export if requested\n    if let Some(format) = cli_args.report_format {\n        let report_content = report::generate_report(\u0026analysis_result, format);\n\n        if let Some(output_path) = \u0026cli_args.output_path {\n            let path = std::path::Path::new(output_path);\n            report::write_report(\u0026report_content, path)?;\n            println!(\"📄 Report saved to: {}\", output_path);\n        } else {\n            report::write_stdout(\u0026report_content)?;\n        }\n\n        // Exit with appropriate code\n        if analysis_result.has_critical_issues() {\n            std::process::exit(1);\n        }\n        return Ok(());\n    }\n\n    // Print dashboard\n    output::print_dashboard(\u0026analysis_result);\n\n    // Print summary\n    output::dashboard::print_summary(\u0026analysis_result);\n\n    // Print circular dependency details if any\n    if !analysis_result.circular_dependencies.is_empty() {\n        println!();\n        circular::print_circular_dependency_report(\u0026analysis_result.circular_dependencies);\n    }\n\n    // Exit with appropriate code\n    if analysis_result.has_critical_issues() {\n        std::process::exit(1);\n    } else {\n        std::process::exit(0);\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","memory_cache.rs"],"content":"use lru::LruCache;\nuse std::num::NonZeroUsize;\nuse std::path::PathBuf;\nuse std::sync::{Arc, Mutex};\n\n/// Thread-safe LRU memory cache for file analysis results\n#[derive(Clone)]\npub struct MemoryCache {\n    cache: Arc\u003cMutex\u003cLruCache\u003cPathBuf, String\u003e\u003e\u003e,\n}\n\nimpl MemoryCache {\n    /// Create a new memory cache with specified capacity\n    pub fn new(capacity: usize) -\u003e Self {\n        Self {\n            cache: Arc::new(Mutex::new(LruCache::new(\n                NonZeroUsize::new(capacity).expect(\"Capacity must be \u003e 0\"),\n            ))),\n        }\n    }\n\n    /// Get a cached value\n    pub fn get(\u0026self, path: \u0026PathBuf) -\u003e Option\u003cString\u003e {\n        let mut cache = self.cache.lock().unwrap();\n        cache.get(path).cloned()\n    }\n\n    /// Put a value in the cache\n    pub fn put(\u0026self, path: PathBuf, content: String) {\n        let mut cache = self.cache.lock().unwrap();\n        cache.put(path, content);\n    }\n\n    /// Clear the cache\n    pub fn clear(\u0026self) {\n        let mut cache = self.cache.lock().unwrap();\n        cache.clear();\n    }\n\n    /// Get cache size\n    pub fn len(\u0026self) -\u003e usize {\n        let cache = self.cache.lock().unwrap();\n        cache.len()\n    }\n\n    /// Check if cache is empty\n    pub fn is_empty(\u0026self) -\u003e bool {\n        self.len() == 0\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_put_and_get() {\n        let cache = MemoryCache::new(2);\n        let path = PathBuf::from(\"test.ts\");\n        cache.put(path.clone(), \"content\".to_string());\n        assert_eq!(cache.get(\u0026path), Some(\"content\".to_string()));\n    }\n}\n","traces":[{"line":14,"address":[25234336],"length":1,"stats":{"Line":0}},{"line":16,"address":[25234388],"length":1,"stats":{"Line":0}},{"line":23,"address":[25234130,25233888,25234124],"length":1,"stats":{"Line":0}},{"line":24,"address":[25233933],"length":1,"stats":{"Line":0}},{"line":25,"address":[25233997,25234063],"length":1,"stats":{"Line":0}},{"line":29,"address":[25234872,25234838,25234448],"length":1,"stats":{"Line":0}},{"line":30,"address":[25234567,25234473],"length":1,"stats":{"Line":0}},{"line":31,"address":[25234710,25234635],"length":1,"stats":{"Line":0}},{"line":35,"address":[25235076,25235070,25234912],"length":1,"stats":{"Line":0}},{"line":36,"address":[25234921],"length":1,"stats":{"Line":0}},{"line":37,"address":[25235043,25234985],"length":1,"stats":{"Line":0}},{"line":41,"address":[25234144,25234310,25234316],"length":1,"stats":{"Line":0}},{"line":42,"address":[25234153],"length":1,"stats":{"Line":0}},{"line":43,"address":[25234275,25234217],"length":1,"stats":{"Line":0}},{"line":47,"address":[25235088],"length":1,"stats":{"Line":0}},{"line":48,"address":[25235093],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":16},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","metrics.rs"],"content":"//! Metrics and scoring data structures for Architecture Health Score\n//!\n//! This module defines all the types needed for the v4.0 scoring system.\n\nuse serde::{Deserialize, Serialize};\n\n/// Health grade based on score ranges\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\npub enum HealthGrade {\n    A, // 90-100\n    B, // 80-89\n    C, // 70-79\n    D, // 60-69\n    F, // 0-59\n}\n\nimpl HealthGrade {\n    pub fn from_score(score: u8) -\u003e Self {\n        match score {\n            90..=100 =\u003e HealthGrade::A,\n            80..=89 =\u003e HealthGrade::B,\n            70..=79 =\u003e HealthGrade::C,\n            60..=69 =\u003e HealthGrade::D,\n            _ =\u003e HealthGrade::F,\n        }\n    }\n\n    pub fn as_str(\u0026self) -\u003e \u0026'static str {\n        match self {\n            HealthGrade::A =\u003e \"A\",\n            HealthGrade::B =\u003e \"B\",\n            HealthGrade::C =\u003e \"C\",\n            HealthGrade::D =\u003e \"D\",\n            HealthGrade::F =\u003e \"F\",\n        }\n    }\n\n    pub fn emoji(\u0026self) -\u003e \u0026'static str {\n        match self {\n            HealthGrade::A =\u003e \"🏆\",\n            HealthGrade::B =\u003e \"✨\",\n            HealthGrade::C =\u003e \"👍\",\n            HealthGrade::D =\u003e \"⚠️\",\n            HealthGrade::F =\u003e \"❌\",\n        }\n    }\n}\n\n/// Individual score components\n#[derive(Debug, Clone, Copy, Serialize, Deserialize)]\npub struct ScoreComponents {\n    /// Layer isolation score (0-100)\n    /// Formula: 100 - (blocked_violations / total_imports * 100)\n    pub layer_isolation: u8,\n\n    /// Circular dependencies score (0 or 100)\n    /// 100 if no cycles, 0 if cycles exist\n    pub circular_deps: u8,\n\n    /// Code complexity score (0-100)\n    /// Formula: 100 - (long_functions / total_functions * 100)\n    pub complexity: u8,\n\n    /// Violations score (0-100)\n    /// Formula: 100 - ((blocked * 2 + warnings) / total_checks * 100)\n    pub violations: u8,\n}\n\nimpl ScoreComponents {\n    /// Calculate weighted total score\n    /// Weights: Layer Isolation (30%), Circular Deps (25%), Complexity (20%), Violations (25%)\n    pub fn calculate_total(\u0026self) -\u003e u8 {\n        let total = (self.layer_isolation as f64 * 0.30)\n            + (self.circular_deps as f64 * 0.25)\n            + (self.complexity as f64 * 0.20)\n            + (self.violations as f64 * 0.25);\n        total.round() as u8\n    }\n}\n\n/// Complete health score with all components\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct HealthScore {\n    /// Total score (0-100)\n    pub total: u8,\n\n    /// Grade (A-F)\n    pub grade: HealthGrade,\n\n    /// Individual component scores\n    pub components: ScoreComponents,\n\n    /// Status indicators for each component\n    pub layer_isolation_status: ComponentStatus,\n    pub circular_deps_status: ComponentStatus,\n    pub complexity_status: ComponentStatus,\n    pub violations_status: ComponentStatus,\n}\n\nimpl HealthScore {\n    pub fn new(components: ScoreComponents) -\u003e Self {\n        let total = components.calculate_total();\n        let grade = HealthGrade::from_score(total);\n\n        Self {\n            total,\n            grade,\n            components,\n            layer_isolation_status: ComponentStatus::from_score(components.layer_isolation),\n            circular_deps_status: ComponentStatus::from_score(components.circular_deps),\n            complexity_status: ComponentStatus::from_score(components.complexity),\n            violations_status: ComponentStatus::from_score(components.violations),\n        }\n    }\n\n    /// Get the status indicator string for display\n    #[allow(dead_code)] // Used by integration tests\n    pub fn status_indicator(\u0026self) -\u003e \u0026'static str {\n        match self.grade {\n            HealthGrade::A =\u003e \"✅ Excellent\",\n            HealthGrade::B =\u003e \"✓ Good\",\n            HealthGrade::C =\u003e \"! Fair\",\n            HealthGrade::D =\u003e \"⚠ Needs Work\",\n            HealthGrade::F =\u003e \"✗ Critical\",\n        }\n    }\n}\n\n/// Status of an individual component\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\npub enum ComponentStatus {\n    Ok,      // No issues\n    Warning, // Minor issues\n    Blocked, // Critical issues\n}\n\nimpl ComponentStatus {\n    pub fn from_score(score: u8) -\u003e Self {\n        match score {\n            90..=100 =\u003e ComponentStatus::Ok,\n            60..=89 =\u003e ComponentStatus::Warning,\n            _ =\u003e ComponentStatus::Blocked,\n        }\n    }\n\n    pub fn emoji(\u0026self) -\u003e \u0026'static str {\n        match self {\n            ComponentStatus::Ok =\u003e \"[OK]\",\n            ComponentStatus::Warning =\u003e \"[!]\",\n            ComponentStatus::Blocked =\u003e \"[X]\",\n        }\n    }\n}\n\n/// Statistics for layer isolation scoring\n#[derive(Debug, Clone, Default, Serialize, Deserialize)]\npub struct LayerStats {\n    pub total_imports: usize,\n    pub blocked_violations: usize,\n}\n\n/// Statistics for complexity scoring\n#[derive(Debug, Clone, Default, Serialize, Deserialize)]\npub struct ComplexityStats {\n    pub total_functions: usize,\n    pub long_functions: usize, // Functions exceeding max_lines\n    pub max_lines_threshold: usize,\n}\n\n/// Performance metrics for architecture analysis\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct PerformanceMetrics {\n    pub total_time_ms: u64,\n    pub files_analyzed: u32,\n    pub files_from_cache: u32,\n    pub memory_cache_hits: u32,\n    pub disk_cache_hits: u32,\n    pub peak_memory_mb: u32,\n    pub threads_used: u8,\n}\n\nimpl PerformanceMetrics {\n    pub fn new() -\u003e Self {\n        PerformanceMetrics {\n            total_time_ms: 0,\n            files_analyzed: 0,\n            files_from_cache: 0,\n            memory_cache_hits: 0,\n            disk_cache_hits: 0,\n            peak_memory_mb: 0,\n            threads_used: 0,\n        }\n    }\n\n    pub fn cache_hit_rate(\u0026self) -\u003e f64 {\n        if self.files_analyzed == 0 {\n            return 0.0;\n        }\n\n        let total_hits = self.memory_cache_hits as f64 + self.disk_cache_hits as f64;\n        let total_files = self.files_analyzed as f64;\n\n        (total_hits / total_files) * 100.0\n    }\n}\n\nimpl std::fmt::Display for PerformanceMetrics {\n    fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n        write!(\n            f,\n            \"PerformanceMetrics(total_time_ms: {}, files_analyzed: {}, files_from_cache: {}, memory_cache_hits: {}, disk_cache_hits: {}, peak_memory_mb: {}, threads_used: {}, cache_hit_rate: {:.2}%)\",\n            self.total_time_ms,\n            self.files_analyzed,\n            self.files_from_cache,\n            self.memory_cache_hits,\n            self.disk_cache_hits,\n            self.peak_memory_mb,\n            self.threads_used,\n            self.cache_hit_rate()\n        )\n    }\n}\n","traces":[{"line":18,"address":[24682960],"length":1,"stats":{"Line":0}},{"line":20,"address":[24682971,24682993],"length":1,"stats":{"Line":0}},{"line":21,"address":[24682981,24683020],"length":1,"stats":{"Line":0}},{"line":22,"address":[24683008,24683047],"length":1,"stats":{"Line":0}},{"line":23,"address":[24683069,24683035],"length":1,"stats":{"Line":0}},{"line":24,"address":[24683058],"length":1,"stats":{"Line":0}},{"line":28,"address":[24683248],"length":1,"stats":{"Line":0}},{"line":29,"address":[24683253],"length":1,"stats":{"Line":0}},{"line":30,"address":[24683284],"length":1,"stats":{"Line":0}},{"line":31,"address":[24683307],"length":1,"stats":{"Line":0}},{"line":32,"address":[24683330],"length":1,"stats":{"Line":0}},{"line":33,"address":[24683353],"length":1,"stats":{"Line":0}},{"line":34,"address":[24683376],"length":1,"stats":{"Line":0}},{"line":38,"address":[24683088],"length":1,"stats":{"Line":0}},{"line":39,"address":[24683093],"length":1,"stats":{"Line":0}},{"line":40,"address":[24683124],"length":1,"stats":{"Line":0}},{"line":41,"address":[24683147],"length":1,"stats":{"Line":0}},{"line":42,"address":[24683170],"length":1,"stats":{"Line":0}},{"line":43,"address":[24683193],"length":1,"stats":{"Line":0}},{"line":44,"address":[24683216],"length":1,"stats":{"Line":0}},{"line":72,"address":[24683984],"length":1,"stats":{"Line":0}},{"line":73,"address":[24683993,24684080,24684056,24684032],"length":1,"stats":{"Line":0}},{"line":74,"address":[24684012],"length":1,"stats":{"Line":0}},{"line":75,"address":[24684036],"length":1,"stats":{"Line":0}},{"line":76,"address":[24684060],"length":1,"stats":{"Line":0}},{"line":77,"address":[24684090],"length":1,"stats":{"Line":0}},{"line":101,"address":[24683584],"length":1,"stats":{"Line":0}},{"line":102,"address":[24683610],"length":1,"stats":{"Line":0}},{"line":103,"address":[24683629],"length":1,"stats":{"Line":0}},{"line":109,"address":[24683646],"length":1,"stats":{"Line":0}},{"line":110,"address":[24683661],"length":1,"stats":{"Line":0}},{"line":111,"address":[24683676],"length":1,"stats":{"Line":0}},{"line":112,"address":[24683691],"length":1,"stats":{"Line":0}},{"line":118,"address":[24683408],"length":1,"stats":{"Line":0}},{"line":119,"address":[24683413],"length":1,"stats":{"Line":0}},{"line":120,"address":[24683445],"length":1,"stats":{"Line":0}},{"line":121,"address":[24683468],"length":1,"stats":{"Line":0}},{"line":122,"address":[24683491],"length":1,"stats":{"Line":0}},{"line":123,"address":[24683514],"length":1,"stats":{"Line":0}},{"line":124,"address":[24683537],"length":1,"stats":{"Line":0}},{"line":138,"address":[24683776],"length":1,"stats":{"Line":0}},{"line":140,"address":[24683809,24683787],"length":1,"stats":{"Line":0}},{"line":141,"address":[24683831,24683797],"length":1,"stats":{"Line":0}},{"line":142,"address":[24683820],"length":1,"stats":{"Line":0}},{"line":146,"address":[24683856],"length":1,"stats":{"Line":0}},{"line":147,"address":[24683861],"length":1,"stats":{"Line":0}},{"line":148,"address":[24683893],"length":1,"stats":{"Line":0}},{"line":149,"address":[24683916],"length":1,"stats":{"Line":0}},{"line":150,"address":[24683939],"length":1,"stats":{"Line":0}},{"line":183,"address":[24684240],"length":1,"stats":{"Line":0}},{"line":195,"address":[24684128],"length":1,"stats":{"Line":0}},{"line":196,"address":[24684138],"length":1,"stats":{"Line":0}},{"line":197,"address":[24684213],"length":1,"stats":{"Line":0}},{"line":200,"address":[24684149],"length":1,"stats":{"Line":0}},{"line":201,"address":[24684175],"length":1,"stats":{"Line":0}},{"line":203,"address":[24684189],"length":1,"stats":{"Line":0}},{"line":208,"address":[24686416],"length":1,"stats":{"Line":0}},{"line":209,"address":[24686569,24686448],"length":1,"stats":{"Line":0}},{"line":219,"address":[24686520],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":59},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","notification.rs"],"content":"//! OS Native Notifications for Architect Linter Pro\n\nuse notify_rust::Notification;\n\npub fn send_violation_alert(project_name: \u0026str, violation_count: usize) {\n    let summary = format!(\"🚫 Arquitectura Violada - {}\", project_name);\n    let body = format!(\n        \"Se detectaron {} violaciones arquitectónicas. Haz commit para ver los detalles.\",\n        violation_count\n    );\n\n    let _ = Notification::new()\n        .summary(\u0026summary)\n        .body(\u0026body)\n        .icon(\"dialog-error\")\n        .show();\n}\n\npub fn send_cycle_alert(project_name: \u0026str, cycle_count: usize) {\n    let summary = format!(\"🔄 Ciclo Detectado - {}\", project_name);\n    let body = format!(\n        \"Se encontraron {} dependencias cíclicas críticas.\",\n        cycle_count\n    );\n\n    let _ = Notification::new()\n        .summary(\u0026summary)\n        .body(\u0026body)\n        .icon(\"dialog-warning\")\n        .show();\n}\n\npub fn send_success_notification(project_name: \u0026str) {\n    let _ = Notification::new()\n        .summary(\u0026format!(\"✅ Arquitectura OK - {}\", project_name))\n        .body(\"Tu proyecto cumple con las reglas arquitectónicas.\")\n        .icon(\"dialog-information\")\n        .show();\n}\n","traces":[{"line":23,"address":[38853003,38852945],"length":1,"stats":{"Line":0}},{"line":26,"address":[38853102],"length":1,"stats":{"Line":0}},{"line":27,"address":[38853140],"length":1,"stats":{"Line":0}},{"line":28,"address":[38853167],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":4},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","output","dashboard.rs"],"content":"//! Visual dashboard for Architecture Health Score display\n//!\n//! This module provides rich terminal output with box drawing characters\n//! and progress bars.\n\nuse crate::analysis_result::{AnalysisResult, CategorizedViolation};\nuse crate::metrics::{ComponentStatus, HealthGrade};\nuse crate::scoring::{get_grade_color, get_progress_bar, reset_color};\n\nconst BOX_TOP_LEFT: \u0026str = \"+\";\nconst BOX_TOP_RIGHT: \u0026str = \"+\";\nconst BOX_BOTTOM_LEFT: \u0026str = \"+\";\nconst BOX_BOTTOM_RIGHT: \u0026str = \"+\";\nconst BOX_HORIZONTAL: \u0026str = \"=\";\nconst BOX_VERTICAL: \u0026str = \"|\";\nconst BOX_T_LEFT: \u0026str = \"+\";\nconst BOX_T_RIGHT: \u0026str = \"+\";\n\nconst DASHBOARD_WIDTH: usize = 79;\n\n/// Print the full analysis dashboard\npub fn print_dashboard(result: \u0026AnalysisResult) {\n    print_header(\n        \u0026result.project_name,\n        result.pattern_display(),\n        result.files_analyzed,\n    );\n\n    if let Some(ref score) = result.health_score {\n        print_health_score(score.total, score.grade);\n        print_components(\n            score.components.layer_isolation,\n            score.layer_isolation_status,\n            \"Layer isolation\",\n            \u0026format_layer_details(result),\n        );\n        print_components(\n            score.components.circular_deps,\n            score.circular_deps_status,\n            \"No circular deps\",\n            \u0026format_circular_details(result),\n        );\n        print_components(\n            score.components.complexity,\n            score.complexity_status,\n            \"Complexity\",\n            \u0026format_complexity_details(result),\n        );\n        print_components(\n            score.components.violations,\n            score.violations_status,\n            \"Violations\",\n            \u0026format_violations_details(result),\n        );\n    }\n\n    print_violations_list(\u0026result.violations);\n}\n\n/// Print the dashboard header with project info\nfn print_header(project_name: \u0026str, pattern: \u0026str, files_analyzed: usize) {\n    println!();\n    print_horizontal_line(BOX_TOP_LEFT, BOX_TOP_RIGHT, BOX_HORIZONTAL);\n    print_centered_line(\u0026format!(\"ARCHITECT LINTER PRO v4.0\"));\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n    print_info_line(\"Project:\", project_name);\n    print_info_line(\"Pattern:\", pattern);\n    print_info_line(\"Files:\", \u0026format!(\"{} analyzed\", files_analyzed));\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n}\n\n/// Print the health score section\nfn print_health_score(score: u8, grade: HealthGrade) {\n    let color = get_grade_color(grade);\n    let reset = reset_color();\n\n    println!(\n        \"{}{}{}  {}\",\n        BOX_VERTICAL,\n        \" \".repeat(DASHBOARD_WIDTH - 2),\n        BOX_VERTICAL,\n        \"\"\n    );\n    println!(\n        \"{}  ARCHITECTURE HEALTH: {}{}/100{}  {}  {}  {}{}\",\n        BOX_VERTICAL,\n        color,\n        score,\n        reset,\n        get_progress_bar(score, 14),\n        grade.emoji(),\n        grade.as_str(),\n        \" \".repeat(DASHBOARD_WIDTH - 50)\n    );\n    println!(\n        \"{}{}{}\",\n        BOX_VERTICAL,\n        \" \".repeat(DASHBOARD_WIDTH - 2),\n        BOX_VERTICAL\n    );\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n}\n\n/// Print a component status line\nfn print_components(score: u8, status: ComponentStatus, name: \u0026str, details: \u0026str) {\n    let status_emoji = status.emoji();\n    let details_suffix = if details.is_empty() {\n        String::new()\n    } else {\n        format!(\" ({})\", details)\n    };\n\n    let line = format!(\n        \"  +-- {} {}: {}%{}{}\",\n        status_emoji,\n        name,\n        score,\n        details_suffix,\n        \" \".repeat(DASHBOARD_WIDTH.saturating_sub(20 + name.len() + details_suffix.len()))\n    );\n\n    // Truncate if too long\n    if line.len() \u003e DASHBOARD_WIDTH {\n        println!(\n            \"{}{}{}\",\n            BOX_VERTICAL,\n            \u0026line[..DASHBOARD_WIDTH - 2],\n            BOX_VERTICAL\n        );\n    } else {\n        println!(\"{}{}{}\", BOX_VERTICAL, line, BOX_VERTICAL);\n    }\n}\n\n/// Format layer isolation details\nfn format_layer_details(result: \u0026AnalysisResult) -\u003e String {\n    let blocked = result.blocked_count();\n    if blocked \u003e 0 {\n        format!(\"{} violations\", blocked)\n    } else {\n        \"100%\".to_string()\n    }\n}\n\n/// Format circular dependencies details\nfn format_circular_details(result: \u0026AnalysisResult) -\u003e String {\n    let cycles = result.circular_dependencies.len();\n    if cycles \u003e 0 {\n        format!(\"{} cycles\", cycles)\n    } else {\n        \"Pass\".to_string()\n    }\n}\n\n/// Format complexity details\nfn format_complexity_details(result: \u0026AnalysisResult) -\u003e String {\n    let long = result.long_functions.len();\n    if long \u003e 0 {\n        format!(\n            \"{} functions \u003e {}\",\n            long, result.complexity_stats.max_lines_threshold\n        )\n    } else {\n        \"OK\".to_string()\n    }\n}\n\n/// Format violations details\nfn format_violations_details(result: \u0026AnalysisResult) -\u003e String {\n    let blocked = result.blocked_count();\n    let warnings = result.warning_count();\n\n    if blocked == 0 \u0026\u0026 warnings == 0 {\n        \"None\".to_string()\n    } else if warnings == 0 {\n        format!(\"{} blocked\", blocked)\n    } else if blocked == 0 {\n        format!(\"{} warnings\", warnings)\n    } else {\n        format!(\"{} blocked, {} warnings\", blocked, warnings)\n    }\n}\n\n/// Print the violations list section\nfn print_violations_list(violations: \u0026[CategorizedViolation]) {\n    if violations.is_empty() {\n        return;\n    }\n\n    let blocked_count = violations\n        .iter()\n        .filter(|v| v.category == crate::analysis_result::ViolationCategory::Blocked)\n        .count();\n    let warning_count = violations\n        .iter()\n        .filter(|v| v.category == crate::analysis_result::ViolationCategory::Warning)\n        .count();\n\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n    let header_text_len = 30 + blocked_count.to_string().len() + warning_count.to_string().len();\n    let header_padding = DASHBOARD_WIDTH.saturating_sub(header_text_len);\n    println!(\n        \"{}  VIOLATIONS ({} blocked, {} warnings){}\",\n        BOX_VERTICAL,\n        blocked_count,\n        warning_count,\n        \" \".repeat(header_padding)\n    );\n    print_horizontal_line(BOX_T_LEFT, BOX_T_RIGHT, BOX_HORIZONTAL);\n\n    for (i, categorized) in violations.iter().enumerate() {\n        let v = \u0026categorized.violation;\n        let file_line_len =\n            10 + v.file_path.to_string_lossy().len() + v.line_number.to_string().len();\n        let file_padding = DASHBOARD_WIDTH.saturating_sub(file_line_len);\n        println!(\n            \"{}  {}. {}:{}{}\",\n            BOX_VERTICAL,\n            i + 1,\n            v.file_path.display(),\n            v.line_number,\n            \" \".repeat(file_padding)\n        );\n        let rule_line_len = 20 + v.rule.from.len() + v.rule.to.len();\n        let rule_padding = DASHBOARD_WIDTH.saturating_sub(rule_line_len);\n        println!(\n            \"{}     Rule: {} cannot import from {}{}\",\n            BOX_VERTICAL,\n            v.rule.from,\n            v.rule.to,\n            \" \".repeat(rule_padding)\n        );\n\n        if i \u003c violations.len() - 1 {\n            println!(\n                \"{}{}\",\n                BOX_VERTICAL,\n                \" \".repeat(DASHBOARD_WIDTH.saturating_sub(1))\n            );\n        }\n    }\n\n    print_horizontal_line(BOX_BOTTOM_LEFT, BOX_BOTTOM_RIGHT, BOX_HORIZONTAL);\n}\n\n/// Print a horizontal line\nfn print_horizontal_line(left: \u0026str, right: \u0026str, fill: \u0026str) {\n    let middle = fill.repeat(DASHBOARD_WIDTH - 2);\n    println!(\"{}{}{}\", left, middle, right);\n}\n\n/// Print a centered line\nfn print_centered_line(text: \u0026str) {\n    let padding = (DASHBOARD_WIDTH - 2 - text.len()) / 2;\n    let extra = (DASHBOARD_WIDTH - 2 - text.len()) % 2;\n    println!(\n        \"{}{}{}{}{}{}\",\n        BOX_VERTICAL,\n        \" \".repeat(padding),\n        text,\n        \" \".repeat(padding + extra),\n        \"\",\n        BOX_VERTICAL\n    );\n}\n\n/// Print an info line with label and value\nfn print_info_line(label: \u0026str, value: \u0026str) {\n    let content_len = label.len() + 1 + value.len();\n    let padding = DASHBOARD_WIDTH - 2 - content_len;\n    println!(\n        \"{}  {} {}{}{}\",\n        BOX_VERTICAL,\n        label,\n        value,\n        \" \".repeat(padding),\n        BOX_VERTICAL\n    );\n}\n\n/// Print a summary message\npub fn print_summary(result: \u0026AnalysisResult) {\n    println!();\n\n    if result.has_critical_issues() {\n        let score = result.health_score.as_ref().map(|s| s.total).unwrap_or(0);\n        println!(\n            \"❌ Architecture Health: {}/100 - Critical issues found\",\n            score\n        );\n        println!();\n        println!(\"💡 Fix the blocked violations and circular dependencies to improve your score.\");\n    } else {\n        let score = result.health_score.as_ref().map(|s| s.total).unwrap_or(100);\n        let grade = result\n            .health_score\n            .as_ref()\n            .map(|s| s.grade)\n            .unwrap_or(HealthGrade::A);\n\n        if score \u003e= 90 {\n            println!(\n                \"✨ Architecture Health: {}/100 ({}) - Excellent!\",\n                score,\n                grade.as_str()\n            );\n        } else if score \u003e= 70 {\n            println!(\n                \"✓ Architecture Health: {}/100 ({}) - Good\",\n                score,\n                grade.as_str()\n            );\n        } else {\n            println!(\n                \"⚠ Architecture Health: {}/100 ({}) - Needs improvement\",\n                score,\n                grade.as_str()\n            );\n        }\n    }\n}\n","traces":[{"line":192,"address":[24348254,24348240],"length":1,"stats":{"Line":0}},{"line":196,"address":[24348206,24348192],"length":1,"stats":{"Line":0}},{"line":286,"address":[24348149,24348144],"length":1,"stats":{"Line":0}},{"line":294,"address":[24348176,24348181],"length":1,"stats":{"Line":0}},{"line":298,"address":[24348160,24348165],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","output","mod.rs"],"content":"//! Output module for Architect Linter v4.0\n//!\n//! This module provides visual dashboard rendering and report generation.\n\npub mod dashboard;\n\npub use dashboard::print_dashboard;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","go.rs"],"content":"//! Go parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct GoParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl GoParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_go::language())\n            .expect(\"Failed to load Go grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (Go-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        if normalized_path.contains(\u0026normalized_pattern) {\n            return true;\n        }\n\n        // Go imports are package paths: github.com/user/repo/pkg\n        // Check if import ends with pattern folder\n        if let Some(last_segment) = normalized_path.split('/').last() {\n            if let Some(pattern_last) = normalized_pattern.split('/').last() {\n                if last_segment.contains(pattern_last) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for GoParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse Go\"))?;\n\n        // Query for import declarations\n        // Go has both single and grouped imports\n        let query_source = r#\"\n            [\n              (import_declaration\n                (import_spec\n                  path: (interpreted_string_literal) @import_path))\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_go::language(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path_raw = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n\n                // Remove quotes from Go string literal\n                let import_path = import_path_raw.trim_matches('\"');\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"import_spec\" || p.kind() == \"import_declaration\" {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"import \\\"{}\\\"\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // Go-specific rules\n            // Example: handlers shouldn't import database directly\n            if file_path_str.contains(\"handlers\") \u0026\u0026 import.source.contains(\"database\") {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"handlers\".to_string(),\n                        to: \"database\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[24801254,24801260,24800976],"length":1,"stats":{"Line":3}},{"line":17,"address":[24800990],"length":1,"stats":{"Line":3}},{"line":19,"address":[24801067,24801014],"length":1,"stats":{"Line":6}},{"line":23,"address":[24801191],"length":1,"stats":{"Line":3}},{"line":28,"address":[24799472,24800954,24800948],"length":1,"stats":{"Line":0}},{"line":29,"address":[24799536],"length":1,"stats":{"Line":0}},{"line":30,"address":[24800062,24799795,24799923],"length":1,"stats":{"Line":0}},{"line":36,"address":[24800365],"length":1,"stats":{"Line":0}},{"line":37,"address":[24800450],"length":1,"stats":{"Line":0}},{"line":42,"address":[24800433,24800473],"length":1,"stats":{"Line":0}},{"line":43,"address":[24800690,24800633],"length":1,"stats":{"Line":0}},{"line":44,"address":[24800846],"length":1,"stats":{"Line":0}},{"line":45,"address":[24800874],"length":1,"stats":{"Line":0}},{"line":50,"address":[24800650],"length":1,"stats":{"Line":0}},{"line":55,"address":[24792848,24796229,24796376],"length":1,"stats":{"Line":2}},{"line":56,"address":[24792962],"length":1,"stats":{"Line":2}},{"line":59,"address":[24793311,24793127,24793408],"length":1,"stats":{"Line":6}},{"line":63,"address":[24793239],"length":1,"stats":{"Line":3}},{"line":64,"address":[24348880,24348887],"length":1,"stats":{"Line":6}},{"line":68,"address":[24792935],"length":1,"stats":{"Line":2}},{"line":76,"address":[24796311,24793516],"length":1,"stats":{"Line":3}},{"line":78,"address":[24794051],"length":1,"stats":{"Line":3}},{"line":79,"address":[24794086,24794170],"length":1,"stats":{"Line":6}},{"line":81,"address":[24794456,24794252],"length":1,"stats":{"Line":6}},{"line":82,"address":[24794768,24796202,24794535],"length":1,"stats":{"Line":3}},{"line":83,"address":[24794894],"length":1,"stats":{"Line":1}},{"line":84,"address":[24794917],"length":1,"stats":{"Line":1}},{"line":87,"address":[24795145],"length":1,"stats":{"Line":1}},{"line":88,"address":[24795203,24795289],"length":1,"stats":{"Line":1}},{"line":91,"address":[24795262,24795309],"length":1,"stats":{"Line":2}},{"line":92,"address":[24795627,24795311],"length":1,"stats":{"Line":1}},{"line":93,"address":[24795357,24795419],"length":1,"stats":{"Line":2}},{"line":96,"address":[24795574],"length":1,"stats":{"Line":0}},{"line":99,"address":[24796004,24795386,24795648],"length":1,"stats":{"Line":2}},{"line":100,"address":[24795680,24795745],"length":1,"stats":{"Line":2}},{"line":101,"address":[24795788],"length":1,"stats":{"Line":1}},{"line":104,"address":[24795705,24795892],"length":1,"stats":{"Line":0}},{"line":107,"address":[24796095],"length":1,"stats":{"Line":1}},{"line":108,"address":[24795854],"length":1,"stats":{"Line":1}},{"line":110,"address":[24796055],"length":1,"stats":{"Line":1}},{"line":115,"address":[24794608],"length":1,"stats":{"Line":2}},{"line":118,"address":[24799440,24798559,24796416],"length":1,"stats":{"Line":1}},{"line":124,"address":[24796535],"length":1,"stats":{"Line":1}},{"line":125,"address":[24796616,24796676],"length":1,"stats":{"Line":2}},{"line":126,"address":[24796929,24796881],"length":1,"stats":{"Line":2}},{"line":128,"address":[24797305,24797103],"length":1,"stats":{"Line":2}},{"line":130,"address":[24797645,24797414],"length":1,"stats":{"Line":0}},{"line":131,"address":[24798599,24797767],"length":1,"stats":{"Line":0}},{"line":132,"address":[24798668],"length":1,"stats":{"Line":0}},{"line":134,"address":[24798783],"length":1,"stats":{"Line":0}},{"line":135,"address":[24799199],"length":1,"stats":{"Line":0}},{"line":136,"address":[24798821],"length":1,"stats":{"Line":0}},{"line":137,"address":[24798856],"length":1,"stats":{"Line":0}},{"line":138,"address":[24798919],"length":1,"stats":{"Line":0}},{"line":139,"address":[24799127],"length":1,"stats":{"Line":0}},{"line":140,"address":[24798995],"length":1,"stats":{"Line":0}},{"line":141,"address":[24799063],"length":1,"stats":{"Line":0}},{"line":143,"address":[24799191],"length":1,"stats":{"Line":0}},{"line":150,"address":[24797801,24797913],"length":1,"stats":{"Line":0}},{"line":151,"address":[24798375],"length":1,"stats":{"Line":0}},{"line":152,"address":[24797993],"length":1,"stats":{"Line":0}},{"line":153,"address":[24798028],"length":1,"stats":{"Line":0}},{"line":154,"address":[24798091],"length":1,"stats":{"Line":0}},{"line":155,"address":[24798303],"length":1,"stats":{"Line":0}},{"line":156,"address":[24798159],"length":1,"stats":{"Line":0}},{"line":157,"address":[24798231],"length":1,"stats":{"Line":0}},{"line":159,"address":[24798367],"length":1,"stats":{"Line":0}},{"line":164,"address":[24797471],"length":1,"stats":{"Line":1}}],"covered":35,"coverable":68},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","java.rs"],"content":"//! Java parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct JavaParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl JavaParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_java::language())\n            .expect(\"Failed to load Java grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (Java-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        if normalized_path.contains(\u0026normalized_pattern) {\n            return true;\n        }\n\n        // Java uses dot notation: com.example.package.ClassName\n        // Convert between dots and slashes for matching\n        let path_with_dots = normalized_path.replace('/', \".\");\n        let pattern_with_dots = normalized_pattern.replace('/', \".\");\n\n        if path_with_dots.contains(\u0026pattern_with_dots) {\n            return true;\n        }\n\n        // Check if import ends with pattern folder\n        if let Some(last_segment) = path_with_dots.split('.').last() {\n            if let Some(pattern_last) = pattern_with_dots.split('.').last() {\n                if last_segment.contains(pattern_last) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for JavaParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse Java\"))?;\n\n        // Query for import declarations\n        let query_source = r#\"\n            [\n              (import_declaration\n                (scoped_identifier) @import_path)\n              (import_declaration\n                (identifier) @import_path)\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_java::language(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"import_declaration\" {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"import {};\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // Java-specific rules\n            // Example: Controllers shouldn't import Repositories directly\n            if file_path_str.contains(\"controller\")\n                \u0026\u0026 (import.source.to_lowercase().contains(\"repository\")\n                    || import.source.to_lowercase().contains(\".repo.\"))\n            {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"controller\".to_string(),\n                        to: \"repository\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[24220880,24221158,24221164],"length":1,"stats":{"Line":1}},{"line":17,"address":[24220894],"length":1,"stats":{"Line":1}},{"line":19,"address":[24220971,24220918],"length":1,"stats":{"Line":2}},{"line":23,"address":[24221095],"length":1,"stats":{"Line":1}},{"line":28,"address":[24220863,24220841,24218944],"length":1,"stats":{"Line":1}},{"line":29,"address":[24219008],"length":1,"stats":{"Line":1}},{"line":30,"address":[24219395,24219534,24219267],"length":1,"stats":{"Line":3}},{"line":36,"address":[24219843],"length":1,"stats":{"Line":1}},{"line":37,"address":[24219952],"length":1,"stats":{"Line":1}},{"line":42,"address":[24219929,24219981],"length":1,"stats":{"Line":2}},{"line":43,"address":[24220026,24220109],"length":1,"stats":{"Line":2}},{"line":45,"address":[24220154,24220225],"length":1,"stats":{"Line":2}},{"line":46,"address":[24220283],"length":1,"stats":{"Line":1}},{"line":50,"address":[24220306,24220266],"length":1,"stats":{"Line":0}},{"line":51,"address":[24220466,24220523],"length":1,"stats":{"Line":0}},{"line":52,"address":[24220679],"length":1,"stats":{"Line":0}},{"line":53,"address":[24220707],"length":1,"stats":{"Line":0}},{"line":58,"address":[24220483],"length":1,"stats":{"Line":0}},{"line":63,"address":[24212096,24215451,24215304],"length":1,"stats":{"Line":1}},{"line":64,"address":[24212210],"length":1,"stats":{"Line":3}},{"line":67,"address":[24212375,24212656,24212559],"length":1,"stats":{"Line":6}},{"line":71,"address":[24212487],"length":1,"stats":{"Line":3}},{"line":72,"address":[24212419,24212516,24212701,24215432,24212640],"length":1,"stats":{"Line":6}},{"line":75,"address":[24212183],"length":1,"stats":{"Line":3}},{"line":84,"address":[24212764,24215386],"length":1,"stats":{"Line":3}},{"line":86,"address":[24213299],"length":1,"stats":{"Line":3}},{"line":87,"address":[24213334,24213418],"length":1,"stats":{"Line":3}},{"line":89,"address":[24213704,24213500],"length":1,"stats":{"Line":3}},{"line":90,"address":[24215277,24213783,24214004],"length":1,"stats":{"Line":4}},{"line":91,"address":[24214124],"length":1,"stats":{"Line":1}},{"line":92,"address":[24214147],"length":1,"stats":{"Line":2}},{"line":93,"address":[24214379,24214465],"length":1,"stats":{"Line":1}},{"line":96,"address":[24214438,24214485],"length":1,"stats":{"Line":3}},{"line":97,"address":[24214704,24214487],"length":1,"stats":{"Line":2}},{"line":98,"address":[24214533,24214595],"length":1,"stats":{"Line":3}},{"line":101,"address":[24214651],"length":1,"stats":{"Line":0}},{"line":104,"address":[24214562,24215079,24214725],"length":1,"stats":{"Line":3}},{"line":105,"address":[24214757,24214822],"length":1,"stats":{"Line":3}},{"line":106,"address":[24214865],"length":1,"stats":{"Line":1}},{"line":109,"address":[24214969,24214782],"length":1,"stats":{"Line":0}},{"line":112,"address":[24215170],"length":1,"stats":{"Line":2}},{"line":113,"address":[24214931],"length":1,"stats":{"Line":2}},{"line":115,"address":[24215130],"length":1,"stats":{"Line":1}},{"line":120,"address":[24213850],"length":1,"stats":{"Line":2}},{"line":123,"address":[24218898,24217470,24215488],"length":1,"stats":{"Line":1}},{"line":129,"address":[24215607],"length":1,"stats":{"Line":1}},{"line":130,"address":[24215688,24215748],"length":1,"stats":{"Line":2}},{"line":131,"address":[24216001,24215953],"length":1,"stats":{"Line":2}},{"line":133,"address":[24216377,24216175],"length":1,"stats":{"Line":2}},{"line":135,"address":[24216486,24216717],"length":1,"stats":{"Line":2}},{"line":136,"address":[24216839,24218057],"length":1,"stats":{"Line":2}},{"line":137,"address":[24218126],"length":1,"stats":{"Line":1}},{"line":139,"address":[24218241],"length":1,"stats":{"Line":1}},{"line":140,"address":[24218657],"length":1,"stats":{"Line":1}},{"line":141,"address":[24218279],"length":1,"stats":{"Line":1}},{"line":142,"address":[24218314],"length":1,"stats":{"Line":1}},{"line":143,"address":[24218377],"length":1,"stats":{"Line":1}},{"line":144,"address":[24218585],"length":1,"stats":{"Line":1}},{"line":145,"address":[24218453],"length":1,"stats":{"Line":1}},{"line":146,"address":[24218521],"length":1,"stats":{"Line":1}},{"line":148,"address":[24218649],"length":1,"stats":{"Line":1}},{"line":155,"address":[24216873],"length":1,"stats":{"Line":1}},{"line":156,"address":[24216985],"length":1,"stats":{"Line":1}},{"line":157,"address":[24217226],"length":1,"stats":{"Line":0}},{"line":159,"address":[24217839],"length":1,"stats":{"Line":1}},{"line":160,"address":[24217451],"length":1,"stats":{"Line":1}},{"line":161,"address":[24217492],"length":1,"stats":{"Line":1}},{"line":162,"address":[24217555],"length":1,"stats":{"Line":1}},{"line":163,"address":[24217767],"length":1,"stats":{"Line":1}},{"line":164,"address":[24217623],"length":1,"stats":{"Line":1}},{"line":165,"address":[24217695],"length":1,"stats":{"Line":1}},{"line":167,"address":[24217831],"length":1,"stats":{"Line":1}},{"line":172,"address":[24216543],"length":1,"stats":{"Line":1}}],"covered":65,"coverable":73},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","mod.rs"],"content":"//! Parsers module - Multi-language parsing abstraction using Tree-sitter\n//!\n//! This module provides a unified interface for parsing source code across\n//! different programming languages using Tree-sitter.\n\nuse crate::autofix::Violation;\nuse crate::config::LinterContext;\nuse miette::Result;\nuse std::path::Path;\n\npub mod go;\npub mod java;\npub mod php;\npub mod python;\npub mod typescript;\npub mod typescript_pure;\n\n// Re-export pure functions for easier access in tests\npub use typescript_pure::{\n    count_imports_matching,\n    create_violation,\n    extract_folder_from_pattern,\n    extract_imports_from_tree,\n    filter_imports_by_pattern,\n    find_violations_in_imports,\n    generate_import_patterns,\n    has_import_matching,\n    is_controller_to_repository_violation,\n    matches_forbidden_rule,\n    matches_pattern,\n    normalize_path,\n    normalize_pattern,\n    Import as PureImport,\n};\n\n/// Represents an import statement extracted from source code\n#[derive(Debug, Clone)]\npub struct Import {\n    /// The import source/path (e.g., \"../services/user\", \"apps.user.models\")\n    pub source: String,\n    /// Line number where the import appears\n    pub line_number: usize,\n    /// Full import statement text\n    pub raw_statement: String,\n}\n\n/// Language identifier\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum Language {\n    TypeScript,\n    JavaScript,\n    Python,\n    Go,\n    Rust,\n    Php,\n    Java,\n}\n\nimpl Language {\n    /// Get language from file extension\n    pub fn from_extension(ext: \u0026str) -\u003e Option\u003cSelf\u003e {\n        match ext {\n            \"ts\" | \"tsx\" =\u003e Some(Language::TypeScript),\n            \"js\" | \"jsx\" =\u003e Some(Language::JavaScript),\n            \"py\" =\u003e Some(Language::Python),\n            \"go\" =\u003e Some(Language::Go),\n            \"rs\" =\u003e Some(Language::Rust),\n            \"php\" =\u003e Some(Language::Php),\n            \"java\" =\u003e Some(Language::Java),\n            _ =\u003e None,\n        }\n    }\n\n    /// Get file extensions for this language\n    pub fn extensions(\u0026self) -\u003e \u0026'static [\u0026'static str] {\n        match self {\n            Language::TypeScript =\u003e \u0026[\"ts\", \"tsx\"],\n            Language::JavaScript =\u003e \u0026[\"js\", \"jsx\"],\n            Language::Python =\u003e \u0026[\"py\"],\n            Language::Go =\u003e \u0026[\"go\"],\n            Language::Rust =\u003e \u0026[\"rs\"],\n            Language::Php =\u003e \u0026[\"php\"],\n            Language::Java =\u003e \u0026[\"java\"],\n        }\n    }\n}\n\n/// Main trait for language parsers\n///\n/// Implementations of this trait provide language-specific parsing logic\n/// using Tree-sitter to extract imports and detect architectural violations.\npub trait ArchitectParser: Send + Sync {\n    /// Extract all imports from source code\n    fn extract_imports(\u0026self, source_code: \u0026str, file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e;\n\n    /// Find architectural violations in a file\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e;\n}\n\n/// Factory function to get appropriate parser for a file\npub fn get_parser_for_file(file_path: \u0026Path) -\u003e Option\u003cBox\u003cdyn ArchitectParser\u003e\u003e {\n    let ext = file_path.extension()?.to_str()?;\n    let lang = Language::from_extension(ext)?;\n\n    match lang {\n        Language::TypeScript | Language::JavaScript =\u003e {\n            Some(Box::new(typescript::TypeScriptParser::new()))\n        }\n        Language::Python =\u003e Some(Box::new(python::PythonParser::new())),\n        Language::Go =\u003e Some(Box::new(go::GoParser::new())),\n        Language::Php =\u003e Some(Box::new(php::PhpParser::new())),\n        Language::Java =\u003e Some(Box::new(java::JavaParser::new())),\n        Language::Rust =\u003e {\n            // Rust support coming soon\n            None\n        }\n    }\n}\n\n/// Get all supported languages\npub fn supported_languages() -\u003e Vec\u003cLanguage\u003e {\n    vec![\n        Language::TypeScript,\n        Language::JavaScript,\n        Language::Python,\n        Language::Go,\n        Language::Php,\n        Language::Java,\n    ]\n}\n\n/// Get all supported file extensions\npub fn supported_extensions() -\u003e Vec\u003c\u0026'static str\u003e {\n    let mut extensions = Vec::new();\n    for lang in supported_languages() {\n        extensions.extend_from_slice(lang.extensions());\n    }\n    extensions\n}\n","traces":[{"line":61,"address":[25147520],"length":1,"stats":{"Line":7}},{"line":63,"address":[25147543],"length":1,"stats":{"Line":1}},{"line":64,"address":[25147615],"length":1,"stats":{"Line":6}},{"line":65,"address":[25147740,25147687],"length":1,"stats":{"Line":6}},{"line":66,"address":[25147717,25147782],"length":1,"stats":{"Line":5}},{"line":67,"address":[25147759,25147821],"length":1,"stats":{"Line":3}},{"line":68,"address":[25147798,25147860],"length":1,"stats":{"Line":4}},{"line":69,"address":[25147837,25147874],"length":1,"stats":{"Line":2}},{"line":70,"address":[25147867],"length":1,"stats":{"Line":1}},{"line":75,"address":[25147296],"length":1,"stats":{"Line":0}},{"line":76,"address":[25147301,25147494],"length":1,"stats":{"Line":0}},{"line":77,"address":[25147332],"length":1,"stats":{"Line":0}},{"line":78,"address":[25147358],"length":1,"stats":{"Line":0}},{"line":79,"address":[25147381],"length":1,"stats":{"Line":0}},{"line":80,"address":[25147404],"length":1,"stats":{"Line":0}},{"line":81,"address":[25147427],"length":1,"stats":{"Line":0}},{"line":82,"address":[25147450],"length":1,"stats":{"Line":0}},{"line":83,"address":[25147473],"length":1,"stats":{"Line":0}},{"line":106,"address":[25146128],"length":1,"stats":{"Line":1}},{"line":107,"address":[25146151],"length":1,"stats":{"Line":7}},{"line":108,"address":[25146356],"length":1,"stats":{"Line":1}},{"line":110,"address":[25146449],"length":1,"stats":{"Line":1}},{"line":112,"address":[25146460],"length":1,"stats":{"Line":1}},{"line":114,"address":[25146504],"length":1,"stats":{"Line":1}},{"line":115,"address":[25146548],"length":1,"stats":{"Line":1}},{"line":116,"address":[25146600],"length":1,"stats":{"Line":1}},{"line":117,"address":[25146641],"length":1,"stats":{"Line":1}},{"line":120,"address":[25146589],"length":1,"stats":{"Line":0}},{"line":126,"address":[25146704],"length":1,"stats":{"Line":0}},{"line":127,"address":[25146717,25146845],"length":1,"stats":{"Line":0}},{"line":138,"address":[25146864,25147267,25147273],"length":1,"stats":{"Line":0}},{"line":139,"address":[25146881],"length":1,"stats":{"Line":0}},{"line":140,"address":[25146895,25147096,25146952],"length":1,"stats":{"Line":0}},{"line":141,"address":[25147144,25147246],"length":1,"stats":{"Line":0}},{"line":143,"address":[25147202],"length":1,"stats":{"Line":0}}],"covered":18,"coverable":35},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","php.rs"],"content":"//! PHP parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct PhpParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl PhpParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_php::language_php())\n            .expect(\"Failed to load PHP grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (PHP-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        if normalized_path.contains(\u0026normalized_pattern) {\n            return true;\n        }\n\n        // PHP uses namespaces with backslashes: App\\Controllers\\UserController\n        // Also handle PSR-4 autoloading paths\n        let path_with_backslash = normalized_path.replace('/', \"\\\\\");\n        if path_with_backslash.contains(\u0026normalized_pattern.replace('/', \"\\\\\")) {\n            return true;\n        }\n\n        // Check if import contains pattern folder\n        if let Some(last_segment) = normalized_path.split(\u0026['/', '\\\\']).last() {\n            if let Some(pattern_last) = normalized_pattern.split(\u0026['/', '\\\\']).last() {\n                if last_segment.contains(pattern_last) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for PhpParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse PHP\"))?;\n\n        // Query for use declarations and require/include statements\n        let query_source = r#\"\n            [\n              (namespace_use_declaration\n                (namespace_use_clause\n                  (qualified_name) @import_path))\n              (require_expression\n                (string) @import_path)\n              (require_once_expression\n                (string) @import_path)\n              (include_expression\n                (string) @import_path)\n              (include_once_expression\n                (string) @import_path)\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_php::language_php(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path_raw = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n\n                // Remove quotes from string literals (for require/include)\n                let import_path = import_path_raw.trim_matches('\"').trim_matches('\\'');\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"namespace_use_declaration\"\n                        || p.kind() == \"require_expression\"\n                        || p.kind() == \"require_once_expression\"\n                        || p.kind() == \"include_expression\"\n                        || p.kind() == \"include_once_expression\"\n                    {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"use {};\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // PHP-specific rules\n            // Example: Controllers shouldn't import Models directly\n            if file_path_str.contains(\"controller\")\n                \u0026\u0026 import.source.to_lowercase().contains(\"model\")\n            {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"controller\".to_string(),\n                        to: \"model\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[24627888,24628166,24628172],"length":1,"stats":{"Line":1}},{"line":17,"address":[24627902],"length":1,"stats":{"Line":1}},{"line":19,"address":[24627926,24627979],"length":1,"stats":{"Line":4}},{"line":23,"address":[24628103],"length":1,"stats":{"Line":2}},{"line":28,"address":[24627853,24627875,24625920],"length":1,"stats":{"Line":1}},{"line":29,"address":[24625984],"length":1,"stats":{"Line":1}},{"line":30,"address":[24626371,24626510,24626243],"length":1,"stats":{"Line":3}},{"line":36,"address":[24626819],"length":1,"stats":{"Line":1}},{"line":37,"address":[24626928],"length":1,"stats":{"Line":1}},{"line":42,"address":[24626905,24626957],"length":1,"stats":{"Line":0}},{"line":43,"address":[24627002,24627103],"length":1,"stats":{"Line":0}},{"line":44,"address":[24627824],"length":1,"stats":{"Line":0}},{"line":48,"address":[24627315],"length":1,"stats":{"Line":0}},{"line":49,"address":[24627504,24627561],"length":1,"stats":{"Line":0}},{"line":50,"address":[24627719],"length":1,"stats":{"Line":0}},{"line":51,"address":[24627747],"length":1,"stats":{"Line":0}},{"line":56,"address":[24627521],"length":1,"stats":{"Line":0}},{"line":61,"address":[24622511,24618736,24622658],"length":1,"stats":{"Line":1}},{"line":62,"address":[24618850],"length":1,"stats":{"Line":1}},{"line":65,"address":[24619015,24619296,24619199],"length":1,"stats":{"Line":3}},{"line":69,"address":[24619127],"length":1,"stats":{"Line":1}},{"line":70,"address":[24368167,24368160],"length":1,"stats":{"Line":2}},{"line":73,"address":[24618823],"length":1,"stats":{"Line":1}},{"line":89,"address":[24622593,24619404],"length":1,"stats":{"Line":2}},{"line":91,"address":[24619939],"length":1,"stats":{"Line":3}},{"line":92,"address":[24620058,24619974],"length":1,"stats":{"Line":6}},{"line":94,"address":[24620140,24620344],"length":1,"stats":{"Line":6}},{"line":95,"address":[24622484,24620656,24620423],"length":1,"stats":{"Line":7}},{"line":96,"address":[24620782],"length":1,"stats":{"Line":3}},{"line":97,"address":[24620805],"length":1,"stats":{"Line":3}},{"line":100,"address":[24621033],"length":1,"stats":{"Line":3}},{"line":101,"address":[24621243,24621145],"length":1,"stats":{"Line":1}},{"line":104,"address":[24621216,24621263],"length":1,"stats":{"Line":6}},{"line":105,"address":[24621908,24621265],"length":1,"stats":{"Line":5}},{"line":106,"address":[24621385,24621311],"length":1,"stats":{"Line":6}},{"line":107,"address":[24621447],"length":1,"stats":{"Line":3}},{"line":108,"address":[24621558],"length":1,"stats":{"Line":3}},{"line":109,"address":[24621657],"length":1,"stats":{"Line":2}},{"line":110,"address":[24621756],"length":1,"stats":{"Line":1}},{"line":114,"address":[24621855],"length":1,"stats":{"Line":1}},{"line":117,"address":[24621929,24622283,24621346],"length":1,"stats":{"Line":3}},{"line":118,"address":[24622026,24621961],"length":1,"stats":{"Line":3}},{"line":119,"address":[24622069],"length":1,"stats":{"Line":1}},{"line":122,"address":[24621986,24622173],"length":1,"stats":{"Line":0}},{"line":125,"address":[24622377],"length":1,"stats":{"Line":2}},{"line":126,"address":[24622135],"length":1,"stats":{"Line":2}},{"line":128,"address":[24622337],"length":1,"stats":{"Line":1}},{"line":133,"address":[24620496],"length":1,"stats":{"Line":1}},{"line":136,"address":[24625879,24622704,24624998],"length":1,"stats":{"Line":1}},{"line":142,"address":[24622823],"length":1,"stats":{"Line":1}},{"line":143,"address":[24622904,24622964],"length":1,"stats":{"Line":2}},{"line":144,"address":[24623169,24623217],"length":1,"stats":{"Line":2}},{"line":146,"address":[24623391,24623593],"length":1,"stats":{"Line":2}},{"line":148,"address":[24623702,24623933],"length":1,"stats":{"Line":2}},{"line":149,"address":[24624055,24625038],"length":1,"stats":{"Line":2}},{"line":150,"address":[24625107],"length":1,"stats":{"Line":1}},{"line":152,"address":[24625222],"length":1,"stats":{"Line":1}},{"line":153,"address":[24625638],"length":1,"stats":{"Line":1}},{"line":154,"address":[24625260],"length":1,"stats":{"Line":1}},{"line":155,"address":[24625295],"length":1,"stats":{"Line":1}},{"line":156,"address":[24625358],"length":1,"stats":{"Line":1}},{"line":157,"address":[24625566],"length":1,"stats":{"Line":1}},{"line":158,"address":[24625434],"length":1,"stats":{"Line":1}},{"line":159,"address":[24625502],"length":1,"stats":{"Line":1}},{"line":161,"address":[24625630],"length":1,"stats":{"Line":1}},{"line":168,"address":[24624089],"length":1,"stats":{"Line":1}},{"line":169,"address":[24624201],"length":1,"stats":{"Line":0}},{"line":171,"address":[24624814],"length":1,"stats":{"Line":0}},{"line":172,"address":[24624432],"length":1,"stats":{"Line":0}},{"line":173,"address":[24624467],"length":1,"stats":{"Line":0}},{"line":174,"address":[24624530],"length":1,"stats":{"Line":0}},{"line":175,"address":[24624742],"length":1,"stats":{"Line":0}},{"line":176,"address":[24624598],"length":1,"stats":{"Line":0}},{"line":177,"address":[24624670],"length":1,"stats":{"Line":0}},{"line":179,"address":[24624806],"length":1,"stats":{"Line":0}},{"line":184,"address":[24623759],"length":1,"stats":{"Line":1}}],"covered":58,"coverable":76},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","python.rs"],"content":"//! Python parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\npub struct PythonParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl PythonParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_python::language())\n            .expect(\"Failed to load Python grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n\n    /// Check if a file/import path matches a pattern (Python-specific)\n    fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n        let normalized_path = path.to_lowercase().replace('\\\\', \"/\");\n        let normalized_pattern = pattern\n            .to_lowercase()\n            .replace('\\\\', \"/\")\n            .replace(\"**\", \"\")\n            .replace('*', \"\");\n\n        // Python imports use dots: apps.user.models\n        // Convert to path-like for matching: apps/user/models\n        let path_as_dots = normalized_path.replace('/', \".\");\n        let pattern_as_dots = normalized_pattern.replace('/', \".\");\n\n        if path_as_dots.contains(\u0026pattern_as_dots) || normalized_path.contains(\u0026normalized_pattern)\n        {\n            return true;\n        }\n\n        // Check if import contains pattern folder\n        if pattern_as_dots.contains('.') {\n            let parts: Vec\u003c\u0026str\u003e = pattern_as_dots.split('.').collect();\n            for part in parts {\n                if !part.is_empty() \u0026\u0026 path_as_dots.contains(part) {\n                    return true;\n                }\n            }\n        }\n\n        false\n    }\n}\n\nimpl ArchitectParser for PythonParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        let mut imports = Vec::new();\n\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse Python\"))?;\n\n        // Query for different types of imports\n        // 1. import x.y.z\n        // 2. from x.y import z\n        let query_source = r#\"\n            [\n              (import_statement\n                name: (dotted_name) @import_path)\n              (import_from_statement\n                module_name: (dotted_name) @import_path)\n            ]\n        \"#;\n\n        let query = Query::new(\u0026tree_sitter_python::language(), query_source).into_diagnostic()?;\n\n        let mut cursor = QueryCursor::new();\n        let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n        for match_ in matches {\n            for capture in match_.captures {\n                let node = capture.node;\n                let import_path = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n                let line_number = node.start_position().row + 1;\n\n                // Get the full import statement\n                let mut parent = node.parent();\n                while let Some(p) = parent {\n                    if p.kind() == \"import_statement\" || p.kind() == \"import_from_statement\" {\n                        break;\n                    }\n                    parent = p.parent();\n                }\n\n                let raw_statement = if let Some(p) = parent {\n                    p.utf8_text(source_code.as_bytes())\n                        .unwrap_or(import_path)\n                        .to_string()\n                } else {\n                    format!(\"import {}\", import_path)\n                };\n\n                imports.push(Import {\n                    source: import_path.to_string(),\n                    line_number,\n                    raw_statement,\n                });\n            }\n        }\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        let mut violations = Vec::new();\n        let imports = self.extract_imports(source_code, file_path)?;\n        let file_path_str = file_path.to_string_lossy().to_lowercase();\n\n        for import in imports {\n            // Check against forbidden rules\n            for rule in \u0026context.forbidden_imports {\n                let file_matches = Self::matches_pattern(\u0026file_path_str, \u0026rule.from);\n                let import_matches = Self::matches_pattern(\u0026import.source, \u0026rule.to);\n\n                if file_matches \u0026\u0026 import_matches {\n                    violations.push(Violation {\n                        file_path: file_path.to_path_buf(),\n                        file_content: source_code.to_string(),\n                        offensive_import: import.raw_statement.clone(),\n                        rule: ForbiddenRule {\n                            from: rule.from.clone(),\n                            to: rule.to.clone(),\n                        },\n                        line_number: import.line_number,\n                    });\n                }\n            }\n\n            // Python-specific rules (similar to Controller → Repository in TS)\n            // Example: views shouldn't import models directly\n            if file_path_str.contains(\"views\") \u0026\u0026 import.source.contains(\"models\") {\n                violations.push(Violation {\n                    file_path: file_path.to_path_buf(),\n                    file_content: source_code.to_string(),\n                    offensive_import: import.raw_statement.clone(),\n                    rule: ForbiddenRule {\n                        from: \"views\".to_string(),\n                        to: \"models\".to_string(),\n                    },\n                    line_number: import.line_number,\n                });\n            }\n        }\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":16,"address":[25074332,25074048,25074326],"length":1,"stats":{"Line":1}},{"line":17,"address":[25074062],"length":1,"stats":{"Line":1}},{"line":19,"address":[25074139,25074086],"length":1,"stats":{"Line":2}},{"line":23,"address":[25074263],"length":1,"stats":{"Line":1}},{"line":28,"address":[25071936,25073967,25074030],"length":1,"stats":{"Line":1}},{"line":29,"address":[25072000],"length":1,"stats":{"Line":1}},{"line":30,"address":[25072387,25072259,25072526],"length":1,"stats":{"Line":6}},{"line":38,"address":[25072835],"length":1,"stats":{"Line":2}},{"line":39,"address":[25073002,25072919],"length":1,"stats":{"Line":4}},{"line":41,"address":[25073047,25073223,25073130],"length":1,"stats":{"Line":5}},{"line":43,"address":[25073197],"length":1,"stats":{"Line":1}},{"line":47,"address":[25073264],"length":1,"stats":{"Line":1}},{"line":48,"address":[25073359],"length":1,"stats":{"Line":2}},{"line":49,"address":[25073437,25073643],"length":1,"stats":{"Line":4}},{"line":50,"address":[25073838,25073732],"length":1,"stats":{"Line":4}},{"line":51,"address":[25073921],"length":1,"stats":{"Line":1}},{"line":56,"address":[25073321],"length":1,"stats":{"Line":1}},{"line":61,"address":[25068840,25065360,25068693],"length":1,"stats":{"Line":1}},{"line":62,"address":[25065474],"length":1,"stats":{"Line":1}},{"line":65,"address":[25065823,25065639,25065920],"length":1,"stats":{"Line":2}},{"line":69,"address":[25065751],"length":1,"stats":{"Line":1}},{"line":70,"address":[24577111,24577104],"length":1,"stats":{"Line":2}},{"line":75,"address":[25065447],"length":1,"stats":{"Line":1}},{"line":84,"address":[25068775,25066028],"length":1,"stats":{"Line":1}},{"line":86,"address":[25066563],"length":1,"stats":{"Line":1}},{"line":87,"address":[25066598,25066682],"length":1,"stats":{"Line":5}},{"line":89,"address":[25066968,25066764],"length":1,"stats":{"Line":3}},{"line":90,"address":[25068666,25067280,25067047],"length":1,"stats":{"Line":6}},{"line":91,"address":[25067406],"length":1,"stats":{"Line":2}},{"line":92,"address":[25067429],"length":1,"stats":{"Line":2}},{"line":93,"address":[25067667,25067753],"length":1,"stats":{"Line":2}},{"line":96,"address":[25067773,25067726],"length":1,"stats":{"Line":3}},{"line":97,"address":[25067775,25068091],"length":1,"stats":{"Line":1}},{"line":98,"address":[25067821,25067883],"length":1,"stats":{"Line":4}},{"line":101,"address":[25068038],"length":1,"stats":{"Line":0}},{"line":104,"address":[25068112,25068468,25067850],"length":1,"stats":{"Line":5}},{"line":105,"address":[25068209,25068144],"length":1,"stats":{"Line":4}},{"line":106,"address":[25068252],"length":1,"stats":{"Line":1}},{"line":109,"address":[25068356,25068169],"length":1,"stats":{"Line":0}},{"line":112,"address":[25068559],"length":1,"stats":{"Line":1}},{"line":113,"address":[25068318],"length":1,"stats":{"Line":2}},{"line":115,"address":[25068519],"length":1,"stats":{"Line":2}},{"line":120,"address":[25067120],"length":1,"stats":{"Line":1}},{"line":123,"address":[25068880,25071023,25071904],"length":1,"stats":{"Line":1}},{"line":129,"address":[25068999],"length":1,"stats":{"Line":1}},{"line":130,"address":[25069080,25069140],"length":1,"stats":{"Line":2}},{"line":131,"address":[25069393,25069345],"length":1,"stats":{"Line":2}},{"line":133,"address":[25069769,25069567],"length":1,"stats":{"Line":2}},{"line":135,"address":[25070109,25069878],"length":1,"stats":{"Line":2}},{"line":136,"address":[25071063,25070231],"length":1,"stats":{"Line":2}},{"line":137,"address":[25071132],"length":1,"stats":{"Line":1}},{"line":139,"address":[25071247],"length":1,"stats":{"Line":2}},{"line":140,"address":[25071663],"length":1,"stats":{"Line":1}},{"line":141,"address":[25071285],"length":1,"stats":{"Line":1}},{"line":142,"address":[25071320],"length":1,"stats":{"Line":1}},{"line":143,"address":[25071383],"length":1,"stats":{"Line":1}},{"line":144,"address":[25071591],"length":1,"stats":{"Line":1}},{"line":145,"address":[25071459],"length":1,"stats":{"Line":1}},{"line":146,"address":[25071527],"length":1,"stats":{"Line":1}},{"line":148,"address":[25071655],"length":1,"stats":{"Line":1}},{"line":155,"address":[25070265,25070377],"length":1,"stats":{"Line":1}},{"line":156,"address":[25070839],"length":1,"stats":{"Line":0}},{"line":157,"address":[25070457],"length":1,"stats":{"Line":0}},{"line":158,"address":[25070492],"length":1,"stats":{"Line":0}},{"line":159,"address":[25070555],"length":1,"stats":{"Line":0}},{"line":160,"address":[25070767],"length":1,"stats":{"Line":0}},{"line":161,"address":[25070623],"length":1,"stats":{"Line":0}},{"line":162,"address":[25070695],"length":1,"stats":{"Line":0}},{"line":164,"address":[25070831],"length":1,"stats":{"Line":0}},{"line":169,"address":[25069935],"length":1,"stats":{"Line":1}}],"covered":60,"coverable":70},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","typescript.rs"],"content":"//! TypeScript/JavaScript parser using Tree-sitter\n\nuse super::{ArchitectParser, Import};\nuse crate::autofix::Violation;\nuse crate::config::LinterContext;\nuse miette::{IntoDiagnostic, Result};\nuse std::path::Path;\nuse std::sync::Mutex;\nuse tree_sitter::{Parser, Query, QueryCursor};\n\n// Import pure functions for unit testing\nuse super::typescript_pure;\n\npub struct TypeScriptParser {\n    parser: Mutex\u003cParser\u003e,\n}\n\nimpl TypeScriptParser {\n    pub fn new() -\u003e Self {\n        let mut parser = Parser::new();\n        parser\n            .set_language(\u0026tree_sitter_typescript::language_typescript())\n            .expect(\"Failed to load TypeScript grammar\");\n\n        Self {\n            parser: Mutex::new(parser),\n        }\n    }\n}\n\nimpl ArchitectParser for TypeScriptParser {\n    fn extract_imports(\u0026self, source_code: \u0026str, _file_path: \u0026Path) -\u003e Result\u003cVec\u003cImport\u003e\u003e {\n        // Parse the source code\n        let tree = self\n            .parser\n            .lock()\n            .unwrap()\n            .parse(source_code, None)\n            .ok_or_else(|| miette::miette!(\"Failed to parse TypeScript\"))?;\n\n        // Use the pure function to extract imports from the AST\n        let pure_imports = typescript_pure::extract_imports_from_tree(\n            \u0026tree,\n            source_code,\n        )?;\n\n        // Convert pure module Import type to parser Import type\n        let imports = pure_imports\n            .into_iter()\n            .map(|pure_import| Import {\n                source: pure_import.source,\n                line_number: pure_import.line_number,\n                raw_statement: pure_import.raw_statement,\n            })\n            .collect();\n\n        Ok(imports)\n    }\n\n    fn find_violations(\n        \u0026self,\n        source_code: \u0026str,\n        file_path: \u0026Path,\n        context: \u0026LinterContext,\n    ) -\u003e Result\u003cVec\u003cViolation\u003e\u003e {\n        // Extract imports using the parser\n        let imports = self.extract_imports(source_code, file_path)?;\n\n        // Convert parser Import type to pure module Import type\n        let pure_imports: Vec\u003ctypescript_pure::Import\u003e = imports\n            .iter()\n            .map(|import| typescript_pure::Import {\n                source: import.source.clone(),\n                line_number: import.line_number,\n                raw_statement: import.raw_statement.clone(),\n            })\n            .collect();\n\n        // Use the pure function to find violations\n        let violations = typescript_pure::find_violations_in_imports(\n            file_path,\n            source_code,\n            \u0026pure_imports,\n            context,\n        );\n\n        Ok(violations)\n    }\n}\n","traces":[{"line":19,"address":[25443008,25443292,25443286],"length":1,"stats":{"Line":2}},{"line":20,"address":[25443022],"length":1,"stats":{"Line":1}},{"line":22,"address":[25443099,25443046],"length":1,"stats":{"Line":3}},{"line":26,"address":[25443223],"length":1,"stats":{"Line":2}},{"line":32,"address":[25442301,25442274,25441376],"length":1,"stats":{"Line":1}},{"line":34,"address":[25441509,25441640,25441710,25441443],"length":1,"stats":{"Line":5}},{"line":38,"address":[25441586],"length":1,"stats":{"Line":3}},{"line":39,"address":[25441609,25441697,25442314,25441530,25441749],"length":1,"stats":{"Line":4}},{"line":48,"address":[25442018],"length":1,"stats":{"Line":2}},{"line":50,"address":[24891041,24890976],"length":1,"stats":{"Line":4}},{"line":51,"address":[24890984],"length":1,"stats":{"Line":1}},{"line":52,"address":[24891010],"length":1,"stats":{"Line":1}},{"line":53,"address":[24891014],"length":1,"stats":{"Line":1}},{"line":57,"address":[25442185],"length":1,"stats":{"Line":2}},{"line":60,"address":[25442989,25442336,25442995],"length":1,"stats":{"Line":1}},{"line":67,"address":[25442432],"length":1,"stats":{"Line":1}},{"line":70,"address":[25442608],"length":1,"stats":{"Line":1}},{"line":72,"address":[24891299,24891237,24891104,24891305],"length":1,"stats":{"Line":3}},{"line":73,"address":[24891140],"length":1,"stats":{"Line":1}},{"line":74,"address":[24891169],"length":1,"stats":{"Line":1}},{"line":75,"address":[24891178],"length":1,"stats":{"Line":1}},{"line":83,"address":[25442772],"length":1,"stats":{"Line":1}},{"line":87,"address":[25442917],"length":1,"stats":{"Line":1}}],"covered":23,"coverable":23},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","parsers","typescript_pure.rs"],"content":"//! Pure functions for TypeScript parser\n//!\n//! This module contains pure functions that can be unit tested independently\n//! of the Tree-sitter parser and file I/O operations.\n\nuse crate::autofix::Violation;\nuse crate::config::{ForbiddenRule, LinterContext};\nuse miette::IntoDiagnostic;\nuse std::path::Path;\nuse tree_sitter::{Query, QueryCursor, Tree};\n\n/// Represents an import statement extracted from source code\n#[derive(Debug, Clone, PartialEq)]\npub struct Import {\n    /// The import source/path (e.g., \"../services/user\", \"apps/user/models\")\n    pub source: String,\n    /// Line number where the import appears\n    pub line_number: usize,\n    /// Full import statement text\n    pub raw_statement: String,\n}\n\n/// Extract imports from a parsed Tree-sitter tree\n///\n/// This is a pure function that operates on the already-parsed tree,\n/// making it easier to test without needing to set up the full parser.\n///\n/// # Arguments\n/// * `tree` - The parsed Tree-sitter tree\n/// * `source_code` - The source code text (needed for extracting text content)\n///\n/// # Returns\n/// A vector of Import objects extracted from the tree\n///\n/// # Examples\n/// ```\n/// // This would be tested indirectly through the main parser tests\n/// // as it requires a valid Tree-sitter tree\n/// ```\npub fn extract_imports_from_tree(tree: \u0026Tree, source_code: \u0026str) -\u003e miette::Result\u003cVec\u003cImport\u003e\u003e {\n    let mut imports = Vec::new();\n\n    // Query for import declarations\n    let query_source = r#\"\n        (import_statement\n          source: (string (string_fragment) @import_path))\n    \"#;\n\n    let query = Query::new(\u0026tree_sitter_typescript::language_typescript(), query_source)\n        .into_diagnostic()?;\n\n    let mut cursor = QueryCursor::new();\n    let matches = cursor.matches(\u0026query, tree.root_node(), source_code.as_bytes());\n\n    for match_ in matches {\n        for capture in match_.captures {\n            let node = capture.node;\n            let import_path = node.utf8_text(source_code.as_bytes()).into_diagnostic()?;\n            let line_number = node.start_position().row + 1;\n\n            // Get the full import statement\n            let parent = node.parent();\n            let raw_statement = if let Some(p) = parent {\n                p.utf8_text(source_code.as_bytes())\n                    .unwrap_or(import_path)\n                    .to_string()\n            } else {\n                format!(\"import ... from '{}'\", import_path)\n            };\n\n            imports.push(Import {\n                source: import_path.to_string(),\n                line_number,\n                raw_statement,\n            });\n        }\n    }\n\n    Ok(imports)\n}\n\n/// Normalize a path string for pattern matching\n///\n/// Converts Windows backslashes to forward slashes and converts to lowercase\n/// for case-insensitive matching.\n///\n/// # Arguments\n/// * `path` - The path to normalize\n///\n/// # Returns\n/// A normalized string with consistent separators and case\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::normalize_path;\n///\n/// assert_eq!(normalize_path(\"C:\\\\Project\\\\Src\\\\File.ts\"), \"c:/project/src/file.ts\");\n/// assert_eq!(normalize_path(\"src/Components/Button.tsx\"), \"src/components/button.tsx\");\n/// ```\npub fn normalize_path(path: \u0026str) -\u003e String {\n    path.to_lowercase().replace('\\\\', \"/\")\n}\n\n/// Normalize a glob pattern for pattern matching\n///\n/// Removes glob wildcards (**, *) to create a simpler pattern string.\n///\n/// # Arguments\n/// * `pattern` - The glob pattern to normalize\n///\n/// # Returns\n/// A normalized pattern string with wildcards removed\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::normalize_pattern;\n///\n/// assert_eq!(normalize_pattern(\"src/components/**\"), \"src/components/\");\n/// assert_eq!(normalize_pattern(\"**/*.tsx\"), \"/.tsx\");\n/// ```\npub fn normalize_pattern(pattern: \u0026str) -\u003e String {\n    pattern\n        .to_lowercase()\n        .replace('\\\\', \"/\")\n        .replace(\"**\", \"\")\n        .replace('*', \"\")\n}\n\n/// Extract the folder component from a pattern containing \"src/\"\n///\n/// This is used to match imports against file path patterns.\n/// For example, \"src/services/\" becomes \"services/\" for flexible matching.\n///\n/// # Arguments\n/// * `pattern` - The pattern to extract from\n///\n/// # Returns\n/// The folder component after \"src/\", or None if not found\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::extract_folder_from_pattern;\n///\n/// assert_eq!(extract_folder_from_pattern(\"src/services/\"), Some(\"services/\".to_string()));\n/// assert_eq!(extract_folder_from_pattern(\"src/components/\"), Some(\"components/\".to_string()));\n/// assert_eq!(extract_folder_from_pattern(\"lib/utils/\"), None);\n/// ```\npub fn extract_folder_from_pattern(pattern: \u0026str) -\u003e Option\u003cString\u003e {\n    let normalized = normalize_pattern(pattern);\n    if normalized.contains(\"src/\") {\n        normalized.strip_prefix(\"src/\").map(|s| s.to_string())\n    } else {\n        None\n    }\n}\n\n/// Generate alternative import patterns to check against a folder pattern\n///\n/// When matching imports against file path patterns, we need to check multiple\n/// representations because imports can be relative, absolute, or use aliases.\n///\n/// # Arguments\n/// * `folder` - The folder name to generate patterns for\n///\n/// # Returns\n/// A vector of pattern variations to check\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::generate_import_patterns;\n///\n/// let patterns = generate_import_patterns(\"services/\");\n/// assert!(patterns.contains(\u0026\"/services/\".to_string()));\n/// assert!(patterns.contains(\u0026\"../services/\".to_string()));\n/// assert!(patterns.contains(\u0026\"@/services/\".to_string()));\n/// ```\npub fn generate_import_patterns(folder: \u0026str) -\u003e Vec\u003cString\u003e {\n    vec![\n        format!(\"/{}\", folder),           // Absolute path pattern\n        format!(\"../{}\", folder),         // Relative path pattern\n        format!(\"@/{}\", folder),          // Alias pattern\n        folder.to_string(),               // Direct pattern\n    ]\n}\n\n/// Check if a path matches a given pattern\n///\n/// This performs flexible matching to handle different path formats:\n/// - Absolute paths: \"src/components/button.tsx\"\n/// - Relative imports: \"../services/userservice\"\n/// - Alias imports: \"@/services/api\"\n///\n/// # Arguments\n/// * `path` - The path to check\n/// * `pattern` - The pattern to match against\n///\n/// # Returns\n/// true if the path matches the pattern, false otherwise\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::matches_pattern;\n///\n/// // Direct containment\n/// assert!(matches_pattern(\"src/components/button.tsx\", \"src/components/\"));\n///\n/// // Relative imports\n/// assert!(matches_pattern(\"../services/userservice\", \"src/services/\"));\n///\n/// // Alias imports\n/// assert!(matches_pattern(\"@/services/api\", \"src/services/\"));\n///\n/// // Non-matching\n/// assert!(!matches_pattern(\"src/models/user.ts\", \"src/components/\"));\n/// ```\npub fn matches_pattern(path: \u0026str, pattern: \u0026str) -\u003e bool {\n    let normalized_path = normalize_path(path);\n    let normalized_pattern = normalize_pattern(pattern);\n\n    // Empty pattern matches nothing\n    if normalized_pattern.is_empty() {\n        return false;\n    }\n\n    // Direct containment check\n    if normalized_path.contains(\u0026normalized_pattern) {\n        return true;\n    }\n\n    // For patterns with \"src/\", extract folder and check alternatives\n    if let Some(folder_part) = extract_folder_from_pattern(pattern) {\n        // Don't match if the folder_part is empty (e.g., pattern is just \"src/\")\n        if folder_part.is_empty() || folder_part == \"/\" {\n            return false;\n        }\n\n        let import_patterns = generate_import_patterns(\u0026folder_part);\n        for import_pattern in import_patterns {\n            if normalized_path.contains(\u0026import_pattern) {\n                return true;\n            }\n        }\n    }\n\n    false\n}\n\n/// Check if a file path and import source match a forbidden rule\n///\n/// # Arguments\n/// * `file_path` - The path of the file containing the import\n/// * `import_source` - The import path being checked\n/// * `rule` - The forbidden rule to check against\n///\n/// # Returns\n/// true if the combination violates the rule, false otherwise\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::matches_forbidden_rule;\n/// use architect_linter_pro::config::ForbiddenRule;\n///\n/// let rule = ForbiddenRule {\n///     from: \"src/controller/\".to_string(),\n///     to: \"src/repository/\".to_string(),\n/// };\n///\n/// // Violation: controller importing from repository\n/// assert!(matches_forbidden_rule(\n///     \"src/controller/user.controller.ts\",\n///     \"../repository/user\",\n///     \u0026rule\n/// ));\n///\n/// // No violation: service importing from repository\n/// assert!(!matches_forbidden_rule(\n///     \"src/service/user.service.ts\",\n///     \"../repository/user\",\n///     \u0026rule\n/// ));\n/// ```\npub fn matches_forbidden_rule(\n    file_path: \u0026str,\n    import_source: \u0026str,\n    rule: \u0026ForbiddenRule,\n) -\u003e bool {\n    let file_matches = matches_pattern(file_path, \u0026rule.from);\n    let import_matches = matches_pattern(import_source, \u0026rule.to);\n\n    file_matches \u0026\u0026 import_matches\n}\n\n/// Check if a controller file imports from a repository (MVC pattern violation)\n///\n/// This is a special-case rule for common MVC architecture violations.\n/// Checks if the import path contains \"repository\" (with or without a dot prefix).\n///\n/// # Arguments\n/// * `file_path` - The path of the file to check\n/// * `import_source` - The import path being checked\n///\n/// # Returns\n/// true if this is a controller importing a repository, false otherwise\n///\n/// # Examples\n/// ```\n/// use architect_linter_pro::parsers::typescript_pure::is_controller_to_repository_violation;\n///\n/// // Matches: ../repository/user\n/// assert!(is_controller_to_repository_violation(\n///     \"src/controller/user.controller.ts\",\n///     \"../repository/user\"\n/// ));\n///\n/// // Matches: ./user.repository\n/// assert!(is_controller_to_repository_violation(\n///     \"src/controller/user.controller.ts\",\n///     \"./user.repository\"\n/// ));\n///\n/// // Doesn't match: not a repository import\n/// assert!(!is_controller_to_repository_violation(\n///     \"src/controller/user.controller.ts\",\n///     \"../service/user\"\n/// ));\n/// ```\npub fn is_controller_to_repository_violation(file_path: \u0026str, import_source: \u0026str) -\u003e bool {\n    let normalized_file_path = normalize_path(file_path);\n    let normalized_import = normalize_path(import_source);\n\n    let is_controller = normalized_file_path.contains(\"controller\");\n    let is_repository = normalized_import.contains(\"repository\")\n        || normalized_import.contains(\".repository\");\n\n    is_controller \u0026\u0026 is_repository\n}\n\n/// Check all forbidden rules for a single import\n///\n/// # Arguments\n/// * `file_path` - The path of the file containing the import\n/// * `import` - The import to check\n/// * `forbidden_rules` - List of forbidden rules to check against\n///\n/// # Returns\n/// A vector of matching rule indices\npub fn check_import_against_rules(\n    file_path: \u0026str,\n    import: \u0026Import,\n    forbidden_rules: \u0026[ForbiddenRule],\n) -\u003e Vec\u003cusize\u003e {\n    let mut matching_rules = Vec::new();\n\n    for (idx, rule) in forbidden_rules.iter().enumerate() {\n        if matches_forbidden_rule(file_path, \u0026import.source, rule) {\n            matching_rules.push(idx);\n        }\n    }\n\n    matching_rules\n}\n\n/// Create violations for a matching rule\n///\n/// # Arguments\n/// * `file_path` - The path of the file\n/// * `source_code` - The source code content\n/// * `import` - The import that violates the rule\n/// * `rule` - The rule being violated\n///\n/// # Returns\n/// A Violation object representing the violation\npub fn create_violation(\n    file_path: \u0026Path,\n    source_code: \u0026str,\n    import: \u0026Import,\n    rule: ForbiddenRule,\n) -\u003e Violation {\n    Violation {\n        file_path: file_path.to_path_buf(),\n        file_content: source_code.to_string(),\n        offensive_import: import.raw_statement.clone(),\n        rule,\n        line_number: import.line_number,\n    }\n}\n\n/// Find all violations in a set of imports\n///\n/// # Arguments\n/// * `file_path` - The path of the file being checked\n/// * `source_code` - The source code content\n/// * `imports` - List of imports extracted from the file\n/// * `context` - The linter context containing rules\n///\n/// # Returns\n/// A vector of violations found\npub fn find_violations_in_imports(\n    file_path: \u0026Path,\n    source_code: \u0026str,\n    imports: \u0026[Import],\n    context: \u0026LinterContext,\n) -\u003e Vec\u003cViolation\u003e {\n    let mut violations = Vec::new();\n    let file_path_str = file_path.to_string_lossy().to_string();\n\n    for import in imports {\n        // Check against configured forbidden rules\n        for rule in \u0026context.forbidden_imports {\n            if matches_forbidden_rule(\u0026file_path_str, \u0026import.source, rule) {\n                violations.push(create_violation(\n                    file_path,\n                    source_code,\n                    import,\n                    rule.clone(),\n                ));\n            }\n        }\n\n        // Check for controller-to-repository violations\n        if is_controller_to_repository_violation(\u0026file_path_str, \u0026import.source) {\n            violations.push(create_violation(\n                file_path,\n                source_code,\n                import,\n                ForbiddenRule {\n                    from: \"controller\".to_string(),\n                    to: \".repository\".to_string(),\n                },\n            ));\n        }\n    }\n\n    violations\n}\n\n/// Filter imports to find those that match a pattern\n///\n/// # Arguments\n/// * `imports` - List of imports to filter\n/// * `pattern` - Pattern to match against\n///\n/// # Returns\n/// Imports whose source matches the pattern\npub fn filter_imports_by_pattern\u003c'a\u003e(imports: \u0026'a [Import], pattern: \u0026str) -\u003e Vec\u003c\u0026'a Import\u003e {\n    imports\n        .iter()\n        .filter(|import| matches_pattern(\u0026import.source, pattern))\n        .collect()\n}\n\n/// Check if any import matches a pattern\n///\n/// # Arguments\n/// * `imports` - List of imports to check\n/// * `pattern` - Pattern to match against\n///\n/// # Returns\n/// true if any import matches the pattern\npub fn has_import_matching(imports: \u0026[Import], pattern: \u0026str) -\u003e bool {\n    imports\n        .iter()\n        .any(|import| matches_pattern(\u0026import.source, pattern))\n}\n\n/// Count imports matching a pattern\n///\n/// # Arguments\n/// * `imports` - List of imports to count\n/// * `pattern` - Pattern to match against\n///\n/// # Returns\n/// Number of imports matching the pattern\npub fn count_imports_matching(imports: \u0026[Import], pattern: \u0026str) -\u003e usize {\n    imports\n        .iter()\n        .filter(|import| matches_pattern(\u0026import.source, pattern))\n        .count()\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    // =========================================================================\n    // normalize_path tests\n    // =========================================================================\n\n    #[test]\n    fn test_normalize_path_windows_to_unix() {\n        assert_eq!(\n            normalize_path(\"C:\\\\Project\\\\Src\\\\File.ts\"),\n            \"c:/project/src/file.ts\"\n        );\n        assert_eq!(\n            normalize_path(\"src\\\\components\\\\Button.tsx\"),\n            \"src/components/button.tsx\"\n        );\n    }\n\n    #[test]\n    fn test_normalize_path_lowercase() {\n        assert_eq!(normalize_path(\"SRC/Components/Button\"), \"src/components/button\");\n        assert_eq!(normalize_path(\"MyFile.TS\"), \"myfile.ts\");\n    }\n\n    #[test]\n    fn test_normalize_path_mixed_separators() {\n        assert_eq!(\n            normalize_path(\"src\\\\components/Button.tsx\"),\n            \"src/components/button.tsx\"\n        );\n    }\n\n    // =========================================================================\n    // normalize_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_normalize_pattern_wildcards() {\n        assert_eq!(normalize_pattern(\"src/components/**\"), \"src/components/\");\n        assert_eq!(normalize_pattern(\"**/*.tsx\"), \"/.tsx\");\n        assert_eq!(normalize_pattern(\"src/services/*\"), \"src/services/\");\n    }\n\n    #[test]\n    fn test_normalize_pattern_no_wildcards() {\n        assert_eq!(normalize_pattern(\"src/components/\"), \"src/components/\");\n        assert_eq!(normalize_pattern(\"repository\"), \"repository\");\n    }\n\n    // =========================================================================\n    // extract_folder_from_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_extract_folder_from_pattern_with_src() {\n        assert_eq!(\n            extract_folder_from_pattern(\"src/services/\"),\n            Some(\"services/\".to_string())\n        );\n        assert_eq!(\n            extract_folder_from_pattern(\"src/components/**\"),\n            Some(\"components/\".to_string())\n        );\n    }\n\n    #[test]\n    fn test_extract_folder_from_pattern_without_src() {\n        assert_eq!(extract_folder_from_pattern(\"lib/utils/\"), None);\n        assert_eq!(extract_folder_from_pattern(\"repository\"), None);\n    }\n\n    // =========================================================================\n    // generate_import_patterns tests\n    // =========================================================================\n\n    #[test]\n    fn test_generate_import_patterns() {\n        let patterns = generate_import_patterns(\"services/\");\n        assert!(patterns.contains(\u0026\"/services/\".to_string()));\n        assert!(patterns.contains(\u0026\"../services/\".to_string()));\n        assert!(patterns.contains(\u0026\"@/services/\".to_string()));\n        assert!(patterns.contains(\u0026\"services/\".to_string()));\n        assert_eq!(patterns.len(), 4);\n    }\n\n    // =========================================================================\n    // matches_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_matches_pattern_direct_containment() {\n        assert!(matches_pattern(\"src/components/button.tsx\", \"src/components/\"));\n        assert!(matches_pattern(\"src/components/nested/Button.tsx\", \"src/components/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_relative_imports() {\n        assert!(matches_pattern(\"../services/userservice\", \"src/services/\"));\n        assert!(matches_pattern(\"../repository/user\", \"src/repository/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_alias_imports() {\n        assert!(matches_pattern(\"@/services/api\", \"src/services/\"));\n        assert!(matches_pattern(\"@/models/user\", \"src/models/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_case_insensitive() {\n        assert!(matches_pattern(\"SRC/Components/Button\", \"src/components/\"));\n        assert!(matches_pattern(\"src/COMPONENTS/Button\", \"src/components/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_no_match() {\n        assert!(!matches_pattern(\"src/models/user.ts\", \"src/components/\"));\n        assert!(!matches_pattern(\"test.ts\", \"src/\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_empty_pattern() {\n        assert!(!matches_pattern(\"src/components/Button.tsx\", \"\"));\n        assert!(!matches_pattern(\"test.ts\", \"\"));\n    }\n\n    #[test]\n    fn test_matches_pattern_windows_paths() {\n        assert!(matches_pattern(\n            \"C:\\\\Project\\\\Src\\\\Components\\\\Button.tsx\",\n            \"src/components/\"\n        ));\n    }\n\n    // =========================================================================\n    // matches_forbidden_rule tests\n    // =========================================================================\n\n    #[test]\n    fn test_matches_forbidden_rule_violation() {\n        let rule = ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        };\n\n        assert!(matches_forbidden_rule(\n            \"src/controller/user.controller.ts\",\n            \"../repository/user\",\n            \u0026rule\n        ));\n\n        assert!(matches_forbidden_rule(\n            \"SRC/CONTROLLER/User.Controller.ts\",\n            \"../repository/user\",\n            \u0026rule\n        ));\n    }\n\n    #[test]\n    fn test_matches_forbidden_rule_no_violation_different_file() {\n        let rule = ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        };\n\n        assert!(!matches_forbidden_rule(\n            \"src/service/user.service.ts\",\n            \"../repository/user\",\n            \u0026rule\n        ));\n    }\n\n    #[test]\n    fn test_matches_forbidden_rule_no_violation_different_import() {\n        let rule = ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        };\n\n        assert!(!matches_forbidden_rule(\n            \"src/controller/user.controller.ts\",\n            \"../service/user\",\n            \u0026rule\n        ));\n    }\n\n    // =========================================================================\n    // is_controller_to_repository_violation tests\n    // =========================================================================\n\n    #[test]\n    fn test_is_controller_to_repository_violation_true() {\n        assert!(is_controller_to_repository_violation(\n            \"src/controller/user.controller.ts\",\n            \"../repository/user\"\n        ));\n\n        assert!(is_controller_to_repository_violation(\n            \"CONTROLLER/User.Controller.ts\",\n            \"./user.repository\"\n        ));\n    }\n\n    #[test]\n    fn test_is_controller_to_repository_violation_false_not_controller() {\n        assert!(!is_controller_to_repository_violation(\n            \"src/service/user.service.ts\",\n            \"../repository/user\"\n        ));\n    }\n\n    #[test]\n    fn test_is_controller_to_repository_violation_false_not_repository() {\n        assert!(!is_controller_to_repository_violation(\n            \"src/controller/user.controller.ts\",\n            \"../service/user\"\n        ));\n    }\n\n    // =========================================================================\n    // filter_imports_by_pattern tests\n    // =========================================================================\n\n    #[test]\n    fn test_filter_imports_by_pattern() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        let filtered = filter_imports_by_pattern(\u0026imports, \"src/repository/\");\n        assert_eq!(filtered.len(), 1);\n        assert_eq!(filtered[0].source, \"../repository/user\");\n    }\n\n    #[test]\n    fn test_filter_imports_by_pattern_empty() {\n        let imports = vec![\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        let filtered = filter_imports_by_pattern(\u0026imports, \"src/repository/\");\n        assert_eq!(filtered.len(), 0);\n    }\n\n    // =========================================================================\n    // has_import_matching tests\n    // =========================================================================\n\n    #[test]\n    fn test_has_import_matching_true() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        assert!(has_import_matching(\u0026imports, \"src/repository/\"));\n    }\n\n    #[test]\n    fn test_has_import_matching_false() {\n        let imports = vec![\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        assert!(!has_import_matching(\u0026imports, \"src/repository/\"));\n    }\n\n    // =========================================================================\n    // count_imports_matching tests\n    // =========================================================================\n\n    #[test]\n    fn test_count_imports_matching() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../repository/product\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { Product } from '../repository/product';\".to_string(),\n            },\n            Import {\n                source: \"../service/user\".to_string(),\n                line_number: 3,\n                raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n            },\n        ];\n\n        assert_eq!(count_imports_matching(\u0026imports, \"src/repository/\"), 2);\n        assert_eq!(count_imports_matching(\u0026imports, \"src/service/\"), 1);\n        assert_eq!(count_imports_matching(\u0026imports, \"src/controller/\"), 0);\n    }\n\n    // =========================================================================\n    // check_import_against_rules tests\n    // =========================================================================\n\n    #[test]\n    fn test_check_import_against_rules_single_match() {\n        let rules = vec![\n            ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            },\n            ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/service/\".to_string(),\n            },\n        ];\n\n        let import = Import {\n            source: \"../repository/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { User } from '../repository/user';\".to_string(),\n        };\n\n        let matching = check_import_against_rules(\"src/controller/user.controller.ts\", \u0026import, \u0026rules);\n        assert_eq!(matching, vec![0]);\n    }\n\n    #[test]\n    fn test_check_import_against_rules_multiple_matches() {\n        let rules = vec![\n            ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            },\n            ForbiddenRule {\n                from: \"src/*/\".to_string(),\n                to: \"src/**/repository/\".to_string(),\n            },\n        ];\n\n        let import = Import {\n            source: \"../repository/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { User } from '../repository/user';\".to_string(),\n        };\n\n        let matching = check_import_against_rules(\"src/controller/user.controller.ts\", \u0026import, \u0026rules);\n        // Should match both rules (if pattern matching allows it)\n        assert!(!matching.is_empty());\n    }\n\n    #[test]\n    fn test_check_import_against_rules_no_match() {\n        let rules = vec![ForbiddenRule {\n            from: \"src/controller/\".to_string(),\n            to: \"src/repository/\".to_string(),\n        }];\n\n        let import = Import {\n            source: \"../service/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n        };\n\n        let matching = check_import_against_rules(\"src/service/user.service.ts\", \u0026import, \u0026rules);\n        assert!(matching.is_empty());\n    }\n\n    // =========================================================================\n    // Integration-style tests\n    // =========================================================================\n\n    #[test]\n    fn test_find_violations_in_imports_multiple_violations() {\n        let imports = vec![\n            Import {\n                source: \"../repository/user\".to_string(),\n                line_number: 1,\n                raw_statement: \"import { User } from '../repository/user';\".to_string(),\n            },\n            Import {\n                source: \"../repository/product\".to_string(),\n                line_number: 2,\n                raw_statement: \"import { Product } from '../repository/product';\".to_string(),\n            },\n        ];\n\n        let context = LinterContext {\n            max_lines: 100,\n            framework: crate::config::Framework::NestJS,\n            pattern: crate::config::ArchPattern::MVC,\n            forbidden_imports: vec![ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            }],\n            ignored_paths: vec![],\n            ai_configs: vec![],\n        };\n\n        let violations = find_violations_in_imports(\n            Path::new(\"src/controller/user.controller.ts\"),\n            \"source code\",\n            \u0026imports,\n            \u0026context,\n        );\n\n        // Should have 4 violations:\n        // - 2 from the configured forbidden rule (user.repository and product.repository)\n        // - 2 from the controller-to-repository rule (same imports)\n        assert_eq!(violations.len(), 4);\n    }\n\n    #[test]\n    fn test_find_violations_in_imports_no_violations() {\n        let imports = vec![Import {\n            source: \"../service/user\".to_string(),\n            line_number: 1,\n            raw_statement: \"import { UserService } from '../service/user';\".to_string(),\n        }];\n\n        let context = LinterContext {\n            max_lines: 100,\n            framework: crate::config::Framework::NestJS,\n            pattern: crate::config::ArchPattern::MVC,\n            forbidden_imports: vec![ForbiddenRule {\n                from: \"src/controller/\".to_string(),\n                to: \"src/repository/\".to_string(),\n            }],\n            ignored_paths: vec![],\n            ai_configs: vec![],\n        };\n\n        let violations = find_violations_in_imports(\n            Path::new(\"src/controller/user.controller.ts\"),\n            \"source code\",\n            \u0026imports,\n            \u0026context,\n        );\n\n        assert_eq!(violations.len(), 0);\n    }\n}\n","traces":[{"line":40,"address":[25087918,25088027,25085440],"length":1,"stats":{"Line":1}},{"line":41,"address":[25085538],"length":1,"stats":{"Line":2}},{"line":44,"address":[25085511],"length":1,"stats":{"Line":2}},{"line":49,"address":[25085844,25085762,25085579,25085647],"length":1,"stats":{"Line":6}},{"line":52,"address":[25086152],"length":1,"stats":{"Line":3}},{"line":53,"address":[25086271,25086195],"length":1,"stats":{"Line":6}},{"line":55,"address":[25086341,25086545],"length":1,"stats":{"Line":6}},{"line":56,"address":[25087891,25086624,25086826],"length":1,"stats":{"Line":3}},{"line":57,"address":[25086946],"length":1,"stats":{"Line":1}},{"line":58,"address":[25086969],"length":1,"stats":{"Line":1}},{"line":59,"address":[25087287,25087201],"length":1,"stats":{"Line":1}},{"line":62,"address":[25087260],"length":1,"stats":{"Line":1}},{"line":63,"address":[25087693,25087307],"length":1,"stats":{"Line":1}},{"line":64,"address":[25087369,25087434],"length":1,"stats":{"Line":2}},{"line":65,"address":[25087477],"length":1,"stats":{"Line":1}},{"line":68,"address":[25087581,25087394],"length":1,"stats":{"Line":0}},{"line":71,"address":[25087784],"length":1,"stats":{"Line":1}},{"line":72,"address":[25087543],"length":1,"stats":{"Line":1}},{"line":74,"address":[25087744],"length":1,"stats":{"Line":1}},{"line":79,"address":[25086691],"length":1,"stats":{"Line":1}},{"line":100,"address":[25082008,25082002,25081840],"length":1,"stats":{"Line":1}},{"line":101,"address":[25081952,25081864],"length":1,"stats":{"Line":2}},{"line":121,"address":[25084108,25083664,25084114],"length":1,"stats":{"Line":1}},{"line":122,"address":[25083949,25083724,25083834],"length":1,"stats":{"Line":3}},{"line":148,"address":[25090272,25090560,25090566],"length":1,"stats":{"Line":0}},{"line":149,"address":[25090299],"length":1,"stats":{"Line":0}},{"line":150,"address":[25090443,25090388,25090323],"length":1,"stats":{"Line":0}},{"line":151,"address":[25090450,25090501],"length":1,"stats":{"Line":0}},{"line":153,"address":[25090430],"length":1,"stats":{"Line":0}},{"line":177,"address":[25085413,25085407,25084512],"length":1,"stats":{"Line":0}},{"line":178,"address":[25084936,25085157,25084759,25084591,25085394,25085113,25084549],"length":1,"stats":{"Line":0}},{"line":179,"address":[25084632,25084564],"length":1,"stats":{"Line":0}},{"line":180,"address":[25084800,25084732],"length":1,"stats":{"Line":0}},{"line":181,"address":[25084980,25084909],"length":1,"stats":{"Line":0}},{"line":182,"address":[25085084],"length":1,"stats":{"Line":0}},{"line":216,"address":[25082032,25083187,25083124],"length":1,"stats":{"Line":1}},{"line":217,"address":[25082090],"length":1,"stats":{"Line":1}},{"line":218,"address":[25082114],"length":1,"stats":{"Line":1}},{"line":221,"address":[25082238,25082182],"length":1,"stats":{"Line":2}},{"line":222,"address":[25082266],"length":1,"stats":{"Line":0}},{"line":226,"address":[25082286,25082249],"length":1,"stats":{"Line":2}},{"line":227,"address":[25082348],"length":1,"stats":{"Line":1}},{"line":231,"address":[25082358,25082329],"length":1,"stats":{"Line":0}},{"line":233,"address":[25082567,25082521,25082435],"length":1,"stats":{"Line":0}},{"line":234,"address":[25082553],"length":1,"stats":{"Line":0}},{"line":237,"address":[25082581],"length":1,"stats":{"Line":0}},{"line":238,"address":[25082627,25082821],"length":1,"stats":{"Line":0}},{"line":239,"address":[25082895,25083007],"length":1,"stats":{"Line":0}},{"line":240,"address":[25083062],"length":1,"stats":{"Line":0}},{"line":245,"address":[25082446],"length":1,"stats":{"Line":0}},{"line":282,"address":[25084304],"length":1,"stats":{"Line":1}},{"line":287,"address":[25084369],"length":1,"stats":{"Line":1}},{"line":288,"address":[25084418],"length":1,"stats":{"Line":1}},{"line":290,"address":[25084473],"length":1,"stats":{"Line":1}},{"line":327,"address":[25090576,25091065,25091071],"length":1,"stats":{"Line":1}},{"line":328,"address":[25090634],"length":1,"stats":{"Line":1}},{"line":329,"address":[25090676],"length":1,"stats":{"Line":1}},{"line":331,"address":[25090726,25090794],"length":1,"stats":{"Line":2}},{"line":332,"address":[25090931,25090842],"length":1,"stats":{"Line":2}},{"line":333,"address":[25090914,25090951],"length":1,"stats":{"Line":0}},{"line":335,"address":[25090995],"length":1,"stats":{"Line":1}},{"line":347,"address":[25088192,25088761,25088755],"length":1,"stats":{"Line":0}},{"line":352,"address":[25088274],"length":1,"stats":{"Line":0}},{"line":354,"address":[25088376,25088301],"length":1,"stats":{"Line":0}},{"line":355,"address":[25088603,25088698],"length":1,"stats":{"Line":0}},{"line":356,"address":[25088731],"length":1,"stats":{"Line":0}},{"line":360,"address":[25088630],"length":1,"stats":{"Line":0}},{"line":373,"address":[25083200,25083638],"length":1,"stats":{"Line":1}},{"line":380,"address":[25083285],"length":1,"stats":{"Line":1}},{"line":381,"address":[25083352],"length":1,"stats":{"Line":1}},{"line":382,"address":[25083411],"length":1,"stats":{"Line":1}},{"line":384,"address":[25083502],"length":1,"stats":{"Line":1}},{"line":398,"address":[25090004,25090236,25088784],"length":1,"stats":{"Line":1}},{"line":404,"address":[25088927],"length":1,"stats":{"Line":1}},{"line":405,"address":[25088984,25089032],"length":1,"stats":{"Line":2}},{"line":407,"address":[25089179],"length":1,"stats":{"Line":1}},{"line":409,"address":[25089344,25089469],"length":1,"stats":{"Line":2}},{"line":410,"address":[25089588,25090041],"length":1,"stats":{"Line":2}},{"line":411,"address":[25090171],"length":1,"stats":{"Line":1}},{"line":415,"address":[25090124],"length":1,"stats":{"Line":1}},{"line":421,"address":[25089619],"length":1,"stats":{"Line":1}},{"line":422,"address":[25089939],"length":1,"stats":{"Line":1}},{"line":426,"address":[25089875],"length":1,"stats":{"Line":1}},{"line":427,"address":[25089729],"length":1,"stats":{"Line":1}},{"line":428,"address":[25089760],"length":1,"stats":{"Line":1}},{"line":434,"address":[25089379],"length":1,"stats":{"Line":1}},{"line":445,"address":[25088064],"length":1,"stats":{"Line":0}},{"line":446,"address":[],"length":0,"stats":{"Line":0}},{"line":448,"address":[24618304,24618322],"length":1,"stats":{"Line":0}},{"line":460,"address":[25084128],"length":1,"stats":{"Line":0}},{"line":463,"address":[24618192,24618160],"length":1,"stats":{"Line":0}},{"line":474,"address":[25084224],"length":1,"stats":{"Line":0}},{"line":477,"address":[24618240,24618258],"length":1,"stats":{"Line":0}}],"covered":58,"coverable":93},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","report.rs"],"content":"//! Report generation for Architect Linter v4.0\n//!\n//! This module provides JSON and Markdown report export functionality.\n\nuse crate::analysis_result::AnalysisResult;\nuse crate::cli::ReportFormat;\nuse miette::{IntoDiagnostic, Result};\nuse serde_json::json;\nuse std::fs;\nuse std::io::{self, Write};\nuse std::path::Path;\n\n/// Generate a report in the specified format\npub fn generate_report(result: \u0026AnalysisResult, format: ReportFormat) -\u003e String {\n    match format {\n        ReportFormat::Json =\u003e to_json(result),\n        ReportFormat::Markdown =\u003e to_markdown(result),\n    }\n}\n\n/// Export analysis result to JSON format\npub fn to_json(result: \u0026AnalysisResult) -\u003e String {\n    let health_score = result.health_score.as_ref();\n\n    let report = json!({\n        \"version\": \"4.0.0\",\n        \"timestamp\": result.timestamp.to_rfc3339(),\n        \"project\": {\n            \"name\": result.project_name,\n            \"pattern\": result.pattern_display(),\n            \"files_analyzed\": result.files_analyzed,\n        },\n        \"health_score\": health_score.map(|s| json!({\n            \"total\": s.total,\n            \"grade\": s.grade.as_str(),\n            \"components\": {\n                \"layer_isolation\": s.components.layer_isolation,\n                \"circular_deps\": s.components.circular_deps,\n                \"complexity\": s.components.complexity,\n                \"violations\": s.components.violations,\n            }\n        })),\n        \"summary\": {\n            \"total_violations\": result.violations.len(),\n            \"blocked_violations\": result.blocked_count(),\n            \"warning_violations\": result.warning_count(),\n            \"circular_dependencies\": result.circular_dependencies.len(),\n            \"long_functions\": result.long_functions.len(),\n        },\n        \"violations\": result.violations.iter().map(|cv| {\n            json!({\n                \"file\": cv.violation.file_path.to_string_lossy().to_string(),\n                \"line\": cv.violation.line_number,\n                \"category\": cv.category.as_str(),\n                \"rule\": {\n                    \"from\": cv.violation.rule.from,\n                    \"to\": cv.violation.rule.to,\n                },\n                \"import\": cv.violation.offensive_import,\n            })\n        }).collect::\u003cVec\u003c_\u003e\u003e(),\n        \"circular_dependencies\": result.circular_dependencies.iter().map(|cd| {\n            json!({\n                \"cycle\": cd.cycle,\n                \"description\": cd.description,\n            })\n        }).collect::\u003cVec\u003c_\u003e\u003e(),\n        \"long_functions\": result.long_functions.iter().map(|lf| {\n            json!({\n                \"file\": lf.file_path.to_string_lossy().to_string(),\n                \"name\": lf.name,\n                \"line_start\": lf.line_start,\n                \"lines\": lf.lines,\n                \"threshold\": lf.threshold,\n            })\n        }).collect::\u003cVec\u003c_\u003e\u003e(),\n    });\n\n    serde_json::to_string_pretty(\u0026report).unwrap_or_else(|_| \"{}\".to_string())\n}\n\n/// Export analysis result to Markdown format\npub fn to_markdown(result: \u0026AnalysisResult) -\u003e String {\n    let mut md = String::new();\n\n    // Header\n    md.push_str(\"# Architect Linter Pro Report\\n\\n\");\n    md.push_str(\u0026format!(\n        \"\u003e Generated: {}\\n\\n\",\n        result.timestamp.format(\"%Y-%m-%d %H:%M:%S UTC\")\n    ));\n\n    // Project info\n    md.push_str(\"## Project\\n\\n\");\n    md.push_str(\u0026format!(\"- **Name:** {}\\n\", result.project_name));\n    md.push_str(\u0026format!(\"- **Pattern:** {}\\n\", result.pattern_display()));\n    md.push_str(\u0026format!(\n        \"- **Files Analyzed:** {}\\n\\n\",\n        result.files_analyzed\n    ));\n\n    // Health Score\n    if let Some(ref score) = result.health_score {\n        md.push_str(\"## Architecture Health Score\\n\\n\");\n        md.push_str(\u0026format!(\n            \"# {} Score: {}/100\\n\\n\",\n            score.grade.as_str(),\n            score.total\n        ));\n\n        md.push_str(\"| Component | Score | Status |\\n\");\n        md.push_str(\"|-----------|-------|--------|\\n\");\n        md.push_str(\u0026format!(\n            \"| Layer Isolation | {}% | {} |\\n\",\n            score.components.layer_isolation,\n            score.layer_isolation_status.emoji()\n        ));\n        md.push_str(\u0026format!(\n            \"| Circular Deps | {}% | {} |\\n\",\n            score.components.circular_deps,\n            score.circular_deps_status.emoji()\n        ));\n        md.push_str(\u0026format!(\n            \"| Complexity | {}% | {} |\\n\",\n            score.components.complexity,\n            score.complexity_status.emoji()\n        ));\n        md.push_str(\u0026format!(\n            \"| Violations | {}% | {} |\\n\\n\",\n            score.components.violations,\n            score.violations_status.emoji()\n        ));\n    }\n\n    // Summary\n    md.push_str(\"## Summary\\n\\n\");\n    md.push_str(\u0026format!(\n        \"- **Total Violations:** {}\\n\",\n        result.violations.len()\n    ));\n    md.push_str(\u0026format!(\"- **Blocked:** {}\\n\", result.blocked_count()));\n    md.push_str(\u0026format!(\"- **Warnings:** {}\\n\", result.warning_count()));\n    md.push_str(\u0026format!(\n        \"- **Circular Dependencies:** {}\\n\",\n        result.circular_dependencies.len()\n    ));\n    md.push_str(\u0026format!(\n        \"- **Long Functions:** {}\\n\\n\",\n        result.long_functions.len()\n    ));\n\n    // Violations\n    if !result.violations.is_empty() {\n        md.push_str(\"## Violations\\n\\n\");\n        for (i, cv) in result.violations.iter().enumerate() {\n            md.push_str(\u0026format!(\n                \"### {}. {} (Line {})\\n\\n\",\n                i + 1,\n                cv.violation.file_path.display(),\n                cv.violation.line_number\n            ));\n            md.push_str(\u0026format!(\"- **Category:** {}\\n\", cv.category.as_str()));\n            md.push_str(\u0026format!(\n                \"- **Rule:** `{}` cannot import from `{}`\\n\",\n                cv.violation.rule.from, cv.violation.rule.to\n            ));\n            md.push_str(\u0026format!(\n                \"- **Import:** `{}`\\n\\n\",\n                cv.violation.offensive_import\n            ));\n        }\n    }\n\n    // Circular Dependencies\n    if !result.circular_dependencies.is_empty() {\n        md.push_str(\"## Circular Dependencies\\n\\n\");\n        for (i, cd) in result.circular_dependencies.iter().enumerate() {\n            md.push_str(\u0026format!(\"### Cycle #{}\\n\\n```\\n\", i + 1));\n            for (j, node) in cd.cycle.iter().enumerate() {\n                if j \u003c cd.cycle.len() - 1 {\n                    md.push_str(\u0026format!(\"{} →\\n\", node));\n                } else {\n                    md.push_str(\u0026format!(\"{} ↑\\n\", node));\n                }\n            }\n            md.push_str(\"```\\n\\n\");\n        }\n    }\n\n    // Long Functions\n    if !result.long_functions.is_empty() {\n        md.push_str(\"## Long Functions\\n\\n\");\n        md.push_str(\"| File | Function | Lines | Threshold |\\n\");\n        md.push_str(\"|------|----------|-------|----------|\\n\");\n        for lf in \u0026result.long_functions {\n            md.push_str(\u0026format!(\n                \"| {} | {} | {} | {} |\\n\",\n                lf.file_path.display(),\n                lf.name,\n                lf.lines,\n                lf.threshold\n            ));\n        }\n        md.push_str(\"\\n\");\n    }\n\n    md\n}\n\n/// Write report to file\npub fn write_report(content: \u0026str, path: \u0026Path) -\u003e Result\u003c()\u003e {\n    // Create parent directories if needed\n    if let Some(parent) = path.parent() {\n        fs::create_dir_all(parent).into_diagnostic()?;\n    }\n\n    fs::write(path, content).into_diagnostic()\n}\n\n/// Write report to stdout\npub fn write_stdout(content: \u0026str) -\u003e Result\u003c()\u003e {\n    let mut stdout = io::stdout();\n    stdout.write_all(content.as_bytes()).into_diagnostic()?;\n    stdout.flush().into_diagnostic()\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::config::ArchPattern;\n    use crate::metrics::{HealthScore, ScoreComponents};\n\n    #[test]\n    fn test_json_report_structure() {\n        let mut result = AnalysisResult::new(\"test-project\".to_string(), ArchPattern::MVC);\n        result.files_analyzed = 10;\n        result.health_score = Some(HealthScore::new(ScoreComponents {\n            layer_isolation: 100,\n            circular_deps: 100,\n            complexity: 80,\n            violations: 90,\n        }));\n\n        let json = to_json(\u0026result);\n        assert!(json.contains(\"test-project\"));\n        assert!(json.contains(\"MVC\"));\n    }\n\n    #[test]\n    fn test_markdown_report_structure() {\n        let mut result = AnalysisResult::new(\"test-project\".to_string(), ArchPattern::Hexagonal);\n        result.files_analyzed = 5;\n\n        let md = to_markdown(\u0026result);\n        assert!(md.contains(\"# Architect Linter Pro Report\"));\n        assert!(md.contains(\"test-project\"));\n        assert!(md.contains(\"Hexagonal\"));\n    }\n}\n","traces":[{"line":28,"address":[53458384,53458736,53458409,53458746],"length":1,"stats":{"Line":0}},{"line":33,"address":[25149995,25148720,25148928,25150588,25149772,25149137,25148750,25149552,25149203,25149396,25150218],"length":1,"stats":{"Line":0}},{"line":34,"address":[53458610],"length":1,"stats":{"Line":0}},{"line":35,"address":[25149187,25149113],"length":1,"stats":{"Line":0}},{"line":48,"address":[53460544,53460512,53460608,53460620],"length":1,"stats":{"Line":0}},{"line":50,"address":[25155320,25155458,25153136],"length":1,"stats":{"Line":0}},{"line":51,"address":[25154332,25154488,25153442,25155326,25153349,25154708,25154139,25153174,25155074,25153847,25154072,25155298,25153513],"length":1,"stats":{"Line":0}},{"line":52,"address":[25153332,25153408],"length":1,"stats":{"Line":0}},{"line":54,"address":[25154123,25154044],"length":1,"stats":{"Line":0}},{"line":56,"address":[53464336],"length":1,"stats":{"Line":0}},{"line":61,"address":[25155290],"length":1,"stats":{"Line":0}},{"line":62,"address":[25153090,25153115,25152464],"length":1,"stats":{"Line":0}},{"line":63,"address":[25153096,25152502,25152844,25152636,25153068],"length":1,"stats":{"Line":0}},{"line":64,"address":[53441589,53464373],"length":1,"stats":{"Line":0}},{"line":65,"address":[53464380],"length":1,"stats":{"Line":0}},{"line":67,"address":[25153060],"length":1,"stats":{"Line":0}},{"line":68,"address":[25152355,25152446,25150768],"length":1,"stats":{"Line":0}},{"line":69,"address":[25151889,25150806,25151118,25151669,25151050,25150961,25152109,25151449,25152361,25152333],"length":1,"stats":{"Line":0}},{"line":70,"address":[25150945,25151016],"length":1,"stats":{"Line":0}},{"line":72,"address":[53462954,53463014,53462990],"length":1,"stats":{"Line":0}},{"line":73,"address":[53463003],"length":1,"stats":{"Line":0}},{"line":74,"address":[53463146,53463090],"length":1,"stats":{"Line":0}},{"line":76,"address":[25152325],"length":1,"stats":{"Line":0}},{"line":79,"address":[25148608,25148624],"length":1,"stats":{"Line":0}},{"line":83,"address":[53463382],"length":1,"stats":{"Line":0}},{"line":84,"address":[53463394],"length":1,"stats":{"Line":0}},{"line":87,"address":[53463370],"length":1,"stats":{"Line":0}},{"line":89,"address":[53463524],"length":1,"stats":{"Line":0}},{"line":90,"address":[53463531,53463592],"length":1,"stats":{"Line":0}},{"line":94,"address":[53463729,53463657],"length":1,"stats":{"Line":0}},{"line":95,"address":[53463746,53463762],"length":1,"stats":{"Line":0}},{"line":96,"address":[53463771],"length":1,"stats":{"Line":0}},{"line":98,"address":[53463636],"length":1,"stats":{"Line":0}},{"line":99,"address":[53463819,53463880],"length":1,"stats":{"Line":0}},{"line":103,"address":[53463961],"length":1,"stats":{"Line":0}},{"line":104,"address":[53463993,53464054],"length":1,"stats":{"Line":0}},{"line":105,"address":[53464061],"length":1,"stats":{"Line":0}},{"line":107,"address":[53464078],"length":1,"stats":{"Line":0}},{"line":108,"address":[53464173,53464249],"length":1,"stats":{"Line":0}},{"line":111,"address":[53464300],"length":1,"stats":{"Line":0}},{"line":112,"address":[53464309],"length":1,"stats":{"Line":0}},{"line":118,"address":[53464155],"length":1,"stats":{"Line":0}},{"line":119,"address":[53463619,53464163],"length":1,"stats":{"Line":0}},{"line":126,"address":[53438640],"length":1,"stats":{"Line":0}},{"line":130,"address":[53438663],"length":1,"stats":{"Line":0}},{"line":136,"address":[53438889],"length":1,"stats":{"Line":0}},{"line":138,"address":[53438782,53438921,53438989],"length":1,"stats":{"Line":0}},{"line":139,"address":[53438980],"length":1,"stats":{"Line":0}},{"line":143,"address":[53440103,53440087],"length":1,"stats":{"Line":0}},{"line":144,"address":[53440187,53440119],"length":1,"stats":{"Line":0}},{"line":145,"address":[53440194],"length":1,"stats":{"Line":0}},{"line":149,"address":[53439105,53439133,53439015],"length":1,"stats":{"Line":0}},{"line":153,"address":[53439848],"length":1,"stats":{"Line":0}},{"line":158,"address":[53439917,53439956,53439941],"length":1,"stats":{"Line":0}},{"line":159,"address":[53439935],"length":1,"stats":{"Line":0}},{"line":160,"address":[53439953],"length":1,"stats":{"Line":0}},{"line":162,"address":[53440044],"length":1,"stats":{"Line":0}},{"line":164,"address":[53439228,53439159,53439275],"length":1,"stats":{"Line":0}},{"line":165,"address":[53439470,53439450],"length":1,"stats":{"Line":0}},{"line":167,"address":[53439437],"length":1,"stats":{"Line":0}},{"line":168,"address":[53439453,53439466],"length":1,"stats":{"Line":0}},{"line":175,"address":[53439582],"length":1,"stats":{"Line":0}},{"line":176,"address":[53439600],"length":1,"stats":{"Line":0}},{"line":177,"address":[53439684,53439616],"length":1,"stats":{"Line":0}},{"line":178,"address":[53439691],"length":1,"stats":{"Line":0}},{"line":180,"address":[53438704],"length":1,"stats":{"Line":0}},{"line":181,"address":[53439703],"length":1,"stats":{"Line":0}},{"line":186,"address":[53441024],"length":1,"stats":{"Line":0}},{"line":191,"address":[53441078,53441380,53441143],"length":1,"stats":{"Line":0}},{"line":192,"address":[53441209],"length":1,"stats":{"Line":0}},{"line":193,"address":[53441413,53441620,53441300],"length":1,"stats":{"Line":0}},{"line":194,"address":[53441527],"length":1,"stats":{"Line":0}},{"line":195,"address":[53441556],"length":1,"stats":{"Line":0}},{"line":196,"address":[53441605],"length":1,"stats":{"Line":0}},{"line":197,"address":[53441652],"length":1,"stats":{"Line":0}},{"line":198,"address":[53441659],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":76},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","scoring.rs"],"content":"//! Scoring engine for Architecture Health Score\n//!\n//! This module implements the scoring algorithm that converts analysis results\n//! into a 0-100 health score with letter grades.\n\nuse crate::analysis_result::AnalysisResult;\nuse crate::metrics::{HealthGrade, HealthScore, ScoreComponents};\n\n/// Severity level of a violation\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum ViolationType {\n    /// Critical violation that severely impacts architecture\n    Critical,\n    /// Warning that should be reviewed\n    Warning,\n    /// Informational notice\n    Info,\n}\n\n/// A simple violation for unit testing\n#[derive(Debug, Clone)]\npub struct Violation {\n    /// Severity of the violation\n    pub severity: ViolationType,\n    /// File path where the violation occurred\n    pub file_path: String,\n    /// Line number where the violation occurred\n    pub line: usize,\n    /// Violation message\n    pub message: String,\n}\n\n/// Calculate the health score from an analysis result\npub fn calculate(result: \u0026AnalysisResult) -\u003e HealthScore {\n    let components = ScoreComponents {\n        layer_isolation: calculate_layer_isolation_score(result),\n        circular_deps: calculate_circular_deps_score(result),\n        complexity: calculate_complexity_score(result),\n        violations: calculate_violations_score(result),\n    };\n\n    HealthScore::new(components)\n}\n\n/// Calculate layer isolation score\n/// Formula: 100 - (blocked_violations / total_imports * 100)\n/// Minimum score is 0\nfn calculate_layer_isolation_score(result: \u0026AnalysisResult) -\u003e u8 {\n    let blocked = result.layer_stats.blocked_violations;\n    let total = result.layer_stats.total_imports.max(1); // Avoid division by zero\n\n    if blocked == 0 {\n        return 100;\n    }\n\n    let ratio = blocked as f64 / total as f64;\n    let score = 100.0 - (ratio * 100.0);\n    score.max(0.0).min(100.0) as u8\n}\n\n/// Calculate circular dependencies score\n/// Binary: 100 if no cycles, 0 if cycles exist\nfn calculate_circular_deps_score(result: \u0026AnalysisResult) -\u003e u8 {\n    if result.circular_dependencies.is_empty() {\n        100\n    } else {\n        0\n    }\n}\n\n/// Calculate complexity score\n/// Formula: 100 - (long_functions / total_functions * 100)\nfn calculate_complexity_score(result: \u0026AnalysisResult) -\u003e u8 {\n    let long_funcs = result.complexity_stats.long_functions;\n    let total_funcs = result.complexity_stats.total_functions.max(1);\n\n    if long_funcs == 0 {\n        return 100;\n    }\n\n    let ratio = long_funcs as f64 / total_funcs as f64;\n    let score = 100.0 - (ratio * 100.0);\n    score.max(0.0).min(100.0) as u8\n}\n\n/// Calculate violations score\n/// Formula: 100 - ((blocked * 2 + warnings) / total_checks * 100)\n/// Where total_checks is estimated based on files analyzed\nfn calculate_violations_score(result: \u0026AnalysisResult) -\u003e u8 {\n    let blocked = result.blocked_count();\n    let warnings = result.warning_count();\n\n    if blocked == 0 \u0026\u0026 warnings == 0 {\n        return 100;\n    }\n\n    // Estimate total checks as files * 5 (rough average of imports per file)\n    let total_checks = (result.files_analyzed * 5).max(1);\n\n    let penalty = (blocked * 2) as f64 + warnings as f64;\n    let score = 100.0 - (penalty / total_checks as f64 * 100.0);\n    score.max(0.0).min(100.0) as u8\n}\n\n/// Get a visual progress bar for a score\npub fn get_progress_bar(score: u8, width: usize) -\u003e String {\n    let filled = (score as usize * width) / 100;\n    let empty = width - filled;\n\n    let filled_char = \"=\";\n    let empty_char = \" \";\n\n    format!(\n        \"[{}{}]\",\n        filled_char.repeat(filled),\n        empty_char.repeat(empty)\n    )\n}\n\n/// Get grade color code for terminal (ANSI)\npub fn get_grade_color(grade: HealthGrade) -\u003e \u0026'static str {\n    match grade {\n        HealthGrade::A =\u003e \"\\x1b[32m\", // Green\n        HealthGrade::B =\u003e \"\\x1b[36m\", // Cyan\n        HealthGrade::C =\u003e \"\\x1b[33m\", // Yellow\n        HealthGrade::D =\u003e \"\\x1b[35m\", // Magenta\n        HealthGrade::F =\u003e \"\\x1b[31m\", // Red\n    }\n}\n\n/// Reset ANSI color\npub fn reset_color() -\u003e \u0026'static str {\n    \"\\x1b[0m\"\n}\n\n/// Apply severity multipliers to a base score\n///\n/// This function applies various multipliers and bonuses to a base health score:\n/// - Empty project bonus: 10% bonus for projects with 0 files and 0 violations\n/// - Architecture pattern bonus: 5% bonus for detected patterns (e.g., MVC)\n/// - Historical trend factor: adjustment based on improvement/degradation over time\n///\n/// # Arguments\n/// * `violations` - List of violations found in the project\n/// * `base_score` - The base health score (0-100)\n/// * `total_files` - Total number of files in the project\n///\n/// # Returns\n/// Adjusted health score with multipliers applied\npub fn apply_severity_multiplier(\n    violations: \u0026[Violation],\n    base_score: f64,\n    total_files: usize,\n) -\u003e f64 {\n    let mut score = base_score;\n\n    // Empty project bonus: 10% bonus for projects with no files and no violations\n    if total_files == 0 \u0026\u0026 violations.is_empty() {\n        score = base_score * 1.1; // 10% bonus\n    }\n\n    // Architecture pattern bonus: 5% bonus for detected patterns\n    // TODO: This is a placeholder for future implementation. In the full version, this should:\n    // - Detect actual architectural patterns (MVC, Layered, Hexagonal, etc.)\n    // - Use static analysis to identify pattern-specific structures\n    // - Apply bonus based on pattern adherence quality\n    // For now, we apply a simple heuristic based on project size as a temporary approximation\n    if total_files \u003e= 100 \u0026\u0026 violations.is_empty() {\n        score = score * 1.05; // 5% bonus for well-structured large projects\n    }\n\n    // Historical trend factor would be applied here\n    // TODO: This is a placeholder for future functionality. In the full version, this should:\n    // - Accept historical trend data as a parameter\n    // - Compare current results with previous runs\n    // - Apply multiplier based on improvement/degradation trends\n    // For now, we just return the score with applied bonuses\n\n    score.min(100.0) // Cap scores at 100.0 to prevent overflow from multipliers\n}\n\n/// Calculate health score from a list of violations\n///\n/// This is a simplified scoring function for unit testing that takes\n/// a list of violations and returns a 0-100 score.\n///\n/// # Arguments\n/// * `violations` - List of violations found in the project\n/// * `total_files` - Total number of files in the project\n///\n/// # Returns\n/// Health score from 0.0 to 100.0\n///\n/// # Scoring Formula\n/// - Critical violations: -10 points each\n/// - Warning violations: -2 points each\n/// - Info violations: -0.5 points each\n/// - Base score: 100.0\n/// - Final score is clamped to 0.0-100.0\npub fn calculate_health_score(violations: \u0026[Violation], total_files: f64) -\u003e f64 {\n    let mut score = 100.0;\n\n    for violation in violations {\n        match violation.severity {\n            ViolationType::Critical =\u003e score -= 10.0,\n            ViolationType::Warning =\u003e score -= 2.0,\n            ViolationType::Info =\u003e score -= 0.5,\n        }\n    }\n\n    // Normalize by project size (more violations in larger projects have less impact)\n    // This prevents very large projects from being overly penalized\n    let size_factor = (total_files / 100.0).min(5.0); // Cap the reduction\n    let normalized_score = score + (size_factor * 2.0);\n\n    // Clamp to 0-100\n    normalized_score.max(0.0).min(100.0)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_health_grade_from_score() {\n        assert_eq!(HealthGrade::from_score(95), HealthGrade::A);\n        assert_eq!(HealthGrade::from_score(85), HealthGrade::B);\n        assert_eq!(HealthGrade::from_score(75), HealthGrade::C);\n        assert_eq!(HealthGrade::from_score(65), HealthGrade::D);\n        assert_eq!(HealthGrade::from_score(55), HealthGrade::F);\n    }\n\n    #[test]\n    fn test_score_components_calculate_total() {\n        let components = ScoreComponents {\n            layer_isolation: 100,\n            circular_deps: 100,\n            complexity: 100,\n            violations: 100,\n        };\n        assert_eq!(components.calculate_total(), 100);\n\n        let components = ScoreComponents {\n            layer_isolation: 80,\n            circular_deps: 100,\n            complexity: 90,\n            violations: 70,\n        };\n        // (80 * 0.30) + (100 * 0.25) + (90 * 0.20) + (70 * 0.25)\n        // = 24 + 25 + 18 + 17.5 = 84.5 ≈ 85\n        assert_eq!(components.calculate_total(), 85);\n    }\n\n    #[test]\n    fn test_progress_bar() {\n        let bar = get_progress_bar(100, 10);\n        assert_eq!(bar, \"[==========]\");\n\n        let bar = get_progress_bar(50, 10);\n        assert_eq!(bar, \"[=====     ]\");\n\n        let bar = get_progress_bar(0, 10);\n        assert_eq!(bar, \"[          ]\");\n    }\n\n    // Unit tests for calculate_health_score\n    #[test]\n    fn test_calculate_health_score_with_zero_violations() {\n        let violations = vec![];\n        let score = calculate_health_score(\u0026violations, 100.0);\n        assert_eq!(score, 100.0, \"Perfect project should score 100\");\n    }\n\n    #[test]\n    fn test_calculate_health_score_with_critical_violations() {\n        let mut violations = Vec::new();\n        for i in 0..10 {\n            violations.push(Violation {\n                severity: ViolationType::Critical,\n                file_path: format!(\"src/bad{}.rs\", i),\n                line: i,\n                message: \"Critical violation\".to_string(),\n            });\n        }\n\n        let score = calculate_health_score(\u0026violations, 100.0);\n        assert!(\n            score \u003c 50.0,\n            \"Score should be \u003c50 with 10 critical violations\"\n        );\n    }\n\n    #[test]\n    fn test_calculate_health_score_boundary_values() {\n        let violations = vec![];\n        let score_min = calculate_health_score(\u0026violations, 1.0);\n        assert_eq!(\n            score_min, 100.0,\n            \"1 file project should score 100 with no violations\"\n        );\n\n        let score_max = calculate_health_score(\u0026violations, 1000.0);\n        assert_eq!(\n            score_max, 100.0,\n            \"Large project should score 100 with no violations\"\n        );\n    }\n\n    #[test]\n    fn test_calculate_health_score_with_many_files() {\n        let mut violations = Vec::new();\n        for i in 0..1000 {\n            violations.push(Violation {\n                severity: ViolationType::Warning,\n                file_path: format!(\"src/file{}.rs\", i),\n                line: 1,\n                message: \"Warning violation\".to_string(),\n            });\n        }\n\n        let score = calculate_health_score(\u0026violations, 1000.0);\n        assert!(score \u003c 80.0, \"1000 files with warnings should score \u003c80\");\n    }\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","ui.rs"],"content":"use crate::ai::{AISuggestionResponse, SuggestedRule};\nuse crate::config::AIConfig;\nuse console::style;\nuse dialoguer::{theme::ColorfulTheme, Input, MultiSelect, Select};\nuse miette::{IntoDiagnostic, Result};\nuse std::env;\nuse std::path::PathBuf;\n\n/// Imprime el banner de bienvenida con ASCII art y estilo de alto impacto\npub fn print_banner() {\n    println!();\n    println!(\n        \"{}\",\n        style(\n            \"╔══════════════════════════════════════════════════════════════════════════════════╗\"\n        )\n        .cyan()\n    );\n    println!(\n        \"{}\",\n        style(\n            r\"\n    ___    ____  ______ __  __________________  ______ ______ \n   /   |  / __ \\/ ____// / / /  _/_  __/ ____/ / ____//_  __/ \n  / /| | / /_/ / /    / /_/ // /  / / / __/   / /      / /    \n / ___ |/ _, _/ /___ / __  // /  / / / /___  / /___   / /     \n/_/  |_/_/ |_|\\____//_/ /_/___/ /_/ /_____/  \\____/  /_/      \n                                                              \n    __     _____  _   __ ______ ______ ____           \n   / /    /  _/ / | / //_  __// ____// __ \\          \n  / /     / /  /  |/ /  / /  / __/  / /_/ /          \n / /___ _/ /  / /|  /  / /  / /___ / _, _/           \n/_____//___/ /_/ |_/  /_/  /_____//_/ |_|            \n\"\n        )\n        .cyan()\n        .bold()\n    );\n    println!(\n        \"{}\",\n        style(\n            \"╚══════════════════════════════════════════════════════════════════════════════════╝\"\n        )\n        .cyan()\n    );\n    println!();\n    println!(\n        \"{}\",\n        style(\"                 Manteniendo la arquitectura de tu código ⚡\")\n            .white()\n            .bold()\n    );\n    println!();\n}\n\n/// Solicita al usuario una o más configuraciones de IA\npub fn ask_ai_configs() -\u003e Result\u003cVec\u003cAIConfig\u003e\u003e {\n    let mut configs = Vec::new();\n\n    loop {\n        println!(\"🤖 CONFIGURACIÓN DE LA IA (#{})\", configs.len() + 1);\n        println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n\n        // Pedir un nombre para esta configuración\n        let name: String = Input::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"Nombre para esta configuración (ej: Claude Pro, Ollama Local)\")\n            .interact_text()\n            .into_diagnostic()?;\n\n        let providers = vec![\n            \"Claude (Anthropic)\",\n            \"Gemini (Google)\",\n            \"OpenAI\",\n            \"Groq\",\n            \"Ollama (Local)\",\n            \"Kimi (Moonshot)\",\n            \"DeepSeek\",\n        ];\n        let selection = Select::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"Selecciona un proveedor de IA\")\n            .items(\u0026providers)\n            .default(0)\n            .interact()\n            .into_diagnostic()?;\n\n        let provider = match selection {\n            0 =\u003e crate::config::AIProvider::Claude,\n            1 =\u003e crate::config::AIProvider::Gemini,\n            2 =\u003e crate::config::AIProvider::OpenAI,\n            3 =\u003e crate::config::AIProvider::Groq,\n            4 =\u003e crate::config::AIProvider::Ollama,\n            5 =\u003e crate::config::AIProvider::Kimi,\n            6 =\u003e crate::config::AIProvider::DeepSeek,\n            _ =\u003e unreachable!(),\n        };\n\n        // URLs base según el proveedor (Hardcoded)\n        let default_url = match provider {\n            crate::config::AIProvider::Claude =\u003e \"https://api.anthropic.com\".to_string(),\n            crate::config::AIProvider::Gemini =\u003e {\n                \"https://generativelanguage.googleapis.com\".to_string()\n            }\n            crate::config::AIProvider::OpenAI =\u003e \"https://api.openai.com/v1\".to_string(),\n            crate::config::AIProvider::Groq =\u003e \"https://api.groq.com/openai/v1\".to_string(),\n            crate::config::AIProvider::Ollama =\u003e \"http://localhost:11434/v1\".to_string(),\n            crate::config::AIProvider::Kimi =\u003e \"https://api.moonshot.ai/v1\".to_string(),\n            crate::config::AIProvider::DeepSeek =\u003e \"https://api.deepseek.com\".to_string(),\n        };\n\n        // Verificar si existen variables de entorno\n        let env_url = env::var(format!(\"{}_BASE_URL\", provider.as_str().to_uppercase())).ok();\n        let env_key = env::var(format!(\"{}_API_KEY\", provider.as_str().to_uppercase())).ok();\n\n        // Solo pedimos la URL si es Ollama, para los demás usamos la hardcoded (o env)\n        let api_url: String = Input::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(format!(\"URL de la API para {}\", provider.as_str()))\n            .default(env_url.unwrap_or(default_url))\n            .interact_text()\n            .into_diagnostic()?;\n\n        let api_key: String = if provider == crate::config::AIProvider::Ollama {\n            Input::with_theme(\u0026ColorfulTheme::default())\n                .with_prompt(\"API Key (opcional para Ollama)\")\n                .allow_empty(true)\n                .default(env_key.unwrap_or_else(|| String::new()))\n                .interact_text()\n                .into_diagnostic()?\n        } else {\n            Input::with_theme(\u0026ColorfulTheme::default())\n                .with_prompt(format!(\"API Key para {}\", provider.as_str()))\n                .default(env_key.unwrap_or_else(|| String::new()))\n                .interact_text()\n                .into_diagnostic()?\n        };\n\n        // Obtener modelos dinámicamente usando los curls\n        println!(\n            \"🔍 Conectando con {} para obtener modelos...\",\n            provider.as_str()\n        );\n        let model: String =\n            match crate::ai::obtener_modelos_disponibles(\u0026provider, \u0026api_url, \u0026api_key) {\n                Ok(mut models) if !models.is_empty() =\u003e {\n                    models.sort();\n                    let selection = Select::with_theme(\u0026ColorfulTheme::default())\n                        .with_prompt(\"Selecciona el modelo\")\n                        .items(\u0026models)\n                        .default(0)\n                        .interact()\n                        .into_diagnostic()?;\n                    models[selection].clone()\n                }\n                Err(e) =\u003e {\n                    println!(\n                        \"⚠️  No se pudieron obtener los modelos automáticamente: {}\",\n                        e\n                    );\n                    Input::with_theme(\u0026ColorfulTheme::default())\n                    .with_prompt(\n                        \"Ingresa el nombre del modelo manualmente (ej: claude-3-5-sonnet-20241022)\",\n                    )\n                    .interact_text()\n                    .into_diagnostic()?\n                }\n                _ =\u003e {\n                    println!(\"⚠️  La lista de modelos está vacía.\");\n                    Input::with_theme(\u0026ColorfulTheme::default())\n                        .with_prompt(\"Ingresa el nombre del modelo manualmente\")\n                        .interact_text()\n                        .into_diagnostic()?\n                }\n            };\n\n        configs.push(crate::config::AIConfig {\n            name,\n            provider,\n            api_url,\n            api_key,\n            model,\n        });\n\n        println!(\"✅ Configuración añadida.\");\n\n        let add_another = dialoguer::Confirm::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"¿Deseas agregar otro modelo de IA?\")\n            .default(false)\n            .interact()\n            .into_diagnostic()?;\n\n        if !add_another {\n            break;\n        }\n    }\n\n    Ok(configs)\n}\n\n/// Permite al usuario elegir qué reglas de las sugeridas por la IA desea aplicar.\npub fn ask_user_to_confirm_rules(\n    suggestions: AISuggestionResponse,\n) -\u003e Result\u003c(Vec\u003cSuggestedRule\u003e, usize)\u003e {\n    println!(\"\\n🤖 El Arquitecto Virtual ha analizado tu proyecto.\");\n    println!(\n        \"\\n🤖 El Arquitecto Virtual sugiere el patrón: {}\",\n        suggestions.pattern\n    );\n\n    let max_lines: usize = Input::with_theme(\u0026ColorfulTheme::default())\n        .with_prompt(\"Límite máximo de líneas por función sugerido\")\n        .default(suggestions.suggested_max_lines)\n        .interact_text()\n        .into_diagnostic()?;\n\n    println!(\"Deseas aplicar las siguientes reglas de importación?\\n\");\n\n    // Preparamos las etiquetas para el menú (Regla + Razón)\n    let items: Vec\u003cString\u003e = suggestions\n        .rules\n        .iter()\n        .map(|r| format!(\"{} -\u003e {} \\n   └─ Razón: {}\", r.from, r.to, r.reason))\n        .collect();\n\n    // Por defecto, todas las reglas están marcadas (true)\n    let defaults = vec![true; items.len()];\n\n    let selections = MultiSelect::with_theme(\u0026ColorfulTheme::default())\n        .with_prompt(\"Usa [Espacio] para marcar/desmarcar y [Enter] para confirmar\")\n        .items(\u0026items)\n        .defaults(\u0026defaults)\n        .interact()\n        .into_diagnostic()?;\n\n    // Filtramos solo las reglas seleccionadas por el usuario\n    let mut selected_rules = Vec::new();\n    for index in selections {\n        selected_rules.push(suggestions.rules[index].clone());\n    }\n\n    Ok((selected_rules, max_lines))\n}\n\npub fn get_interactive_path() -\u003e Result\u003cPathBuf\u003e {\n    let current_dir = env::current_dir().into_diagnostic()?;\n    let search_dir = current_dir.parent().unwrap_or(\u0026current_dir);\n\n    let projects: Vec\u003cPathBuf\u003e = std::fs::read_dir(search_dir)\n        .into_diagnostic()?\n        .filter_map(|e| e.ok())\n        .map(|e| e.path())\n        .filter(|p| p.is_dir() \u0026\u0026 p.join(\"package.json\").exists())\n        .collect();\n\n    let mut options: Vec\u003cString\u003e = projects\n        .iter()\n        .map(|p| {\n            p.file_name()\n                .map(|n| n.to_string_lossy().into_owned())\n                .unwrap_or_else(|| \"Unknown\".to_string())\n        })\n        .collect();\n\n    options.push(\"\u003e\u003e Ingresar ruta manualmente...\".into());\n\n    let selection = Select::with_theme(\u0026ColorfulTheme::default())\n        .with_prompt(\"Selecciona proyecto\")\n        .items(\u0026options)\n        .interact()\n        .into_diagnostic()?;\n\n    if selection == options.len() - 1 {\n        let path: String = Input::with_theme(\u0026ColorfulTheme::default())\n            .with_prompt(\"Ruta completa\")\n            .interact_text()\n            .into_diagnostic()?;\n\n        Ok(PathBuf::from(path))\n    } else {\n        Ok(projects[selection].clone())\n    }\n}\n","traces":[{"line":125,"address":[24331004,24330992],"length":1,"stats":{"Line":0}},{"line":131,"address":[24330960,24330972],"length":1,"stats":{"Line":0}},{"line":220,"address":[24331680,24331716],"length":1,"stats":{"Line":0}},{"line":248,"address":[24331136,24331166],"length":1,"stats":{"Line":0}},{"line":249,"address":[24331456,24331484],"length":1,"stats":{"Line":0}},{"line":250,"address":[24331216,24331248],"length":1,"stats":{"Line":0}},{"line":255,"address":[24331024],"length":1,"stats":{"Line":0}},{"line":256,"address":[24331061],"length":1,"stats":{"Line":0}},{"line":257,"address":[24331616,24331640,24331081],"length":1,"stats":{"Line":0}},{"line":258,"address":[24331568,24331097,24331580],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":10},{"path":["/","home","protec","Documentos","dev","architect-linter-pro","src","watch.rs"],"content":"use miette::{IntoDiagnostic, Result};\nuse notify::{Config, Event, EventKind, RecommendedWatcher, RecursiveMode, Watcher};\nuse std::io::Write;\nuse std::path::{Path, PathBuf};\nuse std::sync::mpsc::{channel, Sender};\nuse std::time::{Duration, Instant};\n\n/// Commands available in interactive watch mode\n#[derive(Debug, Clone)]\npub enum WatchCommand {\n    Fix,            // 'f' - Run AI auto-fix\n    ReportJson,     // 'r' - Generate JSON report\n    ReportMarkdown, // 'm' - Generate Markdown report\n    FullAnalysis,   // 'a' - Full analysis with dashboard\n    Violations,     // 'v' - List all current violations\n    Dashboard,      // 'd' - Show health score\n    Clear,          // 'c' - Clear screen\n    Help,           // 'h' - Show commands\n    Quit,           // 'q' - Exit\n}\n\n/// Print the interactive watch mode help banner\npub fn print_watch_help() {\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"  Interactive Watch Mode Commands\");\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!(\"  f + Enter  →  Fix: auto-fix violations with AI\");\n    println!(\"  r + Enter  →  Report: generate JSON report\");\n    println!(\"  m + Enter  →  Markdown: generate Markdown report\");\n    println!(\"  a + Enter  →  Analyze: full analysis with dashboard\");\n    println!(\"  v + Enter  →  Violations: list all current violations\");\n    println!(\"  d + Enter  →  Dashboard: show health score\");\n    println!(\"  c + Enter  →  Clear: clear terminal screen\");\n    println!(\"  h + Enter  →  Help: show this menu\");\n    println!(\"  q + Enter  →  Quit: exit watch mode\");\n    println!(\"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\");\n    println!();\n    let _ = std::io::stdout().flush();\n}\n\n/// Parse a single character into a WatchCommand\nfn parse_command(input: \u0026str) -\u003e Option\u003cWatchCommand\u003e {\n    match input.trim().to_lowercase().as_str() {\n        \"f\" =\u003e Some(WatchCommand::Fix),\n        \"r\" =\u003e Some(WatchCommand::ReportJson),\n        \"m\" =\u003e Some(WatchCommand::ReportMarkdown),\n        \"a\" =\u003e Some(WatchCommand::FullAnalysis),\n        \"v\" =\u003e Some(WatchCommand::Violations),\n        \"d\" =\u003e Some(WatchCommand::Dashboard),\n        \"c\" =\u003e Some(WatchCommand::Clear),\n        \"h\" =\u003e Some(WatchCommand::Help),\n        \"q\" =\u003e Some(WatchCommand::Quit),\n        _ =\u003e None,\n    }\n}\n\n/// Internal event used to unify file watcher and stdin into one channel\nenum InternalEvent {\n    FileNotify(notify::Result\u003cEvent\u003e),\n    UserInput(WatchCommand),\n}\n\n/// Spawn a thread that reads lines from stdin and sends parsed commands.\n/// Uses `read_line` per iteration instead of holding a persistent `stdin.lock()`\n/// to avoid blocking stdin on Windows.\nfn spawn_stdin_reader(tx: Sender\u003cInternalEvent\u003e) {\n    std::thread::spawn(move || {\n        loop {\n            let mut input = String::new();\n            match std::io::stdin().read_line(\u0026mut input) {\n                Ok(0) =\u003e break, // EOF — stdin closed\n                Ok(_) =\u003e {\n                    if let Some(cmd) = parse_command(\u0026input) {\n                        if tx.send(InternalEvent::UserInput(cmd)).is_err() {\n                            break; // Channel closed, main loop exited\n                        }\n                    } else if !input.trim().is_empty() {\n                        eprintln!(\n                            \"Unknown command: '{}'. Press h + Enter for help.\",\n                            input.trim()\n                        );\n                    }\n                }\n                Err(_) =\u003e break,\n            }\n        }\n    });\n}\n\n/// Inicia el modo watch interactivo para observación continua\npub fn start_watch_mode\u003cF, G\u003e(\n    project_root: \u0026Path,\n    ignored_paths: Vec\u003cString\u003e,\n    mut on_change: F,\n    mut on_command: G,\n) -\u003e Result\u003c()\u003e\nwhere\n    F: FnMut(\u0026[PathBuf]) -\u003e Result\u003c()\u003e,\n    G: FnMut(WatchCommand) -\u003e Result\u003cbool\u003e, // returns false to quit\n{\n    println!(\"👁️  Modo Watch activado\");\n    println!(\"📂 Observando: {}\", project_root.display());\n\n    if !ignored_paths.is_empty() {\n        println!(\"🚫 Ignorando: {}\", ignored_paths.join(\", \"));\n    }\n\n    println!(\"⏱️  Debounce: 300ms\\n\");\n\n    print_watch_help();\n\n    // Unified channel for both file events and user commands\n    let (unified_tx, unified_rx) = channel::\u003cInternalEvent\u003e();\n\n    // Setup file watcher sending to the unified channel\n    let file_tx = unified_tx.clone();\n    let _watcher = {\n        let mut watcher = RecommendedWatcher::new(\n            move |res| {\n                let _ = file_tx.send(InternalEvent::FileNotify(res));\n            },\n            Config::default(),\n        )\n        .into_diagnostic()?;\n\n        watcher\n            .watch(project_root, RecursiveMode::Recursive)\n            .into_diagnostic()?;\n\n        watcher // keep alive by binding to _watcher\n    };\n\n    // Spawn stdin reader thread\n    spawn_stdin_reader(unified_tx);\n\n    // Build file-filtering helpers (reuse FileWatcher logic inline)\n    let project_root_buf = project_root.to_path_buf();\n    let ignored = ignored_paths.clone();\n    let debounce_duration = Duration::from_millis(300);\n\n    let is_relevant_file = |path: \u0026Path| -\u003e bool {\n        if let Some(ext) = path.extension() {\n            matches!(\n                ext.to_str(),\n                Some(\"ts\") | Some(\"tsx\") | Some(\"js\") | Some(\"jsx\")\n            )\n        } else {\n            false\n        }\n    };\n\n    let should_ignore_path = |path: \u0026Path| -\u003e bool {\n        let relative_path = path\n            .strip_prefix(\u0026project_root_buf)\n            .unwrap_or(path)\n            .to_string_lossy()\n            .replace('\\\\', \"/\");\n\n        for pattern in \u0026ignored {\n            let normalized_pattern = pattern.replace('\\\\', \"/\");\n            if relative_path.contains(normalized_pattern.trim_end_matches('/'))\n                || relative_path.starts_with(\u0026normalized_pattern)\n                || relative_path\n                    .starts_with(\u0026format!(\"{}/\", normalized_pattern.trim_end_matches('/')))\n            {\n                return true;\n            }\n        }\n        false\n    };\n\n    let is_relevant_event = |event: \u0026Event| -\u003e bool {\n        matches!(\n            event.kind,\n            EventKind::Modify(_) | EventKind::Create(_) | EventKind::Remove(_)\n        )\n    };\n\n    print!(\"👁️  Esperando cambios o comandos... (h + Enter = ayuda)\\n\u003e \");\n    let _ = std::io::stdout().flush();\n\n    // Main loop with debouncing for file events\n    let mut changed_files: Vec\u003cPathBuf\u003e = Vec::new();\n    let mut last_event_time = Instant::now();\n\n    loop {\n        match unified_rx.recv_timeout(Duration::from_millis(100)) {\n            Ok(InternalEvent::FileNotify(Ok(event))) =\u003e {\n                if is_relevant_event(\u0026event) {\n                    for path in \u0026event.paths {\n                        if is_relevant_file(path) \u0026\u0026 !should_ignore_path(path) {\n                            if !changed_files.contains(path) {\n                                changed_files.push(path.clone());\n                            }\n                        }\n                    }\n                    last_event_time = Instant::now();\n                }\n            }\n            Ok(InternalEvent::FileNotify(Err(e))) =\u003e {\n                eprintln!(\"⚠️  Error en file watcher: {:?}\", e);\n            }\n            Ok(InternalEvent::UserInput(cmd)) =\u003e {\n                match on_command(cmd) {\n                    Ok(true) =\u003e {\n                        print!(\"\\n👁️  Esperando cambios o comandos...\\n\u003e \");\n                        let _ = std::io::stdout().flush();\n                    }\n                    Ok(false) =\u003e {\n                        // Quit requested\n                        println!(\"👋 Saliendo del modo watch...\");\n                        return Ok(());\n                    }\n                    Err(e) =\u003e {\n                        eprintln!(\"❌ Error ejecutando comando: {}\", e);\n                        print!(\"\\n👁️  Esperando cambios o comandos...\\n\u003e \");\n                        let _ = std::io::stdout().flush();\n                    }\n                }\n            }\n            Err(_) =\u003e {\n                // Timeout — check if debounced file changes are ready\n            }\n        }\n\n        // Process accumulated file changes after debounce period\n        if !changed_files.is_empty() \u0026\u0026 last_event_time.elapsed() \u003e= debounce_duration {\n            println!(\n                \"\\n🔄 Cambios detectados en {} archivo(s):\",\n                changed_files.len()\n            );\n            for file in \u0026changed_files {\n                println!(\"   📝 {}\", file.display());\n            }\n            println!();\n\n            if let Err(e) = on_change(\u0026changed_files) {\n                eprintln!(\"❌ Error durante re-análisis: {}\", e);\n            } else {\n                println!(\"✅ Re-análisis completado\");\n            }\n\n            changed_files.clear();\n            print!(\"\\n👁️  Esperando cambios o comandos...\\n\u003e \");\n            let _ = std::io::stdout().flush();\n        }\n    }\n}\n","traces":[{"line":23,"address":[25438976],"length":1,"stats":{"Line":0}},{"line":24,"address":[25438980],"length":1,"stats":{"Line":0}},{"line":25,"address":[25439009],"length":1,"stats":{"Line":0}},{"line":26,"address":[25439038],"length":1,"stats":{"Line":0}},{"line":27,"address":[25439067],"length":1,"stats":{"Line":0}},{"line":28,"address":[25439096],"length":1,"stats":{"Line":0}},{"line":29,"address":[25439125],"length":1,"stats":{"Line":0}},{"line":30,"address":[25439154],"length":1,"stats":{"Line":0}},{"line":31,"address":[25439183],"length":1,"stats":{"Line":0}},{"line":32,"address":[25439212],"length":1,"stats":{"Line":0}},{"line":33,"address":[25439241],"length":1,"stats":{"Line":0}},{"line":34,"address":[25439270],"length":1,"stats":{"Line":0}},{"line":35,"address":[25439299],"length":1,"stats":{"Line":0}},{"line":36,"address":[25439328],"length":1,"stats":{"Line":0}},{"line":37,"address":[25439357],"length":1,"stats":{"Line":0}},{"line":38,"address":[25439386],"length":1,"stats":{"Line":0}},{"line":42,"address":[25438960,25438954,25438352],"length":1,"stats":{"Line":0}},{"line":43,"address":[25438460,25438366],"length":1,"stats":{"Line":0}},{"line":44,"address":[25438476,25438542],"length":1,"stats":{"Line":0}},{"line":45,"address":[25438519,25438595,25438556],"length":1,"stats":{"Line":0}},{"line":46,"address":[25438572,25438609,25438648],"length":1,"stats":{"Line":0}},{"line":47,"address":[25438701,25438662,25438625],"length":1,"stats":{"Line":0}},{"line":48,"address":[25438678,25438715,25438754],"length":1,"stats":{"Line":0}},{"line":49,"address":[25438768,25438731,25438807],"length":1,"stats":{"Line":0}},{"line":50,"address":[25438818,25438857,25438784],"length":1,"stats":{"Line":0}},{"line":51,"address":[25438868,25438834,25438906],"length":1,"stats":{"Line":0}},{"line":52,"address":[25438884,25438916,25438929],"length":1,"stats":{"Line":0}},{"line":53,"address":[25438922],"length":1,"stats":{"Line":0}},{"line":66,"address":[25439440],"length":1,"stats":{"Line":0}},{"line":67,"address":[25437908,25438270,25437264],"length":1,"stats":{"Line":0}},{"line":69,"address":[25437295],"length":1,"stats":{"Line":0}},{"line":70,"address":[25437346,25437533,25437414],"length":1,"stats":{"Line":0}},{"line":73,"address":[25437623,25437552],"length":1,"stats":{"Line":0}},{"line":74,"address":[25437686,25437768],"length":1,"stats":{"Line":0}},{"line":77,"address":[25437748,25437924],"length":1,"stats":{"Line":0}},{"line":78,"address":[25438058],"length":1,"stats":{"Line":0}},{"line":80,"address":[25437980],"length":1,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":118}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      },
    };
  });

  return [...folders, ...files.filter(file => file.path.length === 1)];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener('hashchange', () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.slice(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(
      ({current}) => {
        return {current: [...current, file.path[0]]};
      },
      () => this.updateHash(),
    );
  }

  back(file) {
    this.setState(
      ({current}) => {
        return {current: current.slice(0, current.length - 1)};
      },
      () => this.updateHash(),
    );
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e(
    'div',
    {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e(
      'table',
      {className: 'files-list'},
      e('thead', {className: 'files-list__head'}, e('tr', null, e('th', null, 'Path'), e('th', null, 'Coverage'))),
      e(
        'tbody',
        {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile})),
      ),
    ),
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? (file.covered / file.coverable) * 100 : -1;
  const coverageDelta =
    file.prevRun && (file.covered / file.coverable) * 100 - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'tr',
    {
      className:
        'files-list__file' +
        (coverage >= 0 && coverage < 50 ? ' files-list__file_low' : '') +
        (coverage >= 50 && coverage < 80 ? ' files-list__file_medium' : '') +
        (coverage >= 80 ? ' files-list__file_high' : '') +
        (file.is_folder ? ' files-list__file_folder' : ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e(
      'td',
      null,
      file.covered + ' / ' + file.coverable + (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
    ),
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'}, e(FileHeader, {file, onBack}), e(FileContent, {file}));
}

function FileHeader({file, onBack}) {
  const coverage = (file.covered / file.coverable) * 100;
  const coverageDelta = file.prevRun && coverage - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'div',
    {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e(
      'div',
      {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable + (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
      e('input', {id: 'theme-toggle', type: 'checkbox', hidden: true}),
      e('label', {for: 'theme-toggle', id: 'theme-toggle-label'}, '🌙'),
    ),
  );
}

function FileContent({file}) {
  return e(
    'pre',
    {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      const nbHit = covered? trace.stats.Line: 0;
      return e(
        'div',
        { className: 'code-text-container' },
        e(
          'code',
          {
            className: 'code-line' + (covered ? ' code-line_covered' : '') + (uncovered ? ' code-line_uncovered' : ''),
          },
          line
        ),
        e(
          'div',
          { className: 'cover-indicator' + (covered? ' check-cover': '') + (uncovered? ' no-cover': '')},
          e(
            'div',
            { className: (covered? 'stat-line-hit': '')},
            covered? nbHit: ""
          )
        )
      );
    }),
  );
}

(function () {
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData &&
    previousData.files.forEach(file => {
      const path = file.path.slice(commonPath.length).join('/');
      prevFilesMap.set(path, file);
    });

  const files = data.files.map(file => {
    const path = file.path.slice(commonPath.length);
    const {covered = 0, coverable = 0} = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: {covered, coverable},
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    },
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));

  const toggle = document.getElementById('theme-toggle');
  const label = document.getElementById('theme-toggle-label');
  label.textContent = '🌙';

  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      document.documentElement.setAttribute('data-theme', 'dark');
      label.textContent = '☀️';
    } else {
      document.documentElement.removeAttribute('data-theme');
      label.textContent = '🌙';
    }
  });
})();
</script>
</body>
</html>